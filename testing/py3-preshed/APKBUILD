# Contributor: Oleg Titov <oleg.titov@gmail.com>
# Maintainer: Oleg Titov <oleg.titov@gmail.com>
pkgname=py3-preshed
pkgver=2.0.1
pkgrel=0
pkgdesc="Cython hash tables that assume keys are pre-hashed"
url="https://github.com/explosion/preshed"
arch="all"
license="MIT"
depends="python3 py3-cymem"
makedepends="python3-dev py3-setuptools cython3"
checkdepends="py3-pytest py3-tox"
subpackages="$pkgname-doc"
source="preshed-$pkgver.tar.gz::https://github.com/explosion/preshed/archive/v$pkgver.tar.gz
tox.ini"
builddir="$srcdir/preshed-$pkgver"

build() {
	python3 setup.py build
}

check() {
	python3 setup.py install --root="$PWD/tmp_install"

	cd tmp_install/usr/lib/python3.7/site-packages

	PYTHONPATH="$PWD/tmp_install/usr/lib/python3.7/site-packages:$PYTHONPATH" \
		pytest-3 preshed

#cp "$srcdir"/tox.ini "$builddir"
#tox -e python3.7
}

package() {
	python3 setup.py install --prefix=/usr --root="$pkgdir"

	install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
	install -Dm644 README.rst "$pkgdir/usr/share/doc/$pkgname/README.rst"
}

sha512sums="28ee0267dbe922d456985d319fc5c5ba24e2f5ac2e4ac379b22914bf4dbb90f6cb05595f92d28a9707a881e92c5e1b2dcd48ff8f4a394f89901850af0a60a3b0  preshed-2.0.1.tar.gz
c964019b2f30d0ea062c8ab4076c557419a9594d13f0798e4e6e9a139e9649abc4111706e7696d7c127fef4a9c9425075e77f0dce2ca866296353819ac966e42  tox.ini"
