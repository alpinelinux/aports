# Maintainer: Stuart Cardall <developer@it-offshore.co.uk>
pkgname=logcheck-busybox
_pkgname=${pkgname/-busybox/}
pkgver=1.3.17
pkgrel=0
pkgdesc="Monitor log files for anomalies [patched to work with busybox builtin tools]"
url="http://packages.debian.org/source/sid/logcheck"
arch="noarch"
license="GPL"
depends="lockfile-progs perl-mime-construct"
install="$pkgname.pre-install"
subpackages="$pkgname-doc"
pkgusers="logcheck"
options="!check"
source="http://ftp.debian.org/debian/pool/main/l/logcheck/${_pkgname}_$pkgver.tar.xz
	logcheck.cron.d
	logcheck.cron.sample.d
	logcheck.initd
	00-busybox-compat.patch
	01-kernel_regex.patch
	02-sh-not-bash.patch
	"
builddir="$srcdir"/$_pkgname-$pkgver

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
	mkdir -p "$pkgdir"/var/lib/logcheck
	mkdir -p "$pkgdir"/var/lock/logcheck
	mkdir -p "$pkgdir"/usr/share/man/man8
	mkdir -p "$pkgdir"/usr/share/man/man1
	mkdir -p "$pkgdir"/usr/share/doc/logcheck

	install -D -m 755 "$srcdir"/logcheck.cron.d "$pkgdir"/etc/periodic/hourly/logcheck
	install -D -m 755 "$srcdir"/logcheck.initd "$pkgdir"/etc/init.d/logcheck
	install -D -m 644 "$srcdir"/logcheck.cron.sample.d "$pkgdir"/etc/logcheck/logcheck.cron.sample
	mv "$builddir"/docs/*.8 "$pkgdir"/usr/share/man/man8/
	mv "$builddir"/docs/*.1 "$pkgdir"/usr/share/man/man1/
	mv "$builddir"/docs/* "$pkgdir"/usr/share/doc/logcheck/

	rm -rf "$pkgdir"/var/lock # lockfile kept in /var/lib/logcheck => run as logcheck user
	chown -R $pkgusers "$pkgdir"/etc/logcheck "$pkgdir"/var/lib/logcheck
	chmod 750 "$pkgdir"/etc/logcheck
}

sha512sums="e4a30b6ccd7a9f0f51354b1a6e577f6a3837e3db078f61b3d3ceaf630a1f1eeae03324e6ec58307f8f723dbd017e1543c15f7dc34e50c0eeb9ee0b160b2c879d  logcheck_1.3.17.tar.xz
9f1ab5c161e816ed8e327197216737bf9c37784b2c4874b19aff1a45c5b2c1d3032b3f5053535b22de7e807ba5bb8232a5bff8a7e5abef6cba71e5b0ca1946fc  logcheck.cron.d
6eb2b86b110b18c6cc5f27637897f8d7a0021722b7f2662a04047c0e8e5a2058173ebb0d2794efe52b7d3b5bd82e971899a21a033d6ac93a19f78b57bdcbbf83  logcheck.cron.sample.d
f36b30255652bb944fc62c4f4ea7e3b3228d2220b37d910de5489b12b2a54d00dccc92eed94ca9d63314416c94903c8ba7366a943ab505150f55361f0ca0967f  logcheck.initd
b93465c6c1583c94a88d3fe808a8ef37ccdf12610a378872c05b614cc988c6184f7b233d8230b63881bc294a27aae2807df8429fbbdbe330532f363973aa9b15  00-busybox-compat.patch
f1269ea4692284095404aa84f1a5ba5c67c6233e5b6054618ae1ddb941dc6605f2df4bcfc875028634178ee3c7c15638a951e4de951ad5481d7cfab612636344  01-kernel_regex.patch
c2947555cfee113d09164b14ed6c975d28a16fcbad98feeceedad29963d02b5bc66f04ce23355459bb434996fa6d1353e3dfac52d79573c2ca7f1eee943c1816  02-sh-not-bash.patch"
