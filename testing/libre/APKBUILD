# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=libre
pkgver=4.4.0
pkgrel=0
pkgdesc="Portable library for real-time communications"
url="https://github.com/baresip/re"
arch="all"
license="BSD-3-Clause"
makedepends="openssl-dev zlib-dev cmake linux-headers samurai"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/baresip/re/archive/v$pkgver.tar.gz
disable-udp-test.patch"

builddir="$srcdir/re-$pkgver"

build() {
	cmake -B build -G Ninja -DCMAKE_BUILD_TYPE='None' -DCMAKE_INSTALL_PREFIX='/usr' -Wno-dev
	cmake --build build
}

check() {
	cmake --build build --parallel -t retest
		build/test/retest -rv
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
69110578a0a086efe55ea61d98882a352aad4ce35fd522b99f990156c946c5b9f89bf516dadf3ace47c126866cd4afb2121e9ffe3b1de93d41d2f084150f76d5  libre-4.4.0.tar.gz
00c32f980ff9ba5e8da9d46abcfd31ec59880acd1ea88ef3a61b3c71f1929cc47da046427e9bac0d398091401de48522705d0754b92e4f03fde36bd4fd5d5c81  disable-udp-test.patch
"
