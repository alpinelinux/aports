# Contributor: Olliver Schinagl <oliver@schinagl.nl>
# Maintainer: Olliver Schinagl <oliver@schinagl.nl>
pkgname=openv2g
pkgver=0.9.4
pkgrel=4
pkgdesc="Implements ISO IEC 15118 and also the DIN 70121 vehicle to grid (V2G) communication interface"
url="https://openv2g.org/"
arch="all"
license="LGPL-3.0-or-later"
options="!check" # No tests available
subpackages="lib$pkgname:libs lib$pkgname-dev"
source="
	0001-Enable-XMLDSIG-codec-support.patch
	0002-Violate-the-spec-less-by-downgrading-to-ASCII-for-UT.patch
	makefiles.patch
	${pkgname}.pc.in
	$pkgname-$pkgver.zip::https://downloads.sourceforge.net/sourceforge/openv2g/OpenV2G_$pkgver.zip
"

unpack() {
	mkdir -p "$builddir"
	unzip "$srcdir/$pkgname-$pkgver.zip" -d "$builddir"
	# To ensure patches can be applied, convert the \r\n code-base first.
	find "$builddir" -type f -exec dos2unix '{}' \;
}

build() {
	cd Release
	make

	sed \
	    -e "s|@PKGVER@|${pkgver}|g" \
	    "${srcdir}/${pkgname}.pc.in" > "${builddir}/${pkgname}.pc"

}

package() {
	depends="lib$pkgname"
	cd Release
	make DESTDIR="$pkgdir/usr" install

	install -D -m 0644 -t "${pkgdir}/usr/lib/pkgconfig/" \
	        "${builddir}/${pkgname}.pc"
}

sha512sums="0d055188801e0724b78f935bd3de72ad7b673dab894577f255eb895a4871f1e775476adf6c55427c293e85f488140cad51d7ce85a626dbba6bb87c96a3866064  0001-Enable-XMLDSIG-codec-support.patch
6737110c91830f9d93fbce1cc54a73d0a86d12ddefb69cbe1a91ffdb478626b0aa8d0ccdc3392fd2213747a5eef5da948a0249e9e3c8844953d36118dc28425c  0002-Violate-the-spec-less-by-downgrading-to-ASCII-for-UT.patch
d19033d7a42503c11e8d59518896a14d31da0aed2f60707e6eaafe72cc818a4650c2001989a8f260b0656f6271a4c044e109bac8af419b9d0ef5c87924eb372f  makefiles.patch
94d1f15c33ae7327d76320d5ba35febd6068393e70667729953edfc3a54eb1dc91513bec8abf11b14b53154594746123cca8db00cb31d5a5d139b38054d8a986  openv2g.pc.in
0fe088bc3ae0f0dc6af8c9c3a989301e5e155a9406b80cb9025ceb5b548dc94202dde37993711c589fac6eddf626897c7ef003b73e01cb1c5b20b7b73365b930  openv2g-0.9.4.zip"
