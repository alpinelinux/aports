# Maintainer: Marcel Esser <marcel.esser@gmail.com>
pkgname=py3-pillow-simd
_pkgname=Pillow-SIMD
pkgver=6.0.0
pkgrel=0
_pypi_rel=0 # rare pypi "post-release" version used by this project
pkgdesc="Python Imaging Library SIMD"
url="https://github.com/uploadcare/pillow-simd"
arch="x86_64"
license="PSF"
depends="py3-olefile freetype jpeg libwebp tiff libpng lcms2 libjpeg-turbo zlib"
makedepends="python3-dev py3-setuptools freetype-dev jpeg-dev libwebp-dev
	tiff-dev libpng-dev lcms2-dev libjpeg-turbo-dev zlib-dev"
subpackages="py3-${_pkgname#py-}:_py3"
source="https://files.pythonhosted.org/packages/source/${_pkgname:0:1}/$_pkgname/$_pkgname-$pkgver.post$_pypi_rel.tar.gz"
builddir="$srcdir/$_pkgname-$pkgver.post0"
options="!check" # Unknown if test host has necessary SSE4 extensions.

build() {
	cd "$builddir"
	# zlib resides in lib
	export CFLAGS="$CFLAGS -L/lib"
	python3 setup.py build
}

package() {
	mkdir -p "$pkgdir"
}

_py3() {
	pkgdesc="$pkgdesc (for python3)"
	install_if="$pkgname=$pkgver-r$pkgrel python3"

	cd "$builddir"
	python3 setup.py install --prefix=/usr --root="$subpkgdir"
}

sha512sums="792b0bbc6a2e72cd7277f76703f87c94aec27cd9ad7f4891dc32cbfa684cd3031b64618550995177daa0c4729beeb6e0802d06e41a1f22c2f783f736e02a3d44  Pillow-SIMD-6.0.0.post0.tar.gz"
