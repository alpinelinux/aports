# Developer: Frank DENIS <j at pureftpd.org>
# Maintainer: Timofey Bychkov <boobooin@gmail.com>
pkgname=libpuzzle
subpackages="$pkgname-doc"
pkgver=0.11
pkgrel=0
pkgdesc="The Puzzle library is designed to find visually similar images."
url="http://libpuzzle.pureftpd.org/project/libpuzzle"
arch="all"
license="BSD-2-Clause"
depends="libgd"
makedepends="gd-dev"
source="https://download.pureftpd.org/pub/pure-ftpd/misc/libpuzzle/releases/libpuzzle-$pkgver.tar.gz"
builddir="$srcdir/$pkgname-$pkgver"
options="!check" # Libpuzzle was developed on OpenBSD, and one of the tests doesn't pass because floating point numbers are rounded differently on Linux. It has no implications on usage.

build() {
	cd "$builddir"
	./configure --prefix=/usr
	make
}

package() {
	install -d "$pkgdir"
	install -d "$pkgdir"/usr/bin/
	install -d "$pkgdir"/usr/include/
	install -d "$pkgdir"/usr/lib/

	cd "$builddir"

	install -t "$pkgdir"/usr/bin/ ./src/.libs/puzzle-diff	
	install -t "$pkgdir"/usr/include/ ./src/puzzle.h
	install -t "$pkgdir"/usr/lib/ ./src/.libs/libpuzzle.so.1.0.0
	ln -s libpuzzle.so.1.0.0 "$pkgdir"/usr/lib/libpuzzle.so.1
	ln -s libpuzzle.so.1 "$pkgdir"/usr/lib/libpuzzle.so
}

doc() {
	install -d "$subpkgdir"
	install -d "$subpkgdir"/usr/share/man/man3/
	install -d "$subpkgdir"/usr/share/man/man8/
	install -d "$subpkgdir"/usr/share/doc/"$pkgname"-"$pkgver"/

	cd "$builddir"
	install -Dm644 README README-PHP php/libpuzzle/CREDITS php/libpuzzle/LICENSE "$subpkgdir"/usr/share/doc/"$pkgname"-"$pkgver"/

	cd "$builddir"/man
	gzip puzzle_set.3 libpuzzle.3 puzzle-diff.8
	install -Dm644 puzzle_set.3.gz libpuzzle.3.gz "$subpkgdir"/usr/share/man/man3/
	install -Dm644 puzzle-diff.8.gz "$subpkgdir"/usr/share/man/man8/
}

sha512sums="632d890e0acff5aab2846f0a79964c3dbe3a70a142a27409ede2ef139103d2348d0237d59f7b5728a0327a9a7f4a2141093058bba68d7a7bc6755f8292113403  libpuzzle-0.11.tar.gz"
