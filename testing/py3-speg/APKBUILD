# Contributor: John Vogel <jvogel@stygian.me>
# Maintainer: John Vogel <jvogel@stygian.me>
maintainer="John Vogel <jvogel@stygian.me>"
pkgname=py3-speg
_pkgname=speg
pkgver=0.3_git20180819
pkgrel=0
_commit=877acddfd5ac5ae8b4a4592d045e74e108477643
pkgdesc="A PEG-based parser interpreter with memoization"
url="https://github.com/avakar/speg"
arch="all"
license="MIT"
depends="python3"
makedepends="py3-gpep517 py3-setuptools"
checkdepends="py3-pytest"
subpackages="$pkgname-doc $pkgname-pyc"
source="$_pkgname-$_commit.tar.gz::https://github.com/avakar/speg/archive/$_commit/speg-$_commit.tar.gz
	remove-six.patch
	"
builddir="$srcdir/$_pkgname-$_commit"

build() {
	gpep517 build-wheel \
		--wheel-dir .dist \
		--output-fd 3 3>&1 >&2
}

check() {
	python3 -m venv --clear --without-pip --system-site-packages .testenv
	.testenv/bin/python3 -m installer .dist/*.whl
	.testenv/bin/python3 -m pytest
}

package() {
	python3 -m installer -d "$pkgdir" .dist/*.whl
	install -Dm644 -t "$pkgdir/usr/share/doc/$pkgname" README.md
}

sha512sums="
01f0913a59b0a3b32c72c937f948508e303121bd35a8d057f1c043ab77a8b5c3a63b696f5aa8a6bf300901131ae56f50d187e7259dcc7bbaf4d1368e6bdd8bb1  speg-877acddfd5ac5ae8b4a4592d045e74e108477643.tar.gz
ea92038875672289099797d4ff40a44ce070e5ca4b8a3697cd73b6aafd903a31b9bc9f48bf29d9d773c3e9765517c0b2bf55047431dfdf69a2d58add6f56a64c  remove-six.patch
"
