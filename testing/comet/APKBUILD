# Contributor: Joshua Murphy <joshuamurphy@posteo.net>
maintainer="Joshua Murphy <joshuamurphy@posteo.net>"
pkgname=comet
pkgver=0.3.1
pkgrel=0
_proto=923e8a0008603365d29002db611559190da5bf99
pkgdesc="Open Source implementation of GOG Galaxy's Communication Service"
url="https://github.com/imLinguin/comet"
arch="all"
license="Apache-2.0"
makedepends="
	cargo
	cargo-auditable
	protoc
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/imLinguin/comet/archive/v$pkgver.tar.gz
	proto-$_proto.tar.gz::https://github.com/Yepoleb/gog_protocols/archive/$_proto.tar.gz
	protoc.patch
	"
options="!check net" # no tests, net for cargo

prepare() {
	default_prepare

	rmdir proto
	ln -sfv "$srcdir"/gog_protocols-$_proto proto

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --frozen --release
}

package() {
	install -Dm755 target/release/comet "$pkgdir"/usr/bin/comet
}

sha512sums="
8a35e2d0998af5299f10038c9bd0079de32f7b591ca271ca5270de2f4b4b6c240d64a07b1b96d2e0b8b8ab876c25fb351e33d6ce05432e9bd1335d4ee6fdbcc4  comet-0.3.1.tar.gz
12ec7a44aab54871483dc061cfe9166370325132a16d7f90edd297da64f6844b3dac0eade8ddaf2a786d7754912be8fa5166222235880505cbba6e9e0594fd28  proto-923e8a0008603365d29002db611559190da5bf99.tar.gz
2ca59aeebc608fd5a36b469243fa6b718e6cb9d26a67022d6dd6fea0fdd90dc59bc03ad66ab10f1d9a2129dc19c89a0f4f97bd00696808c506275fd047945807  protoc.patch
"
