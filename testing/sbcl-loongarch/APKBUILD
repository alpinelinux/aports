# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=sbcl-loongarch
pkgver=2.6.0_git20260120
_gitrev=2e0b93ae5ce33aad132663315bb3101257e9610d
pkgrel=0
pkgdesc="Steel Bank Common Lisp (for bootstrapping Loongarch)"
url="https://www.sbcl.org/"
arch="loongarch64"
license="custom"
makedepends="ecl-dev linux-headers"
source="https://github.com/sbcl/sbcl/archive/$_gitrev/sbcl-$_gitrev.tar.gz
	sigcontext.patch
	"
builddir="$srcdir/sbcl-$_gitrev"
options="!check" # stage0 compiler

prepare() {
	default_prepare

	if [ ! -f "version.lisp-expr" ]; then
		echo "\"${pkgver%%_git*}\"" > version.lisp-expr
	fi
}

build() {
	# sb-simd is only built on x86_64 for now,
	# and is not needed for bootstrapping sbcl.
	./make.sh ecl \
		--prefix=/usr \
		--without-sb-simd
}

package() {
	# omit docs for stage0 compiler
	BUILD_ROOT="$pkgdir" \
	MAN_DIR="/.omit" \
	INFO_DIR="/.omit" \
	DOC_DIR="/.omit" \
		./install.sh

	rm -rv "$pkgdir"/.omit
}

sha512sums="
1b6a0e169395fac8564c25475a0c8471a7669ee438fca8dcbe04d6e98d6339f918e2379419666bf4fdf0b26802ee2e951145bc69b1d5b84b3c90e4c283716ffb  sbcl-2e0b93ae5ce33aad132663315bb3101257e9610d.tar.gz
36c5efafcd15a4d05423b41204928f7e8c89378361c2a6fa8e1b59fa361296aa153c26b9245fd68da95b9851b2c1ec93ce390736ff30a29c2cc60dc737252096  sigcontext.patch
"
