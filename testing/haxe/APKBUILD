# Contributor: Jon Ong <jonongjs@rottenmage.com>
# Maintainer:
pkgname=haxe
pkgver=3.4.2
_pkgver_haxelib=3.3.0
_pkgver_ocamllibs=ea953db15a552e682b8dea83e7c98da343ae1d65
pkgrel=0
pkgdesc="Cross-platform toolkit and programming language"
url="http://haxe.org"
arch="x86_64"
license="GPL MIT LGPL" # http://haxe.org/foundation/open-source.html
depends=""
makedepends="camlp4 ocaml neko-dev zlib-dev pcre-dev"
options="!strip !makeflags"
install=""
subpackages="$pkgname-doc"
source="${pkgname}-${pkgver}.tar.gz::https://github.com/HaxeFoundation/haxe/archive/${pkgver}.tar.gz
	haxelib-${_pkgver_haxelib}.tar.gz::https://github.com/HaxeFoundation/haxelib/archive/${_pkgver_haxelib}.tar.gz
	https://github.com/HaxeFoundation/ocamllibs/archive/${_pkgver_ocamllibs}.tar.gz
	haxe.sh
	"
builddir="$srcdir/$pkgname-$pkgver"

build() {
	cd "$builddir"

	rmdir libs extra/haxelib_src
	mv "$srcdir"/haxelib-${_pkgver_haxelib} extra/haxelib_src
	mv "$srcdir"/ocamllibs-${_pkgver_ocamllibs} libs

	make -j1
	make -j1 tools
}

check() {
	cd "$builddir"
	./haxe -version
}

package() {
	cd "$builddir"
	install -d "$pkgdir"/usr/bin/ "$pkgdir"/usr/share/haxe/
	install -m 755 haxe haxelib "$pkgdir"/usr/bin/
	cp -rf std "$pkgdir"/usr/share/$pkgname/
	install -Dm 644 extra/LICENSE.txt "$pkgdir"/usr/share/licenses/$pkgname/LICENSE.txt
	install -Dm 644 "$srcdir/haxe.sh" "$pkgdir/etc/profile.d/haxe.sh"
}

sha512sums="b83b10062e927de12f727f52e3bbb9da9591bd8b8df8c2154150a747ac133f54e6d43413101e808435444bf43944ab889d3e03f8d1ce7a55fa0b07ad3d4b068c  haxe-3.4.2.tar.gz
04f4b4cd3c82750c79cdb54b1874ce4624791c4ef0c3e79fe929c39375e2aa70c244fa38cc0fd46b65fdbf0dbc711774618d28de1f66220ef6b56bc3b74021bf  haxelib-3.3.0.tar.gz
ca7e85bbf096d380fe2c6d3f5a33bc39e5992c7cf024e06fffafea5fd71eeb498ef64d8c2047d938ff48166bef1f3405d9586a3c3d108e4742d23cb8a726c910  ea953db15a552e682b8dea83e7c98da343ae1d65.tar.gz
c756571769bcdb0d7040b44b3d486e445c56a01a8d23d26f668be19b8d147e9f324166f004872d04e912f329e45ad821672a0a365df4ba27fb1dc22bb34130a3  haxe.sh"
