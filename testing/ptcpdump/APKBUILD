# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=ptcpdump
pkgver=0.37.0
pkgrel=1
pkgdesc="Process-aware, eBPF-based tcpdump"
url="https://github.com/mozillazg/ptcpdump"
arch="x86_64"
license="MIT"
options="!check net"
makedepends="libpcap-dev go clang"
source="$pkgname-$pkgver.tar.gz::https://github.com/mozillazg/ptcpdump/archive/refs/tags/v$pkgver.tar.gz"

build() {
	export LDFLAGS="-linkmode external -extldflags -static"
	export LDFLAGS="$LDFLAGS -X github.com/mozillazg/ptcpdump/internal.Version=$pkgver"
	TARGET=amd64 go generate ./...
	CGO_ENABLED=1 go build -ldflags "$LDFLAGS"
}

package() {
	install -Dm755 ptcpdump -t "$pkgdir"/usr/sbin/
}

sha512sums="
7cd06a90d4bc5f88fa0521a687001634bf17491ba54bced23fd6c850909d7f32aa798069f9a5e2710b60c4d4f75f7404a70aa54795fdff0bd5c890c96b59772c  ptcpdump-0.37.0.tar.gz
"
