# Contributor: kpcyrd <git@rxv.cc>
# Maintainer: kpcyrd <git@rxv.cc>
pkgname=cargo-cyclonedx
pkgver=0.5.7
pkgrel=0
pkgdesc="Creates CycloneDX Software Bill of Materials (SBOM) from Rust (Cargo) projects"
url="https://github.com/CycloneDX/cyclonedx-rust-cargo"
arch="all"
license="Apache-2.0"
makedepends="
	cargo
	cargo-auditable
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/CycloneDX/cyclonedx-rust-cargo/archive/cargo-cyclonedx-$pkgver.tar.gz
		libc-0.2.180.patch::https://github.com/CycloneDX/cyclonedx-rust-cargo/pull/815/commits/dc3d6fdaf6eacbbc4b891091e086e69fd7a5e4fc.diff"
builddir="$srcdir/cyclonedx-rust-cargo-$pkgname-$pkgver"
options="net"

prepare() {
	default_prepare

	cargo fetch --target="$CHOST" --locked
}

build() {
	cargo auditable build --release --frozen -p "$pkgname"
}

check() {
	cargo test --frozen -- --skip ui
}

package() {
	install -Dm755 "$builddir/target/release/cargo-cyclonedx" -t "$pkgdir/usr/bin"
}

sha512sums="
62cf69c7a51903be072f52fe17d2d4fd6f30e26fa9f75436aa3f56997458cc044733a9b54d3f3a68481d7d672a91da64e648ded0d7646535ad07a96cb2e9ca74  cargo-cyclonedx-0.5.7.tar.gz
478fe92fb6f930f1b74ef6e33e92486129b7bc5589b164c81e91ca6342b3fb6111e17d8b2eea2a19d3ce9d65c5eb4f4664f5bdab844ee780f3d9490247d1a3d1  libc-0.2.180.patch
"
