diff --git a/Telegram/SourceFiles/ffmpeg/ffmpeg_utility.cpp b/Telegram/SourceFiles/ffmpeg/ffmpeg_utility.cpp
index 5d0e50926..24b47e8c8 100644
--- a/Telegram/SourceFiles/ffmpeg/ffmpeg_utility.cpp
+++ b/Telegram/SourceFiles/ffmpeg/ffmpeg_utility.cpp
@@ -354,7 +354,41 @@ QImage CreateFrameStorage(QSize size) {
 		cleanupData);
 }
 
+QImage CreateFromData(const QImage & from, QImage::Format format){
+	const auto size = from.size();
+	const auto width = size.width();
+	const auto height = size.height();
+	const auto widthAlign = kAlignImageBy / kPixelBytesSize;
+	const auto neededWidth = width + ((width % widthAlign)
+		? (widthAlign - (width % widthAlign))
+		: 0);
+	const auto perLine = neededWidth * kPixelBytesSize;
+	const auto buffer = new uchar[perLine * height + kAlignImageBy];
+	memcpy(buffer, from.bits(), perLine * height + kAlignImageBy);
+	const auto cleanupData = reinterpret_cast<const void *>(buffer);
+	const auto address = reinterpret_cast<uintptr_t>(buffer);
+	const auto alignedBuffer = buffer + ((address % kAlignImageBy)
+		? (kAlignImageBy - (address % kAlignImageBy))
+		: 0);
+	return QImage(
+		alignedBuffer,
+		width,
+		height,
+		perLine,
+		format,
+		AlignedImageBufferCleanupHandler,
+		const_cast<void*>(cleanupData));
+}
+
 void UnPremultiply(QImage &to, const QImage &from) {
+	auto result = CreateFromData(from, QImage::Format_ARGB32_Premultiplied);
+	result = result.convertToFormat(QImage::Format_ARGB32);
+	to = CreateFromData(result, QImage::Format_ARGB32_Premultiplied);
+	return;
+
+        //// below is original tdesktop code, we shortcut them by using Qt public API
+        //// see https://github.com/telegramdesktop/tdesktop/issues/6219
+        /*
 	// This creates QImage::Format_ARGB32_Premultiplied, but we use it
 	// as an image in QImage::Format_ARGB32 format.
 	if (!GoodStorageForFrame(to, from.size())) {
@@ -387,9 +421,17 @@ void UnPremultiply(QImage &to, const QImage &from) {
 			layout,
 			nullptr);
 	}
+	*/
 }
 
 void PremultiplyInplace(QImage &image) {
+	image = CreateFromData(image, QImage::Format_ARGB32);
+	image = image.convertToFormat(QImage::Format_ARGB32_Premultiplied);
+	return;
+
+        //// below is original tdesktop code, we shortcut them by using Qt public API
+        //// see https://github.com/telegramdesktop/tdesktop/issues/6219
+        /*
 	const auto layout = &qPixelLayouts[QImage::Format_ARGB32];
 	const auto convert = layout->convertToARGB32PM;
 	const auto perLine = image.bytesPerLine();
@@ -413,6 +455,7 @@ void PremultiplyInplace(QImage &image) {
 			layout,
 			nullptr);
 	}
+	*/
 }
 
 } // namespace FFmpeg

