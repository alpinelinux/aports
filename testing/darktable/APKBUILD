# Contributor: Kevin Daudt <ops@ikke.info>
# Maintainer: Kevin Daudt <ops@ikke.info>
pkgname=darktable
pkgver=2.2.0_rc1
pkgrel=0
pkgdesc="an open source photography workflow application and raw developer"
url="https://www.darktable.org/"
arch="all !armhf"
license="GPL3"
depends="libxslt gtk+3.0 libgphoto2 libwebp lensfun librsvg sqlite curl jpeg
	 tiff lcms2 json-glib exiv2 lua5.2 pugixml colord colord-gtk openexr"
makedepends="cmake intltool gtk+3.0-dev libgphoto2-dev libwebp-dev
	     lensfun-dev librsvg-dev sqlite-dev curl-dev jpeg-dev tiff-dev
	     lcms2-dev json-glib-dev exiv2-dev lua5.2-dev pugixml-dev
	     colord-dev colord-gtk-dev openexr-dev"
subpackages="$pkgname-dbg $pkgname-doc $pkgname-lang"
source="https://github.com/darktable-org/darktable/releases/download/release-${pkgver/_/}/darktable-${pkgver/_/.}.tar.xz"
builddir="$srcdir/$pkgname-${pkgver/_/~}"

prepare() {
	cd "$builddir"
	mkdir -p build
}

build() {
	cd "$builddir/build"
	cmake -DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=Release \
		.. || return 1
	make
}

package() {
	cd "$builddir/build"
	make DESTDIR="$pkgdir" install
}

sha256sums="0612163b0020bc3326909f6d7f7cbd8cfb5cff59b8e0ed1a9e2a2aa17d8f308e  $pkgname-${pkgver/_/.}.tar.xz"
