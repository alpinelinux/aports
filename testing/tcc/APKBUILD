# Contributor: SÃ¶ren Tempel <soeren+alpine@soeren-tempel.net>
# Contributor: Hinata Yanagi <hinasssan@gmail.com>
# Maintainer: Hinata Yanagi <hinasssan@gmail.com>
pkgname=tcc
pkgver=2017.12.12
_commit=d348a9a51d32cece842b7885d27a411436d7887b
pkgrel=0
pkgdesc="Tiny C Compiler"
url="http://repo.or.cz/tinycc.git"
arch="all !ppc64le !s390x"
license="LGPL-2.1"
makedepends="texinfo"
options="!check" # test suite currently fails on the server
source="$pkgname-$pkgver.tar.gz::http://repo.or.cz/tinycc.git/snapshot/$_commit.tar.gz"
subpackages="$pkgname-doc"
builddir="$srcdir/tinycc-d348a9a"

build() {
        ./configure \
                --prefix=/usr \
                --config-musl
        make
}

check() {
        cd "$builddir"
        make test
}

package() {
        cd "$builddir"
        make DESTDIR="$pkgdir" install

        mkdir -p "$pkgdir"/usr/share/doc/$pkgname/
        install -m644 Changelog CodingStyle README TODO \
                "$pkgdir"/usr/share/doc/$pkgname/
}

sha512sums="6e5a10e89381aa10ecd6666d050458aef9ac7ee791ad7cba5f6a080ac59c3903007942d57c809544d533522105314646ef4758f4bf69aa3ffa5283bedde02f38  tcc-2017.12.12.tar.gz"
