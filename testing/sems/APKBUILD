# Contributor: Francesco Colista <francesco.colista@gmail.com>
# Maintainer: Francesco Colista <francesco.colista@gmail.com>
pkgname=sems
pkgver=1.1.1
pkgrel=2
pkgdesc="High performance, extensible media server for SIP (RFC3261) based VoIP  services"
url="http://iptel.org/sems/"
license="GPL-2"
depends="kamailio"
makedepends="python-dev openssl-dev lame-dev"
install=
subpackages=
source="http://ftp.iptel.org/pub/$pkgname/1.1/$pkgver/src/$pkgname-$pkgver.tar.gz
	0001-makefile-fail-on-errors.patch
	0002-include-headers.patch
	0003-cc-and-cflags.patch
	"

prepare() {
	cd "$srcdir"/$pkgname-$pkgver
	for i in "$srcdir"/*.patch; do
		[ -f "$i" ] || continue
		patch -p1 -i $i || return 1
	done

	sed -i -e 's:^cfg-target.*:cfg-target = $(cfg-dir):' \
		-e 's:^cfg-prefix.*:cfg-prefix = $(basedir):' \
		Makefile.defs \
		|| return 1
}


build() {
	cd "$srcdir"/$pkgname-$pkgver

	make PREFIX=/usr \
		cfg-dir=/etc/sems/ \
		CC="$CC" CXX="$CXX" \
		exclude_modules+="ivr examples py_sems speex gateway echo g722" \
		WITH_MPG123DECODER=no \
		|| return 1
}

package() {
	cd "$srcdir"/$pkgname-$pkgver
	make PREFIX=/usr \
		cfg-dir=/etc/sems/ \
		exclude_modules+="ivr examples py_sems speex gateway echo g722" \
		DESTDIR="$pkgdir" \
		WITH_MPG123DECODER=no \
		install || return 1

	# remove the 2 lines below (and this) if there is no init.d script
#	 install -m755 -D "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
#	 install -m644 -D "$srcdir"//$pkgname.confd "$pkgdir"/etc/conf.d/$pkgname
}

md5sums="4a6422d09ddadaf9eacd8cae8f0848d5  sems-1.1.1.tar.gz
f893ceef9295b593d2b1837a538b315a  0001-makefile-fail-on-errors.patch
3d217a6d217fa8704d108f23815d4b97  0002-include-headers.patch
0054e6ed7e11393e71204876179d3199  0003-cc-and-cflags.patch"
