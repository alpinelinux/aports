# Contributor: mekyt <hello@mek.yt>
# Maintainer: mekyt <hello@mek.yt>
pkgname=zulip-desktop
pkgver=5.12.2
pkgrel=0
pkgdesc="Desktop application for Zulip, an open source chat and collaborative software"
url="https://github.com/zulip/zulip-desktop"
# same as electron
arch="aarch64 x86_64"
license="Apache-2.0"
depends="
	electron
"
makedepends="
	electron-tasje
	nodejs
	npm
"
options="net !check"

source="
	$pkgname-$pkgver.tar.gz::https://github.com/zulip/zulip-desktop/archive/refs/tags/v$pkgver.tar.gz
	$pkgname
	$pkgname.desktop
"

build() {
	npm ci --ignore-scripts
	npx vite build
	npm prune --omit=dev --ignore-scripts

	tasje pack
}

package() {
	cd "$srcdir"

	install -Dm644 $pkgname.desktop "$pkgdir"/usr/share/applications/$pkgname.desktop
	install -Dm755 $pkgname "$pkgdir"/usr/bin/$pkgname

	cd "$builddir"

	install -Dm644 tasje_out/resources/app.asar "$pkgdir"/usr/lib/$pkgname/app.asar

	while read -r size; do
		install -Dm644 tasje_out/icons/$size.png "$pkgdir"/usr/share/icons/hicolor/$size/apps/zulip.png
	done < tasje_out/icons/size-list
}

sha512sums="
aa812270919272a3434ada6761076414797b6e94434407aaec35bac2855c7188f6070d9eec5b9213a92cfe15016185bdd4261dcc2bada999a6b1d788e678f157  zulip-desktop-5.12.2.tar.gz
9e2d8aa4cfde943c3d8827fb36511848902852f55fe8d6899c0097a0f15ad37e0c5f0e0b6d530cbfda2f6aacd5d77e4cfb5c2a4438ec34bf174bca41cb25a2a7  zulip-desktop
a893639364d2b972de7b29c7ea7399a79d818cf9dc0f3df7c6aaa9e349803fa187f7030c12ae81881f7f2eef9d2aecca22a9e1bf0b7198726a993ea6a5f368ed  zulip-desktop.desktop
"
