# Contributor: Amelia Clarke <selene@perilune.dev>
# Maintainer: Amelia Clarke <selene@perilune.dev>
pkgname=zelbar
pkgver=1.2.0
pkgrel=0
pkgdesc="Wayland status bar reading input from STDIN, inspired by lemonbar"
url="https://sr.ht/~novakane/zelbar"
arch="x86_64 aarch64" # limited by zig aport
license="GPL-3.0-only"
makedepends="
	fcft-dev
	pixman-dev
	pkgconf
	wayland-dev
	wayland-protocols
	zig
	"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://git.sr.ht/~novakane/zelbar/archive/v$pkgver.tar.gz"
builddir="$srcdir/$pkgname-v$pkgver"
options="net"

# We may want other than "baseline" for other targets, when enabled by zig
case "$CARCH" in
aarch64|x86_64) _cputarget=baseline ;;
esac

build() {
	DESTDIR="$builddir"/zig-out zig build \
		"${_cputarget:+-Dcpu="$_cputarget"}" \
		-Doptimize=ReleaseSafe \
		-Dpie=true \
		--prefix /usr install
}

check() {
	zig build test \
		"${_cputarget:+-Dcpu="$_cputarget"}" \
		-Doptimize=ReleaseSafe \
		-Dpie=true
}

package() {
	mkdir -p "$pkgdir"
	cp -R zig-out/* "$pkgdir"
}

sha512sums="
d8cfde950fb442fb98b4c22da26788a41caf4df4859066db26d27b6a987eb1c63a8b3a0d34142d0c75401cf691f659f0c70dd9558ed91468bd53de03db12566d  zelbar-1.2.0.tar.gz
"
