maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=81voltd
pkgver=1.1.0
pkgrel=0
pkgdesc="Server-side implementation of IMS Data service on QMI/QRTR"
url="https://gitlab.postmarketos.org/modem/81voltd"
arch="all"
license="GPL-2.0-or-later"
makedepends="
	libqmi-dev
	meson
	modemmanager-dev
	qmi-utils
	qrtr-dev
	"
subpackages="$pkgname-doc $pkgname-openrc $pkgname-systemd"
source="https://gitlab.postmarketos.org/modem/81voltd/-/archive/v$pkgver/81voltd-v$pkgver.tar.gz
	qrtr-pc.patch
	services.patch
	"
builddir="$srcdir/$pkgname-v$pkgver"

build() {
	abuild-meson \
		output .
	meson compile -C output
}

check() {
	meson test --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

sha512sums="
20a48208ed59078ce45942d81b01ebe55480e5078d2ccc8504cf85b9fd8ff2a13b081df59df227d6d8d37c57090149de71b6988ad02821a2db130de6b79b3f61  81voltd-v1.1.0.tar.gz
eb144dbe5919dc07431055639d55d17a2b8b75142602df9bead671202a9424a505d64e54234023a11e14df08faa8ae588edb25341e07258747f700f62b6aa6f6  qrtr-pc.patch
8e43821098fa937ac9646e8e7abddc7e24a6d4130e970b7219d486849061239b358567d90a696a357e328a476be12a917315058feb240e786230e7c6b5aa2fd3  services.patch
"
