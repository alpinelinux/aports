maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=valent
pkgver=1.0.0_alpha49
_pkgver=${pkgver/_alpha/.alpha.}
pkgrel=0
pkgdesc="Connect, control and sync devices"
url="https://valent.andyholmes.ca/"
arch="all !armhf" # libpeas2
license="GPL-3.0-or-later"
makedepends="
	desktop-file-utils
	evolution-data-server-dev
	glib-dev
	gnutls-dev
	gstreamer-dev
	json-glib-dev
	libpeas2-dev
	libphonenumber-dev
	libportal-dev
	meson
	pipewire-dev
	pulseaudio-dev
	tinysparql-dev
	vala
	"
subpackages="$pkgname-lang $pkgname-libs $pkgname-dev"
source="https://github.com/andyholmes/valent/releases/download/v$_pkgver/valent-$_pkgver.tar.xz"
builddir="$srcdir/$pkgname-$_pkgver"

build() {
	abuild-meson \
		output .
	meson compile -C output
}

check() {
	meson test --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

dev() {
	default_dev
	amove usr/lib/girepository-1.0
}

sha512sums="
5bc47b00b8893c1bb37a41fe84c8f9b0dca82d67389620cc72b6f55bf48f94d19b718c0357f3a3dc13c17d92507bd226f64d779b191b6e8bfb607699741ce18e  valent-1.0.0.alpha.49.tar.xz
"
