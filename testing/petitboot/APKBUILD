# Contributor: Julian Winkler <julian.winkler1@web.de>
# Maintainer: Jens Reidel <adrian@postmarketos.org>
pkgname=petitboot
pkgver=1.15
pkgrel=0
pkgdesc="Operating system bootloader based on Linux kexec"
url="https://github.com/open-power/petitboot"
arch="all"
license="GPL-2.0-only"
makedepends="
	bison
	elfutils-dev
	eudev-dev
	flex
	lvm2-dev
	musl-libintl
	ncurses-dev
	"
source="
	https://github.com/open-power/petitboot/releases/download/v$pkgver/petitboot-v$pkgver.tar.gz
	musl-gcc15.patch
	ui-Fix-compile-with-curses-opaque-menu-headers.patch
	"
subpackages="
	$pkgname-doc
	$pkgname-dbg
	"

builddir="$srcdir/$pkgname-v$pkgver"

build() {
	HOST_PROG_KEXEC=/usr/sbin/kexec ./configure --prefix=/usr
	make
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
48a47ad6b7715ed13eee1cd5b618eabe9726d22b2dc33aaa7c86f79e10edad792f5e6bb6a19327f4e395b1286df619ce2fb8e9e0a966f06621c8797a2c6277ea  petitboot-v1.15.tar.gz
e1f2d438b5970a61e8231e99e29edcb660e5f47c425c4480e7b4f6d8cbbddf5e8e9ae9f08c325c72467a3490a2a3f66f24af28df3309feeb0cb072c49ba0b71f  musl-gcc15.patch
1246d469c022009887aefd31312ae97986431444af6518629201dec34ade0c50c7013d0f0d5b8c89a0e8b2f50a9cd5ff73ed4142f8774bb8aa8707d8a720a22a  ui-Fix-compile-with-curses-opaque-menu-headers.patch
"
