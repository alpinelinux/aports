# Maintainer: omni <omni+alpine@hack.org>
maintainer="omni <omni+alpine@hack.org>"
pkgname=pinnacle
pkgver=0.2.3
pkgrel=0
pkgdesc="Smithay-based Wayland compositor, inspired by AwesomeWM, configured in Lua or Rust"
arch="x86_64" # others fail with: expected `[u8; 32]`, found `[i8; 32]`
url="https://pinnacle-comp.github.io/pinnacle/"
license="GPL-3.0-or-later"
makedepends="cargo cargo-auditable
	elogind-dev
	eudev-dev
	expat-dev
	libdisplay-info-dev
	libdrm-dev
	libinput-dev
	libseat-dev
	libxkbcommon-dev
	mesa-dev
	protoc
	"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/pinnacle-comp/pinnacle/archive/refs/tags/v$pkgver.tar.gz"

prepare() {
	default_prepare
	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen

	# cleanup wiki/ for -doc subpackage
	cd wiki && rm -r patches public versions \
		index.md ./*.json ./*.yaml
}

check() {
	./target/release/"$pkgname" --version
	# TODO: run some proper tests
	#cargo test --frozen
}

package() {
	install -Dm0755 -t "$pkgdir"/usr/bin/ target/release/"$pkgname"


	install -Dm0644 -t "$pkgdir"/usr/share/doc/"$pkgname"/ \
		README.md
	mv wiki/* "$pkgdir"/usr/share/doc/"$pkgname"/

}

sha512sums="
0d919ba85ddf6a9b55187af98925ce91eac0ab60e059cf7d39b159692c122c1b48ea4fdee91a2bd55c5f53bec360634bc4ad401a1481eb7b64000f0d4dcf9421  pinnacle-0.2.3.tar.gz
"
