# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Luca Weiss <luca@lucaweiss.eu>
pkgname=lomiri-api
pkgver=0.3.0
pkgrel=0
pkgdesc="API for Lomiri shell integration"
url="https://gitlab.com/ubports/development/core/lomiri-api"
arch="all"
license="LGPL-3.0-only"
depends_dev="
	gtest-dev
	qt5-qtdeclarative-dev
	"
makedepends="
	$depends_dev
	cmake
	cmake-extras
	gmock
	libqtdbustest
	samurai
	"
checkdepends="dbus"
source="https://gitlab.com/ubports/development/core/lomiri-api/-/archive/$pkgver/lomiri-api-$pkgver.tar.gz
	qmltestrunner.patch
	"
subpackages="$pkgname-dev"

build() {
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=ON \
		-DCMAKE_BUILD_TYPE=None
	cmake --build build
}

check() {
	ctest --test-dir build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
09a64280927345a20275b17145a3dda28a72b621972848050a2239126d62b9e6705118af5470cadbe9ce71111d35d10abba83ac8627710cc675544a5b6e79acd  lomiri-api-0.3.0.tar.gz
c4542f3cec7f933f070d0d1da44f70f97f6072906b057ae558a5a0fda3d29779be5fb8716b2b93a4276301c5a3751c74aef46d1c65a14268b6dcd93bf010b6c7  qmltestrunner.patch
"
