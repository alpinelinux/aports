# Contributor: Milan P. Stanić <mps@arvanta.net>
# Maintainer: Milan P. Stanić <mps@arvanta.net>
pkgname=opensbi-spacemit
# XXX: Updates require rebuilds of testin/u-boot-spacemit
pkgver=2.2.9
pkgrel=0
pkgdesc="risc-v open source supervisor binary interface for spacemit"
url="https://gitee.com/bianbu-linux/opensbi"
arch="riscv64"
license="BSD-2-Clause"
options="!check" # no tests
makedepends="bash dtc python3 u-boot-tools coreutils"

source="$pkgname-v$pkgver.tar.gz::https://gitee.com/bianbu-linux/opensbi/repository/archive/k1-bl-v$pkgver-release.tar.gz
	0001-remove-typedef-bool-becaause-bool-is-type-in-gcc-15.patch
	"

builddir=$srcdir/opensbi-k1-bl-v$pkgver-release

build() {
	make PLATFORM=generic PLATFORM_DEFCONFIG=k1_defconfig
}

package() {
	mkdir -p "$pkgdir"/usr/share/$pkgname
	cp $builddir/build/platform/generic/firmware/*itb "$pkgdir"/usr/share/$pkgname
	cp $builddir/build/platform/generic/firmware/*bin "$pkgdir"/usr/share/$pkgname
}

sha512sums="
0745f805b0003c7c0fbb64522a3d3854a1e6e8c777fde147dff629b893530a6a7fbefb17a8b7a475ca0beafcfe931dd43bfcf005f0ffc1a6d1ba0edddfc1ce5a  opensbi-spacemit-v2.2.9.tar.gz
13aceeb92fc2d4434672fd7d8ea4f6e9144579160cf858cbb107fcc61c50b8eba9c31914bc452c9a6b38447ca974267a2db16b41b539d51fb1742f876bc2c574  0001-remove-typedef-bool-becaause-bool-is-type-in-gcc-15.patch
"
