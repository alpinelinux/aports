# Contributer from Arch Linux : Kyle Keen <keenerd@gmail.com>
# Maintainer: Daniel YC Lin <dlin.tw@gmail.com>
# Contributer: Daniel YC Lin <dlin.tw@gmail.com>
pkgname=xombrero
pkgver=1.6.4
_pkgver=1_6_4
pkgrel=0
pkgdesc="A minimalists web browser, vi-like but with traditional web browser behavior."
arch='all'
url="https://github.com/conformal/xombrero"
license='custom:ISC'
depends='webkitgtk libbsd desktop-file-utils'
makedepends='webkitgtk-dev libbsd-dev groff'
subpackages="$pkgname-doc"
source="https://github.com/conformal/xombrero/archive/XOMBRERO_${_pkgver}.tar.gz
	LICENSE"
builddir="$srcdir/xombrero-XOMBRERO_$_pkgver"
prepare() {
	cd "$builddir"
	# no spam
	sed	-i 's|https://www.cyphertite.com|https://www.archlinux.org|' \
		xombrero.c xombrero.conf xombrero.h
	# relocations
	sed -i 's|/etc/ssl/cert.pem|/etc/ssl/certs/ca-certificates.crt|' xombrero.conf
	sed -i 's|/usr/local/share/|/usr/share/|' unix.c xombrero.conf xombrero.h
}

build() {
	cd "$builddir"
	make PREFIX="/usr" -C linux GTK_VERSION=gtk3
}

package() {
	cd "$builddir"

	mkdir -p "$pkgdir/usr/share/applications/"  # buggy makefile
	make PREFIX="/usr" DESTDIR="$pkgdir" install -C linux GTK_VERSION=gtk3
	install -Dm644 xombrero.conf     "$pkgdir/etc/skel/.xombrero.conf"
	install -Dm644 xombrero.desktop  "$pkgdir/usr/share/applications/xombrero.desktop"
	install -Dm755 config-checker.pl "$pkgdir/usr/bin/config-checker.pl"
	install -Dm644 "$srcdir/LICENSE" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
sha512sums="ab97cc3da7333eecaf409393e0067bf5a57c27e4b743bc41ab5fc8d35427e53112194e8ded3d48c4fee9b45124df7564bb44dd20527ca532cb6d037565d73f74  XOMBRERO_1_6_4.tar.gz
a4f5ed427562f92e44ecd0a3b21e24b61102c27665024642f5be5cb836bf3651ea1d2513fe20b93d1c1b41a7414a516d719b0c0595345cd159b84d9d84d659ad  LICENSE"
