# Contributor: Natanael Copa <ncopa@alpinelinux.org>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=qt-creator
pkgver=3.0.1
pkgrel=1
pkgdesc="Lightweight and cross-platform IDE for Qt"
url="https://qt-project.org/wiki/Category:Tools::QtCreator"
arch="all !aarch64 !ppc64le !s390x"
license="LGPL-2.0 with exceptions"
depends=""
depends_dev=""
makedepends="$depends_dev qt-dev qt-private-dev paxmark"
install=""
subpackages=""
ldpath="/usr/lib/qtcreator:/usr/lib/qtcreator/plugins/Nokia"
source="http://download.qt-project.org/official_releases/qtcreator/${pkgver%.*}/$pkgver/qt-creator-opensource-src-$pkgver.tar.gz
	qtcreator-arm.patch
	fix-headers-musl.patch
	fix-execinfo.patch
	qtcreator.desktop"

builddir="$srcdir"/qt-creator-opensource-src-$pkgver
prepare() {
	local i
	cd "$builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i;;
		esac
	done
}

build() {
	cd "$builddir"
	qmake -r IDE_LIBRARY_BASENAME=lib
	make CXX="${CXX:-g++}"
}

package() {
	cd "$builddir"
	make install INSTALL_ROOT="$pkgdir"/usr
	paxmark -m "$pkgdir"/usr/bin/qtcreator \
		"$pkgdir"/usr/bin/qmlpuppet
	install -Dm 644 "$srcdir"/qtcreator.desktop \
		"$pkgdir"/usr/share/applications/qtcreator.desktop
}

sha512sums="fa8b2c4196136b310127daf308a5a99b0ef39b2e25db83930f959a034418a08590edbe8e19e6afea02c1d647602bb49c96df8db156d24f6b9b9246c1a93ead19  qt-creator-opensource-src-3.0.1.tar.gz
b2d3a256db69512c693194234ff25d97ec58f19879b80d70d8fdac1f1f412aff1fddfe4d5fd0be98f77d7085d000aaa2ddb67cb1fe5d5a49be1d7fe8c95e7109  qtcreator-arm.patch
f523b9da264265a01c7e3c6c298c3ea2098b1d15baa16a38dee6b3bd5b696dff6a5b7d32040fee2ad1d88bec3119a4d83029714e88cd56f5fb8f725694a742e6  fix-headers-musl.patch
d145e037a7871a60309c0db70a30cbe1e7fac04756ff9445c8689cc56ac06838387db67ed8a3395200ecee0b7fd73108e3b5231b643f0eee6f9a02783f6278a8  fix-execinfo.patch
b694063d2c91bfcf1cad25845c32158f35b8659f03ab9beebbadd98d06f01324ceafca682c2145025f6155c4f1d86bcba3bdcae4f54d5b5d71fc813aaf129a48  qtcreator.desktop"
