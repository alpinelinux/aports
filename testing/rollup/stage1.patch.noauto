From 143db2050329908eaf94164bbb2b1812238bac83 Mon Sep 17 00:00:00 2001
From: LN Liberda <lauren@selfisekai.rocks>
Date: Tue, 20 Jan 2026 09:02:35 +0100
Subject: [PATCH] esbuild-able stage1

---
 cli/cli.ts                 | 7 +++----
 src/browser-entry.ts       | 2 +-
 src/node-entry.ts          | 2 +-
 src/rollup/rollup.ts       | 3 ++-
 src/utils/PluginContext.ts | 3 ++-
 src/utils/logger.ts        | 3 ++-
 6 files changed, 11 insertions(+), 9 deletions(-)

diff --git a/cli/cli.ts b/cli/cli.ts
index 87a9e3392..0152d7c7e 100644
--- a/cli/cli.ts
+++ b/cli/cli.ts
@@ -1,7 +1,6 @@
 #!/usr/bin/env node
-import help from 'help.md';
 import process from 'node:process';
-import { version } from 'package.json';
+import pkg from '../package.json' with {type:'json'};
 import argParser from 'yargs-parser';
 import { commandAliases } from '../src/utils/options/mergeOptions';
 import run from './run/index';
@@ -12,9 +11,9 @@ const command = argParser(process.argv.slice(2), {
 });
 
 if (command.help || (process.argv.length <= 2 && process.stdin.isTTY)) {
-	console.log(`\n${help}\n`);
+	console.log(`\n$\{help}\n`);
 } else if (command.version) {
-	console.log(`rollup v${version}`);
+	console.log(`rollup v${pkg.version}`);
 } else {
 	try {
 		// eslint-disable-next-line @typescript-eslint/no-require-imports
diff --git a/src/browser-entry.ts b/src/browser-entry.ts
index 0691094e6..dc86d8f3a 100644
--- a/src/browser-entry.ts
+++ b/src/browser-entry.ts
@@ -1,4 +1,4 @@
 import '../typings/package.json';
 
-export { version as VERSION } from 'package.json';
+export { version as VERSION } from '../package.json' with {type:'json'};
 export { defineConfig, default as rollup } from './rollup/rollup';
diff --git a/src/node-entry.ts b/src/node-entry.ts
index 865f5445b..9f553f068 100644
--- a/src/node-entry.ts
+++ b/src/node-entry.ts
@@ -1,3 +1,3 @@
-export { version as VERSION } from 'package.json';
+export { version as VERSION } from '../package.json' with {type:'json'};
 export { defineConfig, default as rollup } from './rollup/rollup';
 export { default as watch } from './watch/watch-proxy';
diff --git a/src/rollup/rollup.ts b/src/rollup/rollup.ts
index 824cba4f3..14725a891 100644
--- a/src/rollup/rollup.ts
+++ b/src/rollup/rollup.ts
@@ -1,4 +1,4 @@
-import { version as rollupVersion } from 'package.json';
+import pkg from '../../package.json' with {type:'json'};
 import Bundle from '../Bundle';
 import Graph from '../Graph';
 import { catchUnfinishedHookActions } from '../utils/hookActions';
@@ -37,6 +37,7 @@ import type {
 	RollupOutput,
 	RollupWatcher
 } from './types';
+const rollupVersion = pkg.version;
 
 // @ts-expect-error TS2540: the polyfill of `asyncDispose`.
 Symbol.asyncDispose ??= Symbol('Symbol.asyncDispose');
diff --git a/src/utils/PluginContext.ts b/src/utils/PluginContext.ts
index 7590b89bf..fb69bd939 100644
--- a/src/utils/PluginContext.ts
+++ b/src/utils/PluginContext.ts
@@ -1,4 +1,4 @@
-import { version as rollupVersion } from 'package.json';
+import pkg from '../../package.json' with {type:'json'};
 import type Graph from '../Graph';
 import type {
 	NormalizedInputOptions,
@@ -16,6 +16,7 @@ import { normalizeLog } from './options/options';
 import { parseAst } from './parseAst';
 import { createPluginCache, getCacheForUncacheablePlugin, NO_CACHE } from './PluginCache';
 import { ANONYMOUS_OUTPUT_PLUGIN_PREFIX, ANONYMOUS_PLUGIN_PREFIX } from './pluginNames';
+const rollupVersion = pkg.version;
 
 export function getPluginContext(
 	plugin: Plugin,
diff --git a/src/utils/logger.ts b/src/utils/logger.ts
index f03229a8d..238ab39ea 100644
--- a/src/utils/logger.ts
+++ b/src/utils/logger.ts
@@ -1,4 +1,4 @@
-import { version as rollupVersion } from 'package.json';
+import pkg from '../../package.json' with {type:'json'};
 import type {
 	LoggingFunction,
 	LogHandler,
@@ -13,6 +13,7 @@ import { doNothing } from './doNothing';
 import { LOGLEVEL_DEBUG, LOGLEVEL_INFO, LOGLEVEL_WARN, logLevelPriority } from './logging';
 import { augmentLogMessage, error } from './logs';
 import { normalizeLog } from './options/options';
+const rollupVersion = pkg.version;
 
 export function getLogger(
 	plugins: Plugin[],
