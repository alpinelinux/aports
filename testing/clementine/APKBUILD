# Contributor: knuxify <knuxify@gmail.com>
# Maintainer: Liliana <me@iodomi.eu>
pkgname=clementine
pkgver=1.4.1_git20260109
pkgrel=1
_tag=1.4.1-60-g1a3e8b56f
pkgdesc="A modern music player and library organizer"
url="https://www.clementine-player.org/"
arch="all"
license="GPL-3.0-or-later"
depends="gst-plugins-good"
makedepends="alsa-lib-dev
	boost-dev
	chromaprint-dev
	cmake
	fftw-dev
	glib-dev
	glu-dev
	gst-plugins-base-dev
	gstreamer-dev
	gtest-dev
	libcdio-dev
	libgpod-dev
	liblastfm-qt-dev
	libmtp-dev
	libmygpo-qt-dev
	libx11-dev
	projectm-dev
	protobuf-dev
	pulseaudio-dev
	qt5-qtbase-dev
	qt5-qttools-dev
	qt5-qtx11extras-dev
	samurai
	sparsehash
	taglib-dev
"
checkdepends="gtest-dev"
source="
	https://github.com/clementine-player/Clementine/releases/download/$_tag/clementine-$_tag.tar.xz
	cmake-4.patch
	"
builddir="$srcdir/clementine-$_tag"

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		CMAKE_CROSSOPTS="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_CXX_FLAGS="$CXXFLAGS -std=c++17 -Wno-error=format" \
		-DCMAKE_POLICY_VERSION_MINIMUM=3.5 \
		-DBUNDLE_PROJECTM_PRESETS=OFF \
		-DUSE_SYSTEM_PROJECTM=ON \
		-DUSE_SYSTEM_TAGLIB=ON \
		-DBUILD_WERROR=OFF \
		-DFORCE_GIT_REVISION="$_tag" \
		$CMAKE_CROSSOPTS
	cmake --build build
	cmake --build build --target build_tests
}

check() {
	cd "$builddir"/build/tests
	for test in *_test; do
		./$test
	done
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
725c1998505b08ca97481573fd991a3b1fa54a0fd0015d738f149838a457e733712886c617e9fc08510fdc486338d4322d4c5a2e362c87f1106b9eacb1f3627d  clementine-1.4.1-60-g1a3e8b56f.tar.xz
bedf64cd1780c974f18663d383f747c7c22e5d3c7d3c10c663883554bac9ce1b8a41d9d79460b9275d773fa5c75045ed1e46073fe1ebc9fdfcd06304b23639ad  cmake-4.patch
"
