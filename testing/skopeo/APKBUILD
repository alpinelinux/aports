# Contributor: Ed Robinson <ed@reevoo.com>
# Maintainer: Ed Robinson <ed@reevoo.com>
pkgname=skopeo
pkgver=0.1.23
pkgrel=0
pkgdesc="Work with remote images registries - retrieving information, images, signing content"
url="https://github.com/projectatomic/skopeo"
arch="all"
license="ASL 2.0"
makedepends="go btrfs-progs-dev gnupg gpgme-dev ostree-dev lvm2-dev bash"
source="$pkgname-$pkgver.tar.gz::https://github.com/projectatomic/$pkgname/archive/v$pkgver.tar.gz"
builddir="$srcdir"/$pkgname-$pkgver
subpackages=$pkgname-doc

prepare() {
	default_prepare
	export GOPATH="$(pwd)/_gopath"
	_projectatomic="${GOPATH}/src/github.com/projectatomic"
	mkdir -vp ${_projectatomic}
	ln -vsf ${builddir} ${_projectatomic}/${pkgname}
}

build() {
	cd ${_projectatomic}/${pkgname}
	make binary-local
}

package() {
	cd "$builddir"
	install -Dm755 skopeo "$pkgdir"/usr/bin/skopeo
}

doc () {
	cd "$builddir"
	install -Dm644 LICENSE "$subpkgdir"/usr/share/licenses/$pkgname/LICENSE
}

check() {
	cd "$builddir"
	./skopeo -v
}

sha512sums="5711ff8829e7c444b64054f38ace85591da54a50aaa7c605c443ba9cc72e1f623f0eb4fb747e3d29eebb19d41f04024452d3b4921efa71d5260595fb2f7722f4  skopeo-0.1.23.tar.gz"
