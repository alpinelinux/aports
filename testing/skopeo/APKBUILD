# Contributor: Ed Robinson <ed@reevoo.com>
# Maintainer: Ed Robinson <ed@reevoo.com>
pkgname=skopeo
pkgver=0.1.28
pkgrel=0
pkgdesc="Work with remote images registries - retrieving information, images, signing content"
url="https://github.com/projectatomic/skopeo"
arch="all"
license="ASL 2.0"
makedepends="go btrfs-progs-dev gnupg gpgme-dev ostree-dev lvm2-dev bash libselinux-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/projectatomic/$pkgname/archive/v$pkgver.tar.gz"
builddir="$srcdir"/$pkgname-$pkgver
subpackages=$pkgname-doc

prepare() {
	default_prepare
	export GOPATH="$(pwd)/_gopath"
	_projectatomic="${GOPATH}/src/github.com/projectatomic"
	mkdir -vp ${_projectatomic}
	ln -vsf ${builddir} ${_projectatomic}/${pkgname}
}

build() {
	cd ${_projectatomic}/${pkgname}
	make binary-local
}

package() {
	cd "$builddir"
	install -Dm755 skopeo "$pkgdir"/usr/bin/skopeo
}

doc () {
	cd "$builddir"
	install -Dm644 LICENSE "$subpkgdir"/usr/share/licenses/$pkgname/LICENSE
}

check() {
	cd "$builddir"
	./skopeo -v
}

sha512sums="fcc7a75607a4caac557db6f6d448923c1719c05fbefde069f9c24dca007e4d51c559f6dfecdfa62f73e9a0f804ed71f9e7be19c1b043dd8ff700df23606c013c  skopeo-0.1.28.tar.gz"
