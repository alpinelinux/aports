# Contributor: SÃ¶ren Tempel <soeren+alpine@soeren-tempel.net>
# Contributor: stef <l0ls0fo2i@ctrlc.hu>
# Contributor: Eivind Uggedal <eu@eju.no>
# Maintainer:
pkgname=mu
pkgver=1.2
_pkgver=1.2.0
pkgrel=0
pkgdesc="A collection of utilities for indexing and searching Maildirs"
arch="x86 x86_64 ppc64le"
url="http://www.djcbsoftware.nl/code/mu"
license="GPL-3.0"
depends="sqlite"
makedepends="xapian-core-dev gmime-dev sqlite-dev emacs autoconf automake
	libtool"
subpackages="$pkgname-doc mu4e"
source="https://github.com/djcb/mu/releases/download/$pkgver/mu-$_pkgver.tar.xz"
builddir="$srcdir/$pkgname-$_pkgver"

build() {
	autoreconf --force --install
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var \
		--disable-webkit \
		--disable-gtk  \
		--enable-mu4e
	make
}

package() {
	cd "$builddir"
	make DESTDIR=$pkgdir install

	# if msg2pdf and mug were built, install them
	# if not, remove the unneeded mug manpage
	if [ -f toys/msg2pdf/msg2pdf ]; then
		install -m755 toys/msg2pdf/msg2pdf $pkgdir/usr/bin/msg2pdf
	fi
	if [ -f toys/mug/mug ]; then
		install -m755 toys/mug/mug $pkgdir/usr/bin/mug
		install -Dm644 toys/mug/mug.svg $pkgdir/usr/share/pixmaps/mug.svg
	else
		rm $pkgdir/usr/share/man/man1/mug.1
	fi
}

mu4e() {
	pkgdesc="Emacs-based e-mail client which uses mu as its back-end"
	depends="$pkgname=$pkgver-r$pkgrel emacs"

	mkdir -p "$subpkgdir"/usr
	mv "$pkgdir"/usr/share "$subpkgdir"/usr
}
sha512sums="a8bd16bb62cd4c8b8ec8961f3466e9d9b9e4186194152c8e9e6bd6d0f71770ee9cde55bcde2f41efbd29f88e6dd06ab5aa5b1fe01b2564f90fe7e6507cb74775  mu-1.2.0.tar.xz"
