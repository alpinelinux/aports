# Contributor: Hannes Braun <hannes@hannesbraun.net>
# Maintainer: Hannes Braun <hannes@hannesbraun.net>
pkgname=faircamp
pkgver=1.7.0
pkgrel=0
_gitrev=856070a
pkgdesc="Static site generator for audio producers"
url="https://simonrepp.com/faircamp/"
arch="all !armhf !armv7 !x86" # blocked by libvips crate
license="AGPL-3.0-or-later"
makedepends="cargo cargo-auditable opus-dev vips-dev"
source="$pkgname-$pkgver.tar.gz::https://codeberg.org/simonrepp/faircamp/archive/$pkgver.tar.gz
	external-revision.patch"
builddir="$srcdir/faircamp"
options="!check" # no test suite

prepare() {
	default_prepare

	cargo fetch --target="$CHOST" --locked
}

build() {
	FAIRCAMP_REVISION=$_gitrev cargo auditable build --frozen --release --features libvips
}

package() {
	install -Dm755 target/release/faircamp "$pkgdir"/usr/bin/faircamp
}

sha512sums="
a10a531cc10b25a8d6a021e49cfd2eae00944ecf38473727e11752b664decbf17a873fcce9a5906a5dc4ceffec41b88b170b485f1678552cae08dde573955a0c  faircamp-1.7.0.tar.gz
a44ea4c2cfd177c6f06f47d466444b0ebd2f8e4c255dfbed13adb35d1aa5245962e59ee14965b9bb712afb1361d3fa581d5d6cd2680e33da60f1a46eb7b979f9  external-revision.patch
"
