# Developer: Frank DENIS <j at pureftpd.org>
# Contributor: Andreas Sundqvist <andreas at forme.se>
# Maintainer: Timofey Bychkov <boobooin@gmail.com>
pkgname=php7-libpuzzle
pkgver=0.11
pkgrel=0
pkgdesc="PHP module of the Puzzle library. Library is designed to find visually similar images."
url="http://libpuzzle.pureftpd.org/project/libpuzzle"
arch="all"
license="BSD"
depends="libpuzzle"
makedepends="libpuzzle php7-dev"
source="https://download.pureftpd.org/pub/pure-ftpd/misc/libpuzzle/releases/libpuzzle-$pkgver.tar.gz 10_php7_support.patch"
builddir="$srcdir/libpuzzle-$pkgver"
options="!check" # Libpuzzle was developed on OpenBSD, and one of the tests doesn't pass because floating point numbers are rounded differently on Linux. It has no implications on usage.

build() {
	cd "$builddir"/php/libpuzzle
	phpize
	./configure
	make
}

package() {
	install -d "$pkgdir"
	install -d "$pkgdir"/usr/lib/php7/modules/
	install -d "$pkgdir"/etc/php7/conf.d/

	cd "$builddir"

	install -t "$pkgdir"/usr/lib/php7/modules/ ./php/libpuzzle/modules/libpuzzle.so
	echo "extension=libpuzzle.so" > "$pkgdir"/etc/php7/conf.d/00_libpuzzle.ini
}

sha512sums="632d890e0acff5aab2846f0a79964c3dbe3a70a142a27409ede2ef139103d2348d0237d59f7b5728a0327a9a7f4a2141093058bba68d7a7bc6755f8292113403  libpuzzle-0.11.tar.gz
ec652e093cf0df9db49a53cc2c3cf4f3a8e95112638ff435b377f291c9a80a27d9d788a2464db4419f46f7fed5aa876dfdd94241636e56227d2b28402298650c  10_php7_support.patch"
