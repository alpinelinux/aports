# Contributor: Anjandev Momi <anjan@momi.ca>
# Maintainer: Anjandev Momi <anjan@momi.ca>
_gitcommit=423132f82fff1a78d7e450f8f2ac6fd28a5f6263
pkgname=borogove-sdk
pkgver=0_git20251206
pkgrel=0
pkgdesc="Pre-pre-pre-alpha experimental prototype work in progress. Nothing to see here!"
url="https://borogove.dev"
arch="all !riscv64 !loongarch64 !armv7 !armhf !s390x" # riscv64, loongarch64 blocked by haxe. armv7,armhf, s390x blocked by gcc -m32 not supported
license="Apache-2.0"
makedepends="haxe~4.3.3 opus-dev libdatachannel-dev libstrophe-dev libc++-dev musl-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/snikket-im/snikket-sdk/archive/$_gitcommit.tar.gz
	xlocale.patch"
builddir="$srcdir/snikket-sdk-$_gitcommit"
options="!check" # no checks

prepare() {
	haxelib setup .
	haxelib git jsImport https://github.com/back2dos/jsImport
	haxelib install datetime
	haxelib install haxe-strings
	haxelib install hsluv
	haxelib install tink_http
	haxelib install sha
	haxelib install thenshim
	haxelib install HtmlParser
	haxelib install hxnodejs
	haxelib git hxtsdgen https://github.com/singpolyma/hxtsdgen
	haxelib install utest
	haxelib git hxcpp https://github.com/HaxeFoundation/hxcpp
	cd hxcpp/git/tools/hxcpp
	haxe compile.hxml
	cd -
	default_prepare
}

build() {
	make libborogove.so
}

package() {
	install -Dm644 libborogove.so "$pkgdir"/usr/lib/libborogove.so
	install -Dm644 cpp/borogove.h "$pkgdir"/usr/include/borogove.h
}

sha512sums="
6dec0b536f26f6240b82a8bd72fde3e5feae7988ee7171cd0a18aac0614b6e0848577e362f9a637a5939a67cdf4fc2726257714f5106ae36b0267dbc4eeb5cf2  borogove-sdk-0_git20251206.tar.gz
0cd6e361af802188c9e58589d132c04b5809b52b1d4a97cc48b0807d022bd032296ce46c628cdacb626c2386c2845f309d9383f0aa1ab7a4446f75cdcfe6b334  xlocale.patch
"
