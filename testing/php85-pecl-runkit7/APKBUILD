# Maintainer: Andy Postnikov <apostnikov@gmail.com>
pkgname=php85-pecl-runkit7
_extname=runkit7
pkgver=4.0.0_alpha6
pkgrel=0
pkgdesc="PHP 8.5 extension for replace, rename, and remove user defined functions, methods, and constants - PECL"
url="https://pecl.php.net/package/runkit7"
arch="all"
license="BSD-3-Clause"
_phpv=85
_php=php$_phpv
depends="$_php-common"
makedepends="$_php-dev clang"
source="php-pecl-$_extname-$pkgver.tgz::https://pecl.php.net/get/$_extname-${pkgver//_alpha/a}.tgz
	fix-build.patch
	fix-estrict.patch
	fix-build85.patch
	fix-tests85.patch
	"
builddir="$srcdir/$_extname-${pkgver//_alpha/a}"

build() {
	phpize$_phpv
	CC=clang \
	./configure --prefix=/usr --with-php-config=/usr/bin/php-config$_phpv
	make
}

check() {
	$_php -dextension=modules/$_extname.so --ri $_extname
	make NO_INTERACTION=1 REPORT_EXIT_STATUS=1 test TESTS="${TESTS:- --show-diff }"
}

package() {
	make INSTALL_ROOT="$pkgdir" install
	local _confdir="$pkgdir"/etc/$_php/conf.d
	install -d $_confdir
	echo "extension=$_extname" > $_confdir/$_extname.ini
}

sha512sums="
fd54b395ab07806035d18ba4efa4337304c345d8800063755c94b0b776b254b41ed7932ca0a9e366fe8f0a8e4e184355ed2e1b3452fbe3c45e6fa28750aa956e  php-pecl-runkit7-4.0.0_alpha6.tgz
ca4cc06074cae7b69f376a59cc3285a6a9de7c7eb6151b8066873d8e11f1d89c34ecfa43b80790485c9f05369376a3d3efda529c738eda140220fa5586e33810  fix-build.patch
3e7f10f9156f9c9019ee7b5e42dae9a1b3961c06ff50ae6979b94d49a498f0a23c72e85e4e09a8d1d1d7f8683fc1f4989077e46dc1e58912504b48a71bed99f3  fix-estrict.patch
22c14ff43aa3c83aa4681abe397574a1a348af98e8050d4b8171a3ca5b0470b2034053a8e7d3755a43715dc5c2765c77e09b8e6cc48f28ea2c0a8a4a761a3c13  fix-build85.patch
6632aac27f128a12f0eaad8d0b0fc2d6dd5aed31f8dce616b0cf7d501a0b142ce53231ce5ed0cc82ac6baf7cb968f27f29e07aac1b212193baf6bba59770f9f4  fix-tests85.patch
"
