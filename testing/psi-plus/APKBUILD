# Maintainer: Cowington Post <cowingtonpost@gmail.com>
pkgname=psi-plus
pkgver=1.5.2096
pkgrel=0
pkgdesc="Powerful XMPP (Jabber) client (Qt, C++) designed for power users"
url="https://psi-plus.com/"
# ppc64le, s390x, riscv64, armhf, x86: qt6-qtwebengine missing
arch="all !ppc64le !s390x !riscv64 !armhf !x86"
license="GPL-2.0-or-later"
makedepends="
	cmake
	hunspell-dev
	libidn-dev
	libomemo-c-dev
	libotr-dev
	libsignal-protocol-c-dev
	libusrsctp-dev
	qca-qt6-dev
	qt6-qtbase-dev
	qt6-qtmultimedia-dev
	qt6-qtsvg-dev
	qt6-qtwebengine-dev
	qtkeychain-dev
	samurai
	tidyhtml-dev
	"
subpackages="$pkgname-plugins"
source="https://github.com/psi-plus/psi-plus-snapshots/archive/$pkgver/psi-plus-$pkgver.tar.gz"
builddir="$srcdir/psi-plus-snapshots-$pkgver"
options="!check" # no tests

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		local crossopts="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=ON \
		-DCMAKE_BUILD_TYPE=None \
		-DCHAT_TYPE=webengine \
		-DUSE_QT6=ON \
		-DUSE_XSS=0 \
		-DPSI_PLUS=1 \
		-DENABLE_PLUGINS=ON \
		-DBUILD_DEV_PLUGINS=ON \
		$crossopts
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

plugins() {
	amove usr/lib/psi-plus/plugins
}

sha512sums="
c446aa16f9497cc618c45d72f1638fa73eb8b6323023e130fd1459e9a375fc7ff17068cf3ba22d848fda36d837a0e5773a202f7a419f8b49da9b94c3f69e594b  psi-plus-1.5.2096.tar.gz
"
