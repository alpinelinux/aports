# Contributor: Taner Tas <taner76@gmail.com>
# Maintainer: Taner Tas <taner76@gmail.com>
pkgname=gpm
pkgver=1.20.7
pkgrel=0
pkgdesc="Console-based mouse driver."
url="https://www.nico.schottelius.org/software/gpm/"
arch="all"
license="GPL-2.0-or-later"
makedepends="
	autoconf
	automake
	byacc
	libtool
	linux-headers
	texinfo
	xz
	"
subpackages="$pkgname-dev $pkgname-doc $pkgname-libs $pkgname-openrc"
source="
	http://www.nico.schottelius.org/software/gpm/archives/gpm-$pkgver.tar.lzma
	$pkgname.confd
	$pkgname.initd
	$pkgname.sh
	musl-fcntl.patch
	musl-gpm_h.patch
	musl-linux_major_h.patch
	musl-select.patch
	musl-sigaction.patch
"
prepare() {
	cd "$builddir"
	default_prepare
	./autogen.sh
}

build() {
	cd "$builddir"
	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--sbindir=/usr/bin
	make
}

check() {
	cd "$builddir"
	make check
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
	install -Dm0755 "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
	install -Dm0644 "$srcdir"/$pkgname.confd "$pkgdir"/etc/conf.d/$pkgname
	install -Dm0644 "$srcdir"/$pkgname.sh "$pkgdir"/etc/profile.d/$pkgname.sh
}

libs() {
	mkdir -p "$subpkgdir"/usr/lib/
	mv "$pkgdir"/usr/lib/*.so* "$subpkgdir"/usr/lib/
}

sha512sums="a502741e2f457b47e41c6d155b1f7ef7c95384fd394503f82ddacf80cde9cdc286c906c77be12b6af8565ef1c3ab24d226379c1dcebcfcd15d64bcf3e94b63b9  gpm-1.20.7.tar.lzma
81e2f7b50ac29afe58091f09bd7bf24ce804fef4e78ba3fd5a9c835429d7ec95dbb874380ac0277dd0c07f723f6c88f5e474fa2b0ba4a8495b8bffe609efb679  gpm.confd
d7ba31896391995df8fe8bb8cce6523593ce20c00060f923b19158dc755fb459cfd979bd372d0483ddbca50bb3dbe3276f5aca740d98995e0b37c1f0cf26029a  gpm.initd
69c224972f0434e20dd04ad7e42bef286fe31686b7e61b8ac344752167daec2fa02380cfd8ec74e581ab7e9be8c15f78c69db571c8fbe11f134f221fca94875c  gpm.sh
373db988475129582af6c12146d3cc87fcf327a30bb82f5d5ed08308e16768991be3f1fb405fcb2fa27e68d44b27f40f6375ebe98a2929495eea460ed66f8d15  musl-fcntl.patch
c2ffd03d6333ea4bb0d9df6300ac2da9f9d8631df0c16baeb60165d4ff3d520555c21d9d01a99e1e28be40e9936b7cf41bfed02e6bfe8837483610591d1fbf9e  musl-gpm_h.patch
c76b4d9f51f37535cfb89044e78a64fa225e39941cc8269c01003bca67f366b94b5cc52997f4d6048fbd0d9a253b1a02143bf50ecc34de47d98c582b3a891fdc  musl-linux_major_h.patch
a43e2db1f40f67c4ad89a314ba7abef7bc7223d7423919fef9eaaae09f1aef03acd81de1ed3518819d090097f4d74daefcc393ec2a5f4ae5e0fbf840862e2e8e  musl-select.patch
039493f8c6177459b1c8bd791a7fde006573c888b3f7a5851a96206a72627b096e08695ee9e84f8052ef2129e2274242d467a29059b5b501c0b6ffb2f8e40943  musl-sigaction.patch"
