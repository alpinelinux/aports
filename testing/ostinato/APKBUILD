# Maintainer: Corentin Henry <corentinhenry@gmail.com>
# Contributor: Corentin Henry <corentinhenry@gmail.com>
_commit=edc7ed677c1d5c308e66441f464dfd69aa922643
pkgname=ostinato
pkgver=0.9_git
pkgrel=0
pkgdesc="Packet/Traffic Generator and Analyzer"
url="https://www.ostinato.org"
arch="all"
license="GPL-3.0-or-later"
# options="!check" # make test does nothing
makedepends="qt5-qtbase-dev qt5-qtscript-dev protobuf-dev libpcap-dev paxmark
	libnl3-dev"
subpackages="$pkgname-drone $pkgname-gui"
source="$pkgname-$pkgver.tar.gz::https://github.com/pstavirs/$pkgname/archive/${_commit}.tar.gz
	fix-werror.patch
	fix-build.patch
	"
builddir="$srcdir/$pkgname-$_commit"

build() {
	qmake-qt5 PREFIX=/usr
	make CXXFLAGS="$CXXFLAGS -O2" LDFLAGS="$LDFLAGS -lmodeltest"
}

package() {
	make INSTALL_ROOT="$pkgdir" install
	paxmark -m "$pkgdir"/usr/bin/drone
	paxmark -m "$pkgdir"/usr/bin/ostinato
}

drone() {
	pkgdesc="ostinato controller"

	install -d "$subpkgdir"/usr/bin
	mv "$pkgdir"/usr/bin/drone "$subpkgdir"/usr/bin/drone
}

gui() {
	pkgdesc="graphical controller for ostinato"

	install -d "$subpkgdir"/usr/bin
	mv "$pkgdir"/usr/bin/ostinato "$subpkgdir"/usr/bin/ostinato
}

sha512sums="b71bb38d9bd429198a0cce7f4abbe599f68ceb6a13d377aef437d12a972818f53ed67090191405f8b95538c9f2101fc20548f32258a1da1aca10a812fbd05a3c  ostinato-0.9_git.tar.gz
fc9a6dc35386e2ac23ab58e1fa8f3eadb3f00a13cf1fdd44ac08d895b15060e2e9bbcdf1e9673641aae142bf7e381408e42afa84991be28930a12010fbee0bcd  fix-werror.patch
5af77c97a49787d1c1a781dda2b7e26862072598f1db204aed95f56e55c1fa357e4fc2a56ea6ec50053f4e1598199415eec16fe3f9a0e13b0812c2cf43bc860b  fix-build.patch"
