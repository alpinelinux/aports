# Maintainer: Julien Voisin <julien.voisin@dustri.org>
pkgname=hardened-malloc
pkgver=14
pkgrel=0
pkgdesc="Hardened allocator designed for modern systems."
url="https://github.com/GrapheneOS/hardened_malloc"
arch="x86_64 aarch64"
license="MIT"
checkdepends="python3"
source="$pkgname-$pkgver.tar.gz::https://github.com/GrapheneOS/hardened_malloc/archive/refs/tags/$pkgver.tar.gz"
builddir="$srcdir/${pkgname/-/_}-$pkgver"

build() {
	make VARIANT=light
	make VARIANT=default

}

check() {
	make test
}

package() {
	mkdir -p "$pkgdir"/usr/lib/
	install -m755 out/libhardened_malloc.so "$pkgdir"/usr/lib/
	install -m755 out-light/libhardened_malloc-light.so "$pkgdir"/usr/lib/

}

sha512sums="
1953bcf8bb6895ea32d0da76a1a61177f524279fa3fa878f9d4a6f96606c082f292dcbcc71a14f9a9d631fc0e92bb2eb3cf5debe63bf67a1c12ef98f85ec652f  hardened-malloc-14.tar.gz
"
