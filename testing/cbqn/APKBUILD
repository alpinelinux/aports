# Maintainer: Siva Mahadevan <me@svmhdvn.name>
pkgname=cbqn
pkgver=0.11.0
pkgrel=0
pkgdesc="BQN implementation in C"
url="https://github.com/dzaima/CBQN"
arch="all !armhf !armv7 !s390x" # CBQN fails to compile on these archs
makedepends="bash libffi-dev"
license="LGPL-3.0-only OR GPL-3.0-only OR MPL-2.0"
options="!check" # TODO Testsuite requires fetching mlochbaum/BQN
_singeli_ver=2936c66b061b9df61cafc1f8d07a7ed53bf10bee
_replxx_ver=5e3bd870699007b9536d29f60e3a2b0a68ce0a7a
_cbqn_bytecode_ver=156b47caf895f6706811c5c34bbbbaf192b8018b
source="$pkgname-$pkgver.tar.gz::https://github.com/dzaima/CBQN/archive/v$pkgver.tar.gz
	Singeli-$_singeli_ver.tar.gz::https://github.com/mlochbaum/Singeli/archive/$_singeli_ver.tar.gz
	replxx-$_replxx_ver.tar.gz::https://github.com/dzaima/replxx/archive/$_replxx_ver.tar.gz
	cbqnBytecode-$_cbqn_bytecode_ver.tar.gz::https://github.com/dzaima/cbqnBytecode/archive/$_cbqn_bytecode_ver.tar.gz
	"
builddir="$srcdir/CBQN-$pkgver"

prepare() {
	default_prepare
	ln -s "$srcdir/Singeli-$_singeli_ver" "$builddir/build/singeliLocal"
	ln -s "$srcdir/replxx-$_replxx_ver" "$builddir/build/replxxLocal"
	ln -s "$srcdir/cbqnBytecode-$_cbqn_bytecode_ver" "$builddir/build/bytecodeLocal"
}

build() {
	make version="$pkgver" notui=1 nogit=1
}

package() {
	make PREFIX="/usr" DESTDIR="$pkgdir" install
}
sha512sums="
1e4db2e56548ea7513859d7c91be5410d38e1b35e2b2370b7a5573d2ceb01101cbdeffd784ec3db0ed83251fea4399045c55a30700002e4d0833c8bba72a03c9  cbqn-0.11.0.tar.gz
bde10e9909d84e0bf40164320a742c23f0cc6775f48971dd3dbda800f6b6689cb2dbece1216a0370ad9686aae1b5d7d8b38efe39312189dfd3734620279a9b4d  Singeli-2936c66b061b9df61cafc1f8d07a7ed53bf10bee.tar.gz
b180fb54062dcb12db15098327de31fd81a3c0379626c482e85613750f7af5a8cc2cd6a9482250347553e7eeab92c14c06adc86cca98bf310922b04d238156a7  replxx-5e3bd870699007b9536d29f60e3a2b0a68ce0a7a.tar.gz
8d840e72845dde5498712eaae30821cea9423b879524eab076cefac905aad4db8d184c55be3808bb9ea1fe49aca087c4de2a4c712c8c6ce6136bae261499244d  cbqnBytecode-156b47caf895f6706811c5c34bbbbaf192b8018b.tar.gz
"
