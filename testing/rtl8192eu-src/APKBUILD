# Maintainer: Prabu Anand K <kprabuanand@gmail.com>
pkgname=rtl8192eu-src
_modname=8192eu
_projname=rtl8192eu-linux
pkgver=5.11.2.3_git20251220
# No git tags in the repo, but they use version numbers
_gitrev=ed045d0e04303dce7b7b174abcb27bd24d207ee6
pkgrel=0
pkgdesc="Realtek RTL8192EU wireless driver for Linux"
url="https://github.com/clnhub/rtl8192eu-linux"
arch="noarch"
license="GPL-2.0-only"
source="https://github.com/clnhub/rtl8192eu-linux/archive/$_gitrev/$_projname-$_gitrev.tar.gz"
builddir="$srcdir/$_projname-$_gitrev"
options="!check"  # No test suite, only sources

prepare() {
	default_prepare

	cat >AKMBUILD <<-EOF
	modname=$_modname
	modver=$pkgver-r$pkgrel
	built_modules=$_modname.ko
	build() {
			make \$MAKEFLAGS KVER="\$kernel_ver" KSRC="\$kernel_srcdir"
}
EOF
}

package() {
	local destdir="$pkgdir/usr/src/$_modname-$pkgver"
	install -Dm644 -t "$destdir" AKMBUILD Makefile
	cp -r core/ hal/ include/ os_dep/ platform/ "$destdir/"

	# Blacklist conflicting drivers
	install -Dm644 /dev/stdin "$pkgdir/etc/modprobe.d/rtl8192eu.conf" << EOF
# Blacklist conflicting drivers
blacklist rtl8xxxu
EOF
}

sha512sums="
9a9bdc7ac4d093fa1b0a20aa4c7fb32393c4122cf1bc4ff874b77c3b758602b38e9b26bd4b6312f141e54f9af9ddcaa3a72f16df6c9bbfa65afc5d2a3562ca2c  rtl8192eu-linux-ed045d0e04303dce7b7b174abcb27bd24d207ee6.tar.gz
"
