# Maintainer: Prabu Anand K <kprabuanand@gmail.com>
pkgname=rtl8192eu-src
_modname=8192eu
_projname=rtl8192eu-linux
pkgver=5.11.2.3_git20251017
# No git tags in the repo, but they use version numbers
_gitrev=e670de06ebedc844f173cf8d377691ce7f237311
pkgrel=0
pkgdesc="Realtek RTL8192EU wireless driver for Linux"
url="https://github.com/clnhub/rtl8192eu-linux"
arch="noarch"
license="GPL-2.0-only"
source="https://github.com/clnhub/rtl8192eu-linux/archive/$_gitrev/$_projname-$_gitrev.tar.gz"
builddir="$srcdir/$_projname-$_gitrev"
options="!check"  # No test suite, only sources

prepare() {
	default_prepare

	cat >AKMBUILD <<-EOF
	modname=$_modname
	modver=$pkgver-r$pkgrel
	built_modules=$_modname.ko
	build() {
			make \$MAKEFLAGS KVER="\$kernel_ver" KSRC="\$kernel_srcdir"
}
EOF
}

package() {
	local destdir="$pkgdir/usr/src/$_modname-$pkgver"
	install -Dm644 -t "$destdir" AKMBUILD Makefile
	cp -r core/ hal/ include/ os_dep/ platform/ "$destdir/"

	# Blacklist conflicting drivers
	install -Dm644 /dev/stdin "$pkgdir/etc/modprobe.d/rtl8192eu.conf" << EOF
# Blacklist conflicting drivers
blacklist rtl8xxxu
EOF
}

sha512sums="
6715a93e34a8c0e8d8c97a8130a305436e20f21dc6bb148b58a20642134540f3e9772e2d7006c9ea600659211afc36a471a24fd0d6686d5358daa224abc1da81  rtl8192eu-linux-e670de06ebedc844f173cf8d377691ce7f237311.tar.gz
"
