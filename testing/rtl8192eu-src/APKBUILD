# Maintainer: Prabu Anand K <kprabuanand@gmail.com>
pkgname=rtl8192eu-src
_modname=8192eu
_projname=rtl8192eu-linux
pkgver=5.11.2.1_git20250812
# No git tags in the repo, but they use version numbers
_gitrev=ee928d5dc065f328043711c271eb54f008e6245c
pkgrel=0
pkgdesc="Realtek RTL8192EU wireless driver for Linux"
url="https://github.com/clnhub/rtl8192eu-linux"
arch="noarch"
license="GPL-2.0-only"
source="https://github.com/clnhub/rtl8192eu-linux/archive/$_gitrev/$_projname-$_gitrev.tar.gz"
builddir="$srcdir/$_projname-$_gitrev"
options="!check"  # No test suite, only sources

prepare() {
	default_prepare

	cat >AKMBUILD <<-EOF
	modname=$_modname
	modver=$pkgver-r$pkgrel
	built_modules=$_modname.ko
	build() {
			make \$MAKEFLAGS KVER="\$kernel_ver" KSRC="\$kernel_srcdir"
}
EOF
}

package() {
	local destdir="$pkgdir/usr/src/$_modname-$pkgver"
	install -Dm644 -t "$destdir" AKMBUILD Makefile
	cp -r core/ hal/ include/ os_dep/ platform/ "$destdir/"

	# Blacklist conflicting drivers
	install -Dm644 /dev/stdin "$pkgdir/etc/modprobe.d/rtl8192eu.conf" << EOF
# Blacklist conflicting drivers
blacklist rtl8xxxu
EOF
}

sha512sums="
03ae935c43dab544acfda5708537cd7bbfc78e22d96854ad2db7d244944378a0f8e78daef235579ec9b6a568b9d5c57cffa3779683a91c498e79bb724462e534  rtl8192eu-linux-ee928d5dc065f328043711c271eb54f008e6245c.tar.gz
"
