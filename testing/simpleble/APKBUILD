maintainer="Leon White <badfunkstripe@gmail.com>"
pkgname=simpleble
pkgver=0.12.1
pkgrel=0
pkgdesc="Cross-platform library for bluetooth low-energy"
url="https://github.com/simpleble/simpleble"
arch="all"
license="GPL-3.0-only"
makedepends="
	cmake
	dbus-dev
	fmt-dev
	samurai
	"
subpackages="
	$pkgname-dev
	libsimpleble:lib
	libsimplecble:lib_c
	libsimplebluez:lib_bluez
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/simpleble/simpleble/archive/refs/tags/v$pkgver.tar.gz"
options="!check" # tests require plain

build() {
	cmake -B build-ble -G Ninja -S simpleble \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_SKIP_INSTALL_RPATH=ON \
		-DBUILD_SHARED_LIBS=ON
	cmake --build build-ble

	cmake -B build-cble -G Ninja -S simplecble \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_SKIP_INSTALL_RPATH=ON \
		-DBUILD_SHARED_LIBS=ON
	cmake --build build-cble

	cmake -B build-bluez -G Ninja -S simplebluez \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_SKIP_INSTALL_RPATH=ON \
		-DBUILD_SHARED_LIBS=ON
	cmake --build build-bluez
}

package() {
	DESTDIR="$pkgdir" cmake --install build-ble
	DESTDIR="$pkgdir" cmake --install build-cble
	DESTDIR="$pkgdir" cmake --install build-bluez
}

lib() {
	amove usr/lib/libsimpleble.so.*
}

lib_c() {
	amove usr/lib/libsimplecble.so.*
}

lib_bluez() {
	amove usr/lib/libsimplebluez.so.*
}

sha512sums="
c53c435c53f4829bfe1f1db94a94693958a23174689b798ae32d9518725efbb3173540e150c5a630ee53752d3e49f80f9e412c1c21e9f7a326369592d47cab46  simpleble-0.12.1.tar.gz
"
