# Contributor: Bob Hampton <bobh@optimizations.com>
# Maintainer: Bob Hampton <bobh@optimizations.com>
pkgname=bullet3
pkgver=2.87
pkgrel=0
pkgdesc="Bullet Physics SDK"
url="http://bulletphysics.org/wordpress"
arch="all"
license="custom:zlib"
depends=""
makedepends="cmake doxygen
	linux-headers
	python-dev
	py-setuptools"
install=""
subpackages="$pkgname-doc py-$pkgname:py $pkgname-examples"
source="${pkgname}-${pkgver}.tar.gz::https://github.com/bulletphysics/bullet3/archive/2.87.tar.gz"
builddir="$srcdir/$pkgname-$pkgver"

build() {
	cd "$builddir"
	rm -f CMakeCache.txt
	mkdir -p build_cmake
	cd build_cmake
	cmake -DCMAKE_INSTALL_PREFIX=/usr -DBUILD_PYBULLET=ON -DBUILD_PYBULLET_NUMPY=OFF -DUSE_DOUBLE_PRECISION=ON -DCMAKE_BUILD_TYPE=Release ..
	make -j12
	cd "$builddir"
	python setup.py build
}

package() {
	cd "$builddir"/build_cmake
	make -j1 DESTDIR="$pkgdir" install
	cd "$builddir"
	python setup.py install --prefix=/usr --root="$pkgdir"
}

py() {
	subpkgdir=`pwd`/pkg/py-"$pkgname"
	cd "$builddir"
	pkgdesc="$pkgname python bindings"
	install -d "$subpkgdir"/usr/lib
	mv "$pkgdir"/usr/lib/python* "$subpkgdir"/usr/lib/
}

doc() {
	subpkgdir=`pwd`/pkg/"$pkgname"-doc
	_docs="AUTHORS.txt LICENSE.txt README.md"
	for _doc in $_docs; do
		install -Dm644 "$srcdir/$pkgname-$pkgver"/$_doc \
				"$subpkgdir"/usr/share/doc/$_pkgname/$_doc
	done
	_docs="BulletQuickstart.pdf Bullet_User_Manual.pdf
			GPU_rigidbody_using_OpenCL.pdf pybullet_quickstartguide.pdf"
	for _doc in $_docs; do
		install -Dm644 "$srcdir/$pkgname-$pkgver"/docs/$_doc \
				"$subpkgdir"/usr/share/doc/$_pkgname/$_doc
	done
	mkdir -p "$subpkgdir"/usr/share/licenses/"$pkgname"
	cp "$subpkgdir"/usr/share/doc/$_pkgname/LICENSE.txt \
		"$subpkgdir"/usr/share/licenses/$_pkgname
}

examples() {
	subpkgdir=`pwd`/pkg/"$pkgname-examples"
	pkgdesc="Example applications for bullet3"
	mkdir -p "$subpkgdir"/usr/share/doc/"$pkgname"/examples 
	install -d "$srcdir/$pkgname-$pkgver"/examples\
				"$subpkgdir"/usr/share/doc/$_pkgname/examples
	install -d "$srcdir/$pkgname-$pkgver"/data\
				"$subpkgdir"/usr/share/doc/$_pkgname/data
}

sha512sums="649e470223295666eda6f7ff59d03097637c2645b5cd951977060ae14b89f56948ce03e437e83c986d26876f187d7ee34e790bc3882d5d66da9af89a4ab81c21  bullet3-2.87.tar.gz"
