maintainer="Hoang Nguyen <folliekazetani@protonmail.com>"
pkgname=helm-diff
pkgver=3.13.1
pkgrel=1
pkgdesc="Helm plugin to preview helm upgrade changes as a diff"
url="https://github.com/databus23/helm-diff"
arch="all"
license="Apache-2.0"
makedepends="go"
install="helm-diff.pre-install"
source="$pkgname-$pkgver.tar.gz::https://github.com/databus23/helm-diff/archive/refs/tags/v$pkgver.tar.gz"
options="net" # download Go modules

build() {
	go build -v \
		-ldflags "-X github.com/databus23/helm-diff/v3/cmd.Version=v$pkgver"
}

check() {
	go test ./...
}

package() {
	install -Dm755 $pkgname "$pkgdir"/usr/libexec/helm/plugins/diff

	mkdir -p "$pkgdir"/usr/share/helm/plugins/diff
	cat <<-EOF > "$pkgdir"/usr/share/helm/plugins/diff/plugin.yaml
	name: "diff"
	version: "$pkgver"
	usage: "Preview helm upgrade changes as a diff"
	description: "Preview helm upgrade changes as a diff"
	platformCommand:
	  - os: "$(go env GOOS)"
	    arch: "$(go env GOARCH)"
	    command: "/usr/libexec/helm/plugins/diff"
	EOF
}

sha512sums="
c0961a46f7c09ce3064a4415d2162c5d33be4e82e15fd9284a5dd9f8a9008367847a74ea3be082eb52a968b3c066a8c64146893c27fcaf555ed3242359843e2a  helm-diff-3.13.1.tar.gz
"
