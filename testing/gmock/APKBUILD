# Contributor: Daniel YC Lin <dlin.tw@gmail.com>
# Maintainer: Daniel YC Lin <dlin.tw@gmail.com>
pkgname=gmock
pkgver=1.8.0
pkgrel=0
pkgdesc="Google Mock - A library for writing and using C++ mock classes"
url="https://github.com/google/googletest"
arch="all"
license="BSD"
depends="python2 gtest"
depends_dev="python2 cmake"
makedepends="$depends_dev autoconf automake libtool coreutils"
install=""
subpackages="$pkgname-dev $pkgname-doc"
source="gtest-$pkgver.tar.gz::https://github.com/google/googletest/archive/release-$pkgver.tar.gz
	gmock-install.patch
	gmock.pc.in
"
builddir="$srcdir"/googletest-release-${pkgver}

prepare() {
	cd "$builddir"
	find -name '*.py' -exec sed -i 's|env python|env python2|g' {} \;
	default_prepare || return
	cd googlemock
	cp "${srcdir}/gmock.pc.in" .
	autoreconf -fvi || return
}

build() {
	cd "$builddir/googlemock"
	./configure --prefix=/usr --with-gtest --enable-external-gtest || return
	make || return
}

package() {
	cd "$builddir/googlemock"
	make --trace -w -j1 DESTDIR="${pkgdir}" install || return
	install -Dm 644 LICENSE -t "${pkgdir}/usr/share/licenses/${pkgname}" || return
	install -Dm 644 README.md CHANGES CONTRIBUTORS \
	  -t "${pkgdir}/usr/share/doc/${pkgname}" || return
	install -Dm 755 scripts/gmock-config -t "${pkgdir}/usr/bin" || return
	install -Dm 644 include/gmock/internal/custom/* \
	  -t "${pkgdir}/usr/include/gmock/internal/custom" || return
	mkdir "${pkgdir}/usr/share/doc/${pkgname}/generator"
	mv "${pkgdir}/usr/share/gmock//generator/LICENSE" \
	  "${pkgdir}/usr/include/gmock/internal/custom" || return
	mv "${pkgdir}/usr/share/gmock//generator/README" \
	  "${pkgdir}/usr/include/gmock/internal/custom" || return
	mv "${pkgdir}/usr/share/gmock//generator/README.cppclean" \
	  "${pkgdir}/usr/include/gmock/internal/custom" || return
}

sha512sums="1dbece324473e53a83a60601b02c92c089f5d314761351974e097b2cf4d24af4296f9eb8653b6b03b1e363d9c5f793897acae1f0c7ac40149216035c4d395d9d  gtest-1.8.0.tar.gz
2c2417c178485a590695f7d37b26fad3a1a1993fdc9a0c869c34fec83d51769b8057b4f67000e0585f61919c092175186252704a032e9b06bfc1f0e7c0b900f9  gmock-install.patch
3e4c2e96139292818d97b52536776b656bea30f119124dab4d5c2cb2f31098a3bfac928b74297f7c77229d3eb5fa3b734931c64d8bef2f867b585e43b390a59c  gmock.pc.in"
