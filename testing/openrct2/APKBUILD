# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Bart Ribbers <bribbers@disroot.org>
pkgname=openrct2
pkgver=0.2.1
_pkgver_objects=1.0.8
_pkgver_title_sequences=0.1.2
pkgrel=0
pkgdesc="Open-source re-implementation of Roller Coaster Tycoon 2"
arch="all"
url="https://openrct2.io"
license="GPL-3.0"
makedepends="cmake ninja jansson-dev libzip-dev libpng-dev speexdsp-dev fontconfig-dev curl-dev icu-dev sdl2-dev mesa-dev fts-dev unzip"
install="$pkgname.post-install"
source="$pkgname-$pkgver.tar.gz::https://github.com/openrct2/openrct2/archive/v$pkgver.tar.gz
	$pkgname-$pkgver-title_sequences.zip::https://github.com/OpenRCT2/title-sequences/releases/download/v$_pkgver_title_sequences/title-sequence-v$_pkgver_title_sequences.zip
	$pkgname-$pkgver-objects.zip::https://github.com/OpenRCT2/objects/releases/download/v$_pkgver_objects/objects.zip
	musl-fixes.patch"
subpackages="$pkgname-cli $pkgname-doc"
options="!check" # No tests available
builddir="$srcdir/OpenRCT2-$pkgver"

prepare() {
	default_prepare

	mkdir "$builddir"/build && cd "$builddir"/build
	mkdir "$builddir"/title && cd "$builddir"/title && unzip "$srcdir"/$pkgname-$pkgver-title_sequences.zip
	mkdir "$builddir"/object && cd "$builddir"/object && unzip "$srcdir"/$pkgname-$pkgver-objects.zip
}

build() {
	cd "$builddir"/build

	cmake -G Ninja \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=/usr/lib \
		-DWITH_TESTS=ON \
		-DDOWNLOAD_TITLE_SEQUENCES=OFF \
		-DDOWNLOAD_OBJECTS=OFF ..
	ninja
}

package() {
	cd "$builddir"/build
	
	DESTDIR="$pkgdir" ninja install

	install -d "$pkgdir"/usr/share/openrct2/title
	install -d "$pkgdir"/usr/share/openrct2/object

	mv "$builddir"/title/* "$pkgdir"/usr/share/openrct2/title
	mv "$builddir"/object/* "$pkgdir"/usr/share/openrct2/object
}

cli() {
	install="$subpkgname.post-install"
	mkdir -p "$subpkgdir"/usr/bin
	mv "$pkgdir"/usr/bin/openrct2-cli "$subpkgdir"/usr/bin/openrct2-cli
}
sha512sums="04bf2cfbb2d3b9fb0a8423cfffc70b81a2a2518af73b9a2c2c65b2a4e5ef2380621d4d3aaefaea73d926a99259dfb047d6fcc330cd0d7227541cffead28ba540  openrct2-0.2.1.tar.gz
7592c5397ceb27347c127ae5c4f8e11d7ef2ff23c97f627b354f941894420f546ffdcff88e2348e42c82d182ccf620e739c745d894a9b5650a0d7d028b68a106  openrct2-0.2.1-title_sequences.zip
29e60a2d72e0c7774993e9d70aeb1c931b359e35776049a1baafd2d0bdfc56c1374e577e43f596c31ee146bd38b87eeeb8acc3ea03fdd9c9bc3be08436b7aa6a  openrct2-0.2.1-objects.zip
75fdb0f32bf00a0da464fe164522d39798b02d569bde94050926c59c381658241cf60b191679a3797337b9d3ed1456e57a0fffe5e04cc6d9d10e066e82fa6b08  musl-fixes.patch"
