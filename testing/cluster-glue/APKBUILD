# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer:
pkgname=cluster-glue
pkgver=1.0.12
pkgrel=1
pkgdesc="A set of libraries, tools and utilities suitable for the Heartbeat/Pacemaker cluster stack."
url="http://linux-ha.org/wiki/Cluster_Glue"
arch="all"
license="GPL"
depends=""
depends_dev="net-snmp-dev libxml2-dev glib-dev bzip2-dev curl-dev
	e2fsprogs-dev libaio-dev"
makedepends="$depends_dev autoconf automake libtool"
install=""
pkggroups="haclient"
pkgusers="hacluster"
subpackages="$pkgname-dev $pkgname-doc $pkgname-libs"
source="http://hg.linux-ha.org/glue/archive/glue-$pkgver.tar.bz2
	$pkgname.post-install
	$pkgname.pre-install"

builddir="$srcdir"/Reusable-Cluster-Components-glue--glue-$pkgver

prepare() {
	local i
	cd "$builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i;;
		esac
	done
	./autogen.sh
}

build() {
	cd "$builddir"
	./configure --prefix=/usr \
		--localstatedir=/var \
		--enable-fatal-warnings=no \
		--with-daemon-group="$pkggroups" \
		--with-daemon-user="$pkgusers"
	make
}

package() {
	cd "$builddir"
	make DESTDIR="${pkgdir}" install
	rm -rf "$pkgdir"/etc/init.d
	# initd file needs fixing
	#install -m755 -D "$srcdir"/ha_logd.initd \
	#	"$pkgdir"/etc/init.d/ha_logd
}

libs() {
	pkgdesc="A collection of libraries that are useful for writing cluster managers such as Pacemaker."
	mkdir -p "$subpkgdir"/usr/lib
	mv "$pkgdir"/usr/lib/lib*.so.* \
		"$subpkgdir"/usr/lib/
}

sha512sums="d5d2f6c426d2bed0d39269338fedfffe840a90ff56b05dff395243d0d8b803593bf35bbce5f7dce376120cd7ddef78400914cb7515b5451c287a1e9e74233122  glue-1.0.12.tar.bz2
9d75933e002f938b5ac76170db5f1fd80e89172482186a44fe905d1e27c313d79bcff18e3564023ba94f2eeff3cc25811ea30b3ad06fa345a854b4e4da492bee  cluster-glue.post-install
819641edd4aac839cc26c4398f664dc96ccad23bc2c9e813536166852fc01cadfee71294222a40466113bf0ceafb15a55482307a893785b436b3d9e98b58ea0c  cluster-glue.pre-install"
