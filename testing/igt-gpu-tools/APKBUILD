# Contributor: Dennis Krupenik <dennis@krupenik.com>
# Maintainer: Dennis Krupenik <dennis@krupenik.com>
pkgname=igt-gpu-tools
pkgver=2.3
pkgrel=0
pkgdesc="collection of tools for development and testing of the DRM drivers"
url="https://gitlab.freedesktop.org/drm/igt-gpu-tools/"
arch="x86_64" # intel gpus, aarch64 fails to build
license="MIT"
depends_dev="
	alsa-lib-dev
	cairo-dev
	curl-dev
	elfutils-dev
	eudev-dev
	gsl-dev
	json-c-dev
	kmod-dev
	libdrm-dev
	liboping-dev
	libpciaccess-dev
	libunwind-dev
	libxrandr-dev
	libxv-dev
	pixman-dev
	procps-compat-dev
	xmlrpc-c-dev
	"
makedepends="
	$depends_dev
	bison
	flex
	meson
	"
# Test igt_hook calls grep -z
checkdepends="bash grep"
subpackages="$pkgname-dev"
source="https://xorg.freedesktop.org/archive/individual/app/igt-gpu-tools-$pkgver.tar.xz
	skip-tests.patch
	"

build() {
	abuild-meson \
		-Dvalgrind=disabled \
		-Dversion_hash=$pkgver \
		. build
	meson compile -C build
}

check() {
	meson test --print-errorlogs -C build
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C build
}
sha512sums="
669e5f124c1177ed58c43b8b9b945f6436fc37b1162b16bbd1db78c5e170c68be98cc3b08b5ecb438d1313722fee2ab8bba8ca86a971443401c2acc3f3ec68ff  igt-gpu-tools-2.3.tar.xz
4bb7465485f98e42a88f7522e45ee1c942113354f78ff3cd81d2eea75098b1baa32fdd67b0c792338ef9ba989103f9ec6b43e05854e1e6862233d3a863c4e40b  skip-tests.patch
"
