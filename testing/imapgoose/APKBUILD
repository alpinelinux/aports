maintainer="Hugo Osvaldo Barrera <hugo@whynothugo.nl>"
pkgname=imapgoose
pkgver=0.4.2
pkgrel=0
pkgdesc="Keep local Maildirs synchronised with IMAP mailboxes"
url="https://sr.ht/~whynothugo/ImapGoose/"
# loongarch64, riscv64: Flags did not converge within timeout
# https://gitlab.alpinelinux.org/alpine/aports/-/issues/17779
arch="all !loongarch64 !riscv64"
license="ISC"
makedepends="go sqlite-dev"
checkdepends="dovecot golangci-lint mandoc"
subpackages="$pkgname-doc $pkgname-openrc $pkgname-systemd $pkgname-zsh-completion"
source="imapgoose-$pkgver.tar.gz::https://git.sr.ht/~whynothugo/ImapGoose/archive/v$pkgver.tar.gz"
builddir="$srcdir/ImapGoose-v$pkgver"
options="net"

build() {
	make build PREFIX=/usr
}

check() {
	# Increase timeout for tests. Required for slower builders/architectures.
	IMAPGOOSE_TEST_CONVERGENCE_TIMEOUT=300 make check
}

package() {
	make DESTDIR="$pkgdir/" PREFIX=/usr/ install
}

sha512sums="
82aaf46cb183e870f4c37b633ca1e56c87851a2818a185afc6115d11e3db2c70a2fe929bd9516cdf4ef2099670e7fcb6b4e67aaedbd3fc44d3e5564de465bca7  imapgoose-0.4.2.tar.gz
"
