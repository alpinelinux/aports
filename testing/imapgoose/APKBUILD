maintainer="Hugo Osvaldo Barrera <hugo@whynothugo.nl>"
pkgname=imapgoose
pkgver=0.4.1
pkgrel=1
pkgdesc="Keep local Maildirs synchronised with IMAP mailboxes"
url="https://sr.ht/~whynothugo/ImapGoose/"
arch="all"
license="ISC"
makedepends="go sqlite-dev"
checkdepends="dovecot golangci-lint mandoc"
subpackages="$pkgname-doc $pkgname-openrc $pkgname-systemd"
source="imapgoose-$pkgver.tar.gz::https://git.sr.ht/~whynothugo/ImapGoose/archive/v$pkgver.tar.gz"
builddir="$srcdir/ImapGoose-v$pkgver"
options="net"

# https://gitlab.alpinelinux.org/alpine/aports/-/issues/17779
case "$CARCH" in
loongarch64) options="$options !check" ;;
esac

build() {
	make build PREFIX=/usr
}

check() {
	# Increase timeout for tests. Required for slower builders/architectures.
	IMAPGOOSE_TEST_CONVERGENCE_TIMEOUT=300 make check
}

package() {
	make DESTDIR="$pkgdir/" PREFIX=/usr/ install
}

sha512sums="
fd53d04ec6886602e4a4a5e6d7fd7d62b6d0cf5aa92105db8269433966380932295824edadd03500d132644d5af4566ff5cc945437ed70e85f4b8f45f9daa943  imapgoose-0.4.1.tar.gz
"
