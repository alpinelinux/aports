# Maintainer: Micha≈Ç Adamski <michal@ert.pl>
pkgname=btcd
pkgver=0.25.0
_pkgver=${pkgver/_/-}
pkgrel=0
pkgdesc="Alternative full node bitcoin implementation written in Go"
url="https://github.com/btcsuite/btcd#btcd"
arch="all !x86 !armhf !armv7"
license="ISC"
options="net"
makedepends="go"
source="https://github.com/btcsuite/btcd/archive/v$_pkgver/btcd-$_pkgver.tar.gz"

# secfixes:
#   0.23.3-r0:
#     - CVE-2022-39389

export GOCACHE="${GOCACHE:-"$srcdir/go-cache"}"
export GOTMPDIR="${GOTMPDIR:-"$srcdir"}"
export GOMODCACHE="${GOMODCACHE:-"$srcdir/go"}"

build() {
	mkdir bin
	go build -trimpath -v -o bin . ./cmd/...
}

check() {
	GOFLAGS="${GOFLAGS/-trimpath/}" go test ./...
}

package() {
	for bin in bin/*; do
		install -Dm755 $bin "$pkgdir"/usr/$bin
	done
}
sha512sums="
6c806cbe076f2c316ad4c3934fbc5029f6809bc45d683b4d46d35d076e90a9a761b10522be13c73db7353c50554d3def638929cdf511fdd93ce25d32a7ee552a  btcd-0.25.0.tar.gz
"
