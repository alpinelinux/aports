# Maintainer: omni <omni+alpine@hack.org>
maintainer="omni <omni+alpine@hack.org>"
pkgname=zfsnap
pkgver=1.11.2
pkgrel=0
pkgdesc="portable, performant script to make rolling ZFS snapshots easy"
url="https://github.com/zfsnap/zfsnap/tree/legacy"
arch="noarch"
license="BSD-3-Clause"
depends="zfs"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/zfsnap/zfsnap/archive/refs/tags/v$pkgver.tar.gz"
options="!check" # require zfs

build() {
	for period in hourly daily weekly monthly; do
		sed -e "s,xPERIODICx,$period,g" -e "s,xPREFIXx,/usr/bin,g" \
			xPERIODICx_zfSnap.sh > "$period"_zfSnap.sh
		sed -e "s,xPERIODICx,$period,g" -e "s,xPREFIXx,/usr/bin,g" \
			xPERIODICx_zfSnap_delete.sh > "$period"_zfSnap_delete.sh
	done
}

package() {
	install -Dm0755 zfSnap.sh "$pkgdir"/usr/bin/zfSnap

	for period in hourly daily weekly monthly; do
		install -Dm0755 "$period"_zfSnap.sh \
			"$pkgdir"/etc/periodic/"$period"/402.zfSnap
		install -Dm0755 "$period"_zfSnap_delete.sh \
			"$pkgdir"/etc/periodic/"$period"/403.zfSnap_delete
	done

	install -Dm0644 zfSnap.8 -t "$pkgdir"/usr/share/man/man8/
}

sha512sums="
41bcb6f0622bdaa52890c92ead5b4dd5011ac1658bc6c35fb67f32da32e3db9748e5c12ea0158cf84c06e125872d7ac22f92b539824e72d9d25959a552ebb41b  zfsnap-1.11.2.tar.gz
"
