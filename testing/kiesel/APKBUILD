maintainer="Linus Groh <mail@linusgroh.de>"
pkgname=kiesel
pkgver=0_git20251119
_commit=23a660d2cc71e1367be6c0ef9f8a4beeae4d0284
_pkgver=0.1.0-dev+${_commit:0:9}
pkgrel=0
pkgdesc="JavaScript engine written in Zig"
url="https://kiesel.dev/"
arch="x86_64 aarch64" # zig
license="MIT"
makedepends="zig cargo"
subpackages="$pkgname-doc"
source="$pkgname-$_commit.tar.gz::https://codeberg.org/kiesel-js/kiesel/archive/$_commit.tar.gz
	alpine-rust-targets.patch
	"
builddir="$srcdir/kiesel"
options="net" # zig deps

build() {
	zig build \
		-Dcpu=baseline \
		-Doptimize=ReleaseSafe \
		-Dversion-string="$_pkgver"
}

check() {
	zig build test
}

package() {
	install -Dm755 zig-out/bin/kiesel -t "$pkgdir"/usr/bin/
	install -Dm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
	install -Dm644 docs/kiesel.1 -t "$pkgdir"/usr/share/man/man1/
}

sha512sums="
b3a75e2bbe612038cfaed0e6502f8c6a46a5c9b78ed5395efd76768d4c618c5942317a8f8419c30eff2e5e06a573b5b430a3cd0821fe6846e0cd3c24dcd3c2e7  kiesel-23a660d2cc71e1367be6c0ef9f8a4beeae4d0284.tar.gz
cb4e266f4925d407f95b74b2d1ba1bf52470e0a31721b90cfc119b053fdcb2a4f70e1128ae6c6556826486598e3c7a5b407c16588a5c95497900b65eb0e9c561  alpine-rust-targets.patch
"
