// From: https://github.com/godotengine/godot-demo-projects/blob/2.1.4-stable/2d/screen_space_shaders/screen_shaders.tscn
// MIT License: https://github.com/godotengine/godot-demo-projects/blob/2.1.4-stable/LICENSE.md
// [sub_resource type="CanvasItemShader" id=5]

uniform texture vignette;
uniform float radius=0.005;
uniform float etching=2.0;
uniform float edge_darken=0.5;

float d = length(UV-vec2(0.5,0.5))*etching;
mat2 rot = mat2( vec2(cos(d),-sin(d)), vec2(sin(d),cos(d)) );

vec3 col = vec3(0);

col+= texscreen(SCREEN_UV+rot*vec2(-radius,-radius));
col+= texscreen(SCREEN_UV+rot*vec2(0,-radius));
col+= texscreen(SCREEN_UV+rot*vec2(radius,-radius));

col+= texscreen(SCREEN_UV+rot*vec2(-radius,0));
vec3 scol = texscreen(SCREEN_UV+vec2(0,0));
col+= scol;
col+= texscreen(SCREEN_UV+rot*vec2(radius,0));


col+= texscreen(SCREEN_UV+rot*vec2(-radius,radius));
col+= texscreen(SCREEN_UV+rot*vec2(0,radius));
col+= texscreen(SCREEN_UV+vec2(radius,radius));

col/=9.0;
float v = tex(vignette,UV).r;
COLOR.rgb=mix(col,scol,v)*mix(1.0,v,edge_darken);


