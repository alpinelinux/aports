# Contributor: Jann - Ove Risvik <jann.ove@usaklig.com>
# Maintainer:
pkgname=opensm
pkgver=3.3.20
pkgrel=1
pkgdesc="OpenSM InfiniBand subnet manager"
url="https://www.openfabrics.org/index.php/openfabrics-software.html"
arch="x86 x86_64 ppc64le"
license="GPL-2.0 BSD"
depends=""
depends_dev="libibumad-dev"
makedepends="$depends_dev bison flex"
install=""
subpackages="$pkgname-dev $pkgname-doc"
source="https://www.openfabrics.org/downloads/management/$pkgname-$pkgver.tar.gz
0001-musl-fixes.patch"

builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	update_config_sub
	default_prepare
}

build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var
	make
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
}

sha512sums="ea76ae8088c949d6d0d7524920cb333d0981af34bdbe2fa2bde30f13b58dcaeb842989621990a09dfd02db56c180a70109a00e5a45aba800d593b7ee95e4b9b7  opensm-3.3.20.tar.gz
c5f07423c9726bc4671327596d8585a669b25d75d9143db99e621ab6a08ed4aa0ee22e9725afe10bf4bf98ed503a06e9f52639f41a3cae61a34987b4ed643a32  0001-musl-fixes.patch"
