maintainer="Leon White <badfunkstripe@gmail.com>"
pkgname=protoc-gen-js
pkgver=4.0.0
pkgrel=0
pkgdesc="protoc-gen-js javascript protobuf generator"
url="https://github.com/protocolbuffers/protobuf-javascript"
# bazel
arch="x86_64 aarch64"
license="BSD-3-Clause AND Apache-2.0"
depends="protoc"
makedepends="bazel8 linux-headers"
source="$pkgname-$pkgver.tar.gz::https://github.com/protocolbuffers/protobuf-javascript/archive/refs/tags/v$pkgver.tar.gz
	build.patch
	"
builddir="$srcdir/protobuf-javascript-$pkgver"
# bazel stuff, no tests
options="net !check"

build() {
	# prevent broken ccache use
	JAVA_HOME=/usr/lib/jvm/java-21-openjdk \
	PATH=/bin:/usr/bin \
		bazel build plugin_files
}

package() {
	install -Dm755 bazel-bin/generator/protoc-gen-js -t "$pkgdir"/usr/bin
}

sha512sums="
548f016b1342eda5a572ab0af5fbb5dc1df31193727cd63f96927522e93ae5c9654feb7b97579c768bb95611f241ef96eddeaa6fb79c309e1bbbce425cfd76a6  protoc-gen-js-4.0.0.tar.gz
bea8a077513d885febb9763c421022bcdead39688df316548d21e6bf40efa296b65a7291892537d0a3a5a43f2840ad57ce62ed749e4a33efdddd845ae19c741d  build.patch
"
