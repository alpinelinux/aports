maintainer="Leon White <badfunkstripe@gmail.com>"
pkgname=protoc-gen-js
pkgver=4.0.1
pkgrel=0
pkgdesc="protoc-gen-js javascript protobuf generator"
url="https://github.com/protocolbuffers/protobuf-javascript"
# bazel
arch="x86_64 aarch64"
license="BSD-3-Clause AND Apache-2.0"
depends="protoc"
makedepends="
	bazel8
	linux-headers
	nodejs
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/protocolbuffers/protobuf-javascript/archive/refs/tags/v$pkgver.tar.gz"
builddir="$srcdir/protobuf-javascript-$pkgver"
# bazel stuff, no tests
options="net !check"

build() {
	# prevent broken ccache use
	JAVA_HOME=/usr/lib/jvm/java-21-openjdk \
	PATH=/bin:/usr/bin \
		bazel build plugin_files
}

package() {
	install -Dm755 bazel-bin/generator/protoc-gen-js -t "$pkgdir"/usr/bin
}

sha512sums="
9ed4d6e2d1252a1e6a08d8073b15065e97f4952d4c53d5e85ed7ad2dd972a3e094d7c314f00b56d35360a19f5a15481254bd848cb1257cb3f1ffe5efbfd2b128  protoc-gen-js-4.0.1.tar.gz
"
