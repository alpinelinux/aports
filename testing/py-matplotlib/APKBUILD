# Contributor: Isaac Dunham <ibid.ag@gmail.com>
# Maintainer: Isaac Dunham <ibid.ag@gmail.com>
pkgname=py-matplotlib
_pkgname=matplotlib
pkgver=1.5.1
pkgrel=3
pkgdesc="A Python library for plots"
url="http://matplotlib.org"
arch="all"
license="custom"
depends="py-numpy>=1.14.3-r1 py-dateutil py-parsing py-tz py-cycler"
makedepends="python2-dev python3-dev gfortran py-numpy-dev freetype-dev libpng-dev tk-dev
        py-setuptools"
subpackages="py2-${pkgname#py-}:_py2 py3-${pkgname#py-}:_py3 py2-${pkgname#py-}-doc:_py_doc py3-${pkgname#py-}-doc:_py_doc py2-${pkgname#py-}-test:_py2_tests py3-${pkgname#py-}-test:_py3_tests"
#subpackages="py2-${pkgname#py-}:_py2 py3-${pkgname#py-}:_py3 py2-${pkgname#py-}-test:_py2_tests py3-${pkgname#py-}-test:_py3_tests"
source="$_pkgname-$pkgver.tar.gz::https://github.com/matplotlib/$_pkgname/archive/v$pkgver.tar.gz"
builddir="$srcdir/$_pkgname-$pkgver"

build() {
        cd "$builddir"
        python2 setup.py build
        python3 setup.py build
}

check() {
	cd "$builddir"
	python2 setup.py test
	python3 setup.py test
}

package() {
        mkdir -p "$pkgdir"
}

_py2() {
       replaces="$pkgname"
       depends="${depends//py-/py2-} python2-tkinter"
       _py python2 "$subpkgdir"/usr/share/licenses/custom/${pkgname//py-/py2-}
}

_py3() {
       depends="${depends//py-/py3-} python3-tkinter"
       _py python3 "$subpkgdir"/usr/share/licenses/custom/${pkgname//py-/py3-}
}

_py() {
       local python="$1"
       local license_path="$2"
       pkgdesc="$pkgdesc (for $python)"
       depends="$depends $python"
       install_if="${pkgname//py-/py3-}=$pkgver-r$pkgrel $python"

       cd "$builddir"
       $python setup.py install --prefix=/usr --root="$subpkgdir"
       install -m755 -d $license_path
       install -m644 LICENSE/* $license_path/
}

_py2_tests() {
       depends="${depends//py-/py2-} py2-nose"
       _py_tests python2
}

_py3_tests() {
       depends="${depends//py-/py3-} py3-nose"
       _py_tests python3
}

_py_tests() {
       local python="$1"
       pkgdesc="$pkgdesc (tests for $python)"
       arch="noarch"
       local sitepath="$($python -c 'import site; print(site.getsitepackages()[0])')/$_pkgname"
       mkdir -p "$subpkgdir"$sitepath
       mv "${subpkgdir/-test/}"$sitepath/tests "$subpkgdir"$sitepath/
}

_py_doc() {
       mkdir -p "$subpkgdir/usr/share"
       mv "${subpkgdir/-doc}/usr/share/$i" "$subpkgdir/usr/share/"
}

md5sums="b22dc4962f36aab919a7125b3b35953b  matplotlib-1.5.1.tar.gz"
sha256sums="64c9f7cce4075d05c2602108ee1795aa6455c2c1d8e4329c95c83465e3806887  matplotlib-1.5.1.tar.gz"
sha512sums="da99fffcb4fb600ed4386ce89e61725768d4209f3bd4ab174e0d8474c24b2736516a4299ceaa0714b276d7d02c3e33e39a6204e014569ec3f6249085b1ba7a0d  matplotlib-1.5.1.tar.gz"
