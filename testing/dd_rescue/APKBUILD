# Contributor: John D. Rowell <me@jdrowell.com>
# Maintainer: John D. Rowell <me@jdrowell.com>
pkgname=dd_rescue
pkgver="1.99.8"
pkgrel=0
pkgdesc="Like dd, but allows for copying from devices with bad blocks"
url="http://www.garloff.de/kurt/linux/ddrescue/"
arch="x86_64"
license="GPL-2.0-or-later"
depends=""
makedepends=""
install=""
subpackages="$pkgname-doc"
source="http://www.garloff.de/kurt/linux/ddrescue/dd_rescue-1.99.8.tar.bz2
        10-fmt_no.h.patch
	30-fstrim.h.patch
	40-ddr_ctrl.h.patch"
builddir="$srcdir/$pkgname-$pkgver"
patch_args="-p0"
options="!check"

prepare() {
	default_prepare

	cd "$builddir"
	./autogen.sh
	echo -e "#include <stdint.h>\n#include <bits/reg.h>" >> config.h
}

build() {
	cd "$builddir"
	EXTRA_CFLAGS="-D_GNU_SOURCE" make 
}

check() {
	cd "$builddir"
}

package() {
	cd "$builddir"
	EXTRA_CFLAGS="-D_GNU_SOURCE" make -j1 DESTDIR="$pkgdir" install
}

sha512sums="a230e1df4532671ea631036012dd1e38614e45bed58b00757f0017b0ea60f14ac3bdac07777d175aa4929def593b3c8485e463b1fc25b5067adf4cf3f3ac040d  dd_rescue-1.99.8.tar.bz2
7756aa194edb1f287b933f116f8e644ed38c315a0297d8e6e46b90d60329bdc1cf9376e2259e5ddbd1777967d599d263a0ef15bc6f586fd84defa047a977e610  10-fmt_no.h.patch
ba01c84544d12ec24b8911e67def0f0aace670af887c6170561d6ead3d88a4b5e327fcb6aa9740dda201187a25c4d8302fcdb710eeb77e174505895c2fca3047  30-fstrim.h.patch
72ac60f479f9d83f0c6a51ce94330a99b8219bd8180e6713f81c629d00bb5a96a33315dec89d2e877865c51932ecaab207219b01f4bc46b1e478491f7aae00aa  40-ddr_ctrl.h.patch"
