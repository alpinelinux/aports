# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
maintainer="Matthias Ahouansou <matthias@ahouansou.cz>"
pkgname=rescrobbled
pkgver=0.8.0
pkgrel=0
pkgdesc="MPRIS music scrobbler daemon"
url="https://github.com/InputUsername/rescrobbled"
arch="all"
license="GPL-3.0-only"
makedepends="
	cargo
	cargo-auditable
	dbus-dev
	openssl-dev
"
subpackages="
	$pkgname-openrc
	$pkgname-doc
"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/InputUsername/rescrobbled/archive/refs/tags/v$pkgver.tar.gz
	$pkgname.initd
"
options="net"

prepare() {
	default_prepare
	cargo fetch --target="$CTARGET" --locked
}

check() {
	cargo test --frozen
}

build() {
	cargo auditable build --release --frozen
}

package() {
	install -Dm755 target/release/rescrobbled "$pkgdir"/usr/bin/rescrobbled

	install -Dm644 "$srcdir"/$pkgname.initd "$pkgdir"/etc/user/init.d/"$pkgname"

	install -Dm644 LICENSE "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
}

sha512sums="
2e54180b6a29266878109aaff77e0266973aa5c68f186864aeaeae6fe7b870867204d1efeaf28726c3aee53dc4841c1917cc2552d80facd82ac680302cffc4ae  rescrobbled-0.8.0.tar.gz
cb4425b43f9faef558dd848bf2bc5743b234dcdef00c92676a17eb0fc89e73e908abebdddbdb96e93f80a989bfd8b1aaf6c5cd8afbf731784c383e94de7a3ece  rescrobbled.initd
"
