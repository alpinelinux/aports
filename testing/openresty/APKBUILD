# Contributor: tcely <tcely@users.noreply.github.com>
# Maintainer:
pkgname=openresty
pkgver=1.13.6.2
pkgrel=0
pkgdesc="Scalable Web Platform by Extending NGINX with Lua"
url="https://openresty.org/"
arch="all"
license="BSD"
options="!check" # tests environment not available
depends="!nginx"
depends_dev="gd-dev geoip-dev libressl-dev libxslt-dev pcre-dev readline-dev zlib-dev"
makedepends="$depends_dev linux-headers"
install=""
subpackages="$pkgname-dev"
source="https://openresty.org/download/$pkgname-$pkgver.tar.gz"

build() {
	cd "$builddir"

	./configure \
	--prefix=/var/lib/nginx \
	--sbin-path=/usr/sbin/nginx \
	--modules-path=/usr/lib/nginx/modules \
	--conf-path=/etc/nginx/nginx.conf \
	--pid-path=/run/nginx/nginx.pid \
	--lock-path=/run/nginx/nginx.lock \
	--error-log-path=/var/log/nginx/error.log \
	--http-log-path=/var/log/nginx/access.log \
	\
	--with-file-aio \
	--with-http_addition_module \
	--with-http_auth_request_module \
	--with-http_dav_module \
	--with-http_flv_module \
	--with-http_geoip_module=dynamic \
	--with-http_gunzip_module \
	--with-http_gzip_static_module \
	--with-http_image_filter_module=dynamic \
	--with-http_mp4_module \
	--with-http_random_index_module \
	--with-http_realip_module \
	--with-http_secure_link_module \
	--with-http_slice_module \
	--with-http_ssl_module \
	--with-http_stub_status_module \
	--with-http_sub_module \
	--with-http_v2_module \
	--with-http_xslt_module=dynamic \
	--with-mail \
	--with-mail_ssl_module \
	--with-pcre-jit \
	--with-stream \
	--with-stream_ssl_module \
	--with-threads

	make
}

package() {
	cd "$builddir"

	make DESTDIR="$pkgdir" install
}

sha512sums="c0584566c06e95b12c5827f7b3185e859cb79a8d4754257246644c19888bfabfcec3577953b1a5a9aa7c0c5627b3e45bd0befacea4e3c64d21f895869ee302d5  openresty-1.13.6.2.tar.gz"
