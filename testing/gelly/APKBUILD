maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=gelly
pkgver=0.15.0
pkgrel=0
pkgdesc="Jellyfin client for Linux focused on music"
url="https://github.com/Fingel/gelly"
arch="all"
license="GPL-3.0-only"
makedepends="
	cargo-auditable
	libadwaita-dev
	gstreamer-dev
	gst-plugins-base-dev
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/Fingel/gelly/archive/refs/tags/v$pkgver.tar.gz"
options="net" # cargo fetch

prepare() {
	default_prepare

	cargo fetch --target="$CHOST" --locked
}

build() {
	cargo auditable build --frozen --release
}

check() {
	cargo test --frozen
}

package() {
	# justfile is opinionated and wants to e.g. run glib-compile-schemas which we do in a glib trigger
	install -Dm755 target/release/gelly \
		-t "$pkgdir"/usr/bin/
	install -Dm644 resources/io.m51.Gelly.desktop \
		-t "$pkgdir"/usr/share/applications/
	install -Dm644 resources/io.m51.Gelly.metainfo.xml \
		-t "$pkgdir"/usr/share/metainfo/
	install -Dm644 resources/io.m51.Gelly.gschema.xml \
		-t "$pkgdir"/usr/share/glib-2.0/schemas/
	install -Dm644 resources/io.m51.Gelly.svg \
		-t "$pkgdir"/usr/share/icons/hicolor/scalable/apps/
	install -Dm644 resources/io.m51.Gelly-symbolic.svg \
		-t "$pkgdir"/usr/share/icons/hicolor/symbolic/apps/
}

sha512sums="
18f67373f95fec8f85cb149e1ff77c33acfb63ad0cec2cb29aa48175e4e535920bfe3100bc982eeebf7c4a24c83ff50fdedebd124ff67ae5ca8cc8ba93c1728b  gelly-0.15.0.tar.gz
"
