# Contributor: Francesco Colista <francesco.colista@gmail.com>
# Maintainer: Francesco Colista <francesco.colista@gmail.com>
pkgname=dnscrypt-proxy
pkgver=1.6.1
pkgrel=1
pkgdesc="A tool for securing communications between a client and a DNS resolver"
url="http://dnscrypt.org/"
arch="all"
license="custom"
depends=""
depends_dev=""
makedepends="$depends_dev libsodium-dev"
install="$pkgname.pre-install"
pkgusers=dnscrypt
pkggroups=dnscrypt
subpackages="$pkgname-doc $pkgname-setup"
source="http://download.dnscrypt.org/$pkgname/$pkgname-$pkgver.tar.bz2
	$pkgname.initd
	$pkgname.confd
	$pkgname.setup
	"

_builddir="$srcdir"/$pkgname-$pkgver

build() {
        cd "$_builddir"
        CFLAGS="$CFLAGS -fPIC" ./configure \
                --build=$CBUILD \
                --host=$CHOST \
                --prefix=/usr \
                || return 1
        make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR=$pkgdir install || return 1
	mkdir -p "$pkgdir"/var/log/$pkgname
	mkdir -p "$pkgdir"/var/run/$pkgname
	mkdir -p "$pkgdir"/var/empty
	mkdir -p $pkgdir/usr/share/licenses/$pkgname
        install -m755 -D "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
	install -m644 -D "$srcdir"/$pkgname.confd "$pkgdir"/etc/conf.d/$pkgname
	chown dnscrypt "$pkgdir"/var/log/$pkgname
	chown dnscrypt "$pkgdir"/var/run/$pkgname
	chown dnscrypt "$pkgdir"/var/empty
	install -m 644 COPYING $pkgdir/usr/share/licenses/$pkgname
}

setup() {
	arch="noarch"
	pkgdesc="Script for setting up DNSCrypt Proxy"
	depends="sed wget $pkgname"
	mkdir -p "$subpkgdir"/sbin
	install -m755 -D "$srcdir"/$pkgname.setup "$subpkgdir"/sbin/setup-dnscrypt
}

md5sums="d59bd9a5597c95757db150343c795f84  dnscrypt-proxy-1.6.1.tar.bz2
6ca1f01a62ca9e937851986560709a61  dnscrypt-proxy.initd
77b800da6d8cdf6316afacbff740b09a  dnscrypt-proxy.confd
5f29e17b4345d8ac9bdba26a69e3ba9a  dnscrypt-proxy.setup"
sha256sums="895ac36f5d4898dabf0ed65e0a579d0aa4d9a9be9cca4dca7b573a0ff170919a  dnscrypt-proxy-1.6.1.tar.bz2
aa2b83b1944ba5f47ee5b7f2cf3cf63fbef4735753a2daf83fea3bf0ea51a7a3  dnscrypt-proxy.initd
36bd49d3fdada3ed8fc6abae7a8dd40a1f7a0aabf0eb1311698030b7ec710699  dnscrypt-proxy.confd
887c0c2d3b3d1a5326e3229ff8180351bc813f7853997e6772123beafc8bd62a  dnscrypt-proxy.setup"
sha512sums="609962f6e2aa50e9bc5b41d73e028b008f4ff76b135496801ecf7b276fe1687662695f9c5f2e889f5ebfe79e98756a45401e1dbc37aa8f69ea0b883222bc883f  dnscrypt-proxy-1.6.1.tar.bz2
5ad36161fc44d9c8c86a13e20d4d5fa0be81b317097bf1c092aab1e1e307021a8b6f1a92dbf2bec5fb7c534b59cf926235ea507fa6b4ccd2974ac2e3b7baa257  dnscrypt-proxy.initd
8cd2d40c1f465a3b26aa934fe2103650beba9504676faca3ccc9ee2b5bad940e561b3dd201d84c380bfdada72cacbe4862fc1315a4bd44fd7c56ef4f19a884f9  dnscrypt-proxy.confd
904965588e8e1119600413445627dc85a5efc0e32f7f3ad029921f59f214dd5c999bcd98a6622b572e528da4c5265083221fea189ed96407612842033ffcffe1  dnscrypt-proxy.setup"
