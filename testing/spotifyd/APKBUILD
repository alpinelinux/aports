# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer: Dawid Dziurla <dawidd0811@gmail.com>
pkgname=spotifyd
_sha=e7861116b16158d3ef7d875401c082b9bc634837
pkgver=20170702
pkgrel=0
pkgdesc="A spotify playing daemon"
url="https://github.com/Spotifyd/spotifyd"
arch="x86_64 armhf"
license="GPL-3.0"
depends=""
install="$pkgname.pre-install"
makedepends="cargo portaudio-dev protobuf-dev alsa-lib-dev"
subpackages=""
options="!check"
source="$pkgname-$pkgver.zip::$url/archive/$_sha.zip
	$pkgname.initd
	$pkgname.confd
	"
builddir="$srcdir/$pkgname-$_sha"

build() {
	cd "$builddir"
	export CARGO_HOME="$srcdir"/cargo
	export RUSTFLAGS="-C target-feature=-crt-static"
	cargo build \
		--release \
		--verbose \
		--features alsa_backend
}

package() {
	cd "$builddir"
	install -Dm755 target/release/$pkgname "$pkgdir"/usr/bin/$pkgname
	install -Dm755 "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
	install -Dm644 "$srcdir"/$pkgname.confd "$pkgdir"/etc/conf.d/$pkgname
}

sha512sums="74875b6a38a76de4d64c3ca8d551fbe8841426862356097329aac02543ce03a63e83a4dd8046541be189d3b7a01fc8c3cbd226d27f7cf364dd18665b234a5282  spotifyd-20170702.zip
f8b121c91e96367ca52ab40c328cd4bdfbfeacc443a5ab745a79232e08d4ef6458f2233a832727d59b7a732fc41d9e41765bb7fa692619b20666eae72ea1afe2  spotifyd.initd
f892204b0d6585c0d381bd41060bfd270ba649ef97acf2baf3936077b0a907f249aed5aac7b41b2e5a2efb905c2cd13ce05868e440a1ac37d46b2b384de789a6  spotifyd.confd"
