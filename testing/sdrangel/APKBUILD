# Contributor: Maya <hello@unw.re>
# Maintainer: Maya <hello@unw.re>
pkgname=sdrangel
pkgver=7.23.0
pkgrel=0
pkgdesc="SDR Rx/Tx software and analyzer for various hardware"
url="https://github.com/f4exb/sdrangel"
license="GPL-3.0-or-later"
# cm256cc
arch="aarch64 x86_64"
makedepends="
	aptdec-dev
	boost-dev
	cm256cc-dev
	cmake
	faad2-dev
	ffmpeg-dev
	fftw-dev
	flac-dev
	hackrf-dev
	librtlsdr-dev
	libusb-dev
	opencv-dev
	opus-dev
	qt6-qtbase-dev
	qt6-qtbase-private-dev
	qt6-qtcharts-dev
	qt6-qtlocation-dev
	qt6-qtmultimedia-dev
	qt6-qtscxml-dev
	qt6-qtserialport-dev
	qt6-qtspeech-dev
	qt6-qtsvg-dev
	qt6-qtwebengine-dev
	qt6-qtwebsockets-dev
	samurai
	serialdv-dev
	soapy-sdr-dev
	uhd-dev
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/f4exb/sdrangel/archive/refs/tags/v$pkgver.tar.gz
	no-march-magic.patch
	gles.patch
	"
options="!check" # no tests

build() {
	CFLAGS="$CFLAGS -O2 -flto=auto" \
	CXXFLAGS="$CXXFLAGS -O2 -flto=auto" \
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DDEBUG_OUTPUT=ON \
		-DENABLE_QT6=ON \
		-DENABLE_AIRSPY=OFF \
		-DENABLE_AIRSPYHF=OFF \
		-DENABLE_BLADERF=OFF \
		-DENABLE_FUNCUBE=OFF \
		-DENABLE_HACKRF=ON \
		-DENABLE_IIO=OFF \
		-DENABLE_LIMESUITE=OFF \
		-DENABLE_MIRISDR=OFF \
		-DENABLE_PERSEUS=OFF \
		-DENABLE_RTLSDR=ON \
		-DENABLE_SDRPLAY=OFF \
		-DENABLE_SOAPYSDR=ON \
		-DENABLE_XTRX=OFF \
		-DENABLE_PACK_MIRSDRAPI=OFF \
		-DENABLE_USRP=OFF
	cmake --build build
}

check() {
	ctest --test-dir build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
36c9bbae627c952a2672ce4f0d5e0716c0e8b3dfee461da3cc429cf3d3a6597f279549239cc887b3702de4505aba3b79a93ded0c20d0d6035ad2fdcc15d13b61  sdrangel-7.23.0.tar.gz
8779ed53c83505df3dac7a0b0a485c939f439a01f5aed203e25652cdb7d17c10ee629fab75b22b1ac9de882bfefbddcf2af5a3a8da75c5fdefc007a8fb9480f8  no-march-magic.patch
70edb741e72ae991ef72f409d046905e9db2f4e8297abe100bc16d4d521c7f1fbcc584e498e51b8f7d29140a63209961e883ca7527a41f40c784acb6a8fb5ca4  gles.patch
"
