# Contributor: Fabricio Silva <hi@fabricio.dev>
maintainer="Fabricio Silva <hi@fabricio.dev>"
pkgname=recyclarr
pkgver=8.2.1
pkgrel=0
pkgdesc="Automatically sync TRaSH guides to your Sonarr and Radarr instances"
url="https://github.com/recyclarr/recyclarr"
arch="x86_64 aarch64 armv7" # limited by dotnet
license="MIT"
options="net !check !strip" # net for nuget | strip breaks the package
subpackages="$pkgname-doc"
depends="dotnet10-runtime git"
makedepends="dotnet10-sdk"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/recyclarr/recyclarr/archive/refs/tags/v$pkgver.tar.gz
	0001-disable-gitversion.patch
	"
provides="recyclarr-cli=$pkgver-r$pkgrel" # backwards compatibility
replaces="recyclarr-cli"

build() {
	dotnet publish src/Recyclarr.Cli \
		-p:Version="$pkgver-r$pkgrel.alpine" \
		-p:IncludeSourceRevisionInInformationalVersion=false \
		-p:DisableGitVersionTask=true \
		-p:PublishSingleFile=true \
		--no-self-contained \
		--use-current-runtime \
		--configuration Release \
		--output publish
}

package() {
	install -Dm755 publish/recyclarr -t "$pkgdir"/usr/bin
	install -Dm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
}

sha512sums="
3c965ce11632638bd5491983992caa6ec6f4032195164ba4e69ddcb5393e2b1f9982d701aa84f6d8493e50fc380339c2046e96aca37d04df1968432ca3447809  recyclarr-8.2.1.tar.gz
c477c222453b8a77736b97d067c8d890c54acbddf3e05da9b8c6ed241f44bae40762385ca48d3edffc91500ce210a882c9e85e4e5e7c663d4eeac353b9999784  0001-disable-gitversion.patch
"
