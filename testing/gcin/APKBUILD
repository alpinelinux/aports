# Contributors from Arch Linux: 
#  Felix Yan <felixonmars@archlinux.org>
#  Gaetan Bisson <bisson@archlinux.org>
#  Andreas Radke <andyrtr@archlinux.org>
#  damir <damir@archlinux.org>
# Contributor: Daniel YC Lin <dlin.tw@gmail.com>
# Maintainer: Daniel YC Lin <dlin.tw@gmail.com>

pkgname=gcin
pkgver=2.8.4
pkgrel=0
pkgdesc='Input method server supporting various input methods'
url='http://hyperrate.com/dir.php?eid=67'
license="LGPL"
arch="all"
depends="gtk+2.0 libxtst"
makedepends="gtk+2.0-dev libxtst-dev qt5-qtbase-dev gtk+3.0-dev libchewing-dev"
subpackages="$pkgname-doc"
source="http://hyperrate.com/gcin-source/${pkgname}-${pkgver}.tar.xz
  qt-5.5.patch qt5_inc.patch missing_u_int.patch"
builddir="${srcdir}/${pkgname}-${pkgver}"
install="gcin.post-install gcin.post-upgrade gcin.post-deinstall"

prepare() {
	cd "$builddir"
	sed 's/lib64/lib/g' -i configure || return
	sed '/include suffixes-rule/a \
		CFLAGS+='"${CFLAGS}"' \
		LDFLAGS+='"${LDFLAGS}"' \
		OPTFLAGS=' \
		-i Makefile || return
	sed \
		-e 's:usr/include/qt5:usr/include/qt:g' \
		-e 's:QT=qt5:QT=qt:' \
		-e '/^MODVERSION=/a INCS+=-I/usr/include/qt/QtGui/$(MODVERSION) -I/usr/include/qt/QtCore/$(MODVERSION)' \
		-i qt5-im/Makefile || return

	default_prepare || return

	# Qt 5.6 doesn't provide Qt5PlatformSupport.pc anymore
	sed	-i 's/Qt5PlatformSupport//' qt5-im/Makefile || return

	./configure --prefix=/usr --use_i18n=Y \
		--use_anthy=N \
		--use_qt4=N \
		|| return
}

build() {
	cd "$builddir"
	make || return
}

package() {
	cd "$builddir"
	make DESTDIR="${pkgdir}" install || return
}
sha512sums="07e023b493953203754dedf0bf73e4fb5c093bca4c747f3989d8c07f6fdb80fc03b5e1f290fa5ed8a4b4ebd61a78454fbd8439cdea7fd79b739959862d9e25e9  gcin-2.8.4.tar.xz
cefe7fcd1009ac90a735a9b28ce7749a549a707c97019d54e2227b8e248118b21641878cfcc20cfc781693d4eff1e9fc6ff85742dabe38507505ff2d3cec57c0  qt-5.5.patch
82801ebf5ecbe059dbd42ec5721471a049e399fe46b531849e67c6507b6b5d04f91aa78201aaec350366d8fb70bebb588a74ee1f4f013fe8cf67de94885b369f  qt5_inc.patch
c2d8938cbf1c49136d2b7ebccd7b3ba670918650b1377de4d9109e3bbd7df41e8690c2160bbe7612089f086ff50a8f146f832007350c45d0937f52676a897973  missing_u_int.patch"
