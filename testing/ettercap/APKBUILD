# Contributor: Karim Kanso <kaz.kanso@gmail.com>
# Maintainer:
pkgname=ettercap
pkgver=0.8.4
pkgrel=0
pkgdesc="Multipurpose sniffer/interceptor/logger for switched LAN"
url="https://www.ettercap-project.org/"
arch="all"
license="GPL-2.0-or-later"
makedepends="
	bison
	check-dev
	cmake
	curl-dev
	flex
	libmaxminddb-dev
	libnet-dev
	libpcap-dev
	linux-headers
	ncurses-dev
	pcre2-dev
	samurai
	"
subpackages="$pkgname-doc lib$pkgname:libs"
source="https://github.com/Ettercap/ettercap/releases/download/v$pkgver/ettercap-$pkgver.tar.gz
	none-build-type.patch
	"

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		CMAKE_CROSSOPTS="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake3.5 -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=None \
		$CMAKE_CROSSOPTS \
		-DENABLE_GTK=OFF \
		-DINSTALL_DESKTOP=OFF \
		-DBUNDLED_LIBS=OFF \
		-DENABLE_TESTS=ON

	cmake --build build
}

check() {
	ctest --test-dir build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
a1268b56199a2f1f2c3af6cda9c8203e33dd2c13a1a8fc826c58e90daf081b014dc4bdeade463df14b72334df63baf5a52a40ebabc37b39109434d63921ded17  ettercap-0.8.4.tar.gz
9aae86ee1599b4ffa0b9c0c5acc7939675db12c02d53f0e47d6e18acc513c020e0dbc63812536f8d8716132e0f8aeaf2ff737b0c9d11e8d814074ded82093b7c  none-build-type.patch
"
