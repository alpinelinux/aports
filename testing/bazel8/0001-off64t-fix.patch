diff --git a/src/main/native/unix_jni.h b/src/main/native/unix_jni.h
index 742af2c97e..8b39dbbe30 100644
--- a/src/main/native/unix_jni.h
+++ b/src/main/native/unix_jni.h
@@ -18,6 +18,7 @@
 #define BAZEL_SRC_MAIN_NATIVE_UNIX_JNI_H__
 
 #include <errno.h>
+#include <features.h>
 #include <jni.h>
 #include <stdint.h>
 #include <sys/stat.h>
@@ -26,8 +27,7 @@
 
 namespace blaze_jni {
 
-#if defined(__APPLE__) || defined(__FreeBSD__) || defined(__OpenBSD__)
-// stat64 is deprecated on OS X/BSD.
+#if defined(__APPLE__) || defined(__FreeBSD__) || defined(__OpenBSD__) || defined(__GLIBC__) || defined(__linux__)
 typedef struct stat portable_stat_struct;
 #define portable_stat ::stat
 #define portable_lstat ::lstat
diff --git a/src/main/native/unix_jni_linux.cc b/src/main/native/unix_jni_linux.cc
index a8865586eb..e48af2869d 100644
--- a/src/main/native/unix_jni_linux.cc
+++ b/src/main/native/unix_jni_linux.cc
@@ -13,6 +13,7 @@
 // limitations under the License.
 
 #include <errno.h>
+#include <features.h>
 #include <stdint.h>
 #include <stdlib.h>
 #include <string.h>
@@ -45,7 +46,11 @@ std::string ErrorMessage(int error_number) {
 
 int portable_fstatat(
     int dirfd, char *name, portable_stat_struct *statbuf, int flags) {
+#if defined(__GLIBC__) && !defined(__linux__)
   return fstatat64(dirfd, name, statbuf, flags);
+#else
+  return fstatat(dirfd, name, statbuf, flags);
+#endif
 }
 
 uint64_t StatEpochMilliseconds(const portable_stat_struct &statbuf,
diff --git a/src/tools/singlejar/port.h b/src/tools/singlejar/port.h
index 1bf71fc16a..0380a952bd 100644
--- a/src/tools/singlejar/port.h
+++ b/src/tools/singlejar/port.h
@@ -34,6 +34,13 @@ typedef off_t off64_t;
 typedef __int64 off64_t;
 #elif defined(__OpenBSD__)
 typedef int64_t off64_t;
+#elif defined(__GLIBC__) || defined(__linux__)
+#include <features.h>
+#if defined(__GNU_LIBRARY__) || defined(__GLIBC__)
+typedef off64_t off_t;
+#else
+typedef off_t off64_t;
+#endif
 #endif
 static_assert(sizeof(off64_t) == 8, "File offset type must be 64-bit");
 
