maintainer="Aster Boese <asterboese@mailbox.org>"
pkgname=mediascanner2
pkgver=0.200
pkgrel=0
pkgdesc="Media scanner for Lomiri"
url="https://gitlab.com/ubports/development/core/mediascanner2.git"
arch="all"
license="GPL-3.0-only AND LGPL-3.0-only"
makedepends="
	cmake
	dbus-cpp-dev
	gdk-pixbuf-dev
	glib-dev
	gmock
	gtest-dev
	gstreamer-dev
	gst-plugins-base-dev
	libapparmor-dev
	libexif-dev
	qt5-qtbase-dev
	qt5-qtdeclarative-dev
	samurai
	sqlite-dev
	taglib-dev
	udisks2-dev
	"
subpackages="$pkgname-systemd"
source="https://gitlab.com/ubports/development/core/mediascanner2/-/archive/$pkgver/mediascanner2-$pkgver.tar.gz
	0001-Fix-usage-of-invalid-CMake-command-msg.patch
	0002-point-qmlplugindump-to-qmlplugindump-qt5.patch
	0003-disable-coverage-report.patch
	"
options="!check" # tests fail to find gmock

build() {
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=ON \
		-DCMAKE_BUILD_TYPE=None \
		-DENABLE_TESTS=OFF
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
5638e2232064d61d5676d849ef99a32a07c5a2c4b6ace2a0fa1a98160c6b88b1af65244e1bd9ef91e3da6ca590ca3996612fd31f65fe1281317da48f2293b1bb  mediascanner2-0.200.tar.gz
be47ab41126c76a4099236cd6896b25f25567ce54dd5d0f6b77304861d242b3d60675a36806ab0cb5cbe1b25e40afbf1c3f94f4b971cbca12c5529b6a821e5fb  0001-Fix-usage-of-invalid-CMake-command-msg.patch
f484c672ee10d01548a49cc8c0463bb73066003bd4b0a580580f7372c93b49d0ca393ee4032fcb4c9f44c9bb2b12fc0fb28a0fc5ecc3c50b7f4d72b885386bc4  0002-point-qmlplugindump-to-qmlplugindump-qt5.patch
24b4bee0eedfe0ec6ec1cd06d0fbbbbdd80a6b8f5934a4d9b58363231350a993e56d24a5365fc12e2e93e469caa60b5ed384993f4cbec89fb11ed23a8a6b5348  0003-disable-coverage-report.patch
"
