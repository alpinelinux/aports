# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=qownnotes
pkgver=25.10.4
pkgrel=0
pkgdesc="Plain-text file markdown note taking with Nextcloud/ownCloud integration"
url="https://www.qownnotes.org/"
arch="all !armhf" # armhf blocked by qt6-qtdeclarative
license="GPL-2.0-only"
depends="qt6-qtbase-sqlite"
# TODO system md4c https://github.com/pbek/QOwnNotes/pull/3080
makedepends="
	botan3-dev
	cmake
	md4c-dev
	qt6-qtbase-dev
	qt6-qtdeclarative-dev
	qt6-qtsvg-dev
	qt6-qttools-dev
	qt6-qtwebsockets-dev
	samurai
	"
subpackages="$pkgname-lang"
source="https://github.com/pbek/QOwnNotes/releases/download/v$pkgver/qownnotes-$pkgver.tar.xz"
options="!check" # no tests

prepare() {
	default_prepare
	echo "#define RELEASE \"Alpine Linux\"" > release.h
}

build() {
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=None \
		-DQON_QT6_BUILD=ON \
		-DBUILD_WITH_SYSTEM_BOTAN=ON
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

lang() {
	pkgdesc="Translations for $pkgname"
	install_if="$pkgname=$pkgver-r$pkgrel lang"

	amove usr/share/QOwnNotes/translations
}

sha512sums="
00b6cc22f64ada13e6ce61b43075ba10186f92eb4edf52c59afd212bb36cc01832df19891c346a619c74842f2fe3be69685877b7471f158a22993643c0fdd7a7  qownnotes-25.10.4.tar.xz
"
