# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=qownnotes
pkgver=25.12.5
pkgrel=0
pkgdesc="Plain-text file markdown note taking with Nextcloud/ownCloud integration"
url="https://www.qownnotes.org/"
arch="all !armhf" # armhf blocked by qt6-qtdeclarative
license="GPL-2.0-only"
depends="qt6-qtbase-sqlite"
# TODO system md4c https://github.com/pbek/QOwnNotes/pull/3080
makedepends="
	botan3-dev
	cmake
	md4c-dev
	qt6-qtbase-dev
	qt6-qtdeclarative-dev
	qt6-qtsvg-dev
	qt6-qttools-dev
	qt6-qtwebsockets-dev
	samurai
	"
subpackages="$pkgname-lang"
source="https://github.com/pbek/QOwnNotes/releases/download/v$pkgver/qownnotes-$pkgver.tar.xz"
options="!check" # no tests

prepare() {
	default_prepare
	echo "#define RELEASE \"Alpine Linux\"" > release.h
}

build() {
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=None \
		-DQON_QT6_BUILD=ON \
		-DBUILD_WITH_SYSTEM_BOTAN=ON
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

lang() {
	pkgdesc="Translations for $pkgname"
	install_if="$pkgname=$pkgver-r$pkgrel lang"

	amove usr/share/QOwnNotes/translations
}

sha512sums="
0683491334792af23773b435e43487b06e379e74e3d62b787c31e62b282c626bd5bc89549b3d825dcb2c853e3156d123793e04d6d3edb83efd0ffcabaa0b4ed6  qownnotes-25.12.5.tar.xz
"
