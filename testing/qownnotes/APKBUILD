# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=qownnotes
pkgver=25.12.4
pkgrel=0
pkgdesc="Plain-text file markdown note taking with Nextcloud/ownCloud integration"
url="https://www.qownnotes.org/"
arch="all !armhf" # armhf blocked by qt6-qtdeclarative
license="GPL-2.0-only"
depends="qt6-qtbase-sqlite"
# TODO system md4c https://github.com/pbek/QOwnNotes/pull/3080
makedepends="
	botan3-dev
	cmake
	md4c-dev
	qt6-qtbase-dev
	qt6-qtdeclarative-dev
	qt6-qtsvg-dev
	qt6-qttools-dev
	qt6-qtwebsockets-dev
	samurai
	"
subpackages="$pkgname-lang"
source="https://github.com/pbek/QOwnNotes/releases/download/v$pkgver/qownnotes-$pkgver.tar.xz"
options="!check" # no tests

prepare() {
	default_prepare
	echo "#define RELEASE \"Alpine Linux\"" > release.h
}

build() {
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=None \
		-DQON_QT6_BUILD=ON \
		-DBUILD_WITH_SYSTEM_BOTAN=ON
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

lang() {
	pkgdesc="Translations for $pkgname"
	install_if="$pkgname=$pkgver-r$pkgrel lang"

	amove usr/share/QOwnNotes/translations
}

sha512sums="
179e8848385e9951698d118c15d27d2b38730c7a8166a83e8b974e036cb6f045ea901b06f1a6d8fecb5fec84bf8130a7eb04d828dc2a194f0f47cc5493646d1b  qownnotes-25.12.4.tar.xz
"
