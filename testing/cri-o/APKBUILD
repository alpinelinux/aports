# Maintainer: Dan Williams <dan@ma.ssive.co>
pkgname=cri-o
pkgver=1.10.0_beta1
pkgrel=0
pkgdesc="CLI tool for spawning and running containers according to the OCI specification"
url="https://github.com/kubernetes-incubator/cri-o"
arch="all"
license="Apache-2.0"
depends=""
makedepends="go libc6-compat glib-dev gpgme-dev linux-headers btrfs-progs-dev lvm2-dev libseccomp-dev"
install=""
subpackages=""
source="cri-o.tar.gz::$url/archive/v${pkgver/_beta1/-beta.1}.tar.gz
"

builddir="$srcdir/$pkgname-${pkgver/_beta1/-beta.1}"

prepare() {
	mkdir -p "$builddir"/bin
}

build() {
	export AUTO_GOPATH=1

	cd $builddir
	mkdir -p src/github.com/opencontainers/
	ln -s "$builddir" src/github.com/opencontainers/runc
	cd src/github.com/opencontainers/runc
	GOPATH="$PWD" make binaries
}

package() {
	cd $builddir
	install -Dm755 bin/crio "$pkgdir"/usr/bin/crio
	install -Dm755 bin/pause "$pkgdir"/usr/bin/pause
	install -Dm755 bin/conmon "$pkgdir"/usr/bin/conmon
}

check() {
	cd $builddir
	./bin/crio --help > /dev/null
	./bin/conmon --help > /dev/null
}

sha512sums="3d49fb69ef2284d4582c479117f11f609cb13ce25f8405240b76b3a7ab72745d613ad209881d50c4b508418f74f1c21576fc0986bafbdb2fe5e793d41cdc9b67  cri-o.tar.gz"
