maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=gst-thumbnailers
pkgver=1.0_alpha1
_pkgver=${pkgver/_alpha/.alpha.}
pkgrel=1
pkgdesc="Thumbnail generator using GStreamer"
url="https://gitlab.gnome.org/sophie-h/gst-thumbnailers"
arch="noarch"
license="GPL-3.0-only"
depends="gst-audio-thumbnailer gst-video-thumbnailer"
makedepends="
	cargo
	cargo-auditable
	glycin-loaders-dev
	gst-plugins-base-dev
	meson
	"
subpackages="gst-audio-thumbnailer:audio:all gst-video-thumbnailer:video:all"
source="https://gitlab.gnome.org/sophie-h/gst-thumbnailers/-/archive/$_pkgver/gst-thumbnailers-$_pkgver.tar.gz
	cargo-auditable.patch
	"
builddir="$srcdir/$pkgname-$_pkgver"

build() {
	abuild-meson \
		output .
	meson compile -C output
}

check() {
	meson test --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

audio() {
	pkgdesc="$pkgdesc (audio)"
	depends=
	amove usr/bin/gst-audio-thumbnailer
	amove usr/share/thumbnailers/gst-audio-thumbnailer.thumbnailer
}

video() {
	pkgdesc="$pkgdesc (video)"
	depends=
	amove usr/bin/gst-video-thumbnailer
	amove usr/share/thumbnailers/gst-video-thumbnailer.thumbnailer
}

sha512sums="
b94979aef85d4343fa204ae439d3bfff337c3e96f3259a940e48aec8a92241dfc1496ed3896adac9827d185a11f156fb20350a5ded2289295cb68980a7891cc2  gst-thumbnailers-1.0.alpha.1.tar.gz
c202d7d673966fa6a767bc5f2019fc82a8cdd73b01fd61095667c25e9cba15f3b6c10a055ddfef6a6e879d6c3c57a47d29fdee99f4af3f37cdf45df4136ccea2  cargo-auditable.patch
"
