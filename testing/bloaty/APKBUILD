#-*-mode: Shell-script; coding: utf-8;-*-
# Maintainer: Mitch Tishmack <mitch.tishmack@gmail.com>
pkgname=bloaty
# Fake a version until upstream does one
# format is simply 0.0.0.0.${commit_count}
pkgver=0.0_git20170301
pkgrel=0
pkgdesc="A size profiler for binaries"
url="https://github.com/google/bloaty"
arch="all"
license="apache"
depends=""
makedepends="gcc cmake git"
# This software has no releases yet, and has git submodules for 3 things
#
# Note, this is just from the snapshot function
source="https://mitchty.net/bloaty-9572093.tar.xz byteswap.patch"
builddir="$srcdir/${pkgname}.git"

build() {
	make || return 1
}

check() {
	make test || return 1
}

package() {
	install -Dm0755 "${builddir}/bloaty" "${pkgdir}/usr/bin/bloaty" || return 1
	strip "${pkgdir}/usr/bin/bloaty" || return 1
}

snapshot() {
	local dir="bloaty.git"
	git clone --recursive https://github.com/google/bloaty ${dir}
	cd ${dir}
	local commit=$(git rev-parse --short HEAD)
	rm -fr .git
	cd ..
	tar -cf - ${dir} | xz -9 -c - > bloaty-${commit}.tar.xz
}
md5sums="3e11665eb48069adcf0cbcdf2c6be419  bloaty-9572093.tar.xz
2df8e3a50216c21db98fd2a77ccd0599  byteswap.patch"
sha256sums="cffdcb9f8be6b79bb4d8e42e676fc3b96aee84749e5cf419496731f7cba77a2a  bloaty-9572093.tar.xz
c47ec9bf72d3c344aa909168710be3dd639bb9324d5e013ead6de7ba94bf731a  byteswap.patch"
sha512sums="02ab601d0c21c575320c9425caab30b9991083ff131facd00fd57c4cce64a4c9072526091c6899d1280aa966e1609b4d36c2834074d9eb681b822fdb93dbe9cf  bloaty-9572093.tar.xz
e768ecb3660364ee18c85e6aacdabf3a83b5961b9b0d684a8766e8a5545c058580456d1732609bde07c89ff37bdc5448efa40ded24d14a96cc03575a53bfef45  byteswap.patch"
