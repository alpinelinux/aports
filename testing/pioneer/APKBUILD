# Maintainer: DÃ­az Urbaneja Diego <sodomon2@gmail.com>
pkgname=pioneer
pkgver=20190203
pkgrel=0
pkgdesc="A game of lonely space adventure"
url="https://pioneerspacesim.net/"
arch="x86 x86_64"
license="GPL3"
depends="assimp curl freetype glew hicolor-icon-theme libpng libsigc++ libvorbis lua5.2 mesa sdl2 sdl2_image"
makedepends="assimp-dev curl-dev freetype-dev glew-dev libpng-dev libsigc++-dev libvorbis-dev lua5.2-dev mesa-dev sdl2-dev sdl2_image-dev automake pkgconf make"
options="!check"
source="$pkgname-$pkgver.zip::https://github.com/$pkgnamespacesim/$pkgname/archive/$pkgver.zip
  buildopts.h
  net.pioneerspacesim.Pioneer.desktop
  BVHTree.patch
  FileSystemPosix.patch
  Game.patch
  LuaEngine.patch
  main.patch
  modelcompiler.patch
  ObjectViewerView.patch
  OSPosix.patch
  Pi.patch"
builddir="$srcdir/$pkgname-$pkgver"

prepare(){
  ./bootstrap
  cp -f "$srcdir"/buildopts.h "$builddir"
  cp -f "$srcdir"/buildopts.h "$builddir"/src
}

build() {
  cd "$builddir"
  patch src/posix/OSPosix.cpp < $srcdir/OSPosix.patch
  ./configure \
    --datarootdir=/usr/share/pioneer \
    --prefix=/usr 
  make
}

package() {
	cd "$builddir"
  make install DESTDIR="$pkgdir" 
  
  mkdir -p "$pkgdir"/usr/share/pioneer
    mv data/* "$pkgdir"/usr/share/pioneer
  
  mkdir -p "$pkgdir"/usr/share/metainfo
    mv metadata/net.pioneerspacesim.Pioneer.appdata.xml "$pkgdir"/usr/share/metainfo/net.pioneerspacesim.Pioneer.appdata.xml
  
  mkdir -p "$pkgdir"/usr/share/applications
    install -Dm644 "$srcdir"/net.pioneerspacesim.Pioneer.desktop "$pkgdir"/usr/share/applications/net.pioneerspacesim.Pioneer.desktop
}

sha512sums="5cc06e13218d9e61eff9caf3b0f95bf627e0a34079d1a6b19c7cc79b29032be40a3e063f77998ca090962607d6379c5cfbe0c65de556a078246d8b513053b038  pioneer-20190203.zip
7244916a03c3ef5bfdbf161483fea725fb36ce1939c2a99afdd9ddf48e9d3dd1f23253bc7d3071aef372f105370f9be3da26a6baa4193df8a7161b508f2df790  buildopts.h
ac05d33d78056ac2e04f73ac78532a76d61be811ab4e677e325eabb98797d34a3a6e83ec665795ec811307c6d6c24e1c2490026be665948efee7c8896ca27f8b  net.pioneerspacesim.Pioneer.desktop
3ee461cabd9bbc5e5f15b1a40c59e677eb4a71a5511dc3e6b767451acffe9663af542dd709e06032005fb1fd7cbd9d771cfdd9abe0e07072f2fea1fd55f0cda7  BVHTree.patch
bb30ed443bc8f5444547501d5cdf6c6ded786e873c9b6c2e475e5119b2798a493d86f2af84942cf1445dbed72830687acce316cdba305cf036d045c42df325b7  FileSystemPosix.patch
03144f4094935facdf1be8c695d265b8dde74d2d1fbe78a01a30a0021c5083f07d83666de2b8e22062e408cdd511f7a22b73c9577dd23274ed8cacaf14af8e52  Game.patch
e140dafac2bb0f33375029de974102605daac21bb51a5e70b2acb4bd8d7dbe8da0ee637deef7bf8ac5d75e5fcf5128530f4bf686289fc392aa8534266cb80725  LuaEngine.patch
6efa847e1fc84f7ed711068cf36eca523c64212b983c06a05ac989ff09004d98d9f78e608d04f833593be01f8fc377ff522d17b89ce2b60740c73278ebf9a89a  main.patch
419d613e982f34cb891c2d4f23570ad317e6dba03ff5a98d1fbe7566cd45bf7d40e7a2aa847b6cc83bc6c512acff8f4012492b20fcc18a97f524923838c47e6d  modelcompiler.patch
7078694e3e3f95d42d0b787159fdec80fa5b65ccbba6d60a123effa0cc78157dc6cc6e862c230817625611b0a4e440b9792356f5cccf346cdd8984c008a91d31  ObjectViewerView.patch
996d9eeda5a16e9828a798e44b9eadc2b57852c5482e9954bb7261ec0d7e4019bdb4dd6e4f259967f7bbca3d7a8ee494cc757d8581341a830c6a07f22346b365  OSPosix.patch
a8e8b9ca19f0db28006454de6bb1cc139c1f7659b5c2a8ee344576c5f8da016f886edcc6949c0c6e83582ec8d511b01efd4739c80109c5bc283bd9010716c26f  Pi.patch"
