# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Luca Weiss <luca@lucaweiss.eu>
pkgname=lomiri-ui-toolkit
pkgver=1.3.5903
pkgrel=1
pkgdesc="Qt Components for Lomiri"
arch="all !armhf" # blocked by qt5-qtsystems-dev
url="https://gitlab.com/ubports/development/core/lomiri-ui-toolkit"
license="LGPL-3.0-only"
depends="
	qt5-qtfeedback
	qt5-qtgraphicaleffects
	"
depends_dev="
	eudev-dev
	libevdev-dev
	libnih-dev
	libxi-dev
	lttng-ust-dev
	mir-dev
	qt5-qtfeedback-dev
	qt5-qtgraphicaleffects
	qt5-qtpim-dev
	qt5-qtsvg-dev
	qt5-qtsystems-dev
	"
makedepends="
	$depends_dev
	qt5-qtdeclarative-dev
	qt5-qttools-dev
	"
checkdepends="
	bash
	dbus-test-runner
	diffutils
	grep
	xvfb-run
	"
source="https://gitlab.com/ubports/development/core/lomiri-ui-toolkit/-/archive/$pkgver/lomiri-ui-toolkit-$pkgver.tar.gz
	0001-Remove-debian-isms-from-test-runner.patch
	0001-Fix-build-with-Qt5-5.15.10.patch
	"
subpackages="$pkgname-dev $pkgname-lang"
options="!check" # Several tests fail

build() {
	qmake-qt5 CONFIG+="no_docs no_lttng"
	make
}

check() {
	xvfb-run make check
}

package() {
	make INSTALL_ROOT="$pkgdir" install
}

sha512sums="
ddbacdf8e77fc33c6712d06f53fae9fab5091a9867dc53450dfd86cadf0c74810a69e522e78b88e7e07fa4c7b88d60c065906031912f0e60d5a64680406e76fc  lomiri-ui-toolkit-1.3.5903.tar.gz
7423ea0f4edececdeab09c4c91686e981ecedc2b7b39d147d604eb1bd8cdb26a1c3b4fad848215a1a8db1197bd3a58fb82651b0e298c52181632ae629c307d9a  0001-Remove-debian-isms-from-test-runner.patch
118cb74f53f0e88e1c19495453e10684d158165969c591c57b1dd84535813c02a3ee5c0047ffde9c9a49eacb8ca6de0b570419e6072ac9660e9d0219272b6b9c  0001-Fix-build-with-Qt5-5.15.10.patch
"
