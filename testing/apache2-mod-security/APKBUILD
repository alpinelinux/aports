# Contributor: Ondrej Esler <ondrej.esler@intraworlds.com>
# Maintainer: Ondrej Esler <ondrej.esler@intraworlds.com>
pkgname=apache2-mod-security
_pkgreal=modsecurity
_realname=mod_security2
pkgver=2.9.3
pkgrel=0
pkgdesc="Security Module for Apache2"
url="https://www.modsecurity.org/"
arch="all"
license="Apache-2.0"
depends="apache2 pcre libxml2"
makedepends="autoconf automake libtool linux-headers apache2-dev pcre-dev libxml2-dev"
subpackages="$pkgname-doc"
source="https://github.com/SpiderLabs/ModSecurity/releases/download/v$pkgver/$_pkgreal-$pkgver.tar.gz
	$pkgname.conf"
builddir="$srcdir/$_pkgreal-$pkgver"

build() {
	cd "$builddir"
	./autogen.sh
	./configure
	make
}

check() {
	cd "$builddir"
	make -j1 test
}

package() {
	cd "$builddir"
	install -Dm755 "apache2/.libs/$_realname.so" "$pkgdir/usr/lib/apache2/$_realname.so"
	install -Dm644 "$srcdir/$pkgname".conf \
		"$pkgdir"/etc/apache2/conf.d/$pkgname.conf
	install -Dm644 "doc/README.txt" \
		"$pkgdir/usr/share/doc/$pkgname/README.txt"
}

sha512sums="4e1ea5dd8edadf8f630e4fe92a200d3a8e78963fce3128b5975a1e1ecd0e8bf9ceecd9905c95f8c508932ccd837f1d8ae8bb2ba423307718c3c6a4ae9b783ddd  modsecurity-2.9.3.tar.gz
971b8226e44292a294a0e359881526a90dd4f68a7fa542dbede7f2474d24d5bf94ada01e8f0cecfea5991dbacdabde3fc9a4e035039755a089c9823eeeba88f0  apache2-mod-security.conf"
