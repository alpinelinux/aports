# Contributor: Ramanathan Sivagurunathan <ramzthecoder@gmail.com>
# Maintainer: Ramanathan Sivagurunathan <ramzthecoder@gmail.com>
pkgname=metricbeat
pkgver=5.2.0
pkgrel=0
pkgdesc="MetricBeat - Lightweight shipper for system and service statistics"
pkgusers="root"
url="https://www.elastic.co/products/beats"
arch="all"
license="ASL 2.0"
depends=""
makedepends="go"
install=""
subpackages=""
source="beats-${pkgver}.tar.gz::https://github.com/elastic/beats/archive/v$pkgver.tar.gz
	metricbeat.initd
	metricbeat.confd
	metricbeat.yml
	"
builddir="$srcdir/src/github.com/elastic/beats/$pkgname"

prepare() {
	mkdir -p "$srcdir/src/github.com/elastic/"
	mv "$srcdir/beats-${pkgver}" "$srcdir/src/github.com/elastic/beats" || return 1
	default_prepare
}

build() {
	cd "$builddir"
	GOPATH="$srcdir" go build -v || return 1
}

package() {
	cd "$builddir"
	install -Dm755 "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname || return 1
	install -Dm644 "$srcdir"/$pkgname.confd "$pkgdir"/etc/conf.d/$pkgname || return 1
	install -Dm644 "$builddir"/metricbeat.template.json "$pkgdir/etc/$pkgname/metricbeat.template.json" || return 1
	install -Dm644 "$builddir"/metricbeat.template-es2x.json "$pkgdir/etc/$pkgname/metricbeat.template-es2x.json" || return 1
	install -Dm644 "$srcdir/metricbeat.yml" "$pkgdir/etc/$pkgname/metricbeat.yml" || return 1
	install -Dm755 "$builddir/metricbeat" "$pkgdir/usr/bin/metricbeat" || return 1
}

md5sums="249efb0a727c8fd266c92d2f7dc1745d  beats-5.2.0.tar.gz
49ad02b1858c6face776153d195f147b  metricbeat.initd
2f95ba30a7a82ae7266adb1883a8a2b0  metricbeat.confd
a3a3db3ba686ef7f6dd9339be14bb909  metricbeat.yml"
sha256sums="b74d6c77e60dffe1d76623ef50117715219f8d81c2400b2aa90fef79d34ed564  beats-5.2.0.tar.gz
cf55ec4028983fe2c65ddd450bcaa6b857e910306cbc66e7b83f95adfcb0c9cb  metricbeat.initd
549aed3b40ea2ca1f9cba3e26e393d30eab6a86c1284c3b3dc2a5cf1ec433590  metricbeat.confd
772c4b28a988072e75801891a326f37e318272b2152c2f9a6986259f68c40a90  metricbeat.yml"
sha512sums="f9af43303b3645035659d8de8a9c41c95a076b47c8d7406d6af443d59e8fb19bfc0817a3444eaa7485d9833173cdf65b5b73014aacd94f9566bdf74e10a8de63  beats-5.2.0.tar.gz
a846db44732077c38fd0699592ad27371af75ee8a53419c79197c4e5d727e1745c5145ebefd21073304cb624c5947686626f693e87406b122892f99cebe38f5b  metricbeat.initd
91fad211c1ac8b3bb97848f1ff97f7e708cfd100b174ae1839c4dd60d501cd8b7b4e9f0f4dbb936134c4ef19595bf39c53b256990f08f003c3e88893e0c94212  metricbeat.confd
b05e083c2ea2337cebd650f2898385ff40fb7f4fe2d7d46109cec3e960d80566129756e8a45e71ed53ec40c33539295453d363feafb60caec8747ae8d09f9124  metricbeat.yml"
