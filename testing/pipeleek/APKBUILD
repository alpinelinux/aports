# Contributor: Jonas <3426-spameier@users.gitlab.alpinelinux.org>
# Maintainer: Jonas <3426-spameier@users.gitlab.alpinelinux.org>
pkgname=pipeleek
pkgver=0.49.0
pkgrel=0
pkgdesc="Pipeleek scans CI/CD logs and artifacts to detect leaked secrets and pivot from them"
url="https://compasssecurity.github.io/pipeleek/"
# armhf, armv7, x86: ulikunitz/xz/lzma
# ppc64le, riscv64, s390x: headzoo/surf/agent
arch="all !armhf !armv7 !ppc64le !riscv64 !s390x !x86"
license="MIT"
makedepends="go"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/CompassSecurity/pipeleek/archive/refs/tags/v$pkgver.tar.gz"
builddir="$srcdir/$pkgname-$pkgver/cmd/pipeleek"
options="net"

build() {
	go build
}

check() {
	go test -timeout 1h ./...
}

package() {
	install -Dm755 "$builddir/pipeleek" -t "$pkgdir/usr/bin/"
	install -Dm644 "$srcdir/$pkgname-$pkgver/LICENSE" -t "$pkgdir/usr/share/licenses/$pkgname/"
}

sha512sums="
1a56df7d69a9bb1b0bb49e9aa2c9d46ac12a453b8e47ac75d05be2ca2d4986e2a95cb01e89fb0d8e82fed816579088e68e616d6c5383c00872876177aa263341  pipeleek-0.49.0.tar.gz
"
