# Contributor: Jonas <3426-spameier@users.gitlab.alpinelinux.org>
# Maintainer: Jonas <3426-spameier@users.gitlab.alpinelinux.org>
pkgname=pipeleek
pkgver=0.52.0
pkgrel=1
pkgdesc="Pipeleek scans CI/CD logs and artifacts to detect leaked secrets and pivot from them"
url="https://compasssecurity.github.io/pipeleek/"
# armhf, armv7, x86: ulikunitz/xz/lzma
# ppc64le, riscv64, s390x: headzoo/surf/agent
arch="all !armhf !armv7 !ppc64le !riscv64 !s390x !x86"
license="MIT"
makedepends="go"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/CompassSecurity/pipeleek/archive/refs/tags/v$pkgver.tar.gz"
builddir="$srcdir/$pkgname-$pkgver/cmd/pipeleek"
options="net"

build() {
	go build
}

check() {
	go test -timeout 1h ./...
}

package() {
	install -Dm755 "$builddir/pipeleek" -t "$pkgdir/usr/bin/"
	install -Dm644 "$srcdir/$pkgname-$pkgver/LICENSE" -t "$pkgdir/usr/share/licenses/$pkgname/"
}

sha512sums="
a232de944228c5970c7a502048fbadc25afe4077a53259bc94a9122d5c953e3fc3ac165fd1be0ce71fc908a5f744ee8b19b42150b30ad2f60534ace67650b5eb  pipeleek-0.52.0.tar.gz
"
