# Maintainer: Patrick Gansterer <paroga@paroga.com>
pkgname=postgresql-http
_pkgname=pgsql-http
pkgver=1.7.0
pkgrel=0
pkgdesc="HTTP client for PostgreSQL, retrieve a web page from inside the database"
url="https://github.com/pramsey/pgsql-http"
arch="all"
license="MIT"
makedepends="curl-dev postgresql-dev"
subpackages="$pkgname-bitcode"
source="$pkgname-$pkgver.tar.gz::https://github.com/pramsey/pgsql-http/archive/v$pkgver.tar.gz"
builddir="$srcdir/$_pkgname-$pkgver"
options="!check"  # XXX: installcheck requires running PostgreSQL

build() {
	make
}

package() {
	depends="postgresql$(pg_config --major-version)"

	make DESTDIR="$pkgdir" install
}

bitcode() {
	pkgdesc="$pkgdesc (bitcode for JIT)"
	depends="$pkgname=$pkgver-r$pkgrel"
	install_if="postgresql$(pg_config --major-version)-jit $pkgname=$pkgver-r$pkgrel"

	amove usr/lib/postgresql*/bitcode
}

sha512sums="
94ebbcf0f09d382f1c359a38a4f6ce40c10b2feae21f963b5d64db794a5538e13c1fd2df99d8d025ee97b972eaa86bce60e02c31ec8d3d4816471c3e2b07c0dd  postgresql-http-1.7.0.tar.gz
"
