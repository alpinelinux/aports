# Contributor: 1138-4EB
# Contributor: Daniel Sabogal <dsabogalcc@gmail.com>
# Maintainer:
pkgname=octave
pkgver=4.2.0
pkgrel=1
pkgdesc="A high-level language, primarily intended for numerical computations"
url="https://www.gnu.org/software/octave/"
arch="all !s390x"
license="GPL-3.0"
depends=""
subpackages="$pkgname-doc"
makedepends="autoconf automake bison curl curl-dev fftw-dev flex fltk-dev fontconfig-dev
	freetype-dev gfortran ghostscript-dev glu-dev gnuplot graphicsmagick-dev
        icoutils imagemagick-dev hdf5-dev lapack-dev libltdl libsm-dev librsvg-dev
        lcms2-dev pcre-dev perl pkgconf portaudio-dev qt-dev readline-dev texinfo
        texlive-full zlib-dev libsndfile-dev"
source="https://ftp.gnu.org/gnu/octave/$pkgname-$pkgver.tar.gz
	less-docs.patch
	libinterp-deps.patch
	abs.patch
	gnulib.patch"
builddir="$srcdir/$pkgname-$pkgver"

prepare() {
	default_prepare || return 1

	cd "$builddir"
	find -name \*.cc -o -name \*.h -o -name \*.yy | xargs sed -i -e 's/#include <c\(math\|stdlib\)>/#include <\1.h>/'
	find -name \*.h -o -name \*.cc | xargs sed -i -e 's/<config.h>/"config.h"/' -e 's/<base-list.h>/"base-list.h"/'
}

build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--infodir=/usr/share/info \
		--mandir=/usr/share/man \
		--localstatedir=/var \
		--enable-shared \
		--disable-static \
		|| return 1
	sed -i 's/automake-1.15/automake-1.16/g' Makefile || return 1
	aclocal || return 1
	make -j2 || return 1
}

package() {
	make DESTDIR="$pkgdir/" \
		-C "$builddir" install || return 1
	rm -rf "$pkgdir"/usr/lib/charset.alias
}

sha512sums="5d16665d4ef8f218320f471704f8702f3a2911cc4a083cae318c1df0f787d50dddbc511dc91e11379314d65cecac6d521abac026860feca19d11ffdb52d3e678  octave-4.2.0.tar.gz
eb2b754c15eda423bf59061728052993a2ee9611d474e7fa6026f2961561764e6fc56fbb8128ec266bb569e99d7fecb5b68b5ed3f02ae33dd27709a89426f204  less-docs.patch
093b13ad457e290d746908a5de1855071b2cd27b4c08101826d32fcf63398e863c3b72bb81f19255a04a880a2bf49e3ced1141bf7d0044db1328c6f2c9492f66  libinterp-deps.patch
bcd111f35baf2681da2b1ad1edbe956ee359c5fb0114797b27747fa78e6f118406bb7fb325c1fa03c18e29815d2d4b8d9a28faf72c1fbbec526e8fbaed0cb820  abs.patch
50d9a7cefc0d39b666b646abe26148d7640ed2c4505244e3b5d4ba4348f80fc5d0d08465a575682fcae88d245bf72e7ba13df580003a2c5de6b7b222131a5392  gnulib.patch"
