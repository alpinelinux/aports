# Contributor: Daniel Sabogal <dsabogalcc@gmail.com>
# Maintainer:
pkgname=octave
pkgver=4.2.2
pkgrel=0
pkgdesc="A high-level language, primarily intended for numerical computations"
url="https://www.gnu.org/software/octave/"
arch="all !s390x"
license="GPL-3.0"
subpackages="$pkgname-doc"
makedepends="autoconf automake libtool bison curl-dev fftw-dev flex fltk-dev fontconfig-dev
	freetype-dev gfortran ghostscript-dev glu-dev gnuplot graphicsmagick-dev hdf5-dev
	icoutils lapack-dev lcms2-dev libltdl librsvg-dev libsm-dev libsndfile-dev pcre-dev
	perl pkgconf portaudio-dev qt-dev readline-dev texinfo texlive-full zlib-dev"
source="https://ftp.gnu.org/gnu/octave/$pkgname-$pkgver.tar.gz
	less-docs.patch
	libinterp-deps.patch
	abs.patch
	gnulib.patch"

prepare() {
	default_prepare

	cd "$builddir"
	find -name \*.cc -o -name \*.h -o -name \*.yy | xargs sed -i -e 's/#include <c\(math\|stdlib\)>/#include <\1.h>/'
	find -name \*.h -o -name \*.cc | xargs sed -i -e 's/<config.h>/"config.h"/' -e 's/<base-list.h>/"base-list.h"/'
	autoreconf -vif
}

build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--infodir=/usr/share/info \
		--mandir=/usr/share/man \
		--localstatedir=/var \
		--enable-shared \
		--disable-static
	make
}

check() {
	cd "$builddir"
	make check
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
	rm -rf "$pkgdir"/usr/lib/charset.alias
}

sha512sums="b94edd79adc0e19229bb654037910201b51b6cfa373d63de5e3aa69e9b659b2e2790e2d2b4b5e8d2f12b26846c20ba5c12eae657155c8329e85e970f738d08c2  octave-4.2.2.tar.gz
eb2b754c15eda423bf59061728052993a2ee9611d474e7fa6026f2961561764e6fc56fbb8128ec266bb569e99d7fecb5b68b5ed3f02ae33dd27709a89426f204  less-docs.patch
093b13ad457e290d746908a5de1855071b2cd27b4c08101826d32fcf63398e863c3b72bb81f19255a04a880a2bf49e3ced1141bf7d0044db1328c6f2c9492f66  libinterp-deps.patch
bcd111f35baf2681da2b1ad1edbe956ee359c5fb0114797b27747fa78e6f118406bb7fb325c1fa03c18e29815d2d4b8d9a28faf72c1fbbec526e8fbaed0cb820  abs.patch
50d9a7cefc0d39b666b646abe26148d7640ed2c4505244e3b5d4ba4348f80fc5d0d08465a575682fcae88d245bf72e7ba13df580003a2c5de6b7b222131a5392  gnulib.patch"
