# Contributor: Johan Bergström <bugs@bergstroem.nu>
# Maintainer: Johan Bergström <bugs@bergstroem.nu>
pkgname=cjose
pkgver=0.6.1
pkgrel=0
pkgdesc="A C library implementing the Javascript Object Signing and Encryption"
url="https://github.com/cisco/cjose"
arch="all !s390x !mips !mips64" # tests fails on s390x
license="MIT"
depends="jansson openssl"
makedepends="check-dev coreutils doxygen jansson-dev openssl-dev perl"
subpackages="$pkgname-dev $pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/cisco/$pkgname/archive/$pkgver.tar.gz"
builddir="$srcdir/$pkgname-$pkgver/"

prepare() {
	default_prepare

	update_config_sub
	update_config_guess
}

build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--enable-static=no \
		--with-openssl=/usr \
		--with-jansson=/usr \
		--disable-doxygen-ps \
		--disable-doxygen-pdf
	make
	# need to invoke doc generation, otherwise it doesn't get installed properly
	make doxygen
}

check() {
	cd "$builddir"
	make check
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
}

sha512sums="7ae67a6d19591b3d19b888270ec0ca17df399bea117e42686fc1de39b3741ed9a8816f96d33d090687c49c3123cdc95430a781835a525a02d22561ebf5aaa653  cjose-0.6.1.tar.gz"
