From 9f0607c59ab5a089befc8c66f279f9539fda55b6 Mon Sep 17 00:00:00 2001
From: Michael Richardson <mcr@sandelman.ca>
Date: Fri, 18 Jan 2019 20:42:37 -0500
Subject: [PATCH 3/9] wo#8100 . do not insist on GLOB_BRACE being available,
 turn off NOMAGIC, as file must always exist

---
 lib/libipsecconf/parser.l | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/lib/libipsecconf/parser.l b/lib/libipsecconf/parser.l
index 24a0b0922..17bc65692 100644
--- a/lib/libipsecconf/parser.l
+++ b/lib/libipsecconf/parser.l
@@ -55,6 +55,13 @@ extern int yylex (void);
 extern int yydebug;
 extern int verbose;
 
+/* if glob() does not support GLOB_BRACE, then
+ * resulting system just does not {a,b}
+ */
+#ifndef GLOB_BRACE
+#define GLOB_BRACE 0
+#endif
+
 struct ic_inputsource {
 	YY_BUFFER_STATE state;
 	FILE  *file;
@@ -204,11 +211,11 @@ int parser_y_include (const char *filename)
 			     "%s%s", rootdir2, filename);
 		    try = newname2;
 
-		    globresult = glob(try, GLOB_BRACE|GLOB_NOMAGIC, NULL, &globbuf);
+		    globresult = glob(try, GLOB_BRACE, NULL, &globbuf);
 	    }
 	} else {
 		/* try globbing plain name now.. */
-		globresult = glob(try, GLOB_BRACE|GLOB_NOMAGIC, NULL, &globbuf);
+		globresult = glob(try, GLOB_BRACE, NULL, &globbuf);
 	}
 
 	if(globresult == GLOB_NOMATCH)
-- 
2.11.0

