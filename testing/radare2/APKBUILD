# Contributor: Valery Kartel <valery.kartel@gmail.com>
# Contributor: stef <l0ls0fo2i@ctrlc.hu>
# Contributor: Jose-Luis Rivas <ghostbar@riseup.net>
# Maintainer: Valery Kartel <valery.kartel@gmail.com>
pkgname=radare2
pkgver=1.0
pkgrel=0
pkgdesc="An opensource, crossplatform reverse engineering framework"
url="http://www.radare.org"
arch="all !aarch64"
license="GPLv3"
depends=""
depends_dev=""
makedepends="$depends_dev libzip-dev libressl-dev capstone-dev"
install=""
subpackages="$pkgname-dev $pkgname-doc"
source="${pkgname}-${pkgver}.tar.gz::https://github.com/radare/radare2/archive/${pkgver}.tar.gz
	anal_arm_cs_shift.patch
   asmz80.patch
	"

_builddir="$srcdir"/$pkgname-$pkgver

prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--prefix=/usr \
		--with-syscapstone \
		--with-openssl \
		--with-syszip \
	|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	find "$pkgdir" -name Makefile -delete
   #for a in "$pkgdir"/usr/lib/libr_*.$pkgver; do printf "xxxxx ln -s $a ${a%%.$pkgver}\n"; done
}

#TODO: build packages from R2PM package manager (src/radare2-*/binr/r2pm/d/*)

md5sums="38cab737013d8e4c3d15bd8e18c64a29  radare2-1.0.tar.gz
664640d326fe15894891b98b629e0513  anal_arm_cs_shift.patch
0d103727a8fba57ad0c50e697a393bb6  asmz80.patch"
sha256sums="e55fdccbd8a3e654c00ce8e62c62271ae59bbc23be2dd029d17c5583a9f0d9e1  radare2-1.0.tar.gz
e45f8104bb4b3be17a2eda3028cf51fcfd99f346261ba6eddf6d90d160224a09  anal_arm_cs_shift.patch
c5913a1a4cf2e74dda9884fe6f563714dee05e03e77c23609d7afaf7b496d28e  asmz80.patch"
sha512sums="d1af8d64b81573e61bc90495eeed346e8111dea8aac5abd46f7a50894b2426ec05405e3c530e457bcb64ac631519abdefc47a6f2ddb5933af385d29c773202b8  radare2-1.0.tar.gz
ab016177a1173ad647a0028f398c9daa8ef3f71fcc4c6c2cedd8ee9a60873dd68a5c825722b2d5916408c965a89a5a3099f5582a09457c9183c9dd14b20ee880  anal_arm_cs_shift.patch
2d63c2f613063a9e683a6d1669ed875a17c9b03bb031adb2029602eb654e3b5a3bc22154ba52377087b8d65a628a7376fb9af1528bbbc98450b45d6f62193103  asmz80.patch"
