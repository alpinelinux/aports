# Contributor: Orson Teodoro <orsonteodoro@hotmail.com>
# Maintainer: Orson Teodoro <orsonteodoro@hotmail.com>

pkgname=qt5-webengine
_pkgname=qtwebengine
pkgver=5.9.3
_pkgver=5.9
pkgrel=0
pkgdesc="Qt WebEngine integrates Chromium's fast moving web capabilities into Qt."
url="http://wiki.qt.io/QtWebEngine"
arch="x86_64 x86"
license="GPL-2.0-or-later LGPL-3.0-only BSD-3-Clause MIT Apache-2.0 MPL-1.1 \
	OFL-1.1 ISC GFDL-1.3 Libpng LGPL-2.1 NSCA SGI-B-2.0 NPL-1.1 ICU Ms-PL \
	BSL-1.0 Zlib IJG custom"
_license_build="$license BSD-2-Clause Artistic-1.0-cl8 LGPL-2.0-only MPL-2.0"
makedepends="qt5-qtbase-dev
	     paxmark
	     gperf
	     bison
	     flex-dev
	     libxcursor-dev
	     qt5-qtdeclarative-dev
	     qt5-qtwebchannel-dev
	     libjpeg-turbo-dev
	     ffmpeg-dev
	     opus-dev
	     libwebp-dev
	     re2-dev
	     alsa-lib-dev
	     pulseaudio-dev
	     gzip
	     libintl
	     icu-dev
	     libxtst-dev
	     libxrandr-dev
	     libxcomposite-dev
	     libxi-dev
	     harfbuzz-dev
	     jsoncpp-dev
	     protobuf-dev
	     snappy-dev
	     minizip-dev
	     nss-dev
	     "
_qtpkgname="qtwebengine-opensource-src"
source="$pkgname-$pkgver.tar.xz::https://download.qt.io/official_releases/qt/$_pkgver/$pkgver/submodules/$_qtpkgname-$pkgver.tar.xz
	allocator-shim-glibc.patch
	chromium-widevine.patch
	default-pthread-stacksize.patch
	disable-allocator-shim-in-bootstrap.patch
	disable-bootstrap-allocator-shim.patch
	Dl_info.patch
	glibc-logging.patch
	intl.patch
	libevent-compat-gn.patch
	libevent-compat-py.patch
	musl-fixes.patch
	musl-hacks.patch
	musl-sandbox.patch
	paxmark-v8.patch
	no-execinfo.patch
	no-execinfo-2.patch
	no-mallinfo.patch
	no-pvalloc.patch
	no-Wno-c++11-narrowing.patch
	resolver.patch 
	stackstart.patch
	swiftshader.patch
	"
builddir="$srcdir/"$_qtpkgname-$pkgver
subpackages="$pkgname-dev"

build() {
	cd "$builddir"
	qmake-qt5 -- -ffmpeg -opus -webp -alsa -pulseaudio -webengine-icu
	make
}

check() {
	cd "$builddir"
	make check
}

package() {
	cd "$builddir"
	install -d "$pkgdir"/usr/share/licenses/$pkgname
	make DESTDIR="${pkgdir}" INSTALL_ROOT="${pkgdir}" install
	paxmark -m "$pkgdir"/usr/lib/qt5/libexec/QtWebEngineProcess
	install -t "$pkgdir"/usr/share/licenses/$pkgname LICENSE.GPL3-EXCEPT \
		src/3rdparty/chromium/v8/LICENSE.fdlibm
}

sha512sums="0db532b4d54540da1ca63de1cc4d561d72f052211535f75f60b99c1858ec0819ab0f831a3326d58da6350066748634000fe7ad0719ca545e12f3ed249a6eb90a  qt5-webengine-5.9.3.tar.xz
9a6fc4edc99eeab9d163e14c88731fd1d83f8615d8c1b7a0fe842e5b6ac555113e78b54633aac5355e232c6c71240fbace9680fa32655832336e71c281b7f4c2  allocator-shim-glibc.patch
24661f7d2c15be4499b9c5716075236fdda362a69256b6a4053c625717d0808bc8ddad55535b9d65d5540a9a5d6005e84ae0c8110e07821bd0f4871dea1413c5  chromium-widevine.patch
254b088c10866dc9d970dee6b948a8ad31e30031bf868cb03f107bb03fb6aa32c839e000ce0262d47e88409b73e12bfcbb58efd9103480d98f94aaba44e3992e  default-pthread-stacksize.patch
1dae173838064e49aebacb5ad3dcdd771b97b3bbcb88ab17cceed284df9f9897d35798b9c54dbd6fe8706ac9e482e9d846a12d4b9c1e90dcc230ff3b2fb44bec  disable-allocator-shim-in-bootstrap.patch
24652e28124a74a6ddae642239ddc940ce644b837d1180ca411826ac442b65a6ec02e087993b409978a24605833d6ca71b4a68249ed53eb76a503a73d98d31b0  disable-bootstrap-allocator-shim.patch
f04bfde79d8b1a011c12128e2286d191d33f5e450aae4adb89b2b066573c3b27ea8ed5712b718b9d82d86b7bbd96aa3455b817ccb1a361af1b763810cb588f94  Dl_info.patch
01b74af17782cc5020d5e43cbaa7796021216e24537fe5f2a60bf9adc6c686a80fdf4c69eb5ddb967ae309eba3f0d939308250092f8d0f44176725bc4099d369  glibc-logging.patch
9f1e97428c236ce6c59b2367f9e74d1df1fac8131fa6827422d54570a21a4914b32a44259bbc6b743e2b8c1cd2ec44cd9c1f14b745adb959b650cb620254ac01  intl.patch
81f00395a51574e5a25824489e30e870065a6496aa32134c3aba556620355ae4eef884ffc6927970fd9f47e312df108b93e0e2fa32c0a456b4e7437f651ef180  libevent-compat-gn.patch
4bd5e3b63856dc4c2049392ace2e05186e8d9895c98c609a59570b1a0426bc4deab378bba56cff8529eac7aa417d20476e1a6fae12c18dddf3e9657905cc1692  libevent-compat-py.patch
bcc83a1900463c4450c661a52c07ace40536cd280e7df249bd2240d0a225746683af87af3120cc1a21bfd1a1303ca6d0bc50d5880d465ce6416206af29a897d1  musl-fixes.patch
5b757436e690c5efcc40a570da55670fa445be73e98278ca872c98df4025c2b8394fe1c56b6b5226228a02bad4734e5e8db8fabc7db54da96d65529ae8279279  musl-hacks.patch
687e1ce7a9e2ddc51fc02cda12219f853478ef01c9c482c3c23950d02c9ffef3ee0476e0340144f2d2492a73ff314f969c3856831e9dac66bdb5f5ef9c826775  musl-sandbox.patch
e7b40b707f034122b76f48bacc0a34ff2f62cce2d9d0dfda056c07327cc4baec03fc25a69da703c83968440ec523c122c25c709501a5a836854b8915c838bb06  paxmark-v8.patch
c0a53cf98eeddd7f2acf9dd011591e1cc4e3242bde5c5881c238bfd65dbecfb968f907ae7c9924638d028a0956ab200af9a3f3c0b8d3d73d90bfa348b2f54737  no-execinfo.patch
49222f7f30dbd9f31eb527ac2f1afed888351df0bec42b8d1fa5494b25325b9c898eceba090af66f37a53f817f6ba982cc2409fb1b063b20196c6095fc2b4cf9  no-execinfo-2.patch
5fc48df89c5cabe6a7642724840a22a95ac4c2f03cbd21b4a922398e4412a046bd86d996c9a0475795c4b82861a6ee337e99a64e50a5f780314ccd2941bba5f9  no-mallinfo.patch
b932dae6dbfcd846b724fdd8d8364f94e7c7e02bbca90844d598606c1863f58c8bba674de5c0817414dff0308e64f3b5e8c772f5821c6b5812704a75b4a8eadf  no-pvalloc.patch
04d5cd354d65814a8327351623667ca86643a2d07009483ee3136b0bcf926573737157242cb2c48ecb2ebdb0c4c5ee8cca1d55b439a1648916b1eefa47d3a599  no-Wno-c++11-narrowing.patch
47cbfc15ba0dfa1f88d2364cd01e24d87579c78d9943925ffdf0400dd5d2ee3442fc6c2f8e35069d5bdb8550e3d0432299832e2fab867dd9343b3d909288e263  resolver.patch
0fbfc37c31afe8b94cb98e9cb6d4eb0cbd260f859c80802aa1b71a31de973372e5dbabef104b3318414b92138c1b659442ea90391a7aadc8f287b043f861917e  stackstart.patch
7149372ea5de74e0affbebff50e8059eb592ff78ac8f7225ce4e7f32bbe83878357450cbf0bf56c4424b300ed54a64fd80dc88f06a850d007b11e156ed900f92  swiftshader.patch"
