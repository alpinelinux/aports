# Contributor: Olliver Schinagl <oliver@schinagl.nl>
# Maintainer: Olliver Schinagl <oliver@schinagl.nl>
pkgname=linux-firmware
pkgver="0_git$(date +%Y%m%d)"
pkgrel=0
pkgdesc="Linux firmware"
url="http://git.kernel.org/?p=linux/kernel/git/firmware/linux-firmware.git"
arch="noarch"
license="Redistributable"
options="!check !strip" # No checks available
_githash="9ee52be785cf91fc6a3c6aa27d484873f8270b72"
source="https://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git/snapshot/linux-firmware-${_githash}.tar.gz"
subpackages="
	${pkgname}-doc
	${pkgname}-brcmfmac43455sdio ${pkgname}-brcmfmac43455sdio-doc
	${pkgname}-radeon ${pkgname}-radeon-doc
"

brcmfmac43455sdio()
{
	pkgdesc="Broadcom/Cypress FullMAC 43455 SDIO firmware"

	cd "${srcdir}/${pkgname}-${_githash}/"
	install -D -m 644 "LICENCE.cypress" "${subpkgdir}-doc/usr/share/doc/${pkgname}/brcmfmac4355sdio/copying"
	for file in $(find 'brcm/' -type f -iname 'brcmfmac43455-sdio*'); do
		install -D -m 644 "${file}" "${subpkgdir}/lib/firmware/${file}"
	done
}

radeon()
{
	pkgdesc="AMD Radeon firmware files"

	cd "${srcdir}/${pkgname}-${_githash}/"
	install -D -m 644 "LICENSE.radeon" "${subpkgdir}-doc/usr/share/doc/${pkgname}/radeon/copying"
	for file in $(find 'radeon/' -type f -iname '*.bin'); do
		install -D -m 644 "${file}" "${subpkgdir}/lib/firmware/${file}"
	done
}

doc()
{
	depends="
		${pkgname}-brcmfmac43455sdio-doc
		${pkgname}-radeon-doc
	"

	install -d -m 644 "${subpkgdir}/usr/share/doc/${pkgname}/"
}

package()
{
	depends="
		${pkgname}-brcmfmac43455sdio
		${pkgname}-firmware-radeon
	"

	install -d -m 644 "${pkgdir}"
}

sha512sums="1884c9969afc3b77306bd49c8ac099bfcaa93cba2d6c7da66d22085f85fe94f58b13cdf7f0a191eab46c1832899b6d58eab41f7d0cf4769a8e7fdcdae98d1009  linux-firmware-9ee52be785cf91fc6a3c6aa27d484873f8270b72.tar.gz"
