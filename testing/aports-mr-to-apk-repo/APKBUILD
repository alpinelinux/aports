maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=aports-mr-to-apk-repo
pkgver=0_git20260204
_commit=dd90e53ae6da430b4daa8312f215a5f8c521f4ee
pkgrel=1
pkgdesc="Proxy from GitLab CI artifacts to apk repositories"
url="https://gitlab.postmarketos.org/Aelin/aports-mr-to-apk-repo"
arch="all"
license="BSD-3-Clause"
makedepends="
	cargo
	cargo-auditable
	"
subpackages="$pkgname-openrc"
source="https://gitlab.postmarketos.org/Aelin/aports-mr-to-apk-repo/-/archive/$_commit/aports-mr-to-apk-repo-$_commit.tar.gz
	aports-mr-to-apk-repo.initd
	"
builddir="$srcdir/$pkgname-$_commit"
options="net" # cargo

prepare() {
	default_prepare

	cargo fetch --target="$CHOST" --locked
}

build() {
	cargo auditable build --frozen --release
}

check() {
	cargo test --frozen
}

package() {
	install -Dm755 target/release/aports-mr-to-apk-repo \
		-t "$pkgdir"/usr/bin/
	install -Dm755 "$srcdir"/aports-mr-to-apk-repo.initd \
		"$pkgdir"/etc/init.d/aports-mr-to-apk-repo
}

sha512sums="
63d80e98b3e366571fe54c565fe114e7683e9d32f6b080ef9edae6af3de6f41de1adbf0f43bf5418c1b82a4151f418160cb95205152a209fa0f6092b70099f08  aports-mr-to-apk-repo-dd90e53ae6da430b4daa8312f215a5f8c521f4ee.tar.gz
2a7b625e52fe6ada6192eeb9e2c8f3a79e876297b08c7af0f766810e2752a5def095fefab1cdadf35e1d1efa62e4638fabf3d33bba3f877350db84dca852818f  aports-mr-to-apk-repo.initd
"
