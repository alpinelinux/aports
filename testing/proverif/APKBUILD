# Contributor: Marian Buschsieweke <marian.buschsieweke@posteo.net>
# Maintainer: Marian Buschsieweke <marian.buschsieweke@posteo.net>
pkgname=proverif
pkgver=2.05
pkgrel=1
pkgdesc="automatic cryptographic protocol verifier"
url="https://bblanche.gitlabpages.inria.fr/proverif/"
# riscv64: limited by ocamlbuild and ocaml-findlib-dev
# loongarch64: limited by ocamlbuild and ocaml-findlib-dev
arch="all !riscv64 !loongarch64"
license="GPL-2.0-only"
subpackages="
	$pkgname-examples:_examples
	$pkgname-emacs:_emacs
	$pkgname-utils:_utils
	$pkgname-interact:_interact
	"
makedepends="
	m4
	ocamlbuild
	ocaml-findlib-dev
	ocaml-lablgtk3-dev
	"
source="
	$pkgname-$pkgver.tar.gz::http://prosecco.gforge.inria.fr/personal/bblanche/proverif/proverif$pkgver.tar.gz

	use-lablgtk3.patch
	"
builddir="$srcdir/$pkgname$pkgver"

build() {
	./build
}

check() {
	./test
}

package() {
	install -Dm755 proverif -t "$pkgdir"/usr/bin
}

_examples() {
	pkgdesc="examples for $pkgname"

	find "$builddir"/examples -type f \
		-exec install -Dm644 {} -t "$subpkgdir/usr/share/$pkgname/examples/" \;
}

_emacs() {
	pkgdesc="Emacs integration of $pkgname"
	depends="$pkgname emacs"
	install -Dm644 "$builddir"/emacs/proverif.el \
		-t "$subpkgdir"/usr/share/emacs/site-lisp/
}

_utils() {
	pkgdesc="proverif to TeX converter utility"

	install -Dm755 "$builddir"/proveriftotex -t "$subpkgdir"/usr/bin
}

_interact() {
	pkgdesc="GUI for interactive processing of ProVerif scripts"

	install -Dm755 "$builddir"/proverif_interact -t "$subpkgdir"/usr/bin
}

sha512sums="
e20d6dc40b0e4957590b9ce019ef654361f3514f53e0a5c3240a40d296ff2a50093630982b7a230c2277eadf4ed22ba1b6d09b48764c2ad3ec0e102033d1c486  proverif-2.05.tar.gz
50b484ea6c87f7ac8b420f6378b71cc3b0b2b11f7b597012eab9fb228eabd05b5ee7f05ae60f1e5bf6a6cb21bf0cd0543d309e220d334e9d0f85ccc589049937  use-lablgtk3.patch
"
