--- ./Makefile.orig
+++ ./Makefile
@@ -65,11 +65,11 @@
 frontend_deps: $(VENV_NAME) check_for_yarn
 	$(PIP) install build wheel -r requirements-ci.txt
 	for i in $(WWW_DEP_PKGS); \
-		do (cd $$i; $(YARN) install --pure-lockfile; $(YARN) run build); done
+		do (cd $$i; $(YARN) install --frozen-lockfile --ignore-scripts; rm -r node_modules/rollup; ln -s /usr/share/node_modules/rollup node_modules/rollup; $(YARN) run build); done
 
 frontend_tests: frontend_deps check_for_yarn
 	for i in $(WWW_PKGS); \
-		do (cd $$i; $(YARN) install --pure-lockfile); done
+		do (cd $$i; $(YARN) install --frozen-lockfile; rm -r node_modules/rollup; ln -s /usr/share/node_modules/rollup node_modules/rollup); done
 	for i in $(WWW_PKGS_FOR_UNIT_TESTS); \
 		do (cd $$i; $(YARN) run build-dev || exit 1; $(YARN) run test || exit 1) || exit 1; done
 
--- ./pkg/buildbot_pkg.py.orig
+++ ./pkg/buildbot_pkg.py
@@ -224,7 +224,9 @@
             assert yarn_program is not None, "need nodejs and yarn installed in current PATH"
 
             commands = [
-                [yarn_program, 'install', '--pure-lockfile'],
+                [yarn_program, 'install', '--frozen-lockfile', '--ignore-scripts'],
+                ['rm', '-r', 'node_modules/rollup'],
+                ['ln', '-s', '/usr/share/node_modules/rollup', 'node_modules/rollup'],
                 [yarn_program, 'run', 'build'],
             ]
 
