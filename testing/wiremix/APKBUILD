# Contributor: NeYurii <neyuriizkh@proton.me>
# Maintainer: NeYurii <neyuriizkh@proton.me>
pkgname=wiremix
pkgver=0.9.0
pkgrel=0
pkgdesc="Simple TUI audio mixer for PipeWire"
url="https://github.com/tsowell/wiremix"
# x86, armv7, armhf: https://gitlab.freedesktop.org/pipewire/pipewire-rs/-/issues/111
# s390x: https://github.com/nix-rust/nix/issues/2641
arch="all !x86 !armv7 !armhf !s390x"
license="MIT OR Apache-2.0"
makedepends="cargo cargo-auditable clang-dev pipewire-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/tsowell/wiremix/archive/refs/tags/v$pkgver.tar.gz"
subpackages="$pkgname-doc"
options="net" # fetch dependencies

prepare() {
	default_prepare
	cargo fetch --target="$CTARGET" --locked
}

build() {
	VERGEN_GIT_DESCRIBE="$pkgver-$pkgrel" cargo auditable build --frozen --release
}

check() {
	cargo test --frozen
}

package() {
	install -Dm755 -t "$pkgdir"/usr/bin target/release/wiremix
	install -Dm644 -t "$pkgdir"/usr/share/wiremix wiremix.toml
	install -Dm644 -t "$pkgdir"/usr/share/doc/"$pkgname" README.md
	install -Dm644 -t "$pkgdir"/usr/share/licenses/"$pkgname" LICENSE-MIT LICENSE-APACHE
}

sha512sums="
8a6f434b5fd615766190f82d0673f6d925be815636f1f8ad70e0bf7310be500da0794dcb52469843224c62c0c6b9152049a17cabf189c18f5e8d4e0d686c3fb5  wiremix-0.9.0.tar.gz
"
