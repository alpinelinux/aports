maintainer="Hoang Nguyen <folliekazetani@protonmail.com>"
pkgname=helm-mapkubeapis
pkgver=0.6.1
pkgrel=1
pkgdesc="Helm plugin to map deprecated or removed Kubernetes APIs to supported ones"
url="https://github.com/helm/helm-mapkubeapis"
arch="all"
license="Apache-2.0"
makedepends="go"
install="helm-mapkubeapis.pre-install"
source="$pkgname-$pkgver.tar.gz::https://github.com/helm/helm-mapkubeapis/archive/refs/tags/v$pkgver.tar.gz"
options="net" # download Go modules

build() {
	go build -v ./cmd/mapkubeapis/
}

check() {
	go test ./...
}

package() {
	install -Dm755 mapkubeapis "$pkgdir"/usr/libexec/helm/plugins/mapkubeapis

	mkdir -p "$pkgdir"/usr/share/helm/plugins/mapkubeapis
	cat <<-EOF > "$pkgdir"/usr/share/helm/plugins/mapkubeapis/plugin.yaml
	name: "mapkubeapis"
	version: "$pkgver"
	usage: "Map release deprecated Kubernetes APIs in-place"
	description: "Map release deprecated Kubernetes APIs in-place"
	platformCommand:
	  - os: "$(go env GOOS)"
	    arch: "$(go env GOARCH)"
	    command: "/usr/libexec/helm/plugins/mapkubeapis"
	EOF
}

sha512sums="
a7f668c1616491496cecc301358ab05b56b6df5518efc9d60afc750465438367e4bc216c47137de43486b56d9c4fcade343bc43ad784cc026806d13ebc1bd83a  helm-mapkubeapis-0.6.1.tar.gz
"
