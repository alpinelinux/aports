# Contributor: Anjandev Momi <anjan@momi.ca>
# Maintainer: Anjandev Momi <anjan@momi.ca>
pkgname=py3-qdldl
pkgver=0.1.7
pkgrel=0
_postver=5
pkgdesc="Python interface to the QDLDL free LDL factorization routine for quasi-definite linear systems: Ax = b"
url="https://github.com/osqp/qdldl-python"
arch="all !armhf !armv7 !x86" # error: cannot convert 'QDLDL_int*' {aka 'int*'} to 'const long long int*'
license="Apache-2.0"
depends="python3 py3-numpy py3-scipy"
makedepends="py3-setuptools py3-pybind11-dev python3-dev cmake py3-gpep517 samurai"
source="qdldl-python-$pkgver.tar.gz::https://github.com/osqp/qdldl-python/archive/refs/tags/v$pkgver.post$_postver.tar.gz
	qdldl-$pkgver.tar.gz::https://github.com/osqp/qdldl/archive/refs/tags/v$pkgver.tar.gz
	cmake-version.patch"
builddir="$srcdir/qdldl-python-$pkgver.post$_postver"
options="!check" # no upstream checks

prepare() {
	default_prepare
	rmdir c/qdldl
	mv "$srcdir/qdldl-$pkgver" c/qdldl
}

build() {
	export CMAKE_POLICY_VERSION_MINIMUM=3.5
	gpep517 build-wheel \
		--wheel-dir .dist \
		--output-fd 3 3>&1 >&2
}

package() {
	gpep517 install-wheel --destdir "$pkgdir" \
		.dist/*.whl
}

sha512sums="
11cc6c47a92a6937befbc4abf8d9eb063fd6bb6360696d0c5a41c8dda9fb64c26602601f0d42b54d9688b158468c83833f7e8282c12f450e61c380604a6576bc  qdldl-python-0.1.7.tar.gz
13ab85c9e6dab65a1171cd914b054f721192fbf0d99571c5d20519a658b44b9a3c1611311fdd457d23c94cb2514a0bccce5026feb5b01008c25f5d9bf6e6f1ba  qdldl-0.1.7.tar.gz
ff6fd4164a72d80f4022b1601f06f224e7a8633680a478f48f351d0b7e780cc0c140c0e78d58857404192028e7b4834814811504736ff3178445e9f07b3ce266  cmake-version.patch
"
