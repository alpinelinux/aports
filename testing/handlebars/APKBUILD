# vim: smartindent noexpandtab tabstop=4 shiftwidth=4
# Contributor: John Boehr <jbboehr@gmail.com>
# Maintainer: Rafael del Valle <rvalle@privaz.io>

pkgname=handlebars
pkgver=0.6.3
pkgrel=0
pkgdesc="C implementation library of handlebars.js"
url="https://github.com/jbboehr/handlebars.c"
license="LGPLv2.1+"
arch="all"

_gitrev=8ea5f7163281e29e078cedf28801c7fb72493ed5
_mustachespec_rev="83b0721610a4e11832e83df19c73ace3289972b9"
_handlebarsspec_rev="e553716c186961477983d20c6e852d9a387f0668"

depends="talloc"
makedepends="automake autoconf libtool talloc-dev json-c-dev bison flex yaml-dev lmdb-dev pcre-dev check-dev"
subpackages="$pkgname-dev $pkgname-utils"

source="handlebars.c-${_gitrev}.tar.gz::https://github.com/jbboehr/handlebars.c/archive/${_gitrev}.tar.gz
        spec-${_mustachespec_rev}.tar.gz::https://github.com/mustache/spec/archive/${_mustachespec_rev}.tar.gz
        handlebars-spec-${_handlebarsspec_rev}.tar.gz::https://github.com/jbboehr/handlebars-spec/archive/${_handlebarsspec_rev}.tar.gz"

builddir="${srcdir}/handlebars.c-${_gitrev}"

prepare() {
    rm -rf ${builddir}/spec
    mkdir ${builddir}/spec
    ln -s ${srcdir}/spec-${_mustachespec_rev} ${builddir}/spec/mustache
    ln -s ${srcdir}/handlebars-spec-${_handlebarsspec_rev} ${builddir}/spec/handlebars
    cd "${builddir}"
}

build() {
	cd ${builddir}
	./bootstrap || return 1
	./configure --prefix=/usr --disable-refcounting || return 1
	make 
}

check() {
	cd ${builddir}
	make test 
}

package() {
	cd ${builddir}
	make DESTDIR="${pkgdir}" install 
}

utils() {
	pkgdesc="Handlebars command line utilities"
        depends="handlebars"
	mkdir -p "$subpkgdir"/usr
	mv "$pkgdir"/usr/bin "$subpkgdir"/usr/
}

sha512sums="2f58c8dd8bfe9d867cbbed9adf6b2ccf5010c42209160bf2fad207bc4e9131760bd7f576b90caa7518a1933c7dff65d6850593e6bf3a7014c1d9639b9a10cd44  handlebars.c-8ea5f7163281e29e078cedf28801c7fb72493ed5.tar.gz
3ee282295374cb0140cd5f849c92b6159c399e95311e2bc52b717599ae3fd3fb5425933ad5bccb56a11cb7937ee96716b43cb668eda4c1d769243a6302b7d4fe  handlebars-spec-e553716c186961477983d20c6e852d9a387f0668.tar.gz
edc5cfeba455b932ea2732a19a7016ad84b9fb8bb8d7b0ee71c79f155c298620cce06e548d3c7adc297a69b7a2c85be2519ea4073d05c3519930d3bae0b022ba  spec-83b0721610a4e11832e83df19c73ace3289972b9.tar.gz"

