# Contributor: TBK <alpine@jjtc.eu>
# Maintainer: TBK <alpine@jjtc.eu>
pkgname=cvs-fast-export
pkgver=1.68
pkgrel=0
pkgdesc="Export RCS or CVS history as a fast-import stream"
url="http://www.catb.org/esr/cvs-fast-export/"
arch="all"
license="GPL-2.0-or-later"
depends="cvs rcs"
makedepends="asciidoctor bison flex libxslt"
checkdepends="git python3"
subpackages="$pkgname-doc $pkgname-tools::noarch"
source="https://gitlab.com/esr/cvs-fast-export/-/archive/$pkgver/cvs-fast-export-$pkgver.tar.gz
	flags.patch
	"
options="!check" # take 50 years

build() {
	# "make all" will run the commands below + html.
	# html can not run in parallel because the ".adoc.html"
	# rules reuse the "docbook-xsl.css" file name.
	make cvs-fast-export man
}

check() {
	# v1.55 - More then one job and the tests
	# are executed in the wrong order!
	make -j 1 check
}

package() {
	make DESTDIR="$pkgdir" prefix=/usr install
}

tools() {
	pkgdesc="$pkgdesc (extra tools)"
 	depends="$pkgname=$pkgver-r$pkgrel git python3 rsync"

	amove \
		usr/bin/cvsconvert \
		usr/bin/cvssync
}

sha512sums="
f967c3d2cda2c5ba4c14fdd33923807690d7b8e85e19aceb6f9580cb74a15af32291324675cdd10d72cbd160a0e18be980bb0442e99e9cd63daad8d76dd848f6  cvs-fast-export-1.68.tar.gz
29501c56e72a87a1598d180adf21a11f2e2a711ccdb3fa5ec6788a1288edccf9b7277e5a24631bd8e5be7601fd9691420f7d663f28398a5f5be9a3c33d9d5d14  flags.patch
"
