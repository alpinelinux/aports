# Contributor: Jonas <3426-spameier@users.gitlab.alpinelinux.org>
# Maintainer: Jonas <3426-spameier@users.gitlab.alpinelinux.org>
pkgname=nuclei
pkgver=3.6.2
pkgrel=0
pkgdesc="Vulnerability scanner built on a simple YAML-based DSL"
url="https://docs.projectdiscovery.io/tools/nuclei"
# go test -race is not supported on armv7
# the others do not provide chromium, which is required for tests
arch="aarch64 x86_64"
license="MIT"
makedepends="go"
checkdepends="chromium"
subpackages="$pkgname-doc"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/projectdiscovery/nuclei/archive/refs/tags/v$pkgver.tar.gz
	10-set-GOFLAGS.patch
	"
options="net"

build() {
	make GOFLAGS="$GOFLAGS" build
}

check() {
	make GOFLAGS="$GOFLAGS" test
}

package() {
	install -Dm755 "$builddir/bin/nuclei" -t "$pkgdir/usr/bin/"
	install -Dm644 LICENSE.md "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
}

sha512sums="
d77f9ef8083c9f8a845685fbf4da940e978974bf2fa48db0a12923ef899e7fe6081b2007b94419bb93e368ad95c7f9c40371d23940ea41edc8af3727fb1f1e34  nuclei-3.6.2.tar.gz
745ebfd4e1dbca4a8e9604c41dea6638db647272d8447b6a7db9fa9b5a2c2356668eb28be0d955a858a01cc1db6aa1d659cd865d7b4594ed37864889fa4f4dc5  10-set-GOFLAGS.patch
"
