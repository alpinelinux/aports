# Contributor: Stuart Cardall <developer@it-offshore.co.uk>
# Maintainer: Stuart Cardall <developer@it-offshore.co.uk>
pkgname=nxapi
_pkgname=naxsi
pkgver=0.55.3
_ver=${pkgver/_/}
pkgrel=1
pkgdesc="nginx/naxsi log parser, whitelist and report generator."
url="http://www.nginx.org | https://github.com/nbs-system/naxsi"
arch="noarch"
license="GPL v2"
depends="python py-elasticsearch py-certifi py-geoip-api"
depends_dev=""
makedepends="python-dev"
subpackages=""
source="$_pkgname-$_ver.tar.gz::https://github.com/nbs-system/$_pkgname/archive/${_ver}.tar.gz
	json-default-path.patch
	geoipdb_path.patch
	config_path.patch
	nxtool.sh
	"

builddir="$srcdir/$_pkgname-$_ver/nxapi"

build() {
	cd "$builddir"
	python setup.py build
}

package() {
	cd "$builddir"
	python setup.py install --prefix=/usr --root="$pkgdir"
	# nxtool.py wrapper
	install -Dm700 "$srcdir"/nxtool.sh "$pkgdir"/usr/bin/nxtool
}

check() {
	cd "$builddir"
	python setup.py check
}

sha512sums="9e8f41a5cd1342cc9b8aa334a603842d14a256aab1f4a21205bb1278aecbb0c49e39c889d8113a5b41aad2efeaa2ed9f11cba6929173f50add91f54c4c59c8a0  naxsi-0.55.3.tar.gz
6660b48b4728cadd412649a134a05f1cf3df45da97f7c7bf771cd6fd6d7b19119473bd783cb69d831991c336fb2ac1c169b2bb95e8788c7b09a9e57c84b96d2e  json-default-path.patch
5e5ad8605df56efabb5c80752c59433489f55dd5be7c456e7b89d3ac261b48a523bb1a92444256d02e0dcfa6338a1f65310c9c3d873ee78d756a9ad328be3ed5  geoipdb_path.patch
133bebd386fdc8f6953f600a2acbd59f860563d42a2506c6c43ca0af9bf159d17e939476ba9a77cfe77f88255037aea5fd7b8dc8b352ac4ee078a0622ae9aad8  config_path.patch
37fed7e44575bac1ec82e7ec4f14ff14283fa13425abd118087daa92be279a961435509d63554f0146606063d222347e59599f3cac6458fed8e7010d4cd95279  nxtool.sh"
