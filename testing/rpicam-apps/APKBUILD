# Contributor: Zach DeCook <zachdecook@librem.one>
maintainer="Krystian Chachu≈Ça <krystian@krystianch.com>"
pkgname=rpicam-apps
pkgver=1.11.1
pkgrel=0
pkgdesc="Suite of libcamera-based applications to drive the Raspberry Pi cameras"
url="https://github.com/raspberrypi/rpicam-apps"
arch="aarch64 armhf armv7" # libcamera by default only includes rpi/vc4 pipeline on these archs
license="BSD-2-Clause"
depends="libcamera-raspberrypi"
makedepends="
	boost-dev
	ffmpeg-dev
	libcamera-dev
	libdrm-dev
	libexif-dev
	libjpeg-turbo-dev
	libpng-dev
	meson
	musl-dev
	tiff-dev
"
subpackages="$pkgname-doc"
source="
	$pkgname-$pkgver-1.tar.gz::https://github.com/raspberrypi/rpicam-apps/archive/v$pkgver/rpicam-apps-v$pkgver.tar.gz
	"

build() {
	abuild-meson \
		-Denable_libav=enabled \
		-Denable_drm=enabled \
		-Denable_egl=disabled \
		-Denable_qt=disabled \
		-Denable_opencv=disabled \
		-Denable_tflite=disabled \
		-Dneon_flags=auto \
		-Denable_hailo=disabled \
		build .
	meson compile -C build
}

check() {
	meson test --print-errorlogs -C build
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C build
	install -Dm644 license.txt "$pkgdir"/usr/share/licenses/$pkgname/license.txt
}

sha512sums="
3aed1ea2ead5eb1b56496a21e9d188711e78d28e58f0b550a38747fda8e6fb09265dcab5be2e296ff9c5c75384e796d23e4ebfd8baf24d740e7dcfb2d38ac5df  rpicam-apps-1.11.1-1.tar.gz
"
