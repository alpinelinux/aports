# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
# Maintainer: Matthias Ahouansou <matthias@ahouansou.cz>
pkgname=cargo-leptos
pkgver=0.3.2
pkgrel=0
pkgdesc="Build tool for Leptos"
url="https://leptos.dev"
arch="x86_64 aarch64" # dart-sass
license="MIT"
makedepends="
	cargo-auditable
	openssl-dev
"
depends="
	binaryen
	cargo
	cargo-generate
	dart-sass
"
subpackages="$pkgname-doc"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/leptos-rs/cargo-leptos/archive/refs/tags/v$pkgver.tar.gz
	system-openssl.patch
"
options="net"

prepare() {
	default_prepare
	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen --features no_downloads
}

check() {
	# https://github.com/leptos-rs/cargo-leptos/issues/515
	cargo test --frozen --features no_downloads -- \
		--skip compile::tests::test_workspace_project1 \
		--skip compile::tests::test_project_dev
}

package() {
	install -Dm 755 target/release/cargo-leptos "$pkgdir"/usr/bin/cargo-leptos

	install -Dm 644 LICENSE "$pkgdir"/usr/share/licenses/"$pkgname"/LICENSE
}

sha512sums="
37427a2360cb2e7778b1f632d8eb51b87c7f7075fa64f0cd4b7316a45c6d1070d7010c0f1d9117fd16d17bee482a1ba75d760070047945c66512c49cd3998bd4  cargo-leptos-0.3.2.tar.gz
9e8990fea7b43c10defe3f38d06a6a6f80059dd94eb8da5e055a79b4f2278af2c411c47c0b18638f71608b0c17d7cee9e63eedf9d7e7d1d93916ef2f1681f601  system-openssl.patch
"
