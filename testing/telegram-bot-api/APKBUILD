# Maintainer: Maria Lisina <sekoohaka.sarisan@gmail.com>
pkgname=telegram-bot-api
pkgver=9.3
pkgrel=0
# they don't tag releases
_gitrev=03f1fc711e8d2ccc59894c49962853514f926645
_td_gitrev=94860fae3c8072a736fd13363c50416a760d605f
pkgdesc="Telegram Bot API server"
url="https://core.telegram.org/bots"
arch="all !s390x" # td fails to build on big-endian
license="BSL-1.0"
makedepends="cmake gperf linux-headers openssl-dev samurai zlib-dev"
source="$pkgname-$_gitrev.tar.gz::https://github.com/tdlib/telegram-bot-api/archive/$_gitrev.tar.gz
	td-$_td_gitrev.tar.gz::https://github.com/tdlib/td/archive/$_td_gitrev.tar.gz
	"
options="!check" # package doesn't have a testsuite

builddir="$srcdir/$pkgname-$_gitrev"

prepare() {
	default_prepare

	rm -fr "$builddir/td"
	ln -sf "$srcdir/td-$_td_gitrev" "$builddir/td"
}

build() {
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=MinSizeRel \
		-DCMAKE_INSTALL_PREFIX=/usr

	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
9ff68c7291398dff807fd9eaee82a5cc250edbff42af80c4b6884c536707cf04f7a2e85c10046a19f1270c0f0e499bc55434ca0bc80b827c4d7d930c12df3ba0  telegram-bot-api-03f1fc711e8d2ccc59894c49962853514f926645.tar.gz
6051d62aeba27a5a6b4893a74572be829237a166a54ef4b75c73da4abee853da87ce8d41f3f4d4e9870387ebf7a0b2aea2bd98dd6f5f4b015220b94fd8e31ec9  td-94860fae3c8072a736fd13363c50416a760d605f.tar.gz
"
