# Contributor: l-n-s <supervillain@riseup.net>
# Maintainer: l-n-s <supervillain@riseup.net>
pkgname=i2pd
pkgver=2.18.0
pkgrel=0
pkgdesc="I2P Router written in C++"
url="https://github.com/PurpleI2P/i2pd"
arch="all"
license="BSD"
pkgusers="i2pd"
depends="boost-filesystem boost-system boost-program_options boost-date_time boost-thread boost-iostreams openssl musl-utils libstdc++"
makedepends="boost-dev openssl-dev openssl"
options="!check"
install="$pkgname.pre-install"
source="https://github.com/PurpleI2P/i2pd/archive/$pkgver/$pkgname-$pkgver.tar.gz
	i2pd.initd
	i2pd.confd
	"
builddir="$srcdir/$pkgname-$pkgver"

build() {
	cd "$builddir"
	
	make 
}

package() {
	cd "$builddir"

	install -D -m 755 i2pd "$pkgdir"/usr/sbin/i2pd

	install -dm755 -o $pkgusers \
		"$pkgdir"/etc/$pkgname \
		"$pkgdir"/usr/share/$pkgname \
		"$pkgdir"/var/lib/$pkgname \
		"$pkgdir"/var/log/$pkgname

	install -D -m 755 contrib/tunnels.conf "$pkgdir"/etc/i2pd/tunnels.conf
	install -D -m 755 contrib/i2pd.conf "$pkgdir"/etc/i2pd/i2pd.conf
	cp -r contrib/certificates/ "$pkgdir"/usr/share/$pkgname/certificates
	ln -s /usr/share/$pkgname/certificates "$pkgdir"/var/lib/$pkgname/certificates

	install -m755 -D "$srcdir"/$pkgname.initd \
		"$pkgdir"/etc/init.d/$pkgname
	install -m644 -D "$srcdir"/$pkgname.confd \
		"$pkgdir"/etc/conf.d/$pkgname
}

sha512sums="dc8e0f4df25188e4d72ea6ffa2c36e48a7d2103d025730b40e226ab631724a9a07a4dc03a1a3d08328972c98020c44535661820add80374f1dabdf3fc848ef84  i2pd-2.18.0.tar.gz
3c4547fcd713510055e0650ff83f1fde70bac01ca77ac6af860baf5cc0cd3874c8e7c2e2ab92b59f480b40aabaec9c409f7c2db9f88802bbd69740832f9c9fdb  i2pd.initd
ba94e5505f4eeb9a32159aa0a3b7f68ff077abb9704800f70502ac75fd5bcfcb20450ebd983d0523beca2d13e718d7bf888f53ec455d1f41701c16d09c3b2d28  i2pd.confd"
