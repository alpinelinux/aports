# Contributor: sillysausage <sillysausage@privatedemail.net>
# Maintainer:
pkgname=3proxy
pkgver=0.9.5
pkgrel=1
pkgdesc="Really tiny cross-platform proxy servers set"
url="https://3proxy.ru"
arch="all"
license="Apache-2.0 GPL-2.0-or-later LGPL-2.1-or-later"
pkgusers="3proxy"
pkggroups="3proxy"
options="!check" # No test suite
makedepends="linux-headers"
install="3proxy.pre-install"
subpackages="$pkgname-doc $pkgname-openrc $pkgname-systemd"
source="$pkgname-$pkgver.tar.gz::https://github.com/3proxy/3proxy/archive/$pkgver.tar.gz
	install.patch
	$pkgname.initd
	"

build() {
	make -f Makefile.Linux prefix="/usr"
}

package() {
	make -f Makefile.Linux DESTDIR="$pkgdir" prefix="/usr" install
	install -Dm755 "$srcdir"/3proxy.initd "$pkgdir"/etc/init.d/3proxy
	mv "$pkgdir"/usr/local/3proxy/libexec/*.so "$pkgdir"/usr/lib/
	rm -rf "${pkgdir:?}"/usr/local
	chown -R 3proxy:3proxy "$pkgdir"/etc/3proxy
	install -Dm644 copying "$pkgdir"/usr/share/licenses/$pkgname/COPYING

}

sha512sums="
b668db6438da19ee2479228af744b9b3b9ff2c7e6d97aaf3b20737b165ab2baf656ac9ea92b6f1e169c428784c7d9e3e7eeb7c3effb1c0b77e5038319b6d2bcd  3proxy-0.9.5.tar.gz
8f7dddb7346176bd0612b4a65d8f3bdea7bf2180d8fbda60a50b3a408067ccc91b6820abf912402a2ea5f0eea7a1add5645490103deac26a176edc5d6779bf33  install.patch
043fa5784623e29961ae92f5370598d420e55da6d04f6421b585ac050694982765d6b57ee0276a10738bc8ad0e49ddc4edf6ef288bb9c68e7da11b572066688e  3proxy.initd
"
