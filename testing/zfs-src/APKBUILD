# Contributor: Umar Getagazov <umar@handlerug.me>
# Maintainer: Umar Getagazov <umar@handlerug.me>
pkgname=zfs-src
_modname=${pkgname%-src}
pkgver=2.4.0_rc5
pkgrel=0
pkgdesc="ZFS for Linux (sources, AKMS)"
url="https://zfsonlinux.org"
arch="noarch"
license="CDDL-1.0"
depends="akms"
options="!check"  # irrelevant for a -src package
source="https://github.com/openzfs/zfs/releases/download/zfs-${pkgver/_/-}/zfs-${pkgver/_/-}.tar.gz
	AKMBUILD.in
	"
builddir="$srcdir/$_modname-${pkgver/_/-}"

prepare() {
	default_prepare

	sed "s/modver=/&$pkgver-r$pkgrel/" "$srcdir"/AKMBUILD.in > AKMBUILD
}

package() {
	mkdir -p "$pkgdir"/usr/src
	cp -r "$builddir" "$pkgdir"/usr/src/zfs
	install -Dm644 AKMBUILD "$pkgdir"/usr/src/zfs/AKMBUILD
}

sha512sums="
ad59f9f226b9e8210abbb40ef3d4e9c2fa513b2f28efd8e1d470d255ae8e4d25d76f1d7141e3fe96173827237f061dba1cc724e9ef7fec14773cb0a37811207b  zfs-2.4.0-rc5.tar.gz
620753f1ffa20c5741576d51c8ec23dbc794bb44333cabf4087ea34c17893d30b383ba0abee19ec3de920138ad5460f0125acf2693f6f9fa36f9a5365dd3fc6b  AKMBUILD.in
"
