# Contributor: Terror <miguel.a.terron@gmail.com>
# Maintainer: Terror <miguel.a.terron@gmail.com>
pkgname=nss_wrapper
pkgver=1.1.5
pkgrel=0
pkgdesc="A wrapper for the user, group and hosts NSS API"
url="https://cwrap.org/nss_wrapper.html"
arch="all"
license="BSD-3-Clause"
depends=""
makedepends="cmake cmocka-dev"
install=""
subpackages="$pkgname-doc"
source="https://ftp.samba.org/pub/cwrap/$pkgname-$pkgver.tar.gz 
	nss.h
	"
builddir="$srcdir/build"

build() {
	mkdir -p "$builddir"
	cd "$builddir"
	if [ "$CBUILD" != "$CHOST" ]; then
		CMAKE_CROSSOPTS="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	
	export C_INCLUDE_PATH=$C_INCLUDE_PATH:$srcdir
	cmake \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_C_FLAGS="$CFLAGS" \
		-DUNIT_TESTING:BOOL=ON \
		${CMAKE_CROSSOPTS} "$srcdir/$pkgname-$pkgver"
	make
}

check() {
	cd "$builddir"
	make CTEST_OUTPUT_ON_FAILURE=TRUE test
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
}
sha512sums="fd5610c9c6a1159bed42e7b5f0490293575522a845ddf7455b74959360904f33dc9dad2361221366fcbce13b27148a0b7f3de295065f13540947fcfe768816ab  nss_wrapper-1.1.5.tar.gz
8c22372e0647c2a07e061b81d1a30f7fbb72d022b9b5857629d4a7552d25f8822d3edaebdfbfb96ee2805d1c8f928a7e35173bcc250ff258ac1ebcbfd1b0d6bf  nss.h"
