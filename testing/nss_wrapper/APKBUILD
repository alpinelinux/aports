# Contributor: Terror <miguel.a.terron@gmail.com>
# Maintainer: Terror <miguel.a.terron@gmail.com>
pkgname=nss_wrapper
pkgver=1.1.5
pkgrel=0
pkgdesc="A wrapper for the user, group and hosts NSS API"
url="https://cwrap.org/nss_wrapper.html"
arch="all"
license="BSD-3-Clause"
depends=""
makedepends="cmake cmocka-dev"
install=""
subpackages="$pkgname-doc"
source="https://ftp.samba.org/pub/cwrap/$pkgname-$pkgver.tar.gz nss.h"
builddir="$srcdir/$pkgname-$pkgver"

build() {
	mkdir -p "$builddir/build"
	cd "$builddir/build"

        export C_INCLUDE_PATH=$C_INCLUDE_PATH:$srcdir
        cmake -DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_C_FLAGS="$CFLAGS" \
		-DUNIT_TESTING:BOOL=ON ..
        make
}

check() {
        cd "$builddir/build"
        make CTEST_OUTPUT_ON_FAILURE=TRUE test
}

package() {
        cd "$builddir/build"
	make DESTDIR="$pkgdir" install
}

sha512sums="fd5610c9c6a1159bed42e7b5f0490293575522a845ddf7455b74959360904f33dc9dad2361221366fcbce13b27148a0b7f3de295065f13540947fcfe768816ab  nss_wrapper-1.1.5.tar.gz
fb4960943cc6b304864c5713438624ba19d55b8e6c11b2098c248508de22e22eee5603bf563499f63716236396438400c7400a330f3d9d2d1044e378128586a8  nss.h"
