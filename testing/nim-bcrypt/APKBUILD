# Contributor: Will Sinatra <wpsinatra@gmail.com>
# Maintainer: Will Sinatra <wpsinatra@gmail.com>
pkgname=nim-bcrypt
pkgver=0.2.1
pkgrel=0
pkgdesc="Nim wrapper for bcrypt password hashing"
url="https://github.com/runvnc/bcryptnim"
arch="noarch !s390x" # missing nim/nimble
license="BSD-3-Clause"
makedepends="
	nim
	nimble
	bsd-compat-headers"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/runvnc/bcryptnim/archive/refs/heads/master.tar.gz
	musl-compat.patch
	"
builddir="$srcdir/bcryptnim-master"

build() {
	nim c bcrypt.nim
}

check() {
	./bcrypt.out || true
}

package() {
	local destdir="$pkgdir/usr/share/nimble/pkgs2/bcrypt-$pkgver"

	mkdir -p "$destdir/bcrypt"

	# Install main module
	install -Dm644 bcrypt.nim "$destdir/"

	# Install C sources
	install -Dm644 bcrypt/*.c "$destdir/bcrypt/"
	install -Dm644 bcrypt/*.h "$destdir/bcrypt/"

	# Install nimble file if it exists
	if [ -f bcrypt.nimble ]; then
		install -Dm644 bcrypt.nimble "$destdir/"
	fi
}

sha512sums="
ad2c182f22f8c76c090bd4324d20a699159ff4a7fffb77f323d902ef3b1a3b0697ff3788d99245bd2e995f269bd1fbd75fc4755228e54ee2e9289d2d868dfc86  nim-bcrypt-0.2.1.tar.gz
2bbef74984bcb96ec6b47fc3d0eb767bd976b1a5340930820c5416ea98a6e783402f7bc118320bdb04b76bcdaf86d8b24ce92324861cf43a0584ffe33ef5eb08  musl-compat.patch
"
