# Maintainer: qaqland <qaq@qaq.land>
pkgname=flamelens
pkgver=0.4.0
pkgrel=0
pkgdesc="Flamegraph viewer in the terminal"
url="https://github.com/YS-L/flamelens"
arch="all !loongarch64 !riscv64 !s390x" # limited by crates/py-spy
license="MIT"
makedepends="
	cargo
	cargo-auditable
	libunwind-dev
	xz-dev
	"
subpackages="$pkgname-doc"
source="https://github.com/YS-L/flamelens/archive/v$pkgver/flamelens-$pkgver.tar.gz"
options="net" # cargo fetch

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --frozen --release --all-features
}

check() {
	cargo test --frozen --all-features
}

package() {
	install -Dm 755 "target/release/$pkgname" -t "$pkgdir/usr/bin"
	install -Dm 644 README.md -t "$pkgdir/usr/share/doc/$pkgname"
	install -Dm 644 LICENSE -t "$pkgdir/usr/share/licenses/$pkgname"
}

sha512sums="
142a945a1f132b533ceaea77409098b63ab01508b2df63d92974611c596ba82f524825e28c56bb335bc2255c6574401ddfc8850b2cfd6ee971f0307894ee08fe  flamelens-0.4.0.tar.gz
"
