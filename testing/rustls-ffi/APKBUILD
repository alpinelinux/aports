maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=rustls-ffi
pkgver=0.15.0
pkgrel=0
pkgdesc="Use Rustls from any language"
url="https://github.com/rustls/rustls-ffi"
arch="all"
license="Apache-2.0 AND MIT AND ISC"
makedepends="
	cargo
	cargo-auditable
	cargo-c
	cmake
	rust-bindgen
	clang-dev
	samurai
	"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/rustls/rustls-ffi/archive/refs/tags/v$pkgver.tar.gz"
options="net" # crates.io

prepare() {
	default_prepare

	cargo fetch --target="$CHOST" --locked
}

build() {
	CMAKE_POLICY_VERSION_MINIMUM=3.5 \
	cargo auditable cbuild --frozen --release \
		--features=aws-lc-rs --prefix=/usr
}

check() {
	CMAKE_POLICY_VERSION_MINIMUM=3.5 \
	cargo test --frozen --release \
		--features=aws-lc-rs
}

package() {
	CMAKE_POLICY_VERSION_MINIMUM=3.5 \
	cargo cinstall --frozen --release --destdir "$pkgdir" \
		--features=aws-lc-rs --prefix=/usr
}

sha512sums="
b2611da3313015dae039dd6e72f3e0f70a2a24e978f5ff06f7521e3d46fa031588ed723921d6c1bbc3927f5dd48b8761797f97efb4996031827455a5dfac0493  rustls-ffi-0.15.0.tar.gz
"
