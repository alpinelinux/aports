# Contributor: Trevis Schiffer <nikolaibitinit@gmail.com>
# Maintainer: Trevis Schiffer <nikolaibitinit@gmail.com>
pkgname=solidity
pkgver=0.5.10
pkgrel=0
pkgdesc="The Solidity Contract-Oriented Programming Language"
url="https://github.com/ethereum/solidity"
arch="all"
license="GPL-3.0-or-later"
depends="libgcc"
makedepends="boost-dev boost cmake git"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/ethereum/$pkgname/archive/v$pkgver.tar.gz"
# options="!check" # -DTESTS=OFF in build config

prepare() { 
	default_prepare
	mkdir -p build 
	echo -n "" > commit_hash.txt
	# Fix for GCC 8 
	sed -e '/add_compile_options(-Wall)/d' -i.bak cmake/EthCompilerSettings.cmake
}

build() { 
	cd build 
	cmake .. -DCMAKE_INSTALL_PREFIX=/usr \
	-DBoost_USE_STATIC_LIBS=OFF \
	-DTESTS=ON \
	-DCMAKE_BUILD_TYPE=Release
	make
}

package() { 
	make DESTDIR="$pkgdir" install -C build
}

check() {

	ctest -V
}

sha512sums="24d23d5bf74b992a035a2dafd09e3150ebe1522624fd2feecca4f128897d57313546aa17cb5ecabea655ebe4fa9a3bee279bb1697191b4c93f2835850e10a9d0  solidity-0.5.10.tar.gz"
