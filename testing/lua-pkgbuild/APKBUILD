# Contributor: Will Sinatra <wpsinatra@gmail.com>
# Maintainer: Will Sinatra <wpsinatra@gmail.com>
pkgname=lua-pkgbuild
pkgver=1.0.0
pkgrel=0
pkgdesc="LPEG grammar for parsing Arch Linux PKGBUILD files"
url="https://krei.lambdacreate.com/durrendal/lua-pkgbuild"
arch="noarch"
license="0BSD"
depends="lua-lpeg"
checkdepends="lua-busted"
source="$pkgname-$pkgver.tar.gz::https://krei.lambdacreate.com/durrendal/lua-pkgbuild/archive/v$pkgver.tar.gz"
builddir="$srcdir/$pkgname"

_luaversions="5.1 5.2 5.3 5.4"
for _v in $_luaversions; do
	provides="$provides lua$_v-${pkgname#lua-}=$pkgver-r$pkgrel"
	checkdepends="$checkdepends lua$_v lua$_v-busted"
done

check() {
	for _v in $_luaversions; do
		version=$_v make test
	done
}

package() {
	local rockdir="$pkgdir/usr/lib/luarocks/rocks-common/$pkgname/$pkgver-1"

	install -D -m 644 "$builddir"/src/pkgbuild.lua "$pkgdir"/usr/share/lua/common/pkgbuild.lua

	mkdir -p "$rockdir"
	echo 'rock_manifest = {}' > "$rockdir"/rock_manifest
}

sha512sums="
70c522e4e1eaf3d35c7757c10b58da7e0c5dcbc681d44c12ef64826c799f57d980a942e3384de588112e0ced17155f9ab76ad605f5dab5c4982d1d33e83cdb9b  lua-pkgbuild-1.0.0.tar.gz
"
