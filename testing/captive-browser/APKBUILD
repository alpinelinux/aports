maintainer="SÃ¶ren Tempel <soeren+alpine@soeren-tempel.net>"
pkgname=captive-browser
pkgver=0_git20210801
_commit=9c707dc32afc6e4146e19b43a3406329c64b6f3c
pkgrel=2
pkgdesc="A dedicated web browser instance to log into captive portals without messing with DNS settings"
url="https://github.com/FiloSottile/captive-browser"
arch="all"
license="MIT"
makedepends="go"
options="!check" # no tests
subpackages="$pkgname-doc"
source="$pkgname-$pkgver-$_commit.tar.gz::https://github.com/FiloSottile/captive-browser/archive/$_commit.tar.gz
	README.alpine
	captive-browser-alpine-chromium.toml"
builddir="$srcdir/$pkgname-$_commit"

export GOCACHE="${GOCACHE:-"$srcdir/go-cache"}"
export GOTMPDIR="${GOTMPDIR:-"$srcdir"}"
export GOMODCACHE="${GOMODCACHE:-"$srcdir/go"}"
export GO111MODULE=off

prepare() {
	default_prepare

	# The repository currently predates GO 1.11 modules. While there
	# is a (non-merged) PR adding it, which we could backport, the
	# vendored dependencies still work well so let's just use those.
	mkdir -p "$builddir"/src/github.com/FiloSottile
	ln -sf "$builddir" "$builddir"/src/github.com/FiloSottile/$pkgname
}

build() {
	cd "$builddir"/src/github.com/FiloSottile/$pkgname
	GOPATH="$builddir" go build -o captive-browser
}

package() {
	install -Dm755 captive-browser -t "$pkgdir"/usr/bin
	install -Dm644 -t "$pkgdir"/usr/share/doc/$pkgname/ \
		README.md \
		"$srcdir"/README.alpine \
		"$srcdir"/captive-browser-alpine-chromium.toml
}

sha512sums="
8945bf98611a478ff35849d6c69e3149bcd28489030a73713700d9a4dad2057a58ad9dfdfe4604d2f63e7dc1eb642208de58cda765cf4ff17309f422ebdda4c6  captive-browser-0_git20210801-9c707dc32afc6e4146e19b43a3406329c64b6f3c.tar.gz
1dd0daf6c3cab93fd1198d5b65ee4e6a3ed2ef6d0b6168a92668240217ed081560f496baf027688668e17185d0906cf11d894fc6ac87a33d04a89adb897dc646  README.alpine
83e269883f492fa92acf781c5b4194146782eb6308366c76c29cdf5ad3079518d803b4fbbc09815968b3d7d3d660e1696ad948469aba9ad6a1c9ad0f3e66ff99  captive-browser-alpine-chromium.toml
"
