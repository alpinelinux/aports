Patch-Source: https://github.com/linux-msm/hexagonrpc/commit/c4109b45023f7dcc5ef20f68b9bebffc6736da7b
---
From c4109b45023f7dcc5ef20f68b9bebffc6736da7b Mon Sep 17 00:00:00 2001
From: Achill Gilgenast <achill@achill.org>
Date: Mon, 17 Nov 2025 21:23:47 +0100
Subject: [PATCH] data: Add systemd system services

Signed-off-by: Achill Gilgenast <achill@achill.org>
---
 data/hexagonrpcd-adsp-rootpd.service.in    | 18 ++++++++++++++++++
 data/hexagonrpcd-adsp-sensorspd.service.in | 17 +++++++++++++++++
 data/hexagonrpcd-sdsp.service.in           | 13 +++++++++++++
 data/meson.build                           | 15 +++++++++++++++
 meson.build                                |  1 +
 5 files changed, 64 insertions(+)
 create mode 100644 data/hexagonrpcd-adsp-rootpd.service.in
 create mode 100644 data/hexagonrpcd-adsp-sensorspd.service.in
 create mode 100644 data/hexagonrpcd-sdsp.service.in
 create mode 100644 data/meson.build

diff --git a/data/hexagonrpcd-adsp-rootpd.service.in b/data/hexagonrpcd-adsp-rootpd.service.in
new file mode 100644
index 0000000..bd37175
--- /dev/null
+++ b/data/hexagonrpcd-adsp-rootpd.service.in
@@ -0,0 +1,18 @@
+[Unit]
+Description=Server for FastRPC remote procedure calls from Qualcomm ADSP - RootPD
+Conflicts=suspend.target
+Before=suspend.target
+# FIXME: Remove this once hexagonrpcd can serve rootpd on the ADSP
+# of the SDM845 devices
+ConditionPathExists=!/dev/fastrpc-sdsp
+ConditionPathExists=/dev/fastrpc-adsp
+
+[Service]
+ExecStart=@bindir@/hexagonrpcd -f /dev/fastrpc-adsp -d adsp
+Restart=always
+RestartSec=3
+User=fastrpc
+Group=fastrpc
+
+[Install]
+WantedBy=multi-user.target
diff --git a/data/hexagonrpcd-adsp-sensorspd.service.in b/data/hexagonrpcd-adsp-sensorspd.service.in
new file mode 100644
index 0000000..23d31a4
--- /dev/null
+++ b/data/hexagonrpcd-adsp-sensorspd.service.in
@@ -0,0 +1,17 @@
+[Unit]
+Description=Server for FastRPC remote procedure calls from Qualcomm ADSP - sensorspd
+Conflicts=suspend.target
+Before=suspend.target
+# This service shouldn't be run on devices with an SDSP
+ConditionPathExists=!/dev/fastrpc-sdsp
+ConditionPathExists=/dev/fastrpc-adsp
+
+[Service]
+ExecStart=@bindir@/hexagonrpcd -f /dev/fastrpc-adsp -d adsp -s
+Restart=always
+RestartSec=3
+User=fastrpc
+Group=fastrpc
+
+[Install]
+WantedBy=multi-user.target
diff --git a/data/hexagonrpcd-sdsp.service.in b/data/hexagonrpcd-sdsp.service.in
new file mode 100644
index 0000000..6a5c2f8
--- /dev/null
+++ b/data/hexagonrpcd-sdsp.service.in
@@ -0,0 +1,13 @@
+[Unit]
+Description=Server for FastRPC remote procedure calls from Qualcomm SDSP
+ConditionPathExists=/dev/fastrpc-sdsp
+
+[Service]
+ExecStart=@bindir@/hexagonrpcd -f /dev/fastrpc-sdsp -d sdsp -s
+Restart=always
+RestartSec=3
+User=fastrpc
+Group=fastrpc
+
+[Install]
+WantedBy=multi-user.target
diff --git a/data/meson.build b/data/meson.build
new file mode 100644
index 0000000..0ad24ab
--- /dev/null
+++ b/data/meson.build
@@ -0,0 +1,15 @@
+systemd_units = [
+  'hexagonrpcd-adsp-rootpd.service',
+  'hexagonrpcd-adsp-sensorspd.service',
+  'hexagonrpcd-sdsp.service',
+]
+
+foreach unit : systemd_units
+  configure_file(
+    input: unit + '.in',
+    output: unit,
+    configuration: { 'bindir': get_option('prefix') / get_option('bindir') },
+    install: true,
+    install_dir: get_option('libdir') / 'systemd/system',
+  )
+endforeach
diff --git a/meson.build b/meson.build
index 2bdc182..8d08577 100644
--- a/meson.build
+++ b/meson.build
@@ -16,6 +16,7 @@ subdir('libhexagonrpc')
 subdir('hexagonrpcd')
 subdir('chrecd')
 
+subdir('data')
 subdir('tools')
 
 subdir('tests')
