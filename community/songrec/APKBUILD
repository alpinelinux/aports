maintainer="Bart Ribbers <bribbers@disroot.org>"
pkgname=songrec
pkgver=0.6.2
pkgrel=0
pkgdesc="Open-source Shazam client for Linux"
url="https://github.com/marin-m/SongRec"
# loongarch64: blocked by nix crate
arch="all !loongarch64"
license="GPL-3.0-only"
makedepends="
	alsa-lib-dev
	cargo
	cargo-auditable
	gdk-pixbuf-dev
	glib-dev
	graphene-dev
	gtk4.0-dev
	libadwaita-dev
	openssl-dev>3
	pango-dev
	pulseaudio-dev
	"
source="https://github.com/marin-m/songrec/archive/$pkgver/songrec-$pkgver.tar.gz"
# net required to download Rust dependencies
# no tests
options="net !check"
builddir="$srcdir/SongRec-$pkgver"

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
}

check() {
	cargo test --frozen
}

package() {
	install -Dm755 target/release/songrec -t "$pkgdir"/usr/bin/
	mv packaging/rootfs/usr/share "$pkgdir"/usr
}

sha512sums="
0b2b7191235d95c78cddcb84277f1d7672f6cdcdc82a35a7c97b8f1e1d3bac3d6afe46cc0daf9d402b14ff764d0d0cdfc53e27c8fe559784d63bb7201a96ca97  songrec-0.6.2.tar.gz
"
