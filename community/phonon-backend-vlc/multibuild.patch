Patch-Source: https://invent.kde.org/libraries/phonon-vlc/-/commit/8b335d872994196d1dab6f12a3b45bfc2427d910
Patch-Source: https://invent.kde.org/libraries/phonon-vlc/-/commit/a78b72c8a893338a1dbc5465aadc3d6d4c1b6ebe

diff --git a/CMakeLists.txt b/CMakeLists.txt
index aaf97a9..7d963f5 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -48,7 +48,7 @@ set_package_properties(LIBVLC PROPERTIES
     DESCRIPTION "VLC C library"
     URL "http://git.videolan.org")
 
-foreach(version ${VERSIONS})
+function(build_Qt version)
     set(QT_MAJOR_VERSION ${version})
 
     include(KDEInstallDirs${QT_MAJOR_VERSION})
@@ -77,8 +77,10 @@ foreach(version ${VERSIONS})
     add_subdirectory(src src${version})
 
     unset(QUERY_EXECUTABLE CACHE)
-endforeach()
+endfunction()
 
-ecm_install_po_files_as_qm(poqm)
+foreach(version ${VERSIONS})
+    build_Qt(${version})
+endforeach()
 
 feature_summary(WHAT ALL FATAL_ON_MISSING_REQUIRED_PACKAGES)
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index 3f1253f..d531281 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -24,7 +24,9 @@ if(${PHONON_VERSION} VERSION_GREATER "4.9.50")
 endif()
 add_definitions(${BACKEND_VERSION_DEFINE}) # also automatically used for moc
 
-set(phonon_vlc_SRCS
+add_library(phonon_vlc_qt${QT_MAJOR_VERSION} MODULE)
+
+target_sources(phonon_vlc_qt${QT_MAJOR_VERSION} PRIVATE
     audio/audiooutput.cpp
     audio/volumefadereffect.cpp
     backend.cpp
@@ -60,22 +62,25 @@ set(phonon_vlc_SRCS
     video/videomemorystream.h
     utils/debug.h
     utils/libvlc.h
+    equalizereffect.cpp
 )
 
-list(APPEND phonon_vlc_SRCS equalizereffect.cpp)
-
 if(PHONON_EXPERIMENTAL)
-    list(APPEND phonon_vlc_SRCS video/videodataoutput.cpp video/videodataoutput.h)
+    target_sources(phonon_vlc_qt${QT_MAJOR_VERSION} PRIVATE
+        video/videodataoutput.cpp
+        video/videodataoutput.h
+    )
 endif()
 
 if(APPLE)
-    list(APPEND phonon_vlc_SRCS
+    target_sources(phonon_vlc_qt${QT_MAJOR_VERSION} PRIVATE
         video/mac/nsvideoview.mm
-        video/mac/vlcmacwidget.mm)
+        video/mac/vlcmacwidget.mm
+    )
 endif()
 
-ecm_create_qm_loader(phonon_vlc_SRCS phonon_vlc_qt)
-add_library(phonon_vlc_qt${QT_MAJOR_VERSION} MODULE ${phonon_vlc_SRCS})
+ecm_create_qm_loader(phonon_vlc_qt${QT_MAJOR_VERSION} phonon_vlc_qt)
+
 if(QT_MAJOR_VERSION STREQUAL 5)
     set_target_properties(phonon_vlc_qt${QT_MAJOR_VERSION} PROPERTIES INSTALL_NAME "phonon_vlc")
 endif()
@@ -110,3 +115,5 @@ configure_file(${CMAKE_CURRENT_SOURCE_DIR}/utils/mime.h.cmake
 # Also see qtplugin/Q_PLUGIN_METADATA documentation.
 configure_file(${CMAKE_CURRENT_SOURCE_DIR}/phonon-vlc.json.in
                 ${CMAKE_CURRENT_BINARY_DIR}/phonon-vlc.json @ONLY)
+
+ecm_install_po_files_as_qm(../poqm)
