diff --git a/texk/kpathsea/getopt.h b/texk/kpathsea/getopt.h
index 8acf05fb4f..49b1d5ae60 100644
--- a/texk/kpathsea/getopt.h
+++ b/texk/kpathsea/getopt.h
@@ -129,7 +129,7 @@ extern KPSEDLL int getopt (int argc, char *const *argv, const char *shortopts);
 #if defined (__MINGW32__) || defined (__CYGWIN__)
 #define __GETOPT_H__ /* Avoid that <unistd.h> redeclares the getopt API.  */
 #endif
-#elif !defined (__cplusplus)
+#elif !defined (__cplusplus) && !defined (_XOPEN_SOURCE)
 extern KPSEDLL int getopt ();
 #endif
 
