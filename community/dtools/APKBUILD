# Contributor: Mathias LANG <pro.mathias.lang@gmail.com>
# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=dtools
pkgver=2.112.0
pkgrel=0
pkgdesc="Ancillary tools for the D programming language compiler"
url="https://github.com/dlang/tools"
arch="x86_64"
license="BSL-1.0"
makedepends="dmd"
source="https://github.com/dlang/tools/archive/v$pkgver/dtools-$pkgver.tar.gz"
builddir="$srcdir/tools-$pkgver"
options="!check" # todo

# There are 4 'public' tools in the repository as of v2.098.0
# In addition, there are a few 'build' tools which could be
# useful (and can be trivially added if needed).
#
# Out of those 4 public tools, only 'dman' has heavy dependencies,
# as it rely on building dlang.org (and by extension DMD & co),
# so it is excluded from this package.

build() {
	msg "building rdmd"
	dmd -v -of=dtools-rdmd -L=--build-id rdmd.d

	for tool in DustMite/dustmite ddemangle catdoc detab tolf dget; do
		msg "building $tool"
		./dtools-rdmd -v --compiler=dmd --build-only -of=dtools-"$(basename $tool)" $tool.d
	done
}

package() {
	for tool in rdmd ddemangle catdoc detab tolf dget dustmite; do
		install -Dvm755 $pkgname-$tool -t "$pkgdir"/usr/bin/
	done

	ln -s dtools-rdmd "$pkgdir"/usr/bin/rdmd
	ln -s dtools-dustmite "$pkgdir"/usr/bin/dustmite
	ln -s dtools-ddemangle "$pkgdir"/usr/bin/ddemangle
}

sha512sums="
3dfc0f901677d280e94a0e3769be17be45c40884c084c407a72209b18d06d0af6dc472ba92eb9823afb10329ce4500191d857e6950ac264509edde15aff2df6f  dtools-2.112.0.tar.gz
"
