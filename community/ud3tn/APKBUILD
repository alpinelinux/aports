# Contributor: Oleg Titov <oleg.titov@gmail.com>
# Maintainer: Oleg Titov <oleg.titov@gmail.com>
pkgname=ud3tn
pkgver=0.14.5
pkgrel=0
pkgdesc="uD3TN is a free, lean, and space-tested DTN protocol implementation"
url="https://d3tn.com/ud3tn.html"
arch="all !s390x" # segmentation fault running test
license="AGPL-3.0-or-later AND BSD-3-Clause AND MIT"
makedepends="libcbor-dev sqlite-dev jansson-dev"
subpackages="$pkgname-doc"
source="https://gitlab.com/d3tn/ud3tn/-/wikis/uploads/ac3f8f36a739a1870678d61d40c6c9cc/ud3tn-v$pkgver.zip
	march.patch
	"

builddir="$srcdir"/"$pkgname"-v"$pkgver"

build() {
	make type=release posix
}

check() {
	make type=release run-unittest-posix
}

package() {
	install -Dm755 build/posix/ud3tn -t "$pkgdir"/usr/bin/

	install -Dm644 README.md -t "$pkgdir"/usr/share/doc/$pkgname/
}

sha512sums="
a95cb7882be766b35a000232b750fb6fd06140c0ea0c55251219095c1c9b4b25b47892a8b48ee2a7cd783b73e562a5a5e3683c88fe59a1c94539d1f88980cfca  ud3tn-v0.14.5.zip
92e9d2a8926c20afd30eebcdccea929f68a914822035b5e026b21998b0339a25a6d88b42e3f5e9d2f3344bd833b4fe9b086534328f1ca3f2e7fc1c480ef67e40  march.patch
"
