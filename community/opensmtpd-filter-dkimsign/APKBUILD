# Contributor: Malte Voos <malte@malvo.org>
# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Malte Voos <malte@malvo.org>
_pkgname=filter-dkimsign
pkgname=opensmtpd-$_pkgname
pkgver=0.6
pkgrel=2
pkgdesc="OpenSMTPD filter for DKIM signing"
url="http://imperialat.at/dev/filter-dkimsign/"
arch="all"
license="ISC"
makedepends="libopensmtpd-dev openssl-dev mandoc"
install="$pkgname.pre-install $pkgname.post-install"
options="!check"  # no test suite
subpackages="$pkgname-doc"
source="$pkgname-$pkgver-1.tar.gz::https://src.imperialat.at/releases/filter-dkimsign-$pkgver.tar.gz
	dkimsign-genkey
	"
builddir="$srcdir/$_pkgname-$pkgver"

build() {
	make -f Makefile.gnu HAVE_ED25519=1
}

package() {
	make -f Makefile.gnu DESTDIR="$pkgdir" BINDIR=/usr/lib/opensmtpd/ install

	install -D -m755 "$srcdir"/dkimsign-genkey -t "$pkgdir"/usr/sbin/
}

sha512sums="
723b86f7acbe55d1a1e12f630c562e9c621adb34c5eb3ee7709fd18cef03b916b5035cc338f4b641c26cc1fc56f1e14cf02e47734e4fb22a08fcf23b3dcdde1e  opensmtpd-filter-dkimsign-0.6-1.tar.gz
0e6e1db509a8299c97070f82b2c4d832c9f19d8d8909e21563c3d589ef29ebfd5b867b3f5271a6ebe6b97196569a7b9d6403a91d9c0c1db72358d6c12abbc4c5  dkimsign-genkey
"
