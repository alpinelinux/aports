# Contributor: omni <omni+alpine@hack.org>
# Maintainer: Paul Morgan <jumanjiman@gmail.com>
pkgname=editorconfig
_pkgname=$pkgname-core-c
pkgver=0.12.10
_testname=editorconfig-core-test
_testver=d91029bdf1e3e0307714afe0d2cde7ba6fd208ab
pkgrel=0
pkgdesc="core library written in C for use by plugins supporting EditorConfig parsing"
url="https://github.com/editorconfig/editorconfig-core-c"
arch="all"
license="BSD-2-Clause"
makedepends="cmake pcre2-dev samurai"
subpackages="lib$pkgname:libs $pkgname-static $pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/editorconfig/$_pkgname/archive/v$pkgver.tar.gz
	$_testname-$_testver.tar.gz::https://github.com/editorconfig/$_testname/archive/$_testver.tar.gz
	"
builddir="$srcdir/$_pkgname-$pkgver"

prepare() {
	# Tests are taken from a github release tarball so place them in the tree
	rmdir tests
	mv ../"$_testname"-"$_testver" tests
	default_prepare
}

build() {
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_DOCUMENTATION=False
	cmake --build build
}

check() {
	ctest --test-dir build
}

package() {
	DESTDIR="$pkgdir" cmake --install build

	# Remove symlink to editorconfig-$pkgver.
	rm -f "$pkgdir"/usr/bin/"$pkgname"
	mv -f "$pkgdir"/usr/bin/"$pkgname"-"$pkgver" "$pkgdir"/usr/bin/"$pkgname"
}

sha512sums="
fe8cae5e22f91cabcad4f760db70be6b7d7a9f208f20ce5c8b27f5c18fd018b0d34910d042175ff140da229538aa3ea7ee3e08b538d66b58d2dbb7ab74b6352d  editorconfig-0.12.10.tar.gz
530ac91b7dc5b433c59251edd5928c6f9c579c343b85f0dbd7dc71de6eb2e34328dbb398f0e68a416f4f22c9c7bfa13a792bcfe4c0469902e3a1fe2ba6c9841f  editorconfig-core-test-d91029bdf1e3e0307714afe0d2cde7ba6fd208ab.tar.gz
"
