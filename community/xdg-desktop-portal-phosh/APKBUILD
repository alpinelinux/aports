maintainer="team/phosh <achill@achill.org>"
pkgname=xdg-desktop-portal-phosh
pkgver=0.51.0
pkgrel=0
pkgdesc="xdg-desktop-portal implementation using GTK/GNOME/Phosh"
url="https://gitlab.gnome.org/guidog/xdg-desktop-portal-phosh"
arch="all"
license="GPL-3.0-or-later"
depends="
	gsettings-desktop-schemas
	xdg-desktop-portal
	"
makedepends="
	cargo
	gnome-desktop-dev
	libadwaita-dev
	meson
	py3-docutils
	xdg-desktop-portal-dev
	"
subpackages="$pkgname-doc $pkgname-systemd"
source="https://sources.phosh.mobi/releases/xdg-desktop-portal-phosh/xdg-desktop-portal-phosh-${pkgver/_/.}.tar.xz
	debug.patch
	32b-rm-g_debug-call.patch
	"
options="!check net" # no tests, cargo modules for pfs
builddir="$srcdir/$pkgname-${pkgver/_/.}"

prepare() {
	default_prepare
	sed -i 's/\.rc/_rc/' meson.build
}

build() {
	abuild-meson \
		. output
	meson compile -C output
}

check() {
	meson test --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

sha512sums="
bf2bb5ad0d4e31571a473987150a28bd7c4bb0511129ad53e4b1beed171d0419fb79b01a63dbd42912efa592dcbd38d3c69c2de05b0d06f192baff0acb1b7786  xdg-desktop-portal-phosh-0.51.0.tar.xz
6084f2507c0dee12c9345328a9aec608230ca37835f4894946cbec8fc95c034c75b0bfdfb256c78f12f16fa0d4d7e89bd03bc17be97015a3421fb3bcc28314b1  debug.patch
ccf4e37dd194c6d483521b371d4998bbe5d0e87877c1ed235bee5fa4d2bd6a3be6834f67725f9b4fe8b6ad8ced46d696970c7a71f0794f80c3ea544c3b3267f4  32b-rm-g_debug-call.patch
"
