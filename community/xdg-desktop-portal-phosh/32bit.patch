From 435cbe7265ceb2ad1251d65aa9afe3f99965ebe6 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Guido=20G=C3=BCnther?= <agx@sigxcpu.org>
Date: Sun, 16 Nov 2025 14:34:34 +0100
Subject: [PATCH] application: Handle mtime as 64bit uint
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This is how we retrieve it from file info.

Closes: https://gitlab.gnome.org/World/Phosh/xdg-desktop-portal-phosh/-/issues/18
Signed-off-by: Guido GÃ¼nther <agx@sigxcpu.org>
---
 src/thumbnailer/application.c | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/src/thumbnailer/application.c b/src/thumbnailer/application.c
index 46a68b3..86742ab 100644
--- a/src/thumbnailer/application.c
+++ b/src/thumbnailer/application.c
@@ -121,9 +121,9 @@ get_thumbnail_size (void)
 static void process_queue (uint size);
 
 typedef struct {
-  char  *uri;
-  char  *mime_type;
-  time_t mtime;
+  char   *uri;
+  char   *mime_type;
+  guint64 mtime;
 } FileInfo;
 
 
@@ -238,7 +238,8 @@ start_thumbnailing_file (FileInfo *info)
   PtApplication *self = PT_APPLICATION (g_application_get_default ());
   g_autofree char *thumbnail_uri = NULL;
 
-  g_debug ("To thumbnail file %s (%s; %ld)", info->uri, info->mime_type, info->mtime);
+  g_debug ("To thumbnail file %s (%s; %" G_GUINT64_FORMAT ")",
+           info->uri, info->mime_type, info->mtime);
 
   thumbnail_uri = gnome_desktop_thumbnail_factory_lookup (self->factory, info->uri, info->mtime);
   if (thumbnail_uri) {
-- 
GitLab

