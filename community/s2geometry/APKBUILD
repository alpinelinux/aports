# Contributor: Bart Ribbers <bribbers@disroot.org>
# Maintainer: Bart Ribbers <bribbers@disroot.org>
pkgname=s2geometry
pkgver=0.13.1
pkgrel=0
pkgdesc="Computational geometry and spatial indexing on the sphere"
url="https://s2geometry.io/"
arch="all"
license="Apache-2.0"
depends_dev="
	abseil-cpp-dev
	openssl-dev>3
	"
makedepends="$depends_dev
	cmake
	gtest-dev
	python3-dev
	samurai
	swig
	"
source="https://github.com/google/s2geometry/archive/v$pkgver/s2geometry-v$pkgver.tar.gz
	swig-python-typeerror.patch
	"
subpackages="$pkgname-dev py3-$pkgname:_py3"
options="!check" # No test target available

build() {
	# Tests require unavailable googlemock directory
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=MinSizeRel \
		-DBUILD_SHARED_LIBS=ON \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DBUILD_EXAMPLES=OFF \
		-DBUILD_TESTS=OFF \
		-DWITH_PYTHON=ON
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

_py3() {
	pkgdesc="$pkgdesc (Python)"
	depends="python3"

	amove usr/lib/python3*
}

sha512sums="
4ddfff2f44c0e98b2a110da57335fe119788f32e3924c8bdbe9afffbad5e037fdfe64f88f664b025a86134e17f14f6195107035b258fde06f946972f1f0456a8  s2geometry-v0.13.1.tar.gz
7b8eb29cfdae0db2fcd50a825fbf65293f6deb3fe956282fcafddaea1d97d67b14af2627811cbbfc7e64554539a404993d30ad9e73d8d212ead8805e0e05d592  swig-python-typeerror.patch
"
