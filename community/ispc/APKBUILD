# Contributor: Leon Marz <main@lmarz.org>
# Maintainer: Leon Marz <main@lmarz.org>
pkgname=ispc
pkgver=1.29.1
pkgrel=0
pkgdesc="Intel SPMD Program Compiler"
url="https://ispc.github.io/"
arch="x86_64 aarch64" # ispc only supports these arches
license="BSD-3-Clause"
_llvmver=21
makedepends="cmake
	bison
	clang$_llvmver-dev
	flex
	llvm$_llvmver-dev
	llvm$_llvmver-test-utils
	m4
	python3
	samurai
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/ispc/ispc/archive/v$pkgver.tar.gz"
options="!check" # ctest does not find a testsuite

build() {
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_C_COMPILER="/usr/lib/llvm$_llvmver/bin/clang" \
		-DCMAKE_CXX_COMPILER="/usr/lib/llvm$_llvmver/bin/clang++" \
		-DLLVM_CONFIG_EXECUTABLE="/usr/lib/llvm$_llvmver/bin/llvm-config" \
		-DISPC_INCLUDE_EXAMPLES=OFF \
		-DISPC_INCLUDE_RT=OFF \
		-DISPC_SLIM_BINARY=ON

	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
eaee3dbac16494213d96a75afb42a369e6a07a43f45b002cdffe0eeb7e9165cf7f139efa2f77afa1c1701c2b23151b4b5cb674cf860eeb31620510827f79bfb3  ispc-1.29.1.tar.gz
"
