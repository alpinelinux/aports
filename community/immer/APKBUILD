maintainer="Bart Ribbers <bribbers@disroot.org>"
pkgname=immer
pkgver=0.9.0
pkgrel=0
pkgdesc="Postmodern immutable and persistent data structures for C++ â€” value semantics at scale"
url="https://sinusoid.es/immer"
arch="noarch"
license="BSL-1.0"
makedepends="
	catch2-3
	cmake
	samurai
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/arximboldi/immer/archive/refs/tags/v$pkgver.tar.gz"
options="!check" # Calls test executables unconditionally if they have been built or not

build() {
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-Dimmer_BUILD_EXAMPLES=False \
		-Dimmer_BUILD_EXTRAS=False
	cmake --build build
}

check() {
	ctest --test-dir build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
077778c9f5116031dfabb22343339193689c01fb45680f5f0c713ba712abe0c6fc77560a7e0e69d08b5064a2a716a900e0e04053c280fe03fd808d2358cf8738  immer-0.9.0.tar.gz
"
