# Contributor: Alex Denes <caskd@redxen.eu>
# Maintainer: Alex Denes <caskd@redxen.eu>
pkgname=syncplay
pkgver=1.7.4
pkgrel=0
pkgdesc="Synchronize watching movies on mplayer2, vlc, mpv, and mpc-hc across many computers"
url="https://syncplay.pl/"
# riscv64 blocked by py3-pyside6
# armhf blocked by qt6-qtdeclarative -> py3-pyside6
arch="noarch !riscv64 !armhf"
license="Apache-2.0"
depends="
	$pkgname-client
	$pkgname-server
	"
makedepends="py3-setuptools_scm"
subpackages="
	$pkgname-common-pyc:pyc
	$pkgname-common
	$pkgname-client
	$pkgname-server
	"
source="$pkgname-$pkgver.tar.gz::https://github.com/Syncplay/syncplay/archive/v$pkgver.tar.gz"
options="!check" # testing requires pip

build() {
	python3 setup.py build
}

check() {
	python3 setup.py test
}

package() {
	python3 setup.py install --root "$pkgdir"
}

common() {
	depends=
	amove usr/lib/python*/site-packages/
}

client() {
	depends="
		$pkgname-common=$pkgver-r$pkgrel
		python3
		py3-twisted
		py3-pyside6
		"
	amove usr/bin/syncplay
}

server() {
	depends="
		$pkgname-common=$pkgver-r$pkgrel
		python3
		py3-twisted
		"
	amove usr/bin/syncplay-server
}

sha512sums="
57b7bda7a1f9841f8526f2a1a8063768a066469c349005c9cb0e7984a151264f5472222d280ad9a68226bec689bed6a671ea7dc0ea71bdf406ac88bb7ad0083a  syncplay-1.7.4.tar.gz
"
