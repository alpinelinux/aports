# Contributor: Hugo Wang <w@mitnk.com>
# Maintainer: Hugo Wang <w@mitnk.com>
pkgname=cicada
pkgver=1.2.2
pkgrel=0
pkgdesc="A bash-like Unix shell"
url="https://github.com/mitnk/cicada"
# s390x is blocked by nix crate: https://github.com/nix-rust/nix/issues/2683
arch="all !s390x"
license="MIT"
depends="ncurses-terminfo-base"
makedepends="sqlite-dev cargo cargo-auditable"
checkdepends="xz"
install="$pkgname.post-install $pkgname.pre-deinstall"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/mitnk/cicada/archive/v$pkgver.tar.gz
	unbundle-sqlite.patch
	"


prepare() {
	default_prepare
	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --frozen --release
}

check() {
	cargo test --frozen --release --bins
}

package() {
	install -Dm755 target/release/cicada -t "$pkgdir"/usr/bin
	install -Dm644 docs/*.md -t "$pkgdir"/usr/share/doc/$pkgname
	install -Dm644 LICENSE "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
}

sha512sums="
27ee9c7f23783861f7a370630148f96c69c38622cb2624c76d4c8a144d82011f44560510b9601fb248c6979e9268d5c1f7fee46b6dcd8dc9594ae00909079d19  cicada-1.2.2.tar.gz
0e5d9d52404e18df555ad82a4bf8ffe12420ec150417dce060b0ccdf60662ec5b76f1cde321da19c936a2bb89ce7e1d5485d23acbbb9032f8069b25cc9e80110  unbundle-sqlite.patch
"
