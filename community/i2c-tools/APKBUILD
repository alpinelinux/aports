# Contributor: Leonardo Arena <rnalrd@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=i2c-tools
pkgver=4.4
pkgrel=1
pkgdesc="Tools for monitoring I2C devices"
url="https://i2c.wiki.kernel.org/index.php/I2C_Tools"
arch="all"
license="GPL-2.0-or-later AND LGPL-2.1-or-later"
options="!check" #no test/check provided by upstream
makedepends="linux-headers python3-dev py3-setuptools"
subpackages="$pkgname-dev $pkgname-doc py3-smbus:py"
# Source inaccessible via busybox wget
# source="https://fossies.org/linux/misc/i2c-tools-$pkgver.tar.gz"
source="https://www.kernel.org/pub/software/utils/i2c-tools/i2c-tools-$pkgver.tar.gz"

prepare() {
	default_prepare
	sed -e "s|^DESTDIR.*|DESTDIR = \"$pkgdir\"|" \
			-e "s|^prefix.*|prefix = /usr|" \
		 	-e "s|^PREFIX.*|PREFIX = /usr|" \
			-i Makefile
}

build() {
	make

	cd "$builddir"/py-smbus
	CFLAGS="$CFLAGS -I$builddir/include" python3 setup.py build
}

py() {
	pkgdesc="$pkgname python bindings"
	provides="py-smbus=$pkgver-r$pkgrel"
	replaces="py-smbus"
	install -d "$subpkgdir"/usr/lib
	mv "$pkgdir"/usr/lib/python3* "$subpkgdir"/usr/lib
}

package() {
	make install

	cd "$builddir"/py-smbus
	python3 setup.py install --skip-build --root="$pkgdir"
}

sha512sums="
a016590201c01759d3a9eee8054aeb242176143e22851df3c46605064ae221a7ccf63accf0eedc60d5bd809784b3eafd7b85245052cdb48b37bff79d3a2ace56  i2c-tools-4.4.tar.gz
"
