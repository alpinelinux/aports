# Contributor: Leo <thinkabit.ukim@gmail.com>
# Maintainer: omni <omni+alpine@hack.org>
pkgname=ion-shell
pkgver=1.0.5_git20251020
pkgrel=0
_commit=3128d159e0b91980d27aef58186f2a49b927f0f4
pkgdesc="modern system shell with simple, yet powerful, syntax"
url="https://doc.redox-os.org/ion-manual/"
# loongarch64: blocked by old nix crate, bumping currently not possible
# s390x: blocked by nix crate
arch="all !loongarch64 !s390x"
license="MIT"
makedepends="cargo cargo-auditable"
install="$pkgname.post-install $pkgname.post-upgrade $pkgname.pre-deinstall"
source="$pkgname-$pkgver.tar.gz::https://gitlab.redox-os.org/redox-os/ion/-/archive/$_commit.tar.gz
	0002-remove_errno-dragonfly.patch
	0003-remove_redox_users.patch
	"
builddir="$srcdir/ion-$_commit"

prepare() {
	default_prepare
	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
}

check() {
	cargo test --release --frozen
}

package() {
	install -Dm0755 target/release/ion -t "$pkgdir"/usr/bin
}

sha512sums="
d06b08b5d1058e25ebca472b03b0b683302e922e6f0cbb3226ea14bfab356dfc29e5a3c71a6f9db29f0b1613dcab125e433507d309c136f46fc7e04883becb96  ion-shell-1.0.5_git20251020.tar.gz
50fa05b699ca61034a88571e3c9c5f2dbb302dc8547fb33c1a3487d8e8eeac84bac415487b0f7e8fff7b7177135d9b4318bc89ccd38bb915e146c6acede85424  0002-remove_errno-dragonfly.patch
344bfa9c6583e81d3d1fc1619e514026ec11791115e7ef6bd67c074557d922432571eb47e54c7371a485641a8471c78df87cb1d23a0c8d51dc16c74f474c69f2  0003-remove_redox_users.patch
"
