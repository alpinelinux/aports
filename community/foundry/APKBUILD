maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=foundry
pkgver=1.0.1
pkgrel=0
pkgdesc="Companion command-line tool for IDE features of GNOME Builder"
url="https://gitlab.gnome.org/GNOME/foundry"
arch="all !armhf" # libpeas2
license="LGPL-2.1-or-later"
depends_libs="flatpak-xdg-utils"
makedepends="
	cmark-dev
	editorconfig-dev
	flatpak-dev
	glib-dev
	gobject-introspection-dev
	gom-dev
	gtksourceview5-dev
	json-glib-dev
	jsonrpc-glib-dev
	libdex-dev
	libgit2-dev
	libpeas2-dev
	libspelling-dev
	libxml2-dev
	meson
	sysprof-dev
	sysprof-static
	template-glib-dev
	vte3-dev
	webkit2gtk-6.0-dev
	yaml-dev
	"
subpackages="
	$pkgname-bash-completion
	$pkgname-dev
	$pkgname-libs
	"
source="https://gitlab.gnome.org/GNOME/foundry/-/archive/$pkgver/foundry-$pkgver.tar.gz"
options="!check" # TODO: stuck

build() {
	abuild-meson \
		. output
	meson compile -C output
}

check() {
	meson test --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

libs() {
	default_libs
	amove usr/lib/girepository-1.0
	amove usr/share/glib-2.0/schemas
}

sha512sums="
20e6c0bc12a42707153b99f5d5c91370b6aab2571c5ba955dab7f88a5e2b5b993cc8a472e97fe08184715ba245b7d15e586e7f86f4637f3773f5423d9a2f83fc  foundry-1.0.1.tar.gz
"
