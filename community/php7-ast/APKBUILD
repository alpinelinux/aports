# Contributor: Andy Blyler <andy@blyler.cc>
# Maintainer: Fabio Ribeiro <fabiorphp@gmail.com>
pkgname=php7-ast
pkgver=0.1.4
pkgrel=0
_pkgver=${pkgver/_rc/RC}
_phpver=${pkgname%%-*}
_pkgreal=${pkgname#*-}
pkgdesc="$_phpver extension: exposing PHP7 abstract syntax tree"
url="https://github.com/nikic/php-$_pkgreal"
arch="all"
license="BSD"
pecldepends="${pkgname%%-*}-dev autoconf"
makedepends="$pecldepends"
source="$_pkgreal-$_pkgver.tar.gz::https://github.com/nikic/php-$_pkgreal/archive/v$_pkgver.tar.gz"
builddir="$srcdir/php-$_pkgreal-$_pkgver"

build() {
	cd "$builddir"
	phpize || return 1
	./configure --prefix=/usr || return 1
	make
}

check() {
	make -C "$builddir" NO_INTERACTION=1 test
}

package() {
	local confdir=$(php-config|grep -o "scan-dir=[[:graph:]]*"|cut -d= -f2)
	depends="$_phpver-common $depends"
	make -C "$builddir" INSTALL_ROOT="$pkgdir" install || return 1
	mkdir -p "$pkgdir"/$confdir || return 1
	echo "extension=$_pkgreal.so" > "$pkgdir"/$confdir/$_index${_index:+_}$_pkgreal.ini
}

sha512sums="c3976a768a971cfe76fb7f20089d896a52464b7f9567c936d0060407de5467d1eec3afc998f3ee4ca801c1bb063d3b71032219896e2d751a4263dfb62b34d134  ast-0.1.4.tar.gz"
