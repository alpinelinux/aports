Patch-Source: https://src.fedoraproject.org/rpms/tiled/raw/347d0ed26463a26c6ccb4eb60846e1d871291afb/f/0002-qbs3.patch
Upstream ref:
https://github.com/mapeditor/tiled/commit/93fb1e926556794ef3298f8c2b0916105dec47c2.patch
https://github.com/mapeditor/tiled/commit/67735b1cdf6a6832d5af4f49123277dd51032820.patch
---
diff -r -U4 tiled-1.11.2--orig/qbs/imports/TiledTest.qbs tiled-1.11.2--patched/qbs/imports/TiledTest.qbs
--- tiled-1.11.2--orig/qbs/imports/TiledTest.qbs	2025-01-28 10:49:10.000000000 +0100
+++ tiled-1.11.2--patched/qbs/imports/TiledTest.qbs	2025-10-31 13:34:24.169478545 +0100
@@ -1,8 +1,9 @@
 import qbs.FileInfo
 
 CppApplication {
     type: base.concat("autotest")
+    install: false
 
     Depends { name: "libtiled" }
     Depends { name: "Qt.testlib" }
     Depends { name: "autotest" }
diff -r -U4 tiled-1.11.2--orig/src/karchive/karchive.qbs tiled-1.11.2--patched/src/karchive/karchive.qbs
--- tiled-1.11.2--orig/src/karchive/karchive.qbs	2025-01-28 10:49:10.000000000 +0100
+++ tiled-1.11.2--patched/src/karchive/karchive.qbs	2025-10-31 13:34:16.039736451 +0100
@@ -1,4 +1,6 @@
+import qbs.FileInfo
+
 StaticLibrary {
     condition: !qbs.toolchain.contains("msvc")
 
     Depends { name: "cpp" }
@@ -53,9 +55,9 @@
     ]
 
     Export {
         Depends { name: "cpp" }
-        cpp.includePaths: "src"
+        cpp.includePaths: FileInfo.joinPaths(exportingProduct.sourceDirectory, "src")
         cpp.defines: [
             "KARCHIVE_NO_DEPRECATED",
             "KARCHIVE_STATIC_DEFINE",
         ]
diff -r -U4 tiled-1.11.2--orig/src/libtiled/libtiled.qbs tiled-1.11.2--patched/src/libtiled/libtiled.qbs
--- tiled-1.11.2--orig/src/libtiled/libtiled.qbs	2025-01-28 10:49:10.000000000 +0100
+++ tiled-1.11.2--patched/src/libtiled/libtiled.qbs	2025-10-31 13:34:16.039909958 +0100
@@ -15,12 +15,17 @@
 
     cpp.cxxLanguageVersion: "c++17"
     cpp.cxxFlags: {
         var flags = base;
+
         if (qbs.toolchain.contains("msvc")) {
             if (Qt.core.versionMajor >= 6 && Qt.core.versionMinor >= 3)
                 flags.push("/permissive-");
         }
+
+        if (pkgConfigZstd.found)
+            flags = flags.concat(pkgConfigZstd.cflags);
+
         return flags;
     }
     cpp.visibility: "minimal"
     cpp.defines: {
@@ -68,20 +73,19 @@
     }
 
     Properties {
         condition: pkgConfigZstd.found
-        cpp.cxxFlags: outer.concat(pkgConfigZstd.cflags)
-        cpp.libraryPaths: outer.concat(pkgConfigZstd.libraryPaths)
-        cpp.linkerFlags: outer.concat(pkgConfigZstd.linkerFlags)
+        cpp.libraryPaths: pkgConfigZstd.libraryPaths
+        cpp.linkerFlags: pkgConfigZstd.linkerFlags
     }
 
     // When libzstd was not found but staticZstd is enabled, assume that zstd
     // has been compiled in a "zstd" directory at the repository root (this is
     // done by the autobuilds for Windows and macOS).
     Properties {
         condition: !pkgConfigZstd.found && project.staticZstd
-        cpp.libraryPaths: outer.concat(["../../zstd/lib"])
-        cpp.includePaths: outer.concat(["../../zstd/lib"])
+        cpp.libraryPaths: "../../zstd/lib"
+        cpp.includePaths: "../../zstd/lib"
     }
 
     Properties {
         condition: qbs.targetOS.contains("darwin")
@@ -198,9 +202,9 @@
             name: "Qt"
             submodules: ["gui"]
         }
 
-        cpp.includePaths: "."
+        cpp.includePaths: exportingProduct.sourceDirectory
     }
 
     install: !qbs.targetOS.contains("darwin")
     installDir: {
diff -r -U4 tiled-1.11.2--orig/src/libtiledquick/libtiledquick.qbs tiled-1.11.2--patched/src/libtiledquick/libtiledquick.qbs
--- tiled-1.11.2--orig/src/libtiledquick/libtiledquick.qbs	2025-01-28 10:49:10.000000000 +0100
+++ tiled-1.11.2--patched/src/libtiledquick/libtiledquick.qbs	2025-10-31 13:34:16.040055242 +0100
@@ -58,9 +58,9 @@
             name: "Qt"
             submodules: ["quick"]
         }
 
-        cpp.includePaths: "."
+        cpp.includePaths: exportingProduct.sourceDirectory
     }
 
     install: !qbs.targetOS.contains("darwin")
     installDir: {
diff -r -U4 tiled-1.11.2--orig/src/plugins/python/python.qbs tiled-1.11.2--patched/src/plugins/python/python.qbs
--- tiled-1.11.2--orig/src/plugins/python/python.qbs	2025-01-28 10:49:10.000000000 +0100
+++ tiled-1.11.2--patched/src/plugins/python/python.qbs	2025-10-31 13:34:16.040195707 +0100
@@ -14,10 +14,15 @@
     }
 
     cpp.cxxFlags: {
         var flags = base
+
         if (qbs.toolchain.contains("gcc") && !qbs.toolchain.contains("clang"))
             flags.push("-Wno-cast-function-type")
+
+        if (pkgConfigPython3.found)
+            flags = flags.concat(pkgConfigPython3.compilerFlags);
+
         return flags
     }
 
     Probes.PkgConfigProbe {
@@ -33,9 +38,8 @@
     }
 
     Properties {
         condition: pkgConfigPython3.found
-        cpp.cxxFlags: outer.concat(pkgConfigPython3.compilerFlags)
         cpp.defines: pkgConfigPython3.defines
         cpp.dynamicLibraries: pkgConfigPython3.libraries
         cpp.includePaths: pkgConfigPython3.includePaths
         cpp.libraryPaths: pkgConfigPython3.libraryPaths
diff -r -U4 tiled-1.11.2--orig/src/qtpropertybrowser/qtpropertybrowser.qbs tiled-1.11.2--patched/src/qtpropertybrowser/qtpropertybrowser.qbs
--- tiled-1.11.2--orig/src/qtpropertybrowser/qtpropertybrowser.qbs	2025-01-28 10:49:10.000000000 +0100
+++ tiled-1.11.2--patched/src/qtpropertybrowser/qtpropertybrowser.qbs	2025-10-31 13:34:16.040328167 +0100
@@ -1,4 +1,6 @@
+import qbs.FileInfo
+
 StaticLibrary {
     name: "qtpropertybrowser"
 
     Depends { name: "cpp" }
@@ -40,7 +42,7 @@
     ]
 
     Export {
         Depends { name: "cpp" }
-        cpp.includePaths: "src"
+        cpp.includePaths: FileInfo.joinPaths(exportingProduct.sourceDirectory, "src")
     }
 }
diff -r -U4 tiled-1.11.2--orig/src/qtsingleapplication/qtsingleapplication.qbs tiled-1.11.2--patched/src/qtsingleapplication/qtsingleapplication.qbs
--- tiled-1.11.2--orig/src/qtsingleapplication/qtsingleapplication.qbs	2025-01-28 10:49:10.000000000 +0100
+++ tiled-1.11.2--patched/src/qtsingleapplication/qtsingleapplication.qbs	2025-10-31 13:34:16.040461969 +0100
@@ -1,4 +1,6 @@
+import qbs.FileInfo
+
 StaticLibrary {
     name: "qtsingleapplication"
 
     Depends { name: "cpp" }
@@ -25,7 +27,7 @@
 
     Export {
         Depends { name: "cpp" }
         Depends { name: "Qt.widgets" }
-        cpp.includePaths: "src"
+        cpp.includePaths: FileInfo.joinPaths(exportingProduct.sourceDirectory, "src")
     }
 }
diff -r -U4 tiled-1.11.2--orig/src/tiled/libtilededitor.qbs tiled-1.11.2--patched/src/tiled/libtilededitor.qbs
--- tiled-1.11.2--orig/src/tiled/libtilededitor.qbs	2025-01-28 10:49:10.000000000 +0100
+++ tiled-1.11.2--patched/src/tiled/libtilededitor.qbs	2025-10-31 13:34:16.040646046 +0100
@@ -613,9 +613,9 @@
         Depends { name: "cpp" }
         Depends { name: "libtiled" }
         Depends { name: "qtsingleapplication" }
         Depends { name: "Qt"; submodules: ["qml"] }
-        cpp.includePaths: "."
+        cpp.includePaths: exportingProduct.sourceDirectory
     }
 
     install: !qbs.targetOS.contains("darwin")
     installDir: {
