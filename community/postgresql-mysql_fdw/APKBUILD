# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=postgresql-mysql_fdw
_projname=mysql_fdw
pkgver=2.9.3
_pkgver=REL-${pkgver//./_}
pkgrel=0
pkgdesc="PostgreSQL foreign data wrapper for MySQL/MariaDB"
url="https://github.com/EnterpriseDB/mysql_fdw"
arch="all"
license="PostgreSQL"
makedepends="mariadb-connector-c-dev postgresql-dev"
source="https://github.com/EnterpriseDB/mysql_fdw/archive/$_pkgver/$pkgname-$pkgver.tar.gz
	fix-RTLD_DEEPBIND-check.patch
	"
builddir="$srcdir/$_projname-$_pkgver"
options="!check"  # FIXME: requires running PostgreSQL

export USE_PGXS=1

build() {
	make
}

check() {
	make installcheck
}

package() {
	depends="postgresql$(pg_config --major-version)"

	make install DESTDIR="$pkgdir"
}

sha512sums="
41400c67c6a3a301d024a15db86bf9a87d63a704c87703d59ab6a7e2afade4031e651b8726ab330ac7a4dbb23407d26504e06fb57792296e8f8d127a6e387c8f  postgresql-mysql_fdw-2.9.3.tar.gz
60ec2f8b026a52ac3f1c62b425bfe882fc321d3bd24646c513922a3a51c38efd44f3bb70d77f8ce94ff9db6f2554481c3e4a4b3458fb72060368f47921471f50  fix-RTLD_DEEPBIND-check.patch
"
