maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=anubis
pkgver=1.25.0
pkgrel=0
pkgdesc="Block AI scrapers using a sha256 proof-of-work challenge"
url="https://github.com/TecharoHQ/anubis"
arch="all"
license="MIT"
makedepends="go"
subpackages="$pkgname-doc $pkgname-openrc"
source="https://github.com/TecharoHQ/anubis/releases/download/v$pkgver/anubis-src-vendor-npm-$pkgver.tar.gz
	anubis.initd
	anubis.confd
	"
builddir="$srcdir/$pkgname-src-vendor-npm-$pkgver"
options="net" # tests

# secfixes:
#   1.15.2-r0:
#     - CVE-2025-24369

build() {
	go build -tags limitedsupportability ./cmd/anubis
}

check() {
	go test -v ./...
}

package() {
	install -Dm755 anubis -t "$pkgdir"/usr/bin/
	install -Dm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
	install -Dm755 "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
	install -Dm755 "$srcdir"/$pkgname.confd "$pkgdir"/etc/conf.d/$pkgname
}

sha512sums="
e97f0c4d08b8fbd6bf69bb3b275215a4609ac229d2d3a3da41bda02aebd0fb06fd8f36525279911969880f2a53ceb2c2b995068ec015559fb5ea18da8429ad1f  anubis-src-vendor-npm-1.25.0.tar.gz
f970c4a03ff1a9d81e765b3446243bd45bf08b2a765d56355f00526706356a2e1684fc8bdaab2985bf5f6e41c6ea45cdf379c64500f6df060203c59e7de2db17  anubis.initd
52f89e39cc2ff238d5eedbc2b89d1bebd292db9e326889c9d7fc71fae0c8324bf5a638b0fbad31442c5b6462337831b3099265da2944bc51957662d35a384691  anubis.confd
"
