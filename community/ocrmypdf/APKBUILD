# Contributor: Carlo Landmeter <clandmeter@alpinelinux.org>
# Maintainer: Carlo Landmeter <clandmeter@alpinelinux.org>
pkgname=ocrmypdf
pkgver=16.11.1
pkgrel=1
pkgdesc="Add OCR text layer to scanned PDF files"
url="https://github.com/ocrmypdf/OCRmyPDF"
# s390x, armhf, x86: tesseract-ocr
# riscv64: tests fails
# 32-bit: unsupported by upstream (not enough address space to process large files)
arch="noarch !s390x !armhf !x86 !riscv64 !armv7"
license="MIT"
depends="
	ghostscript
	jbig2enc
	leptonica
	pngquant
	py3-deprecation
	py3-hatch-vcs
	py3-hatchling
	py3-img2pdf
	py3-packaging
	py3-pdfminer
	py3-pikepdf
	py3-pillow
	py3-pluggy
	py3-reportlab
	py3-rich
	python3
	qpdf
	tesseract-ocr
	unpaper
	"
makedepends="
	py3-gpep517
	py3-setuptools_scm
	py3-wheel
	"
checkdepends="
	py3-hypothesis
	py3-pytest
	py3-pytest-cov
	py3-pytest-xdist
	tesseract-ocr-data-eng
	tesseract-ocr-data-osd
	"
subpackages="$pkgname-pyc"
source="https://files.pythonhosted.org/packages/source/o/ocrmypdf/ocrmypdf-$pkgver.tar.gz
	ghostscript-fix.patch"

build() {
	export SETUPTOOLS_SCM_PRETEND_VERSION=$pkgver
	gpep517 build-wheel \
		--wheel-dir .dist \
		--output-fd 3 3>&1 >&2
}

check() {
	PYTHONPATH=src \
	pytest
}

package() {
	python3 -m installer -d "$pkgdir" \
		.dist/ocrmypdf*.whl
}

sha512sums="
aaf4c5499a2f5b480ea83216aa86697281c5a19e11ce5f253b08ab2c3071cdc00d03a46101969d95979488427530c1f693621bb4b53c5210f5d2212c8a25237a  ocrmypdf-16.11.1.tar.gz
7f72cfff8282dde5664abb4907fb23dfd7a9cee02adf91f6bb93b83c3698ca67fcfb0428aff0e3a58349a2b1d42859c30248788dddedd1c4c5144cef8fb5eccf  ghostscript-fix.patch
"
