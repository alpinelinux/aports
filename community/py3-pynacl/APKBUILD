# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=py3-pynacl
pkgver=1.6.2
pkgrel=0
pkgdesc="Python3 binding to the Networking and Cryptography (NaCl) library"
url="https://github.com/pyca/pynacl"
arch="all"
license="Apache-2.0"
depends="py3-cffi"
makedepends="py3-gpep517 py3-setuptools python3-dev libffi-dev py3-wheel"
checkdepends="py3-pytest py3-hypothesis"
subpackages="$pkgname-pyc"
source="https://github.com/pyca/pynacl/archive/$pkgver/pynacl-$pkgver.tar.gz"
builddir="$srcdir/pynacl-$pkgver"

replaces="py-pynacl" # Backwards compatibility
provides="py-pynacl=$pkgver-r$pkgrel" # Backwards compatibility

# secfixes:
#   1.6.2-r0:
#     - CVE-2025-69277

build() {
	gpep517 build-wheel \
		--wheel-dir .dist \
		--output-fd 3 3>&1 >&2
}

check() {
	python3 -m venv --clear --without-pip --system-site-packages .testenv
	.testenv/bin/python3 -m installer .dist/*.whl
	.testenv/bin/python3 -m pytest
}

package() {
	python3 -m installer -d "$pkgdir" \
		.dist/*.whl
}

sha512sums="
e1b5871fa6221cb0ec6928fdc7ab6c5900ba0e41df1ac1e7b8dca8b8ea8c32bb7db6c9d2aad0579fd4ed09f5c27800637c6296ef6e0d7a0a804cdc86c796f59d  pynacl-1.6.2.tar.gz
"
