# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=py3-pynacl
pkgver=1.6.1
pkgrel=0
pkgdesc="Python3 binding to the Networking and Cryptography (NaCl) library"
url="https://github.com/pyca/pynacl"
arch="all"
license="Apache-2.0"
depends="py3-cffi"
makedepends="py3-gpep517 py3-setuptools python3-dev libffi-dev py3-wheel"
checkdepends="py3-pytest py3-hypothesis"
subpackages="$pkgname-pyc"
source="https://github.com/pyca/pynacl/archive/$pkgver/pynacl-$pkgver.tar.gz"
builddir="$srcdir/pynacl-$pkgver"

replaces="py-pynacl" # Backwards compatibility
provides="py-pynacl=$pkgver-r$pkgrel" # Backwards compatibility

build() {
	gpep517 build-wheel \
		--wheel-dir .dist \
		--output-fd 3 3>&1 >&2
}

check() {
	python3 -m venv --clear --without-pip --system-site-packages .testenv
	.testenv/bin/python3 -m installer .dist/*.whl
	.testenv/bin/python3 -m pytest
}

package() {
	python3 -m installer -d "$pkgdir" \
		.dist/*.whl
}

sha512sums="
77ea6ae114a6f4e980e59c291485e12fdc2a639803b7d6f521932bba041e1df12c9b394adead2240d99f3c726748446449068ce62896ee354f94949a1e0be34d  pynacl-1.6.1.tar.gz
"
