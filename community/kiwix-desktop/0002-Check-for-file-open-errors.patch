From f4d47f44d16897855148dbf576b19011d64c19c4 Mon Sep 17 00:00:00 2001
From: Vighnesh <vighneshsawant366@gmail.com>
Date: Thu, 27 Nov 2025 01:55:29 +0530
Subject: [PATCH] Check for file open errors

---
 src/choiceitem.cpp         |  2 +-
 src/contentmanagerside.cpp |  2 +-
 src/contentmanagerview.cpp |  2 +-
 src/kiwixapp.cpp           | 13 ++++++++-----
 src/kiwixapp.h             |  2 +-
 src/kiwixchoicebox.cpp     |  2 +-
 src/kiwixmessagebox.cpp    |  2 +-
 src/kprofile.cpp           |  4 +---
 src/localkiwixserver.cpp   |  7 +------
 src/searchbar.cpp          |  2 +-
 src/settingsview.cpp       |  2 +-
 11 files changed, 18 insertions(+), 22 deletions(-)

diff --git a/src/choiceitem.cpp b/src/choiceitem.cpp
index e63464580..61ba4fbf6 100644
--- a/src/choiceitem.cpp
+++ b/src/choiceitem.cpp
@@ -11,7 +11,7 @@ ChoiceItem::ChoiceItem(QString key, QString value, QWidget *parent) :
     m_value(value)
 {
     ui->setupUi(this);
-    this->setStyleSheet(KiwixApp::instance()->parseStyleFromFile(":/css/choiceBox.css"));
+    this->setStyleSheet(getFileContent(":/css/choiceBox.css"));
     ui->itemLabel->setText(key);
     ui->itemLabel->setToolTip(key);
     connect(ui->closeButton, &QPushButton::clicked, [=](){
diff --git a/src/contentmanagerside.cpp b/src/contentmanagerside.cpp
index fa9a466ac..651b268b5 100644
--- a/src/contentmanagerside.cpp
+++ b/src/contentmanagerside.cpp
@@ -14,7 +14,7 @@ ContentManagerSide::ContentManagerSide(QWidget *parent) :
 {
     setFocusPolicy(Qt::FocusPolicy::StrongFocus);
     mp_ui->setupUi(this);
-    this->setStyleSheet(KiwixApp::instance()->parseStyleFromFile(":/css/contentmanagerside.css"));
+    this->setStyleSheet(getFileContent(":/css/contentmanagerside.css"));
 
     mp_ui->buttonGroup->setId(mp_ui->allFileButton, CatalogButtonId::ALL);
     mp_ui->buttonGroup->setId(mp_ui->localFileButton, CatalogButtonId::LOCAL);
diff --git a/src/contentmanagerview.cpp b/src/contentmanagerview.cpp
index 6e29e18e5..845b082ac 100644
--- a/src/contentmanagerview.cpp
+++ b/src/contentmanagerview.cpp
@@ -10,7 +10,7 @@ ContentManagerView::ContentManagerView(QWidget *parent)
 {
     mp_ui->setupUi(this);
     mp_ui->m_view->setSortingEnabled(true);
-    mp_ui->m_view->setStyleSheet(KiwixApp::instance()->parseStyleFromFile(":/css/_contentManager.css"));
+    mp_ui->m_view->setStyleSheet(getFileContent(":/css/_contentManager.css"));
     mp_ui->m_view->setContextMenuPolicy(Qt::CustomContextMenu);
     auto managerDelegate = new ContentManagerDelegate();
     mp_ui->m_view->setItemDelegate(managerDelegate);
diff --git a/src/kiwixapp.cpp b/src/kiwixapp.cpp
index aeeb12a61..f4214088b 100644
--- a/src/kiwixapp.cpp
+++ b/src/kiwixapp.cpp
@@ -85,7 +85,7 @@ void KiwixApp::init()
 
     setApplicationName("Kiwix");
     setDesktopFileName("org.kiwix.desktop.desktop");
-    setStyleSheet(parseStyleFromFile(":/css/style.css"));
+    setStyleSheet(getFileContent(":/css/style.css"));
 
     createActions();
     mp_mainWindow = new MainWindow;
@@ -558,13 +558,16 @@ void KiwixApp::printVersions(std::ostream& out) {
   zim::printVersions(out);
 }
 
-QString KiwixApp::parseStyleFromFile(QString filePath)
+QString getFileContent(QString filePath)
 {
     QFile file(filePath);
-    file.open(QFile::ReadOnly);
-    QString styleSheet = QString(file.readAll());
+    if (!(file.open(QFile::ReadOnly))) {
+      qWarning("Error opening %s", qPrintable(filePath));
+      return QString();
+    }
+    QString content= QString(file.readAll());
     file.close();
-    return styleSheet;
+    return content;
 }
 
 void KiwixApp::saveListOfOpenTabs()
diff --git a/src/kiwixapp.h b/src/kiwixapp.h
index 36ad170e0..d4119bab3 100644
--- a/src/kiwixapp.h
+++ b/src/kiwixapp.h
@@ -99,7 +99,6 @@ class KiwixApp : public QtSingleApplication
     QString getText(const QString &key) { return m_translation.getText(key); };
     void setMonitorDir(const QString &dir);
     bool isCurrentArticleBookmarked();
-    QString parseStyleFromFile(QString filePath);
     void saveListOfOpenTabs();
     void saveWindowState();
     void saveVoiceName(const QString& langName, const QString& voiceName);
@@ -147,6 +146,7 @@ public slots:
     void loadAndInstallTranslations(QTranslator& translator, const QString& filename, const QString& directory);
 };
 
+QString getFileContent(QString filePath);
 QString gt(const QString &key);
 #define _STR(...) # __VA_ARGS__
 #define STR(X) _STR(X)
diff --git a/src/kiwixchoicebox.cpp b/src/kiwixchoicebox.cpp
index 3e3d5cb80..67cce57c8 100644
--- a/src/kiwixchoicebox.cpp
+++ b/src/kiwixchoicebox.cpp
@@ -18,7 +18,7 @@ KiwixChoiceBox::KiwixChoiceBox(QWidget *parent) :
     ui(new Ui::kiwixchoicebox)
 {
     ui->setupUi(this);
-    auto styleSheet = KiwixApp::instance()->parseStyleFromFile(":/css/choiceBox.css");
+    auto styleSheet = getFileContent(":/css/choiceBox.css");
     this->setStyleSheet(styleSheet);
     ui->clearButton->setText(gt("clear"));
     ui->clearButton->setToolTip(gt("clear-filter"));
diff --git a/src/kiwixmessagebox.cpp b/src/kiwixmessagebox.cpp
index 2de9c8928..2114021a1 100644
--- a/src/kiwixmessagebox.cpp
+++ b/src/kiwixmessagebox.cpp
@@ -10,7 +10,7 @@ KiwixMessageBox::KiwixMessageBox(QString confirmTitle, QString confirmText, bool
 {
     ui->setupUi(this);
     setWindowFlag(Qt::FramelessWindowHint, true);
-    setStyleSheet(KiwixApp::instance()->parseStyleFromFile(":/css/messageBox.css"));
+    setStyleSheet(getFileContent(":/css/messageBox.css"));
     connect(ui->yesButton, &QPushButton::clicked, [=]() {
         emit yesClicked();
         m_result = YesClicked;
diff --git a/src/kprofile.cpp b/src/kprofile.cpp
index 6c5eb28bf..0d1e65c0f 100644
--- a/src/kprofile.cpp
+++ b/src/kprofile.cpp
@@ -20,9 +20,7 @@ QWebEngineScript getScript(QString filename,
     script.setInjectionPoint(point);
     script.setWorldId(QWebEngineScript::UserWorld);
 
-    QFile scriptFile(filename);
-    scriptFile.open(QIODevice::ReadOnly);
-    script.setSourceCode(scriptFile.readAll());
+    script.setSourceCode(getFileContent(filename));
     return script;
 }
 
diff --git a/src/localkiwixserver.cpp b/src/localkiwixserver.cpp
index 575ead129..e165fa28b 100644
--- a/src/localkiwixserver.cpp
+++ b/src/localkiwixserver.cpp
@@ -13,12 +13,7 @@ LocalKiwixServer::LocalKiwixServer(QWidget *parent) :
     setWindowFlag(Qt::FramelessWindowHint, true);
     ui->setupUi(this);
 
-    QFile styleFile(":/css/localServer.css");
-    styleFile.open(QIODevice::ReadOnly);
-    auto byteContent = styleFile.readAll();
-    styleFile.close();
-    QString style(byteContent);
-    setStyleSheet(style);
+    setStyleSheet(getFileContent(":/css/localServer.css"));
 
     mp_server = KiwixApp::instance()->getLocalServer();
     m_port = KiwixApp::instance()->getSettingsManager()->getKiwixServerPort();
diff --git a/src/searchbar.cpp b/src/searchbar.cpp
index 3ecd18346..9fbbd755f 100644
--- a/src/searchbar.cpp
+++ b/src/searchbar.cpp
@@ -85,7 +85,7 @@ SearchBarLineEdit::SearchBarLineEdit(QWidget *parent) :
     m_suggestionView->setItemDelegate(new SuggestionListDelegate(this));
     m_suggestionView->header()->setStretchLastSection(true);
     m_suggestionView->setRootIsDecorated(false);
-    m_suggestionView->setStyleSheet(KiwixApp::instance()->parseStyleFromFile(":/css/popup.css"));
+    m_suggestionView->setStyleSheet(getFileContent(":/css/popup.css"));
 
     const int contentHeight = HeaderSectionCSS::lineHeight;
     m_suggestionView->setIconSize(QSize(contentHeight, contentHeight));
diff --git a/src/settingsview.cpp b/src/settingsview.cpp
index f0d08003c..79c89aeaf 100644
--- a/src/settingsview.cpp
+++ b/src/settingsview.cpp
@@ -35,7 +35,7 @@ SettingsView::SettingsView(QWidget *parent)
 {
     SettingsManager *settingsMgr = KiwixApp::instance()->getSettingsManager();
     ui->setupUi(this);
-    ui->widget->setStyleSheet(KiwixApp::instance()->parseStyleFromFile(":/css/_settingsManager.css"));
+    ui->widget->setStyleSheet(getFileContent(":/css/_settingsManager.css"));
     connect(ui->zoomPercentSpinBox, QOverload<int>::of(&QSpinBox::valueChanged), this, &SettingsView::setZoom);
     connect(ui->moveToTrashToggle, &QCheckBox::clicked, this, &SettingsView::setMoveToTrash);
     connect(ui->reopenTabToggle, &QCheckBox::clicked, this, &SettingsView::setReopenTab);
