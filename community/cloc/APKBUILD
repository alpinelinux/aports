# Contributor: Sören Tempel <soeren+alpine@soeren-tempel.net>
# Maintainer: Sören Tempel <soeren+alpine@soeren-tempel.net>
pkgname=cloc
pkgver=2.08
pkgrel=0
pkgdesc="Count lines of code"
url="https://github.com/AlDanial/cloc"
arch="noarch"
license="GPL-2.0-or-later Artistic-2.0"
makedepends="git"
checkdepends="gzip"
depends="perl perl-algorithm-diff perl-regexp-common
	perl-parallel-forkmanager"
subpackages="$pkgname-doc"
source="https://github.com/AlDanial/cloc/releases/download/v$pkgver/cloc-$pkgver.tar.gz
	skip-submodule-tests.patch
	"
builddir="$srcdir/$pkgname-$pkgver/Unix"

prepare() {
	default_prepare

	# Some tests expect the tests/ directory to be a Git repository.
	# We do some basic Git configuration here to make them pass.
	git init -q ..
	git config --local user.name "example"
	git config --local user.email "example@example.com"
	git add ../tests
	git commit -m "tests"
}

build() {
	make
}

check() {
	make test
}

package() {
	make DESTDIR="$pkgdir" install

	install -Dm644 NEWS README AUTHORS \
		-t "$pkgdir"/usr/share/doc/$pkgname/
}

sha512sums="
96b27a56943da6d71d8c6a1169fe2b5ec644f0b2df9a931a1f342ba37e92faa2b7c5a9ed1104db69c1bc87b0ddbc55dcf4064666c08e48d89c50a3d225dd30a1  cloc-2.08.tar.gz
4f65c9eb2cbd94e26d03a1091ab949fa60d8cc6e783782af1d8dbae551b93c0fc13c86941306e89c69dce095c3185d370226d6e49aac4ba5eed93583eeaf6aab  skip-submodule-tests.patch
"
