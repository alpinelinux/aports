# Maintainer: omni <omni+alpine@hack.org>
pkgname=rset
pkgver=3.3
pkgrel=0
pkgdesc="Configure systems using any scripting language"
url="https://scriptedconfiguration.org/"
license="ISC"
arch="all"
checkdepends="curl ruby-bundler"
subpackages="$pkgname-doc"
source="https://scriptedconfiguration.org/code/rset-$pkgver.tar.gz
	tests_Makefile.patch
	no_miniquark_tests_on_loongarch_patch
	"

prepare() {
	default_prepare

	case "$CARCH" in
	loongarch64)
		patch -Np1 < "$srcdir"/no_miniquark_tests_on_loongarch_patch ;;
	esac
}

build() {
	./configure
	make
}

check() {
	make test
}

package() {
	make DESTDIR="$pkgdir" PREFIX=/usr install
	install -Dm0644 NEWS -t "$pkgdir"/usr/share/doc/"$pkgname"
	install -Dm0644 LICENSE -t "$pkgdir"/usr/share/licenses/"$pkgname"
}

sha512sums="
30b4275986efc2bb1db700fe432e731087c3ade82952b629a646dfbe0847d5e91d111f56e77c73839639bea1149df42275714dbe6159f3d0d0ea966f6efaaf9d  rset-3.3.tar.gz
bbd9e433bc770b43329be6c3b0a621f54340bd9d2a9c542f982a256491caafd92825e30b053500f4d49cd2fa4087bd1830bd36d9e4822a91df66c2c6a3bf73d2  tests_Makefile.patch
01ab9b1f22da2245453899179a68f666a6ab4148a05452c61c6cd9ee42eec990290b7c661b5b7ed7e89c7932f768b804409099be4e3b0f2fa6b2070018f91d57  no_miniquark_tests_on_loongarch_patch
"
