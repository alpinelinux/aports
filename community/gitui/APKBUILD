# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=gitui
pkgver=0.22.1
pkgrel=2
pkgdesc="Blazing fast terminal client for git"
url="https://github.com/extrawurst/gitui"
arch="x86_64 armv7 armhf aarch64 x86 ppc64le"  # limited by rust/cargo
license="MIT"
makedepends="
	cargo
	cargo-auditable
	libgit2-dev
	oniguruma-dev
	openssl-dev
	zlib-dev
	"
source="https://github.com/extrawurst/gitui/archive/v$pkgver/gitui-$pkgver.tar.gz
	libgit2.patch
	"
options="net"

export LIBSSH2_SYS_USE_PKG_CONFIG=1  # use system libssh2
export RUSTONIG_DYNAMIC_LIBONIG=1  # use system libonig

_cargo_opts="--frozen --no-default-features --features regex-onig"

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build $_cargo_opts --release
}

check() {
	cargo test $_cargo_opts
}

package() {
	install -D -m755 target/release/gitui "$pkgdir"/usr/bin/gitui
}

sha512sums="
dd695edd4ee7c41209e3e109c4d127a4aecc65562912c82bc1438f1cbd2704ae5faf64a8500875bb65572860c79292095e57c2c59388ae944fb5c34f68c67fb5  gitui-0.22.1.tar.gz
d1287520304f4a80668fe5b7438094f9f64aa8f1d1b40d18f188f3481a6eaff23f44457f4c9e4fde413b0538bb11054392d17dbda61e5fdbd9c38721bcf1b191  libgit2.patch
"
