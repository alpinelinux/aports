# Contributor: Jake Buchholz Göktürk <tomalok@gmail.com>
# Maintainer: Jake Buchholz Göktürk <tomalok@gmail.com>

pkgname=runc
_commit=d842d7719497cc3b774fd71620278ac9e17710e0
pkgver=1.3.4
pkgrel=0
pkgdesc="CLI tool for spawning and running containers according to the OCI specification"
url="https://www.opencontainers.org"
arch="all"
license="Apache-2.0"
makedepends="bash go go-md2man libseccomp-dev libtool"
subpackages="$pkgname-doc"
source="https://github.com/opencontainers/runc/archive/v$pkgver/runc-$pkgver.tar.gz
	add-seccomp-for-loongarch64.patch
	"
options="!check"

provides="oci-runtime"
provider_priority=90

# secfixes:
#   1.3.3-r0:
#     - CVE-2025-31133
#     - CVE-2025-52565
#     - CVE-2025-52881
#   1.1.14-r0:
#     - CVE-2024-45310
#   1.1.12-r0:
#     - CVE-2024-21626
#   1.1.4-r0:
#     - CVE-2023-25809
#     - CVE-2023-27561
#     - CVE-2023-28642
#   1.1.4-r7:
#     - CVE-2023-27561
#   1.1.2-r0:
#     - CVE-2022-29162
#   1.0.3-r0:
#     - CVE-2021-43784
#   1.0.0_rc95-r0:
#     - CVE-2021-30465
#   1.0.0_rc10-r0:
#     - CVE-2019-19921
#   1.0.0_rc9-r0:
#     - CVE-2019-16884
#   1.0.0_rc7-r0:
#     - CVE-2019-5736

export GOCACHE="${GOCACHE:-"$srcdir/go-cache"}"
export GOTMPDIR="${GOTMPDIR:-"$srcdir"}"
export GOMODCACHE="${GOMODCACHE:-"$srcdir/go"}"

build() {
	make COMMIT="$_commit"
	make man
}

package() {
	install -Dsm755 runc "$pkgdir"/usr/bin/runc
	install -Dm644 "$builddir"/man/man8/* -t "$pkgdir"/usr/share/man/man8/
}

sha512sums="
8393a1d2741d47cb7091519185f63bdcb9ec70369d7786da62b7dee82515028358cd32e370c7c32c772b09bd97cfb09d30752b21f1b20431a6659626ae3ea6d4  runc-1.3.4.tar.gz
dc32ab4110c5a0347dbdde4137d5ec1f0d6af1964265b4453267e6a9cf533846e61546e6bcd1ce98eea80d524fc7b5092399b37502202102fe27d7935773a578  add-seccomp-for-loongarch64.patch
"
