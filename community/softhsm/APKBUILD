# Contributor: Frank Felhoffer <silveraid@hackme.ca>
# Maintainer: tcely <softhsm+aports@tcely.33mail.com>
pkgname=softhsm
pkgver=2.5.0
pkgrel=1
pkgdesc="cryptographic store accessible through a PKCS #11"
url="https://www.opendnssec.org/softhsm/"
arch="all"
license="BSD-2-Clause"
depends="sqlite"
checkdepends="cppunit-dev"
makedepends="autoconf automake botan-dev libtool p11-kit-dev sqlite-dev"
install=""
subpackages="$pkgname-doc"
source="https://dist.opendnssec.org/source/$pkgname-$pkgver.tar.gz
        softhsm-2.5.0-botan_ecb-exception-fix.patch
        Issue-435-Fix-botan-build-without-EDDSA.patch
        "
builddir="$srcdir/$pkgname-$pkgver"

build() {
        cd "$builddir"

        ./configure \
                --prefix=/usr \
                --sysconfdir=/etc \
                --localstatedir=/var \
                --with-crypto-backend=botan \
                --with-botan=/usr \
                --with-sqlite3=/usr \
                --with-objectstore-backend-db

        make
}

check() {
        cd "$builddir"

        make check

	ldd src/lib/.libs/libsofthsm2.so
}

package() {
        cd "$builddir"

        make -j1 DESTDIR="$pkgdir/" install
}

sha512sums="a1e686729196dc25591eb3da57c2c8ea8494ed274ba711842b2dcae696f477a202acda13a975b8fb1eb68e8e44a79e839dbbc6ba500cab02ad13072c660752d9  softhsm-2.5.0.tar.gz
25dc68c404f89936df1d7fcdf5460b8f42fff66f4a76d0e50f139337cb515fac853aa76b0b276cdb9186f2cd78a4099fcfa469629c1531dfa4023fa19c23823b  softhsm-2.5.0-botan_ecb-exception-fix.patch
8c76198f9e15878d26ea6daf000895def123d16c099d426c0b633670012ab5a6374a221af4ab14989b10e9e9d73200c5f03eb11fe193091fb991d3b95d2eee70  Issue-435-Fix-botan-build-without-EDDSA.patch"
