# Contributor: Mathias LANG <pro.mathias.lang@gmail.com>
# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=dub
pkgver=1.41.0
pkgrel=0
pkgdesc="Package and build management system for D"
url="https://code.dlang.org/"
arch="x86_64 aarch64 loongarch64"
license="MIT"
depends="libcurl"
makedepends="bash curl-dev ldc"
subpackages="$pkgname-doc $pkgname-zsh-completion"
source="$pkgname-$pkgver.tar.gz::https://github.com/dlang/dub/archive/v$pkgver.tar.gz"

build() {
	# The build script needs a DMD-like interface to pass its arguments, so use ldmd2
	DMD=ldmd2 GITVER="v$pkgver" ldc2 -run build.d

	# Build man pages
	./bin/dub --compiler=ldc2 --single scripts/man/gen_man.d
}

check() {
	./bin/dub test --compiler=ldc2
}

package() {
	install -Dvm755 bin/dub -t "$pkgdir"/usr/bin/

	install -Dvm644 scripts/zsh-completion/_dub \
		-t "$pkgdir"/usr/share/zsh/site-functions/

	install -Dvm644 scripts/man/*.1 -t "$pkgdir"/usr/share/man/man1/
	install -Dvm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
}

sha512sums="
27e531c51dea57458d2b9bb666ae3ef3c3ba9d5cd75427e19fd6272af62164a98fce0a5e85af2abbbf4e1561906aef11d616ba721d281b0ea2c579a272bbf90c  dub-1.41.0.tar.gz
"
