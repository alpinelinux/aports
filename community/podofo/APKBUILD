# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=podofo
pkgver=1.0.3
pkgrel=0
# tests
_resources=394fcb3ea4c8e89bbabafbc1aa6caf20f801620c
pkgdesc="C++ library to work with the PDF file format"
url="https://podofo.sourceforge.net/"
arch="all"
license="GPL-2.0-only"
makedepends="
	cmake
	fontconfig-dev
	freetype-dev
	jpeg-dev
	lcms2-dev
	libpng-dev
	libxml2-dev
	openssl-dev
	samurai
	tiff-dev
	zlib-dev
	"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/podofo/podofo/archive/refs/tags/$pkgver.tar.gz
	podofo-resources-$_resources.tar.gz::https://github.com/podofo/podofo-resources/archive/$_resources.tar.gz
	32-bit.patch
	"

# secfixes:
#   0.9.7-r0:
#     - CVE-2019-9199
#     - CVE-2019-9687
#     - CVE-2018-19532
#     - CVE-2018-20751
#     - CVE-2018-20797
#     - CVE-2019-10723
#     - CVE-2019-20093
#   0.9.6-r0:
#     - CVE-2017-6848
#     - CVE-2017-7378
#     - CVE-2017-7379
#     - CVE-2017-7380
#     - CVE-2017-7381
#     - CVE-2017-7382
#     - CVE-2017-7383
#     - CVE-2017-7994
#     - CVE-2017-8053
#     - CVE-2017-8054
#     - CVE-2017-8378
#     - CVE-2017-8787
#     - CVE-2018-5295
#     - CVE-2018-5296
#     - CVE-2018-5308
#     - CVE-2018-5309
#     - CVE-2018-5783
#     - CVE-2018-6352
#     - CVE-2018-8000
#     - CVE-2018-8001
#     - CVE-2018-8002
#     - CVE-2018-11254
#     - CVE-2018-11255
#     - CVE-2018-11256
#     - CVE-2018-12982
#     - CVE-2018-12983
#   0.9.5-r0:
#     - CVE-2017-6843
#     - CVE-2017-6844
#     - CVE-2017-6845
#     - CVE-2017-6846
#     - CVE-2017-6847
#     - CVE-2017-6849

prepare() {
	default_prepare

	rmdir extern/resources
	ln -sfv "$srcdir"/podofo-resources-$_resources extern/resources
}

build() {
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DPODOFO_BUILD_STATIC=0 \
		-DPODOFO_BUILD_TEST="$(want_check && echo ON || echo OFF)"
	cmake --build build
}

check() {
	ctest --test-dir build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
ddc33e1265eac4650c1cd4f8c04dabae206bd8ca3eadefa310cd87066ce5e262ee1a5dbf395797e01cb4de05e390db2f1d54dffa26e8659b084a57fac97de03b  podofo-1.0.3.tar.gz
6934d562d4a475a5819cd3712f34c6c1721f71b70704722444781271bf90d57f14a783f5c03cf4d5a9a7f26f6183113b57cf03eca9eb5b28316bfc76e85c8212  podofo-resources-394fcb3ea4c8e89bbabafbc1aa6caf20f801620c.tar.gz
2bbe73a94557f5f75f6e96d58b4dfa7d725e5a3e54aeb7edfde83b5015336b4fbe7f32b3260c9ec31401b88ad7c9d240798cd767aef03de510d7710db397e158  32-bit.patch
"
