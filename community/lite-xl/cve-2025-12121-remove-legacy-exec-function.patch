From 2de086246d9f85d014ffb5a5dfd1079bd88e05a7 Mon Sep 17 00:00:00 2001
From: Adam Harrison <adamdharrison@gmail.com>
Date: Wed, 15 Oct 2025 16:25:55 -0400
Subject: [PATCH] Removed legacy exec function.

---
 data/core/commands/core.lua |  2 +-
 data/core/rootview.lua      |  2 +-
 data/plugins/treeview.lua   |  6 +++---
 src/api/system.c            | 18 ------------------
 4 files changed, 5 insertions(+), 23 deletions(-)

diff --git a/data/core/commands/core.lua b/data/core/commands/core.lua
index cdf8d42..cad48c1 100644
--- a/data/core/commands/core.lua
+++ b/data/core/commands/core.lua
@@ -221,7 +221,7 @@ command.add(nil, {
           return
         end
         if abs_path == core.project_dir then
-          core.error("Directory %q is currently opened", abs_path)
+          process.start({ EXEFILE, abs_path[1] }, { detach = true })
           return
         end
         system.exec(string.format("%q %q", EXEFILE, abs_path))
diff --git a/data/core/rootview.lua b/data/core/rootview.lua
index d284658..e9c26c3 100644
--- a/data/core/rootview.lua
+++ b/data/core/rootview.lua
@@ -328,7 +328,7 @@ function RootView:on_file_dropped(filename, x, y)
   if info and info.type == "dir" then
     if self.first_dnd_processed then
       -- first update done, open in new window
-      system.exec(string.format("%q %q", EXEFILE, filename))
+      process.start({ EXEFILE, filename }, { detach = true })
     else
       -- DND event before first update, this is sent by macOS when folder is dropped into the dock
       core.confirm_close_docs(core.docs, function(dirpath)
diff --git a/data/plugins/treeview.lua b/data/plugins/treeview.lua
index 63c0fd4..773497f 100644
--- a/data/plugins/treeview.lua
+++ b/data/plugins/treeview.lua
@@ -797,11 +797,11 @@ command.add(
 
   ["treeview:open-in-system"] = function(item)
     if PLATFORM == "Windows" then
-      system.exec(string.format("start \"\" %q", item.abs_filename))
+      process.start({ "start", "", item.abs_filename }, { detach = true })
     elseif string.find(PLATFORM, "Mac") then
-      system.exec(string.format("open %q", item.abs_filename))
+      process.start({ "open", item.abs_filename }, { detach = true })
     elseif PLATFORM == "Linux" or string.find(PLATFORM, "BSD") then
-      system.exec(string.format("xdg-open %q", item.abs_filename))
+      process.start({ "xdg-open", item.abs_filename }, { detach = true })
     end
   end
 })
diff --git a/src/api/system.c b/src/api/system.c
index 65d8eec..443506c 100644
--- a/src/api/system.c
+++ b/src/api/system.c
@@ -805,23 +805,6 @@ static int f_sleep(lua_State *L) {
 }
 
 
-static int f_exec(lua_State *L) {
-  size_t len;
-  const char *cmd = luaL_checklstring(L, 1, &len);
-  char *buf = SDL_malloc(len + 32);
-  if (!buf) { luaL_error(L, "buffer allocation failed"); }
-#if _WIN32
-  sprintf(buf, "cmd /c \"%s\"", cmd);
-  WinExec(buf, SW_HIDE);
-#else
-  sprintf(buf, "%s &", cmd);
-  int res = system(buf);
-  (void) res;
-#endif
-  SDL_free(buf);
-  return 0;
-}
-
 static int f_fuzzy_match(lua_State *L) {
   size_t strLen, ptnLen;
   const char *str = luaL_checklstring(L, 1, &strLen);
@@ -1106,7 +1089,6 @@ static const luaL_Reg lib[] = {
   { "get_process_id",      f_get_process_id      },
   { "get_time",            f_get_time            },
   { "sleep",               f_sleep               },
-  { "exec",                f_exec                },
   { "fuzzy_match",         f_fuzzy_match         },
   { "set_window_opacity",  f_set_window_opacity  },
   { "load_native_plugin",  f_load_native_plugin  },
