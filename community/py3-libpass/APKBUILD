maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=py3-libpass
pkgver=1.9.3
pkgrel=0
pkgdesc="Maintained fork of py3-passlib, a password hashing library for Python"
url="https://github.com/notypecheck/passlib"
arch="noarch"
license="BSD-2-Clause"
makedepends="
	py3-gpep517
	py3-setuptools
	py3-wheel
	py3-hatchling
	"
checkdepends="
	py3-pytest
	py3-bcrypt
	"
subpackages="$pkgname-pyc"
source="$pkgname-$pkgver.tar.gz::https://github.com/notypecheck/passlib/archive/refs/tags/$pkgver.tar.gz
	bcrypt.patch
	"
builddir="$srcdir/passlib-$pkgver"
options="!check" # test_totp.py fails

build() {
	gpep517 build-wheel \
		--wheel-dir .dist \
		--output-fd 3 3>&1 >&2
}

check() {
	python3 -m venv --clear --without-pip --system-site-packages .testenv
	.testenv/bin/python3 -m installer .dist/*.whl
	.testenv/bin/python3 -m pytest
}

package() {
	python3 -m installer -d "$pkgdir" \
		.dist/*.whl
}

sha512sums="
79619d8829a232a78cbf48af0a1ec5c253d97ff92f4c64f2315fc56607e9074a20d0edbb071a33102f14dbf93d8f2bedc871dccc9e18ca7fec6925e8269e92c4  py3-libpass-1.9.3.tar.gz
d367bdc88c51f3ea77188097ef8863f96b9834f53e95901f94dead50f61dbac35cbd751ffc8351b93c8787cc90fbc5b033696b90d1d3b32fcfdc9cc1ec8fb16c  bcrypt.patch
"
