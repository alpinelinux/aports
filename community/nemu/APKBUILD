# Contributor: Grigory Kirillov <txgk@bk.ru>
# Maintainer: Grigory Kirillov <txgk@bk.ru>
pkgname=nemu
pkgver=3.2.0
pkgrel=1
pkgdesc="Ncurses UI for QEMU"
url="https://github.com/nemuTUI/nemu"
arch="all"
license="BSD-2-Clause"
depends="
	qemu
	qemu-img
	qemu-ui-spice-core
	qemu-hw-display-qxl
	"
makedepends="
	cmake
	dbus-dev
	eudev-dev
	gettext-dev
	graphviz-dev
	json-c-dev
	libarchive-dev
	libintl
	libusb-dev
	libxml2-dev
	ncurses-dev
	openssl-dev
	samurai
	sqlite-dev
	"
subpackages="
	$pkgname-doc
	$pkgname-lang
	$pkgname-bash-completion
	$pkgname-zsh-completion
	"
source="https://github.com/nemuTUI/nemu/archive/v$pkgver/nemu-v$pkgver.tar.gz
	nemu.conf"
install="$pkgname.post-install"

build() {
	CFLAGS="$CFLAGS -D_GNU_SOURCE" \
	cmake -B builddir -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=Release \
		-DNM_WITH_NETWORK_MAP=ON \
		-DNM_WITH_DBUS=ON \
		-DNM_WITH_REMOTE=ON
	cmake --build builddir
}

check() {
	./builddir/nemu --version
}

package() {
	DESTDIR="$pkgdir" cmake --install builddir
	install -Dm644 "$srcdir"/nemu.conf "$pkgdir"/etc/modules-load.d/nemu.conf
}

sha512sums="
b77aaf6acbd1515c07e17714afd86a1ff90211fbe82a17a8fc2c79bc0343ffa6db446c4eab2fc697fd44318502511eb7bdc26eba20bce56110d31f6abffbe8cf  nemu-v3.2.0.tar.gz
871b650ff982be061532b4c5fe4812f41e6e2c58fc69b24f8a745f9a43389da44e742a69b0467b3c3d9e2b031af0728e20f10fa4584695c4f5ac87768a1fd34e  nemu.conf
"
