# Maintainer: Jingyun Hua <huajingyun@loongson.cn>
maintainer="Jingyun Hua <huajingyun@loongson.cn>"
pkgname=gitu
pkgver=0.40.0
pkgrel=0
pkgdesc="TUI Git client inspired by Magit"
url="https://github.com/altsem/gitu"
# s390x: nix crate, riscv64: fails in CI, 32-bit: tests fail
arch="all !s390x !riscv64 !armhf !armv7 !x86"
license="MIT"
depends="git"
makedepends_build="cargo cargo-auditable"
makedepends_host="libgit2-dev"
subpackages="$pkgname-doc"
source="https://github.com/altsem/gitu/archive/refs/tags/v$pkgver/gitu-$pkgver.tar.gz
	feat-align-menu-key-and-label-spacing-476.patch"

prepare() {
	default_prepare

	cargo fetch --target="$CHOST" --locked
}

build() {
	cargo auditable build --frozen --release
}

check() {
	cargo test --frozen
}

package() {
	local targetdir="target/${CARGO_BUILD_TARGET:+$CARGO_BUILD_TARGET/}"

	install -Dvm755 $targetdir/release/gitu -t "$pkgdir"/usr/bin/

	install -Dvm644 README.md -t "$pkgdir"/usr/share/doc/$pkgname/
	install -Dvm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
}

sha512sums="
0d13f39cd396c85d34f34b61a364b9c05532e2d015b1266e350c3c49cdd76be7ee7e3d57d58ba353cb005413752b5e1f031672c066efdc18e8dd010350074489  gitu-0.40.0.tar.gz
6539963110c7bf3e3ea08db9610c8e34dafdb6e3ac5a5cb3e2c6f53c84b376e5708a0ba8bb8adef06a99e84fa1cbfc4a174900ff41af7bbe3d51173feaeea261  feat-align-menu-key-and-label-spacing-476.patch
"
