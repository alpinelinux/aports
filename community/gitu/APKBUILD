# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=gitu
pkgver=0.39.0_git20251211
_gitrev=3580daa47066253d853f065a8d4d194c1a47132f
pkgrel=0
pkgdesc="TUI Git client inspired by Magit"
url="https://github.com/altsem/gitu"
# s390x: nix crate, riscv64: fails in CI, 32-bit: tests fail
arch="all !s390x !riscv64 !armhf !armv7 !x86"
license="MIT"
depends="git"
makedepends_build="cargo cargo-auditable"
makedepends_host="libgit2-dev"
subpackages="$pkgname-doc"
#source="https://github.com/altsem/gitu/archive/refs/tags/v$pkgver/gitu-$pkgver.tar.gz"
source="https://github.com/altsem/gitu/archive/$_gitrev/gitu-$_gitrev.tar.gz"
builddir="$srcdir/$pkgname-$_gitrev"

prepare() {
	default_prepare

	cargo fetch --target="$CHOST" --locked
}

build() {
	cargo auditable build --frozen --release
}

check() {
	cargo test --frozen
}

package() {
	local targetdir="target/${CARGO_BUILD_TARGET:+$CARGO_BUILD_TARGET/}"

	install -Dvm755 $targetdir/release/gitu -t "$pkgdir"/usr/bin/

	install -Dvm644 README.md -t "$pkgdir"/usr/share/doc/$pkgname/
	install -Dvm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
}

sha512sums="
2a99cfe68f57e44de6d9aa3be93fe2708b4c732a3854ebeb8e84526c6db1c10c065192d5922089db3faf11a76c6945f320bfd99a662c77fe78888ceabd7c122a  gitu-3580daa47066253d853f065a8d4d194c1a47132f.tar.gz
"
