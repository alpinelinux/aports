# Maintainer: Patrycja Rosa <alpine@ptrcnull.me>
pkgname=himitsu
pkgver=0.10
pkgrel=0
pkgdesc="A secret storage manager"
url="https://himitsustore.org"
arch="x86_64 aarch64 riscv64" # Hare
license="GPL-3.0-only"
install="$pkgname.post-upgrade"
makedepends="hare scdoc"
subpackages="$pkgname-doc $pkgname-dev $pkgname-openrc"
source="$pkgname-$pkgver.tar.gz::https://git.sr.ht/~sircmpwn/himitsu/archive/$pkgver.tar.gz
	himitsud.initd
"

export HARECACHE="${HARECACHE:-"$srcdir/hare-cache"}"

build() {
	make -j1 PREFIX=/usr
}

check() {
	make PREFIX=/usr check
}

package() {
	make DESTDIR="$pkgdir" PREFIX=/usr install

	install -Dm755 "$srcdir"/himitsud.initd "$pkgdir"/etc/user/init.d/himitsud
}

dev() {
	amove usr/src
}

sha512sums="
88cc1323b2428bc035fcee0d140ac251a298c4bbb45193a39c5e99925c05ada756eb7668e0bab4162e1c35687b392d8234ec33cac72998f2f1bd27bf893b1dd2  himitsu-0.10.tar.gz
bf983bc4158e76b6e8c8aace7a5df7d63f85b1463fbd5883018c08609718854fd01d0ff0673487b74c6c2c1b17b910003611a00dcf468e37161369d0a1f3aea9  himitsud.initd
"
