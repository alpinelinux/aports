# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=riemann-c-client
pkgver=2.2.2
pkgrel=0
pkgdesc="A C client library for the Riemann monitoring system"
url="https://git.madhouse-project.org/algernon/riemann-c-client"
arch="all"
license="LGPL-3.0-or-later"
depends_dev="protobuf-c-dev"
makedepends="$depends_dev
	autoconf
	automake
	json-c-dev
	libtool
	openssl-dev
	"
checkdepends="check-dev"
subpackages="
	$pkgname-libs
	$pkgname-dev
	$pkgname-doc
	"
source="$pkgname-$pkgver-2.tar.gz::https://git.madhouse-project.org/algernon/riemann-c-client/archive/riemann-c-client-$pkgver.tar.gz
	gcc-15.patch
	"
builddir="$srcdir/$pkgname"
# testsuite broken on GCC 15
options="!check"

prepare() {
	default_prepare

	autoreconf -iv
}

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--enable-tls
	make
}

check() {
	make check
}

package() {
	make install DESTDIR="$pkgdir"
}

sha512sums="
60988ef7bf3a96695d86ef03d0372346f9ab2df3833bf4de1032c02a3f16e3cd047e8d2a08247ef71f84d5e98cffeb1ac3e623f0c6ef8e8d8e0385d29e7366f2  riemann-c-client-2.2.2-2.tar.gz
79abc18b18c5f56f5580e047371845528450a65f97eb167973d104d190d3fb5697001e6d536406445c6fba74e021a9a127843f72b412df5c3b8b4ea921d014f4  gcc-15.patch
"
