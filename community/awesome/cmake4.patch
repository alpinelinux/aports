Patch-Source:
https://github.com/awesomeWM/awesome/pull/4012
https://github.com/awesomeWM/awesome/pull/4030
---
From 32a6e61193d19852858070d1bfd37065d6dc301f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Christoph=20Gr=C3=BCninger?= <foss@grueninger.de>
Date: Sat, 5 Jul 2025 10:38:43 +0200
Subject: [PATCH 1/4] Require CMake 3.5 or newer

CMake 4.0 requires that projects require 3.5
---
 CMakeLists.txt                | 2 +-
 tests/examples/CMakeLists.txt | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index c05a7fbc9a..08e3e03a2f 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,4 +1,4 @@
-cmake_minimum_required(VERSION 3.0.0)
+cmake_minimum_required(VERSION 3.5)
 project(awesome C)
 
 # Require an out-of-source build. We generate an awesomerc.lua in the build dir
diff --git a/tests/examples/CMakeLists.txt b/tests/examples/CMakeLists.txt
index c3f9adfbfe..e7f2b9cf1b 100644
--- a/tests/examples/CMakeLists.txt
+++ b/tests/examples/CMakeLists.txt
@@ -14,7 +14,7 @@ if(NOT DEFINED PROJECT_NAME)
     project(awesome-tests-examples NONE)
 endif()
 
-cmake_minimum_required(VERSION 3.0.0)
+cmake_minimum_required(VERSION 3.5)
 
 # Get and update the LUA_PATH so the scripts can be executed without awesome.
 execute_process(COMMAND ${LUA_EXECUTABLE} -e "p = package.path:gsub(';', '\\\\;'); io.stdout:write(p)"

From c01623a2d40db5485321ad8a184cee809a19c74c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Christoph=20Gr=C3=BCninger?= <foss@grueninger.de>
Date: Sat, 5 Jul 2025 10:39:41 +0200
Subject: [PATCH 2/4] Remove CMake policies to be set to 2.6

Many older policies are no longer supported
and got removed.
---
 CMakeLists.txt | 4 ----
 1 file changed, 4 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 08e3e03a2f..a1c05fc94a 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -17,10 +17,6 @@ endif()
 
 set(CMAKE_ALLOW_LOOSE_LOOP_CONSTRUCTS  TRUE)
 
-if(COMMAND cmake_policy)
-    cmake_policy(VERSION 2.6)
-endif()
-
 set(SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR})
 set(BUILD_DIR ${CMAKE_CURRENT_BINARY_DIR})
 

From 4ba04ad031f696deb8bbb583888c70636a6b92d4 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Christoph=20Gr=C3=BCninger?= <foss@grueninger.de>
Date: Sat, 5 Jul 2025 18:26:38 +0200
Subject: [PATCH 3/4] [cmake] Fix CMP0175 issue

CMake 3.31 requires this keyword when a TARGET is set.
---
 awesomeConfig.cmake | 1 +
 1 file changed, 1 insertion(+)

diff --git a/awesomeConfig.cmake b/awesomeConfig.cmake
index 592c2b2526..3d78caa879 100644
--- a/awesomeConfig.cmake
+++ b/awesomeConfig.cmake
@@ -375,6 +375,7 @@ add_custom_target(lgi-check-run ALL
 add_custom_target(setup_directories DEPENDS lgi-check-run)
 
 add_custom_command(TARGET setup_directories
+        POST_BUILD
         COMMAND ${CMAKE_COMMAND} -E make_directory ${BUILD_DIR}/script_files/
         COMMAND ${CMAKE_COMMAND} -E make_directory ${BUILD_DIR}/docs/common/
         COMMAND ${CMAKE_COMMAND} -E make_directory ${BUILD_DIR}/doc/images/

From e4bcf1e023c82b74025992184dd8841dadc764f3 Mon Sep 17 00:00:00 2001
From: Aire-One <aireone@aireone.xyz>
Date: Mon, 3 Nov 2025 01:06:54 +0000
Subject: [PATCH 4/4] build: enable symbols exports for lgi-check target

Fix CMake CMP0065 policy changes.
---
 awesomeConfig.cmake | 1 +
 1 file changed, 1 insertion(+)

diff --git a/awesomeConfig.cmake b/awesomeConfig.cmake
index 3d78caa879..7dca1595cc 100644
--- a/awesomeConfig.cmake
+++ b/awesomeConfig.cmake
@@ -362,6 +362,7 @@ endif()
 
 # {{{ Check for LGI
 add_executable(lgi-check build-utils/lgi-check.c)
+set_target_properties(lgi-check PROPERTIES ENABLE_EXPORTS ON)
 target_link_libraries(lgi-check ${LUA_LIBRARIES})
 target_include_directories(lgi-check PRIVATE ${LUA_INCLUDE_DIR})
 add_custom_target(lgi-check-run ALL

From f4d68bb6e7f42d928653d1d0eccef89e96280551 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=C4=90o=C3=A0n=20Tr=E1=BA=A7n=20C=C3=B4ng=20Danh?=
 <sgn.danh@gmail.com>
Date: Tue, 30 Sep 2025 20:28:28 +0700
Subject: [PATCH] fix build for CMake 4+

From CMake 4.0, a target can only depend on a target. Hence, check if the dependencies is a target before adding dependency on it.
---
 CMakeLists.txt | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index c05a7fbc9a..997c13ac89 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -469,7 +469,7 @@ if(LUACHECK_EXECUTABLE)
     list(APPEND CHECK_QA_TARGETS luacheck)
 endif()
 add_custom_target(check-qa DEPENDS ${CHECK_QA_TARGETS})
-add_dependencies(check check-qa check-examples)
+add_dependencies(check check-qa)
 # }}}
 
 INCLUDE(${CMAKE_SOURCE_DIR}/Packaging.cmake)
