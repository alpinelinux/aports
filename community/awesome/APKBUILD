# Contributor: ≈Åukasz Jendrysik <scadu@yandex.com>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=awesome
pkgver=4.3_git20250517
pkgrel=0
_commitid=f009815cb75139acf4d8ba3c1090bf2844d13f4c
_luaver="5.4"
pkgdesc="lua-configurable window manager framework"
url="https://awesomewm.org/"
arch="all"
license="GPL-2.0-or-later"
depends="imagemagick lua$_luaver-lgi cairo-gobject pango"
makedepends="
	cairo-dev
	cmake
	dbus-dev
	gdk-pixbuf-dev
	glib-dev
	gperf
	imlib2-dev
	libev-dev
	libxcb-dev
	libxdg-basedir-dev
	libxkbcommon-dev
	lua-doc
	lua$_luaver-dev
	lua$_luaver-lgi
	pango-dev
	samurai
	startup-notification-dev
	xcb-util-cursor-dev
	xcb-util-dev
	xcb-util-image-dev
	xcb-util-keysyms-dev
	xcb-util-wm-dev
	xcb-util-xrm-dev
	"
subpackages="$pkgname-doc"
options="!check" # No test suite
source="$pkgname-$pkgver.tar.gz::https://github.com/awesomeWM/awesome/archive/$_commitid.tar.gz
	4012.patch
	4022.patch
	"

builddir="$srcdir"/awesome-$_commitid
build() {
	export CFLAGS="$CFLAGS -fcommon"
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DSYSCONFDIR=/etc \
		-DCMAKE_BUILD_TYPE=MinSizeRel \
		-DLUA_INCLUDE_DIR=/usr/include/lua$_luaver \
		-DLUA_LIBRARY=/usr/lib/lua5.4/liblua-$_luaver.so.0 \
		-DLUA_EXECUTABLE=/usr/bin/lua$_luaver
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
e7e646f23ff84360d177d2f8bdaf770bcd8008152a67588d9b0172748cd9c30dc095e42f4ac45f65c91752e68dd165c8a478240531ad8d55915bbba61f227cd4  awesome-4.3_git20250517.tar.gz
298ae5052982123c68dbacc4479e4381eba7e949763280fe0bbe64444a9c1607897a7da53dbe27583752fa0000bfa67ec5e77f8a4e2cf7d0635223fab5d3ace8  4012.patch
fb6484a01e97c91cd2ce61e8a41754c7fbb8530ba377f93a7f93607509f593e44bfcc548d67daf51fff36df8395316281cddc6dd9e60a031d756f1d35b24b49d  4022.patch
"
