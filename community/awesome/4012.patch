From e1ea9b1af4e23b318eae9815c5207a9414310fcf Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Christoph=20Gr=C3=BCninger?= <foss@grueninger.de>
Date: Sat, 5 Jul 2025 10:38:43 +0200
Subject: [PATCH 1/3] Require CMake 3.5 or newer

CMake 4.0 requires that projects require 3.5
---
 CMakeLists.txt                | 2 +-
 tests/examples/CMakeLists.txt | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index c05a7fbc9a..08e3e03a2f 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,4 +1,4 @@
-cmake_minimum_required(VERSION 3.0.0)
+cmake_minimum_required(VERSION 3.5)
 project(awesome C)
 
 # Require an out-of-source build. We generate an awesomerc.lua in the build dir
diff --git a/tests/examples/CMakeLists.txt b/tests/examples/CMakeLists.txt
index c3f9adfbfe..e7f2b9cf1b 100644
--- a/tests/examples/CMakeLists.txt
+++ b/tests/examples/CMakeLists.txt
@@ -14,7 +14,7 @@ if(NOT DEFINED PROJECT_NAME)
     project(awesome-tests-examples NONE)
 endif()
 
-cmake_minimum_required(VERSION 3.0.0)
+cmake_minimum_required(VERSION 3.5)
 
 # Get and update the LUA_PATH so the scripts can be executed without awesome.
 execute_process(COMMAND ${LUA_EXECUTABLE} -e "p = package.path:gsub(';', '\\\\;'); io.stdout:write(p)"

From fcc960694404b3d8befdce6381d3de1ab1b493c3 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Christoph=20Gr=C3=BCninger?= <foss@grueninger.de>
Date: Sat, 5 Jul 2025 10:39:41 +0200
Subject: [PATCH 2/3] Remove CMake policies to be set to 2.6

Many older policies are no longer supported
and got removed.
---
 CMakeLists.txt | 4 ----
 1 file changed, 4 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 08e3e03a2f..a1c05fc94a 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -17,10 +17,6 @@ endif()
 
 set(CMAKE_ALLOW_LOOSE_LOOP_CONSTRUCTS  TRUE)
 
-if(COMMAND cmake_policy)
-    cmake_policy(VERSION 2.6)
-endif()
-
 set(SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR})
 set(BUILD_DIR ${CMAKE_CURRENT_BINARY_DIR})
 

From f25e89f39ee3a8def16ee2e538dde80ef93332b9 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Christoph=20Gr=C3=BCninger?= <foss@grueninger.de>
Date: Sat, 5 Jul 2025 18:26:38 +0200
Subject: [PATCH 3/3] [cmake] Fix CMP0175 issue

CMake 3.31 requires this keyword when a TARGET is set.
---
 awesomeConfig.cmake | 1 +
 1 file changed, 1 insertion(+)

diff --git a/awesomeConfig.cmake b/awesomeConfig.cmake
index 592c2b2526..3d78caa879 100644
--- a/awesomeConfig.cmake
+++ b/awesomeConfig.cmake
@@ -375,6 +375,7 @@ add_custom_target(lgi-check-run ALL
 add_custom_target(setup_directories DEPENDS lgi-check-run)
 
 add_custom_command(TARGET setup_directories
+        POST_BUILD
         COMMAND ${CMAKE_COMMAND} -E make_directory ${BUILD_DIR}/script_files/
         COMMAND ${CMAKE_COMMAND} -E make_directory ${BUILD_DIR}/docs/common/
         COMMAND ${CMAKE_COMMAND} -E make_directory ${BUILD_DIR}/doc/images/
