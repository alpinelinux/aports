# Maintainer: Willow Barraco <contact@willowbarraco.fr>
pkgname=clapper
pkgver=0.10.0
pkgrel=0
pkgdesc="Modern media player designed for simplicity and ease of use"
url="https://github.com/Rafostar/clapper"
arch="all"
license="GPL-3.0-or-later"
makedepends="
	desktop-file-utils
	gobject-introspection-dev
	gst-plugins-base-dev
	gstreamer-dev
	gtk4.0-dev
	libadwaita-dev
	libmicrodns-dev
	libsoup3-dev
	meson
"
subpackages="$pkgname-dev $pkgname-lang $pkgname-libs"
source="$pkgname-$pkgver.tar.gz::https://github.com/Rafostar/clapper/archive/refs/tags/$pkgver.tar.gz"
options="!check" # No tests
ldpath="/usr/lib/gstreamer-1.0/"

case "$CARCH" in
	armhf)
		_build_opt="-Denhancers-loader=disabled"
		;;
	*)
		makedepends="
			$makedepends
			libpeas2-dev
		"
		;;
esac

build() {
	abuild-meson \
		-Db_lto=true \
		-Dintrospection=enabled \
		$_build_opt \
		. output
	meson compile -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

libs() {
	default_libs
	amove usr/lib/girepository-1.0 usr/lib/gstreamer-1.0
}

sha512sums="
b9f36ffecaedceb8779c6328896226a02fa730123d05c7d6f4738e647d0513cabc5ef52dd299a832405ab7e787cd14cc1b7edac3883375b47577017ba3f75e76  clapper-0.10.0.tar.gz
"
