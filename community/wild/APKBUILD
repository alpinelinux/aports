# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
maintainer="Matthias Ahouansou <matthias@ahouansou.cz>"
pkgname=wild
pkgver=0.7.0
pkgrel=0
pkgdesc="Very fast linker for Linux"
url="https://github.com/davidlattimore/wild"
# Only x86_64, aarch64 and riscv64 are officially supported (as of 0.7.0)
# https://github.com/davidlattimore/wild?tab=readme-ov-file#whats-working
arch="x86_64 aarch64 riscv64"
license="MIT OR Apache-2.0"
makedepends="cargo-auditable"
checkdepends="
	bash
	cmd:clang-format
	lld
"
# gcc doesn't support using arbitrary linkers
depends="clang"
subpackages="$pkgname-doc"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/davidlattimore/wild/archive/refs/tags/$pkgver.tar.gz
"
options="net"

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
}

check() {
	cargo test --frozen
}

package() {
	install -Dm 755 target/release/wild "$pkgdir"/usr/bin/wild

	install -Dm 644 LICENSE-APACHE LICENSE-MIT -t "$pkgdir"/usr/share/licenses/"$pkgname"/
}

sha512sums="
6c777c7bac360087ef46c128022dbb01234d58cc024423bbb1223799c9c2a859756e629c7c1383c4ff69cc6beb2f746cdff7eb11460cd10d3644736bc043ebfc  wild-0.7.0.tar.gz
"
