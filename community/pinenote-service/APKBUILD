# Maintainer: Antoine Martin (ayakael) <dev@ayakael.net>
pkgname=pinenote-service
pkgver=1.0.1
pkgrel=0
pkgdesc="Daemon managing several PineNote systems & drivers"
arch="aarch64"
url="https://git.sr.ht/~phantomas/pinenote-service"
license="GPL-3.0-or-later"
# !check: no testsuite
options="!check"
makedepends="cargo"
subpackages="$pkgname-systemd"
source="$pkgname-$pkgver.tar.gz::https://git.sr.ht/~phantomas/pinenote-service/archive/v$pkgver.tar.gz"
builddir="$srcdir"/$pkgname-v$pkgver

prepare() {
	default_prepare
	cargo fetch --locked
}

build() {
	cargo build --frozen --release --all-features
}

package() {
	install -Dm755 target/release/pinenote-service -t "$pkgdir"/usr/bin

	install -Dm644 packaging/resources/pinenote.service -t "$pkgdir"/usr/lib/systemd/user/
	install -Dm644 packaging/resources/org.pinenote.PineNoteCtl.service -t "$pkgdir"/usr/share/dbus-1/services/
}
sha512sums="
95cafca8f7946a9a3990a125489df0c660822394ef1f72743e95d910af6578b836154b0ce9971a9cf941b6f7f64d8d9fe6a64ac039e4aea80a627b5a86d13eca  pinenote-service-1.0.1.tar.gz
"
