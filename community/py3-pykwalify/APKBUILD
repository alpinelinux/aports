# Contributor: Michał Polański <michal@polanski.me>
# Maintainer: Michał Polański <michal@polanski.me>
pkgname=py3-pykwalify
_pyname=pykwalify
pkgver=1.8.0
pkgrel=7
pkgdesc="Python YAML/JSON schema validation library"
url="https://github.com/Grokzen/pykwalify"
arch="noarch"
license="MIT"
depends="python3 py3-docopt py3-ruamel.yaml py3-dateutil"
makedepends="py3-gpep517 py3-setuptools py3-wheel"
checkdepends="py3-pytest py3-testfixtures"
subpackages="$pkgname-pyc"
source="https://github.com/Grokzen/pykwalify/archive/$pkgver/pykwalify-$pkgver.tar.gz
	fix-tests-for-ruamel-yaml-0.18.patch
	"
builddir="$srcdir/$_pyname-$pkgver"

build() {
	gpep517 build-wheel \
		--wheel-dir .dist \
		--output-fd 3 3>&1 >&2
}

check() {
	python3 -m venv --clear --without-pip --system-site-packages .testenv
	.testenv/bin/python3 -m installer .dist/*.whl
	.testenv/bin/python3 -m pytest
}

package() {
	python3 -m installer -d "$pkgdir" \
		.dist/*.whl
}

sha512sums="
cdc815017b91b3bc0e58652ca69351bee1ea0b61b3a37de1209005958314c230d80573d9b77af77d68ba54b98aa8b40d593191f8a8f3d4a2c4c693c6cb42f9e7  pykwalify-1.8.0.tar.gz
a6055a7b42da256a909da8184005a789724ff6858d1a5e6cd1d1022da63f0b4032b5d23b90e7016c810f79d720b6455fc4c34ffa185b6f6d4bfd772de7a882c6  fix-tests-for-ruamel-yaml-0.18.patch
"
