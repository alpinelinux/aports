# Contributor: Fabian Affolter <fabian@affolter-engineering.ch>
# Maintainer: Fabian Affolter <fabian@affolter-engineering.ch>
pkgname=py3-webtest
pkgver=3.0.7
pkgrel=0
pkgdesc="A Helper to test WSGI applications"
url="http://webtest.pythonpaste.org/"
arch="noarch"
license="MIT"
depends="python3 py3-beautifulsoup4 py3-waitress py3-webob"
makedepends="py3-setuptools"
checkdepends="py3-lxml py3-paste py3-pastedeploy py3-pytest"
subpackages="$pkgname-pyc"
source="https://pypi.io/packages/source/W/WebTest/webtest-$pkgver.tar.gz"

replaces="py-webtest" # Backwards compat
provides="py-webtest=$pkgver-r$pkgrel" # Backwards compat

builddir="$srcdir"/webtest-$pkgver

build() {
	python3 setup.py build
}

check() {
	# disable tests that requires wsgiproxy2 to avoid circular dependency
	pytest -v \
		--deselect tests/test_app.py \
		--deselect tests/test_authorisation.py \
		--deselect tests/test_debugapp.py \
		--deselect tests/test_forms.py \
		--deselect tests/test_lint.py \
		--deselect tests/test_response.py
}

package() {
	python3 setup.py install --skip-build --root="$pkgdir"
}

sha512sums="
fe9d897964179f7921831da50dd7812785190228bbf0dfe1219169163da760b67365e7334c271f07b8a7a3792dce6c320aa8342cf48727b4c49401e6ad05212a  webtest-3.0.7.tar.gz
"
