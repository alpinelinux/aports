# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
maintainer="Matthias Ahouansou <matthias@ahouansou.cz>"
pkgname=scooter
pkgver=0.8.3
pkgrel=0
pkgdesc="Interactive find-and-replace in the terminal"
url="https://github.com/thomasschafer/scooter"
arch="all !riscv64" # tests fail due to having the characters in the input box don't match those expected
license="MIT"
makedepends="cargo-auditable oniguruma-dev"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::$url/archive/refs/tags/v$pkgver.tar.gz"

export RUSTONIG_DYNAMIC_LIBONIG=1

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --frozen --release
}

check() {
	# tests that have a very short timeout, but they are difficult to modify, due to not using a constant
	cargo test --frozen -- \
		--skip test_preview_updates_work_correctly::with_advanced_regex \
		--skip test_preview_updates_work_correctly::without_advanced_regex \
		--skip test_search_and_replace_regex_capture_group::with_advanced_regex \
		--skip test_search_and_replace_regex_capture_group::without_advanced_regex \
		--skip test_search_and_replace_advanced_regex_negative_lookahead
}

package() {
	install -Dm755 "target/release/$pkgname" -t "$pkgdir/usr/bin"
	install -Dm644 "LICENSE" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}

sha512sums="
02e46a93398f8b959e360543d35fb9cd46138c33b3a9edb6fc833fb81ba1daf796af84521d7bc1207d67459c3d5b804a1e26159e2948d65ae58fdd4ec4d16dd1  scooter-0.8.3.tar.gz
"
