# Maintainer: John Vogel <jvogel@stygian.me>
maintainer="John Vogel <jvogel@stygian.me>"
pkgname=pam_mount
pkgver=2.22
pkgrel=0
pkgdesc="Pluggable Authentication Module that can mount volumes for a user session"
url="https://codeberg.org/jengelh/pam_mount"
arch="all"
license="LGPL-2.1-or-later"
makedepends="
	cryptsetup-dev
	libhx-dev
	libxml2-dev
	linux-pam-dev
	openssl-dev
	pcre2-dev
	perl
	util-linux-dev
	zstd
	"
subpackages="
	$pkgname-dev
	$pkgname-doc
	libcryptmount
	"
source="https://inai.de/files/pam_mount/pam_mount-$pkgver.tar.zst"

build() {
	./configure \
		--prefix=/usr \
		--host=$CHOST \
		--build=$CBUILD \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--with-rundir=/run \
		--with-slibdir=/usr/lib \
		--disable-dependency-tracking
	make
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir" install
}

libcryptmount() {
	pkgdesc="$pkgdesc (libcryptmount library)"

	amove usr/lib/libcryptmount.so.*
}

sha512sums="
81a26737aa5c091df1a4775b25479400f9a873b053f904e9c66993aa83d7fd7af0762caf30b5bcb4878167acb48db95cd8ecf6872e08ba09eec4814eef071a8a  pam_mount-2.22.tar.zst
"
