# Contributor: kohnish <kohnish@gmx.com>
maintainer="Michał Polański <michal@polanski.me>"
pkgname=crun
pkgver=1.25.1
pkgrel=0
pkgdesc="Fast and lightweight fully featured OCI runtime and C library for running containers"
url="https://github.com/containers/crun"
license="GPL-2.0-or-later AND LGPL-2.1-or-later"
arch="all"
makedepends="libcap-dev libseccomp-dev yajl-dev argp-standalone python3 go-md2man zstd"
subpackages="$pkgname-doc $pkgname-static"
source="https://github.com/containers/crun/releases/download/$pkgver/crun-$pkgver.tar.zst"

provides="oci-runtime"
provider_priority=100 # highest, default provider

# secfixes:
#   1.20-r0:
#     - CVE-2025-24965
#   1.4.4-r0:
#     - CVE-2022-27650

build() {
	./configure \
		--prefix=/usr \
		--disable-systemd
	make
}

check() {
	make tests/tests_libcrun_errors.log
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
44b38ef939027dfad0ca72e9d5bbcefc05da66887c239fe441ca9e105ecb981aac517de3d1ebc6f9ba3d5061f7d1bcd6528099115ad45390fe56e492cdba47ff  crun-1.25.1.tar.zst
"
