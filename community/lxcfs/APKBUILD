# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer: Stuart Cardall <developer@it-offshore.co.uk>
pkgname=lxcfs
pkgver=2.0.3
pkgrel=2
pkgdesc="FUSE filesystem for LXC"
url="https://linuxcontainers.org/lxcfs"
arch="all"
license="Apache 2.0"
depends="cgmanager shadow"
makedepends="fuse-dev linux-pam-dev linux-headers help2man"
subpackages="$pkgname-pam $pkgname-doc"
source="https://linuxcontainers.org/downloads/lxcfs/lxcfs-$pkgver.tar.gz
	lxcfs.confd
	lxcfs.initd
	chownmap
	README.alpine
	lxcfs-subdir.patch
	"
builddir="$srcdir/lxcfs-$pkgver"

build() {
	cd "$builddir"
	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info || return 1
        make || return 1
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install || return 1
	install -m755 -D "$srcdir"/$pkgname.initd \
		"$pkgdir"/etc/init.d/$pkgname || return 1
	install -m644 -D "$srcdir"/$pkgname.confd \
		"$pkgdir"/etc/conf.d/$pkgname || return 1
	install -m700 -D "$srcdir"/chownmap \
		"$pkgdir"/etc/lxc/chownmap || return 1
	install -m644 -D "$srcdir"/README.alpine \
		"$pkgdir"/usr/share/doc/lxcfs/README.alpine || return 1
}

pam() {
	pkgdesc="$pkgdesc (pam plugin)"
	mkdir -p "$subpkgdir"/lib
	mv "$pkgdir"/lib/security "$subpkgdir"/lib/ || return 1
}

md5sums="8d79c575d0dc5d127776370eceb0f58b  lxcfs-2.0.3.tar.gz
6d7943272d6b71ab7b93e93c55e42ee9  lxcfs.confd
2c4a59861c846dd9ddef0cab6664eed8  lxcfs.initd
e1d7c118ae134fcdd171f8aac146f9a0  chownmap
722e7a773283170910f5c9b40fb83610  README.alpine
14531d992c3c3e731ee596ff86e91829  lxcfs-subdir.patch"
sha256sums="dd94e19bff202cb9fe2aa7d244b2cccf53cf5d7f6dd76c815e1161e3ba4ce0df  lxcfs-2.0.3.tar.gz
d8915d4635b675897895c379c892250f6c2bb55515a3b59cad09b92c35264359  lxcfs.confd
30e9005010508eaa382fbb44f784d26a641bf7c12e94d9ba2603ab3ad782e86b  lxcfs.initd
2e6b84d98fc3cd03fa3f384876191dba05e6d781629a748add75ab380d921823  chownmap
a458f5561d8f1404ac7547bd73f7bf7d56898322d04268f31a7ee3ffdd5e36aa  README.alpine
ef3d2848e534b3db9267efbb5bc515e0ecd6a768cdf8de928bccac21c26add9e  lxcfs-subdir.patch"
sha512sums="1bca2dc88a4551c90e9760ad8d3c7548126d7803040ddab3ac24fda2d602ec0d34ebf78bbd2b4cd5941edba3ccfe135e86d257f0dc2b89617c7ca876b3dda4bb  lxcfs-2.0.3.tar.gz
71df316b1aaf1a0fadc230473a66c0be4d201d706481f1042c353b79fc629e9e681ec4fe0dfb113370e00d3f40175b0d7759fdcdcce57cf1d2db585068aa6e8d  lxcfs.confd
e08ee2e33cc8d82dbfbdc86b7aa87ef6b0033473951e9759bd8fd2b12b1d7beda1c7cb7befb7ce4fd1d7aea274778313957350af617d56b8702dbfcdc59b49b4  lxcfs.initd
5d18df216a004d5039d86634e62dc078f134991696da9c6f1c292f0f8aa3de1f202aa531000c9f75e2bc5d5121f856660e4f1d71c8e92a0e87517a23836a743d  chownmap
16c65a10b2b95a85ea21d2cb44a45c9c7faf1e22c8c438c7325be96025588834a528544598a91facc13fa93cc46f6c4534fa2ca6bb58b152a26f1ced94b18f16  README.alpine
f7589ef65b3e01de0bb9e55c8ae06ae8124196b29b444006f3beaba308a8bebccad38e11c9c74f705dcad826aa6de0a10830053e0b025c640b7337804c48c056  lxcfs-subdir.patch"
