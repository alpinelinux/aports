# Contributor: Guy Godfroy <guy.godfroy@gugod.fr>
# Maintainer: Guy Godfroy <guy.godfroy@gugod.fr>
pkgname=apprise
pkgver=1.9.7
pkgrel=0
pkgdesc="Push Notifications that work with just about every platform"
url="https://github.com/caronc/apprise"
arch="noarch"
license="BSD-2-Clause"
depends="py3-certifi py3-requests py3-requests-oauthlib py3-click py3-markdown py3-yaml py3-tzdata glib"
makedepends="py3-gpep517 py3-setuptools py3-wheel"
checkdepends="py3-pytest py3-pytest-mock"
subpackages="$pkgname-doc $pkgname-pyc"
source="$pkgname-$pkgver.tar.gz::https://codeload.github.com/caronc/apprise/tar.gz/refs/tags/v$pkgver"
options="net"

case "$CARCH" in
loongarch64|s390x|x86)
	options="$options !check" # some tests fail on package builders
	;;
esac

build() {
	gpep517 build-wheel \
		--wheel-dir .dist \
		--output-fd 3 3>&1 >&2
}

check() {
	sh bin/test.sh
}

package() {
	python3 -m installer -d "$pkgdir" .dist/*.whl
	install -Dm644 packaging/man/apprise.1 -t "$pkgdir"/usr/share/man/man1
}

sha512sums="
140351b8ab78e3bc8a4f98e44bd685db97a11e878f9e1f30a4d7cf6fdbc00d5fad9642f4faeb10de29c922e98248ef414a33eddab09a4b9e46ec9fbc8c634032  apprise-1.9.7.tar.gz
"
