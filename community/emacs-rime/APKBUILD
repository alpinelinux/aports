# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=emacs-rime
pkgver=1.0.5_git20251105
_gitrev=f927d26e471e7d63de65ffa92897944242f2fd92
pkgrel=0
_pkgreal=rime
pkgdesc="RIME in Emacs"
url="https://github.com/DogLooksGood/emacs-rime"
arch="all"
license="GPL-3.0-or-later"
depends="
	cmd:emacs
	emacs-dash
	emacs-popup
	emacs-posframe
	"
makedepends="emacs-nox librime-dev"
checkdepends="rime-plum-data"
source="https://github.com/DogLooksGood/emacs-rime/archive/$_gitrev/emacs-rime-$_gitrev.tar.gz"
builddir="$srcdir/$pkgname-$_gitrev"
options="!check" # opens an interactive Emacs window

build() {
	make lib

	emacs -batch -q -no-site-file -L . \
		-f batch-byte-compile \
		rime*.el
}

check() {
	make HOME="$srcdir" test
}

package() {
	install -Dvm644 rime*.el* librime-emacs.so \
		-t "$pkgdir"/usr/share/emacs/site-lisp/

	cd "$pkgdir"/usr/share/emacs/site-lisp
	emacs -batch -q -no-site-file \
		-eval "(loaddefs-generate \".\" \"$_pkgreal-loaddefs.el\")"
}

sha512sums="
dd45d514bf0c9595c04617158b38632244a378273ba597cb7bbd3c7dc9f36d5d6b2503a6c3ef266e796b309d9db0fa672f7cc56bd7ee7a6c7bf75972576ca42e  emacs-rime-f927d26e471e7d63de65ffa92897944242f2fd92.tar.gz
"
