# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=qman
pkgver=1.5.1
pkgrel=0
pkgdesc="Modern man page viewer for the terminal"
url="https://github.com/plp13/qman"
arch="all"
license="BSD-2-Clause"
depends="
	groff
	man-db
	"
makedepends="
	bzip2-dev
	cogapp
	libbsd-dev
	muon
	ncurses-dev
	xz-dev
	zlib-dev
	"
checkdepends="
	bash
	cunit-dev
	"
subpackages="$pkgname-doc"
source="https://github.com/plp13/qman/archive/refs/tags/v$pkgver/qman-$pkgver.tar.gz"

build() {
	# _GNU_SOURCE: for strcasestr
	CFLAGS="$CFLAGS -D_GNU_SOURCE $(pkgconf --cflags libbsd-overlay)" \
	abuild-muon \
		-Dman-pages=enabled \
		-Dconfig=enabled \
		-Dlibbsd=enabled \
		-Dgzip=enabled \
		-Dbzip2=enabled \
		-Dlzma=enabled \
		-Dtests="$(want_check && echo enabled || echo disabled)" \
		output .
	ninja -C output
}

check() {
	TERM=linux muon -C output test -j "${JOBS:-0}" -R -d dots -vv
}

package() {
	DESTDIR="$pkgdir" muon -C output install
}

sha512sums="
b6eeb7f69fac7c08146fd0083a0f7e052d5bb5e01397330e1a4bb804832f0500254e564e9c6c63e8666cc6edfa0ac88b438fe4419af9a326f19d1edcc71ea3d2  qman-1.5.1.tar.gz
"
