# Contributor: TBK <alpine@jjtc.eu>
# Maintainer: TBK <alpine@jjtc.eu>
pkgname=box2d
pkgver=2.4.2
pkgrel=0
pkgdesc="2D Physics Engine for Games"
url="https://box2d.org/"
arch="all"
license="MIT"
makedepends="
	cmake
	doxygen
	libx11-dev
	libxcursor-dev
	libxinerama-dev
	libxrandr-dev
	ninja
	"
subpackages="$pkgname-doc $pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/erincatto/box2d/archive/v$pkgver.tar.gz"

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		CMAKE_CROSSOPTS="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake -B build \
		-GNinja \
		-DCMAKE_BUILD_TYPE=MinSizeRel \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=ON \
		-DBOX2D_BUILD_DOCS=ON \
		-DBOX2D_BUILD_TESTBED=OFF \
		-DBOX2D_BUILD_UNIT_TESTS=ON \
		$CMAKE_CROSSOPTS
	cmake --build build
}

check() {
	echo "Running unit_test"
	build/bin/unit_test
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
e769bcfa11028ea2e842bf96da4bef71a58f1b08cd144139adc724acfe3ca5911f84d0be41d9412b302d9e7c17b7741cf56da60df7bd7379c6e11b3eea100153  box2d-2.4.2.tar.gz
"
