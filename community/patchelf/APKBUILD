# Maintainer: Michael Koloberdin <koloberdin@gmail.com>
pkgname=patchelf
pkgver=0.9
pkgrel=2
pkgdesc="Small utility to modify the dynamic linker and RPATH of ELF executables"
url="https://nixos.org/patchelf.html"
arch="all !aarch64"
license="GPL-3.0"
depends=""
makedepends="autoconf automake libtool"
install=""
subpackages="$pkgname-doc"
source="${pkgname}-${pkgver}.tar.gz::https://github.com/NixOS/patchelf/archive/${pkgver}.tar.gz
        fix-tests.patch"
builddir="$srcdir/$pkgname-$pkgver"

prepare() {
	cd "$builddir"
	default_prepare
	autoreconf -fiv
}

build() {
	cd "$builddir"
	./configure --prefix=/usr
	make
}

check(){
	cd "$builddir"
	if [ "$CARCH" != "ppc64le" ] ; then
		make -C tests -j1 check
	fi
}

package() {
	cd "$builddir"
	make DESTDIR="${pkgdir}" install
}

sha512sums="70e615f2f705f413aab5e3eebe20ffe79743bb92381b10a8faa49f16ca24b0f9bd4095c5644f682ec94d75012ffb1b39837933faa9f3c1f1c41bdc5b9d010a30  patchelf-0.9.tar.gz
f52c519e1b43481b44ac24060a05a1f027468627e9bf6e75055a1ae480f53a4ce141923adcaacea1370a8ef3bdbf12edbf479e348b6aecc0f0d1eba0cdf23ec8  fix-tests.patch"
