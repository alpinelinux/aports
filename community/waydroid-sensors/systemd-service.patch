Patch-Source: https://github.com/waydroid/waydroid-sensors/pull/9
---
From 6453b94e781d719697546a72429c5b613f4f07e2 Mon Sep 17 00:00:00 2001
From: Achill Gilgenast <achill@achill.org>
Date: Sun, 7 Dec 2025 21:31:20 +0100
Subject: [PATCH] Add systemd system service

Allows installation of a canonical systemd service that starts and supervises
waydroid-sensord.

This file is taken from our downstream services package in postmarketOS
and upstreaming it could make future improvements easier and downstream
packaging.

I'm not the best at CMake configuration, so please let me know if there
is something to nag about.

Signed-off-by: Achill Gilgenast <achill@achill.org>
---
 .gitignore                  |  1 +
 CMakeLists.txt              | 10 ++++++++++
 waydroid-sensors.service.in | 15 +++++++++++++++
 3 files changed, 26 insertions(+)
 create mode 100644 waydroid-sensors.service.in

diff --git a/.gitignore b/.gitignore
index 46f42f8f3ce8..66104b25fb28 100644
--- a/.gitignore
+++ b/.gitignore
@@ -9,3 +9,4 @@ install_manifest.txt
 compile_commands.json
 CTestTestfile.cmake
 _deps
+waydroid-sensors.service
diff --git a/CMakeLists.txt b/CMakeLists.txt
index edd3dbf813a6..c562a2edb9bc 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -48,3 +48,13 @@ target_include_directories(waydroid-sensord PUBLIC
 )
 
 install(TARGETS waydroid-sensord RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR})
+
+configure_file(
+	waydroid-sensors.service.in
+	${CMAKE_CURRENT_BINARY_DIR}/waydroid-sensors.service
+)
+
+install(
+	FILES ${CMAKE_CURRENT_BINARY_DIR}/waydroid-sensors.service
+	DESTINATION /usr/lib/systemd/system/
+)
diff --git a/waydroid-sensors.service.in b/waydroid-sensors.service.in
new file mode 100644
index 000000000000..8fe5a9bf9498
--- /dev/null
+++ b/waydroid-sensors.service.in
@@ -0,0 +1,15 @@
+[Unit]
+Description=Waydroid sensor daemon
+Requires=waydroid-container.service
+PartOf=waydroid-container.service
+After=waydroid-container.service
+
+[Service]
+Type=simple
+ExecStart=${CMAKE_INSTALL_PREFIX}/${CMAKE_INSTALL_BINDIR}/waydroid-sensord
+RestartSec=1
+TimeoutStartSec=5
+Restart=always
+
+[Install]
+WantedBy=multi-user.target
-- 
2.52.0

