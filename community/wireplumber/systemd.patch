Patch-Source: https://gitlab.freedesktop.org/pipewire/wireplumber/-/merge_requests/793
---
From 41afbaa999cfdc09f2ce996517768c9ab5fbcc0d Mon Sep 17 00:00:00 2001
From: Achill Gilgenast <achill@achill.org>
Date: Tue, 3 Feb 2026 22:30:55 +0100
Subject: [PATCH] systemd: Allow installation of systemd services without
 libsystemd

Allows installation of systemd services without libsystemd installed.
Useful for Alpine Linux where systemd services are allowed to be subpackaged
(e.g. for postmarketOS) but hasn't systemd in it's repos.

It has no change in existing behavior, but installs services if the unit
directories are explicitly set.
---
 src/systemd/meson.build | 18 ++++++++++--------
 1 file changed, 10 insertions(+), 8 deletions(-)

diff --git a/src/systemd/meson.build b/src/systemd/meson.build
index 73163c84..b56b7185 100644
--- a/src/systemd/meson.build
+++ b/src/systemd/meson.build
@@ -1,13 +1,18 @@
-if systemd.found()
+if get_option('systemd-system-service') or get_option('systemd-user-service')
   systemd_config = configuration_data()
   systemd_config.set('WP_BINARY', wireplumber_bin_dir / 'wireplumber')
 
-  # system service
-  if get_option('systemd-system-service')
+  if systemd.found()
     systemd_system_unit_dir = systemd.get_variable(
-        pkgconfig: 'systemdsystemunitdir',
-        pkgconfig_define: ['prefix', get_option('prefix')])
+      pkgconfig: 'systemdsystemunitdir',
+      pkgconfig_define: ['prefix', get_option('prefix')])
+    systemd_user_unit_dir = systemd.get_variable(
+      pkgconfig: 'systemduserunitdir',
+      pkgconfig_define: ['prefix', get_option('prefix')])
+  endif
 
+  # system service
+  if get_option('systemd-system-service')
     if get_option('systemd-system-unit-dir') != ''
       systemd_system_unit_dir = get_option('systemd-system-unit-dir')
     endif
@@ -17,9 +22,6 @@ if systemd.found()
 
   # user service
   if get_option('systemd-user-service')
-    systemd_user_unit_dir = systemd.get_variable(
-        pkgconfig: 'systemduserunitdir',
-        pkgconfig_define: ['prefix', get_option('prefix')])
 
     if get_option('systemd-user-unit-dir') != ''
       systemd_user_unit_dir = get_option('systemd-user-unit-dir')
-- 
GitLab

