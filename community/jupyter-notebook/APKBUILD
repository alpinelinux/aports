# Contributor: Aiden Grossman <agrossman154@yahoo.com>
maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=jupyter-notebook
pkgver=7.5.2
pkgrel=0
pkgdesc="Jupyter interactive notebook"
url="https://github.com/jupyter/notebook"
# armhf, armv7, x86, loongarch64, riscv64, s390x: blocked by jupyterlab
# ppc64le: jlpm install failed
arch="noarch !armhf !armv7 !x86 !loongarch64 !riscv64 !armv7 !ppc64le !s390x"
license="BSD-3-Clause"
depends="
	jupyter-nbclassic
	jupyter-nbconvert
	jupyter-nbformat
	py3-argon2-cffi
	py3-ipykernel
	py3-ipython_genutils
	py3-jinja2
	py3-jupyter_client
	py3-jupyter_core
	py3-nest_asyncio
	py3-prometheus-client
	py3-pyzmq
	py3-send2trash
	py3-terminado
	py3-tornado
	py3-traitlets
	"
makedepends="
	jupyterlab
	nodejs
	py3-gpep517
	py3-hatch-jupyter-builder
	py3-hatchling
	py3-jupyterlab_server
	py3-setuptools
	py3-wheel
	"
checkdepends="py3-pytest"
options="!check" # lots of unpackaged dependencies + many dependencies would only work on x86_64
subpackages="$pkgname-pyc"
source="$pkgname-$pkgver.tar.gz::https://github.com/jupyter/notebook/archive/refs/tags/v$pkgver.tar.gz"
builddir="$srcdir/notebook-$pkgver"

# secfixes:
#   6.4.12-r0:
#     - CVE-2022-29238
#   6.4.10-r0:
#     - CVE-2022-24758

build() {
	gpep517 build-wheel \
		--wheel-dir .dist \
		--output-fd 3 3>&1 >&2
}

check() {
	python3 -m venv --clear --without-pip --system-site-packages .testenv
	.testenv/bin/python3 -m installer .dist/*.whl
	.testenv/bin/python3 -m pytest
}

package() {
	python3 -m installer -d "$pkgdir" \
		.dist/*.whl
	mv "$pkgdir"/usr/etc "$pkgdir"
}

sha512sums="
f215d1ae1d37efd963c6a32eee7a5619925ea03c693e3f4a5a6081ca61f48c1a4654d7aae02004f3e5a7fab4128b3709794bee8a54527782ad4b1040c2b543c6  jupyter-notebook-7.5.2.tar.gz
"
