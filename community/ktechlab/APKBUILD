# The group tag is just to easily find this APKBUILD by some scripts for automation
# group=kde-other
maintainer="team/kde <bribbers@disroot.org>"
pkgname=ktechlab
pkgver=0.51.0_git20260206
pkgrel=0
_commit="1ce00695e70af005a86f0afbf6912469d9b23273"
pkgdesc="IDE for microcontrollers and electronics"
# armhf blocked by qt6-qtdeclarative -> ki18n
arch="all !armhf"
url="https://apps.kde.org/ktechlab/"
license="GPL-2.0-only"
makedepends="
	extra-cmake-modules
	kcompletion-dev
	kconfig-dev
	kconfigwidgets-dev
	kcoreaddons-dev
	kdoctools-dev
	ki18n-dev
	kiconthemes-dev
	kio-dev
	kparts-dev
	ktexteditor-dev
	ktextwidgets-dev
	kwidgetsaddons-dev
	kwindowsystem-dev
	kxmlgui-dev
	qt6-qtbase-dev
	qt6-qtserialport-dev
	samurai
	"
checkdepends="xwayland-run"
subpackages="$pkgname-doc $pkgname-lang"
_repo_url="https://invent.kde.org/sdk/ktechlab.git"
#source="https://download.kde.org/unstable/ktechlab/ktechlab-$pkgver.tar.xz"
source="$pkgname-$_commit.tar.gz::https://invent.kde.org/sdk/ktechlab/-/archive/$_commit.tar.gz"
options="!check" # No easily runnable tests
builddir="$srcdir/$pkgname-$_commit"

build() {
	cmake3.5 -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=RelWithDebInfo \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_TESTING="$(want_check && echo ON || echo OFF)"
	cmake --build build
}

check() {
	wlheadless-run -- ctest --test-dir build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}
sha512sums="
aac31c2f2aae496faf8c7da77e66c770f91b1d28afd7956252182eee7f5a6dd9043321caa6df0602e64a243dd1043bc52b18c9f3294490a9cd6fa7e8ac163377  ktechlab-1ce00695e70af005a86f0afbf6912469d9b23273.tar.gz
"
