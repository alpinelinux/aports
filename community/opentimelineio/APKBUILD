maintainer="Bart Ribbers <bribbers@disroot.org>"
pkgname=opentimelineio
pkgver=0.18.1
pkgrel=0
# We need a way newer rapidjson than it's last release from 2016
_rapidjson_commit="24b5e7a8b27f42fa16b96fc70aade9106cf7102f"
arch="all"
url="https://opentimeline.io"
pkgdesc="Open Source API and interchange format for editorial timeline information"
license="Apache-2.0"
depends_dev="imath-dev"
makedepends="$depends_dev
	cmake
	samurai
	"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/AcademySoftwareFoundation/OpenTimelineIO/archive/refs/tags/v$pkgver.tar.gz
	rapidjson-$_rapidjson_commit.tar.gz::https://github.com/Tencent/rapidjson/archive/$_rapidjson_commit.tar.gz
	"
builddir="$srcdir/OpenTimelineIO-$pkgver"

prepare() {
	default_prepare

	rmdir src/deps/rapidjson
	mv "$srcdir"/rapidjson-$_rapidjson_commit src/deps/rapidjson
}

build() {
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=RelWithDebInfo \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DOTIO_FIND_IMATH=ON \
		-DOTIO_AUTOMATIC_SUBMODULES=OFF \
		-DOTIO_DEPENDENCIES_INSTALL=OFF
	cmake --build build
}

check() {
	ctest --test-dir build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
136f06ad7f9604b60d0463475f4a177ad8b7a18bc2ac74e5580a3f51fa728fa31cdb6e917c681d170460f685f4d1ec497f5e9ae8ed9952a3525fb69536a9412a  opentimelineio-0.18.1.tar.gz
50f8723414a6e63eadd45f97be5c44e9fff2d06216c8cc4df802f5bfc2a9416a039f2c69e9bb1882f7e756cd38a7097eea05cab76c739f45805dc41617140799  rapidjson-24b5e7a8b27f42fa16b96fc70aade9106cf7102f.tar.gz
"
