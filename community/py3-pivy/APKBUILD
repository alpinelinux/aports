# Contributor: Aiden Grossman <agrossman154@yahoo.com>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=py3-pivy
pkgver=0.6.10
pkgrel=0
pkgdesc="Python3 bindings for coin"
url="https://github.com/coin3d/pivy"
# riscv64 blocked by py3-pyside6
# armhf blocked by qt6-qtdeclarative -> py3-pyside6
arch="all !riscv64 !armhf"
license="ISC"
depends="py3-pyside6"
makedepends="swig soqt-dev qt6-qtbase-dev python3-dev glu-dev cmake samurai"
checkdepends="py3-pytest"
options="!check" # test suite is interactive and requires full installation
source="$pkgname-$pkgver.tar.gz::https://github.com/coin3d/pivy/archive/refs/tags/${pkgver//_alpha/.a}.tar.gz
	fix-build.patch
	"
builddir="$srcdir/pivy-${pkgver//_alpha/.a}"

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		CMAKE_CROSSOPTS="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake3.5 -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=None \
		$CMAKE_CROSSOPTS
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
d4f52635c1e18f137322e52ead8e8e69a6519ed0902aab17a264fc296df9fe2b82221de2234aa152db9c7fd45003a6299a19ddace4488adea99c2159d31d68bb  py3-pivy-0.6.10.tar.gz
b0026ad5044eb3d4d78bd621f7ace3198ae051d36a233533986a112e4f885df9b1b71f036df76e43e92440c5e3335d81a9af56679b81e51ae251c74bdc2d858f  fix-build.patch
"
