From aa458a1c0e0f98b5e988a5ff1e5c08afe4601817 Mon Sep 17 00:00:00 2001
From: Leon Marz <main@lmarz.org>
Date: Wed, 19 Nov 2025 16:24:07 +0100
Subject: [PATCH 3/3] fix headless build

---
 source/blender/blenfont/intern/blf_glyph.cc | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/source/blender/blenfont/intern/blf_glyph.cc b/source/blender/blenfont/intern/blf_glyph.cc
index 6bb0620..aab6098 100644
--- a/source/blender/blenfont/intern/blf_glyph.cc
+++ b/source/blender/blenfont/intern/blf_glyph.cc
@@ -1363,10 +1363,12 @@ GlyphBLF *blf_glyph_ensure(FontBLF *font, GlyphCacheBLF *gc, const uint charcode
   FontBLF *font_with_glyph = font;
   FT_UInt glyph_index = blf_glyph_index_from_charcode(&font_with_glyph, charcode);
 
+#ifndef WITH_HEADLESS
   if (!glyph_index) {
     /* 1 = id of ICON_CHAR_NOTDEF */
     return blf_glyph_ensure_icon(gc, 1, false, nullptr);
   }
+#endif /* WITH_HEADLESS */
 
   if (!blf_ensure_face(font_with_glyph)) {
     return nullptr;
-- 
2.51.2

