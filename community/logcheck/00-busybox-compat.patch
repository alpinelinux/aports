--- logcheck-1.3.17/src/logcheck
+++ logcheck-1.3.17/src/logcheck.new
@@ -73,7 +73,7 @@
 CONFFILE="/etc/logcheck/logcheck.conf"
 STATEDIR="/var/lib/logcheck"
 LOGFILES_LIST="/etc/logcheck/logcheck.logfiles"
-LOGFILE_FALLBACK="/var/log/syslog"
+LOGFILE_FALLBACK="/var/log/messages"
 LOGTAIL="/usr/sbin/logtail2"
 CAT="/bin/cat"
 SYSLOG_SUMMARY="/usr/bin/syslog-summary"
@@ -89,8 +89,8 @@
 SORTUNIQ=0
 SUPPORT_CRACKING_IGNORE=0
 SYSLOGSUMMARY=0
-LOCKDIR=/run/lock/logcheck
-LOCKFILE="$LOCKDIR/logcheck"
+LOCKDIR=/var/lib/logcheck
+LOCKFILE="$LOCKDIR/logcheck"
 
 # Carry out the clean up tasks
 cleanup() {
@@ -215,13 +215,13 @@
 	    mkdir "$cleaned" \
 	        || error "Could not make dir $cleaned for cleaned rulefiles."
 	fi
-	for rulefile in $(run-parts --list "$dir"); do
+	for rulefile in $(ls $dir/*); do
 	    rulefile="$(basename "$rulefile")"
 	    if [ -f "${dir}/${rulefile}" ]; then
 		debug "cleanrules: ${dir}/${rulefile}"
 		if [ -r "${dir}/${rulefile}" ]; then
 			# pipe to cat on greps to get usable exit status
-			egrep --text -v '^[[:space:]]*$|^#' "$dir/$rulefile" | cat \
+			egrep -v '^[[:space:]]*$|^#' "$dir/$rulefile" | cat \
 				>> "$cleaned/$rulefile" \
 			|| error "Couldn't append to $cleaned/$rulefile."
 		else
@@ -326,7 +326,7 @@
 	debug "greplogoutput: $grepfile"
 
 	# Raise entries that match
-	egrep --text -f "$raise/$grepfile" "$TMPDIR/logoutput-sorted" | cat \
+	egrep -f "$raise/$grepfile" "$TMPDIR/logoutput-sorted" | cat \
 	    > "$TMPDIR/checked" \
 	    || error "Could not output to $TMPDIR/checked."
 
@@ -403,7 +403,7 @@
 
     if [ -f "$clean" ]; then
 	debug "cleanchecked - file: $clean"
-        egrep --text -v -f "$clean" "$TMPDIR/checked" | cat >> "$TMPDIR/checked.1"  \
+        egrep -v -f "$clean" "$TMPDIR/checked" | cat >> "$TMPDIR/checked.1"  \
 	    || error "Could not output to $TMPDIR/checked.1."
 	mv "$TMPDIR/checked.1" "$TMPDIR/checked" \
 	    || error "Could not move $TMPDIR/checked.1 to $TMPDIR/checked"
@@ -411,7 +411,7 @@
 	debug "cleanchecked - dir - $clean"
 	for file in $(ls -1 "$clean/"); do
 	debug "cleanchecked - dir - $clean/$file"
-	    egrep --text -v -f "$clean/$file" "$TMPDIR/checked" | cat \
+	    egrep -v -f "$clean/$file" "$TMPDIR/checked" | cat \
 		>> "$TMPDIR/checked.1" \
 		    || error "Could not output to TMPDIR/checked.1."
 	    mv "$TMPDIR/checked.1" "$TMPDIR/checked" \
@@ -663,7 +663,7 @@
     || error "Could not mkdir for log files"
 if [ ! "$LOGFILE" ] && [ -r "$LOGFILES_LIST" ]; then
     SAVEIFS=$IFS; IFS=$(echo -en "\n\b");
-    for file in $(egrep --text -v "(^#|^[[:space:]]*$)" "$LOGFILES_LIST"); do
+    for file in $(egrep -v "(^#|^[[:space:]]*$)" "$LOGFILES_LIST"); do
 	logoutput "$file"
     done
     IFS=$SAVEIFS
@@ -785,3 +785,4 @@
 elif [ "$SYSTEM" -eq 1 ]; then
     sendreport "$EVENTSSUBJECT"
 fi
+

--- logcheck-1.3.17/src/logcheck-test
+++ logcheck-1.3.17/src/logcheck-test.new
@@ -176,9 +176,9 @@
     exit 3
 else
     if [ -n "$RULEFILE" ] ; then
-        CLEANRULE="$(mktemp --tmpdir logcheck-test.XXXXXXXXXX)"
+        CLEANRULE="$(mktemp -t logcheck-test.XXXXXXXXXX)"
         cleanup() { rm -rf $CLEANRULE; }
-        egrep --text -v '^[[:space:]]*$|^#' "$RULEFILE" >> $CLEANRULE
+        egrep -v '^[[:space:]]*$|^#' "$RULEFILE" >> $CLEANRULE
         sed -e 's/[[:space:]]*$//' $FILE | egrep $INVERT -f "$CLEANRULE"
         GREP="$?"
         cleanup
@@ -203,3 +203,4 @@
     fi
     exit $EXIT
 fi
+

