Patch-Source: https://github.com/musescore/MuseScore/pull/30795
Extracted src/ fixes for 4.6.2/4.6.3.
---
From 3ab6d89e992f11fa3e7254bde4835a4b69adc695 Mon Sep 17 00:00:00 2001
From: Casper Jeukendrup <48658420+cbjeukendrup@users.noreply.github.com>
Date: Wed, 29 Oct 2025 19:55:22 +0100
Subject: [PATCH 1/5] Update to Qt 6.10

---
 .github/workflows/build_backend.yml           | 2 +-
 .github/workflows/build_linux.yml             | 2 +-
 .github/workflows/build_macos.yml             | 2 +-
 .github/workflows/build_wasm.yml              | 2 +-
 .github/workflows/build_windows.yml           | 4 ++--
 .github/workflows/check_unit_tests.yml        | 2 +-
 .github/workflows/check_visual_tests.yml      | 4 ++--
 .github/workflows/translate_lupdate.yml       | 2 +-
 .github/workflows/translate_tx_pull_to_s3.yml | 2 +-
 buildscripts/ci/macos/install_qt.sh           | 8 ++++----
 src/importexport/tabledit/tests/data/genrefs  | 2 +-
 src/importexport/tabledit/tests/data/iotest   | 2 +-
 12 files changed, 17 insertions(+), 17 deletions(-)

diff --git a/src/framework/global/io/internal/filesystem.cpp b/src/framework/global/io/internal/filesystem.cpp
index da6aa3e75e570..951a8462dfca5 100644
--- a/src/framework/global/io/internal/filesystem.cpp
+++ b/src/framework/global/io/internal/filesystem.cpp
@@ -460,10 +460,10 @@ Ret FileSystem::isWritable(const io::path_t& filePath) const
         file.remove();
     } else if (!fileInfo.isWritable()) {
         QFile file(filePath.toQString());
-        file.open(QFile::WriteOnly);
-
-        ret = make_ret(Err::FSWriteError);
-        ret.setText(file.errorString().toStdString());
+        if (!file.open(QFile::WriteOnly)) {
+            ret = make_ret(Err::FSWriteError);
+            ret.setText(file.errorString().toStdString());
+        }
 
         file.close();
     }
diff --git a/src/framework/ui/graphicsapiprovider.cpp b/src/framework/ui/graphicsapiprovider.cpp
index 7fe31be5cca00..44b228c5b483e 100644
--- a/src/framework/ui/graphicsapiprovider.cpp
+++ b/src/framework/ui/graphicsapiprovider.cpp
@@ -236,7 +236,10 @@ void GraphicsApiProvider::writeData(const Data& d)
     QString str = vals.join('|');
 
     QFile file(dataFilePath());
-    file.open(QIODevice::WriteOnly);
+    if (!file.open(QIODevice::WriteOnly)) {
+        LOGE() << "Failed to write Graphics GraphicsApi data to file: " << file.fileName();
+        return;
+    }
     file.write(str.toUtf8());
 }
 
diff --git a/src/framework/uicomponents/view/sortfilterproxymodel.cpp b/src/framework/uicomponents/view/sortfilterproxymodel.cpp
index 845068102a049..ac136daf944f5 100644
--- a/src/framework/uicomponents/view/sortfilterproxymodel.cpp
+++ b/src/framework/uicomponents/view/sortfilterproxymodel.cpp
@@ -103,10 +103,11 @@ void SortFilterProxyModel::setAlwaysIncludeIndices(const QList<int>& indices)
         return;
     }
 
+    beginFilterChange();
     m_alwaysIncludeIndices = indices;
-    emit alwaysIncludeIndicesChanged();
+    endFilterChange(QSortFilterProxyModel::Direction::Rows);
 
-    invalidateFilter();
+    emit alwaysIncludeIndicesChanged();
 }
 
 QList<int> SortFilterProxyModel::alwaysExcludeIndices() const
@@ -120,10 +121,11 @@ void SortFilterProxyModel::setAlwaysExcludeIndices(const QList<int>& indices)
         return;
     }
 
+    beginFilterChange();
     m_alwaysExcludeIndices = indices;
-    emit alwaysExcludeIndicesChanged();
+    endFilterChange(QSortFilterProxyModel::Direction::Rows);
 
-    invalidateFilter();
+    emit alwaysExcludeIndicesChanged();
 }
 
 QHash<int, QByteArray> SortFilterProxyModel::roleNames() const
@@ -226,12 +228,14 @@ void SortFilterProxyModel::reset()
 
 void SortFilterProxyModel::fillRoleIds()
 {
-    m_roleIdToFilterValueHash.clear();
+    beginFilterChange();
 
     DEFER {
-        invalidateFilter();
+        endFilterChange(QSortFilterProxyModel::Direction::Rows);
     };
 
+    m_roleIdToFilterValueHash.clear();
+
     if (!sourceModel()) {
         return;
     }
diff --git a/src/importexport/midi/tests/midiexport_tests.cpp b/src/importexport/midi/tests/midiexport_tests.cpp
index c7e44e49e60be..5b6785807e017 100644
--- a/src/importexport/midi/tests/midiexport_tests.cpp
+++ b/src/importexport/midi/tests/midiexport_tests.cpp
@@ -389,7 +389,9 @@ TEST_P(MidiExportEventsTests, DISABLED_eventsTest) {
     CompatMidiRender::renderScore(score.get(), events, ctx, true);
 
     QFile filehandler(writeFile);
-    filehandler.open(QIODevice::WriteOnly | QIODevice::Text);
+    bool open = filehandler.open(QIODevice::WriteOnly | QIODevice::Text);
+    ASSERT_TRUE(open);
+
     QTextStream out(&filehandler);
 
     for (std::size_t i = 0; i < events.size(); i++) {

From 468e7879d5bad34a20f01994385e80289c7d7f7d Mon Sep 17 00:00:00 2001
From: Casper Jeukendrup <48658420+cbjeukendrup@users.noreply.github.com>
Date: Sun, 2 Nov 2025 01:07:50 +0100
Subject: [PATCH 4/5] Work around lupdate hang

https://bugreports.qt.io/browse/QTBUG-141631
---
 src/importexport/mei/internal/meireader.cpp | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/src/importexport/mei/internal/meireader.cpp b/src/importexport/mei/internal/meireader.cpp
index f677cac1092bd..529c51f2c7d69 100644
--- a/src/importexport/mei/internal/meireader.cpp
+++ b/src/importexport/mei/internal/meireader.cpp
@@ -60,9 +60,9 @@ Err MeiReader::import(MasterScore* score, const muse::io::path_t& path, const Op
     bool hasWarnings = (Convert::logs.size() > 0);
 
     if (!forceMode && !MScore::noGui && hasWarnings) {
-        const String text
-            = muse::qtrc("iex_mei", "%n problem(s) occured and the import may be incomplete.", nullptr,
-                         static_cast<int>(Convert::logs.size()));
+        int numLogs = static_cast<int>(Convert::logs.size());
+        const String text = muse::qtrc("iex_mei", "%n problem(s) occurred and the import may be incomplete.",
+                                       nullptr, numLogs);
         if (!this->askToLoadDespiteWarnings(text, Convert::logs.join(u"\n"))) {
             return Err::FileBadFormat;
         }

From d06c5fc9fd68e53aac46935f09fc76bf0cbab7fa Mon Sep 17 00:00:00 2001
From: Casper Jeukendrup <48658420+cbjeukendrup@users.noreply.github.com>
Date: Sun, 2 Nov 2025 01:17:55 +0100
Subject: [PATCH 5/5] Add missing `find_package(PkgConfig)` call

---
 src/framework/audio/CMakeLists.txt | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/framework/audio/CMakeLists.txt b/src/framework/audio/CMakeLists.txt
index 1a533458b338d..b2b459012c28c 100644
--- a/src/framework/audio/CMakeLists.txt
+++ b/src/framework/audio/CMakeLists.txt
@@ -82,6 +82,7 @@ else ()
         set(MODULE_INCLUDE_PRIVATE ${MODULE_INCLUDE_PRIVATE} ${ALSA_INCLUDE_DIRS} )
         set(MODULE_LINK ${MODULE_LINK} ${ALSA_LIBRARIES} pthread )
         if (MUSE_PIPEWIRE_AUDIO_DRIVER)
+            find_package(PkgConfig)
             pkg_check_modules(PipeWire libpipewire-0.3)
             if (PipeWire_FOUND)
                 message(STATUS "Found Pipewire: ${PipeWire_LIBRARIES}")
