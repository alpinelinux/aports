--- a/src/sptps_test.c
+++ b/src/sptps_test.c
@@ -382,7 +382,8 @@
 					if(!datagram)
 						return 1;
 				} else {
-					break;
+					if(datagram)
+						break;
 				}
 
 				bufp += done;
