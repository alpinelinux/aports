# Maintainer: John Vogel <jvogel@stygian.me>
maintainer="John Vogel <jvogel@stygian.me>"
pkgname=nawk
pkgver=20251225
_ckver=20250116
pkgrel=0
pkgdesc="The one, true implementation of AWK"
url="https://github.com/onetrueawk/awk/"
arch="all"
license=MIT
makedepends="bison"
checkdepends="cmd:pr musl-locales"
[ -n "$BOOTSTRAP" ] && options="$options !check"
subpackages="$pkgname-doc"
source="awk-$pkgver.tar.gz::https://github.com/onetrueawk/awk/archive/refs/tags/$pkgver.tar.gz
	awk-$_ckver.tar.gz::https://github.com/onetrueawk/awk/archive/refs/tags/$_ckver.tar.gz"
builddir="$srcdir/awk-$pkgver"

build() {
	make
}

check() {
	make -C "$srcdir"/awk-"$_ckver"
	oldawk="$srcdir"/awk-"$_ckver"/a.out make check
}

package() {
	install -Dm755 a.out "$pkgdir"/usr/bin/$pkgname
	install -Dm644 awk.1 "$pkgdir"/usr/share/man/man1/$pkgname.1
	install -Dm644 LICENSE -t "$pkgdir"/usr/share/licenses/"$pkgname"
	install -Dm644 FIXES FIXES.1e README.md TODO -t "$pkgdir"/usr/share/doc/"$pkgname"
}

sha512sums="
a26606a683a84a5a29c487748d4645e47877ff043f5ce938d07ed519d9e6f75ba8ed84b2d7c31de8b9348770bab5af665ace9826f44da816f85d657149d85070  awk-20251225.tar.gz
3be63637bc1689e56d2eac9fa646e8bd89b8c4ccd4ad028a61c7c5d5e9f3490d3c49657488d39a62451b23f0935b81c5ecd812c92cef9e160f7377f4bd4fc711  awk-20250116.tar.gz
"
