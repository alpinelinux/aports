# Automatically generated by apkbuild-cpan, template 4
# Contributor: Celeste <cielesti@protonmail.com>
# Maintainer: Celeste <cielesti@protonmail.com>
pkgname=perl-javascript-quickjs
pkgver=0.21
pkgrel=1
#_pkgreal is used by apkbuild-cpan to find modules at MetaCpan
_pkgreal=JavaScript-QuickJS
pkgdesc="Run JavaScript via QuickJS in Perl"
url="https://metacpan.org/release/JavaScript-QuickJS/"
arch="all !s390x !ppc64le" # quickjs
license="GPL-1.0-or-later OR Artistic-1.0-Perl"
depends="
	perl
	perl-types-serialiser
	"
makedepends="
	perl-dev
	perl-extutils-makemaker-cpanfile
	perl-file-slurper
	perl-file-which
	quickjs-dev
	"
checkdepends="
	perl-test-deep
	perl-test-failwarnings
	perl-test-fatal
	"
subpackages="$pkgname-doc"
source="https://cpan.metacpan.org/authors/id/F/FE/FELIPE/JavaScript-QuickJS-$pkgver.tar.gz
	quickjs-shared.mk.pl
	"
builddir="$srcdir/$_pkgreal-$pkgver"

prepare() {
	default_prepare

	cp -v ../quickjs-shared.mk.pl Makefile.PL
}

build() {
	export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
	PERL_MM_USE_DEFAULT=1 perl -I. Makefile.PL \
		INSTALLDIRS=vendor \
		NO_PACKLIST=1 \
		NO_PERLLOCAL=1
	make
}

check() {
	export CFLAGS=$(perl -MConfig -E 'say $Config{ccflags}')
	make test
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
4cc3488e506c2312b9f8b3410c09f9aed1d1ceeba5a115815256f2827b1e61246d6ff542cbe6d15d21b51f63c49e73c304815e9e3340516f15fb13c64d200b6d  JavaScript-QuickJS-0.21.tar.gz
c78434dcd87a17dda2c9981987cbd7566e2578a5959203008c910487059d0679bb475b2861651056fb7b548acd91a58f603beb63e5a515db1d3dd6b3b84ff74e  quickjs-shared.mk.pl
"
