# Contributor: Luca Weiss <luca@lucaweiss.eu>
# Maintainer: Clayton Craft <clayton@craftyguy.net>
pkgname=waybar
pkgver=0.15.0
pkgrel=2
pkgdesc="Highly customizable Wayland bar for Sway and Wlroots based compositors"
url="https://github.com/Alexays/Waybar/"
arch="all"
license="MIT"
depends="tzdata"
makedepends="
	date-dev
	eudev-dev
	fmt-dev
	gtk-layer-shell-dev
	gtkmm3-dev
	jsoncpp-dev
	libdbusmenu-gtk3-dev
	libinput-dev
	libmpdclient-dev
	libnl3-dev
	meson
	playerctl-dev
	pulseaudio-dev
	scdoc
	spdlog-dev
	sndio-dev
	upower-dev
	wireplumber-dev
	"
checkdepends="catch2"
subpackages="$pkgname-doc $pkgname-openrc"
source="https://github.com/Alexays/Waybar/archive/$pkgver/Waybar-$pkgver.tar.gz
	waybar.initd
	"
builddir="$srcdir/Waybar-$pkgver"

build() {
	# -Ddefault_library=shared - to override the project defaults.
	abuild-meson \
		-Ddefault_library=shared \
		-Ddbusmenu-gtk=enabled \
		-Dlibevdev=disabled \
		-Dlibnl=enabled \
		-Dlibudev=enabled \
		-Dman-pages=enabled \
		-Dmpd=enabled \
		-Dmpris=enabled \
		-Dpulseaudio=enabled \
		-Drfkill=enabled \
		-Dsndio=enabled \
		-Dsystemd=disabled \
		-Dwireplumber=enabled \
		-Dupower_glib=enabled \
		-Dtests="$(want_check && echo enabled || echo disabled)" \
		. output
	meson compile -C output
}

check() {
	meson test --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
	install -Dm755 "$srcdir"/waybar.initd "$pkgdir"/etc/user/init.d/waybar
}

sha512sums="
f267c1ad2af1e4e74c3d8c966009a013c0b5c2849bfaf312b3b91e9d6f6856dc5466118f308208948118ea1de0cf70986cc3b592cc830f84d634b8518c5b8c9e  Waybar-0.15.0.tar.gz
901d75623de9ae20488a7af8e15720779b37abaf278d8d6fe7c00c2b53e1630f13e31eb031db4e011de0b44b5242cb6c52d5889aca6b23286d016ffdd6738cd5  waybar.initd
"
