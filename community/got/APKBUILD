# Contributor: omni <omni+alpine@hack.org>
# Maintainer: omni <omni+alpine@hack.org>
pkgname=got
_pkgname=got-portable
pkgver=0.122
pkgrel=0
pkgdesc="A VCS which prioritizes ease of use and simplicity over flexibility"
url="https://gameoftrees.org/"
arch="all"
license="ISC"
makedepends="
	libbsd-dev
	libevent-dev
	libretls-dev
	ncurses-dev
	util-linux-dev
	zlib-dev
	"
subpackages="$pkgname-doc"
source="https://gameoftrees.org/releases/portable/got-portable-$pkgver.tar.gz"
builddir="$srcdir/$_pkgname-$pkgver"

build() {
	./configure --prefix=/usr --exec_prefix=/usr --mandir=/usr/share/man \
		--sysconfdir=/etc --localstatedir=/var
	make
}

check() {
	# Test targets from Makefile.am
	# require-{tog,cmdline} tests require /usr/libexec/got-read-gitconfig to be
	# installed when invoking got executable
	make tests \
		TEST_TARGETS="compat regress-delta regress-deltify regress-fetch \
		regress-idset regress-path"
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
f691020b0cfaa36005b8d0d3d8c4fd66ce18bfd8aef0302bbfa32c219ac02a72e397ee84861c91e11ad40bc979a88ad54d627c904ae49d4b8e7df6b9196a0339  got-portable-0.122.tar.gz
"
