maintainer="Patrycja Rosa <alpine@ptrcnull.me>"
pkgname=dinit
pkgver=0.20.0
pkgrel=0
pkgdesc="Service monitoring/init system"
url="https://github.com/davmac314/dinit"
arch="all"
license="Apache-2.0"
subpackages="$pkgname-dbg $pkgname-doc $pkgname-shutdown:_shutdown"
makedepends="m4"
source="$pkgname-$pkgver.tar.gz::https://github.com/davmac314/dinit/archive/refs/tags/v$pkgver.tar.gz"

prepare() {
	default_prepare
	CXXFLAGS="$CXXFLAGS -fno-rtti -flto" \
	./configure \
		--platform=Linux \
		--exec-prefix=/usr \
		--disable-strip \
		--shutdown-prefix=dinit-
}

build() {
	make
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir" install
}

_shutdown() {
	pkgdesc="dinit shutdown utils"
	depends="$pkgname=$pkgver-r$pkgrel"

	amove usr/sbin/dinit-shutdown
	amove usr/sbin/dinit-halt
	amove usr/sbin/dinit-reboot
	amove usr/sbin/dinit-soft-reboot
	amove usr/sbin/dinit-poweroff
}

sha512sums="
e4aa0d7fe1c3a6ad71b161878fea09184bced16d598675b3c14192381090e8f6b26152f59724f181d33a0b737ff60adc49192432c541569e1f2d75f2d4d33482  dinit-0.20.0.tar.gz
"
