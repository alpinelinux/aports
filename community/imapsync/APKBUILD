# Contributor: Stuart Cardall <developer@it-offshore.co.uk>
# Maintainer: Stuart Cardall <developer@it-offshore.co.uk>
pkgname=imapsync
pkgver=2.314
pkgrel=0
pkgdesc="IMAP synchronisation, sync, copy or migration tool"
url="https://imapsync.lamiral.info/"
# tesmp disable due to perl-json-webtoken: https://gitlab.alpinelinux.org/alpine/aports/-/issues/17750
# arch="noarch"
license="NLPL"
depends="perl
	perl-app-cpanminus
	perl-ntlm
	perl-cgi
	perl-crypt-openssl-rsa
	perl-data-uniqid
	perl-digest-hmac
	perl-digest-md5
	perl-dist-checkconflicts
	perl-email-address
	perl-encode-imaputf7
	perl-file-copy-recursive
	perl-file-tail
	perl-http-daemon
	perl-http-daemon-ssl
	perl-io-socket-inet6
	perl-io-socket-ssl
	perl-io-tee
	perl-json-webtoken
	perl-libwww
	perl-mail-imapclient
	perl-module-implementation
	perl-net-dns
	perl-net-server
	perl-package-stash
	perl-package-stash-xs
	perl-parse-recdescent
	perl-proc-processtable
	perl-readonly
	perl-regexp-common
	perl-sys-meminfo
	perl-term-readkey
	perl-unicode-string
	perl-uri
	procps
	"
checkdepends="
	perl-test-nowarnings
	perl-test-simple
	perl-test-warn
	"
makedepends="
	perl-module-scandeps
	perl-par-packer
	perl-test-deep
	perl-test-fatal
	perl-test-mock-guard
	perl-test-mockobject
	perl-test-pod
	perl-test-requires
	"
subpackages="$pkgname-doc"
source="https://imapsync.lamiral.info/dist/imapsync-$pkgver.tgz"

# NOTE: tests.sh requires authors remote imap password
check() {
	./imapsync --version
	make testp  # check dependencies
}

package() {
	make DESTDIR="$pkgdir" install

	mkdir -p "$pkgdir"/usr/share/doc/$pkgname
	install -Dm644 FAQ.d/* "$pkgdir"/usr/share/doc/$pkgname/
}

sha512sums="
d351d3dcd3758e9d6abb2b0be6c0538e8111a5b5e45708c48b00b2d2ae9c8eedc3c26bd8eac622b559941d695fb163fec687b02e8324277009ee3443309e1311  imapsync-2.314.tgz
"
