# Contributor: Holger Jaekel <holger.jaekel@gmx.de>
maintainer="Holger Jaekel <holger.jaekel@gmx.de>"
pkgname=libopendrive
pkgver=0.6.1
pkgrel=0
pkgdesc="Small, lightweight C++ library for handling OpenDRIVE files"
url="https://github.com/DLR-TS/libOpenDRIVE"
arch="all"
license="Apache-2.0"
makedepends="cmake samurai"
subpackages="$pkgname-dev"
source="libopendrive-$pkgver.tar.gz::https://github.com/DLR-TS/libOpenDRIVE/archive/refs/tags/$pkgver-gdal.tar.gz
		10-cmake_install.patch
		"
builddir="$srcdir/libOpenDRIVE-$pkgver-gdal"

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		local crossopts="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=ON \
		-DCMAKE_BUILD_TYPE=None \
		$crossopts
	cmake --build build
}

check() {
	cd tests
	../build/tests
}

package() {
	DESTDIR="$pkgdir" cmake --install build
	rm -rf ${pkgdir:?}/usr/bin
}

sha512sums="
9796512f54da8ec22e368e6f5b9d59c468fb88c6e115292a90e86eeb383cc884f64fec44b8e30e4a4b2685e29a4d565d7a7a3a4b075ac1d925dd6134473541f0  libopendrive-0.6.1.tar.gz
9cade188e8e5ea566d032228fad28c7e093192b1ca790e585a30299b37698cc668106da12208306a38be3f4b4e2a84cde9af14a06c2430991bb8d415a1056dda  10-cmake_install.patch
"
