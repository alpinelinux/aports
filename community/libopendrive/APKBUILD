# Contributor: Holger Jaekel <holger.jaekel@gmx.de>
maintainer="Holger Jaekel <holger.jaekel@gmx.de>"
pkgname=libopendrive
pkgver=0.6.1
pkgrel=1
pkgdesc="Small, lightweight C++ library for handling OpenDRIVE files"
url="https://github.com/DLR-TS/libOpenDRIVE"
arch="all"
license="Apache-2.0"
depends_dev="pugixml-dev"
makedepends="cmake samurai $depends_dev"
checkdepends="catch2-3"
subpackages="$pkgname-dev"
source="libopendrive-$pkgver.tar.gz::https://github.com/DLR-TS/libOpenDRIVE/archive/refs/tags/$pkgver-gdal.tar.gz
		10-cmake_install.patch
		20-pugixml.patch
		30-catch2.patch
		"
builddir="$srcdir/libOpenDRIVE-$pkgver-gdal"

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		local crossopts="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=ON \
		-DCMAKE_BUILD_TYPE=None \
		-DBUILD_TESTING="$(want_check && echo ON || echo OFF)" \
		$crossopts
	cmake --build build
}

check() {
	cd tests
	../build/tests
}

package() {
	DESTDIR="$pkgdir" cmake --install build
	rm -rf ${pkgdir:?}/usr/bin
}

sha512sums="
9796512f54da8ec22e368e6f5b9d59c468fb88c6e115292a90e86eeb383cc884f64fec44b8e30e4a4b2685e29a4d565d7a7a3a4b075ac1d925dd6134473541f0  libopendrive-0.6.1.tar.gz
9cade188e8e5ea566d032228fad28c7e093192b1ca790e585a30299b37698cc668106da12208306a38be3f4b4e2a84cde9af14a06c2430991bb8d415a1056dda  10-cmake_install.patch
9a7321360572a1a79859295fd5cd34c7f2125a7a9b8d7a69a34ab9a2259e5aedf617386014aa2feb387236d07e114dd2bb011b5d14ebfd8f97d62cf19b2f5e14  20-pugixml.patch
30c7f0d7ca89ba2786f97a1ba34adbc5a4f2e39ee7a470b0f6263365a49d39fca5adeccc5ab0ebdd39d60614970c1634fe9afd346e05b3255782f4c36c1cb202  30-catch2.patch
"
