From: Jakub Jirutka <jakub@jirutka.cz>
Date: Wed, 13 Apr 2016 20:58:00 +0200
Last-Updated: Sun, 20 Feb 2022 15:27:05 +0100
Subject: [PATCH] Exclude native libs from jna.jar\

--- a/build.xml
+++ b/build.xml
@@ -324,97 +324,6 @@
 com.sun.jna.ptr;version=&quot;${osgi.version}&quot;;uses:=&quot;com.sun.jna&quot;,
 com.sun.jna.win32;version=&quot;${osgi.version}&quot;;uses:=&quot;com.sun.jna&quot;
 "/>
-              <!-- Note that no terminal "*" is included in this list,
-                 which will force failure on unsupported platforms.
-              -->
-              <attribute name="Bundle-NativeCode"
-                         value="
-com/sun/jna/win32-x86/jnidispatch.dll;
-processor=x86;osname=win32,
-com/sun/jna/win32-x86-64/jnidispatch.dll;
-processor=x86-64;osname=win32,
-com/sun/jna/win32-aarch64/jnidispatch.dll;
-processor=aarch64;osname=win32,
-com/sun/jna/win32-x86/jnidispatch.dll;
-processor=x86;osname=win,
-com/sun/jna/win32-x86-64/jnidispatch.dll;
-processor=x86-64;osname=win,
-com/sun/jna/win32-aarch64/jnidispatch.dll;
-processor=aarch64;osname=win,
-com/sun/jna/w32ce-arm/jnidispatch.dll;
-processor=arm;osname=wince,
-
-com/sun/jna/sunos-x86/libjnidispatch.so;
-processor=x86;osname=sunos,
-com/sun/jna/sunos-x86-64/libjnidispatch.so;
-processor=x86-64;osname=sunos,
-com/sun/jna/sunos-sparc/libjnidispatch.so;
-processor=sparc;osname=sunos,
-com/sun/jna/sunos-sparcv9/libjnidispatch.so;
-processor=sparcv9;osname=sunos,
-
-com/sun/jna/aix-ppc/libjnidispatch.a;
-processor=ppc;osname=aix,
-com/sun/jna/aix-ppc64/libjnidispatch.a;
-processor=ppc64;osname=aix,
-
-com/sun/jna/linux-ppc/libjnidispatch.so;
-processor=ppc;osname=linux,
-com/sun/jna/linux-ppc64/libjnidispatch.so;
-processor=ppc64;osname=linux,
-com/sun/jna/linux-ppc64le/libjnidispatch.so;
-processor=ppc64le;osname=linux,
-com/sun/jna/linux-x86/libjnidispatch.so;
-processor=x86;osname=linux,
-com/sun/jna/linux-x86-64/libjnidispatch.so;
-processor=x86-64;osname=linux,
-com/sun/jna/linux-arm/libjnidispatch.so;
-processor=arm;osname=linux,
-com/sun/jna/linux-arm/libjnidispatch.so;
-processor=arm_le;osname=linux,
-com/sun/jna/linux-armel/libjnidispatch.so;
-processor=armel;osname=linux,
-com/sun/jna/linux-aarch64/libjnidispatch.so;
-processor=aarch64;osname=linux,
-com/sun/jna/linux-ia64/libjnidispatch.so;
-processor=ia64;osname=linux,
-com/sun/jna/linux-sparcv9/libjnidispatch.so;
-processor=sparcv9;osname=linux,
-com/sun/jna/linux-mips64el/libjnidispatch.so;
-processor=mips64el;osname=linux,
-com/sun/jna/linux-s390x/libjnidispatch.so;
-processor=S390x;osname=linux,
-com/sun/jna/linux-loongarch64/libjnidispatch.so;
-processor=loongarch64;osname=linux,
-com/sun/jna/linux-riscv64/libjnidispatch.so;
-processor=riscv64;osname=linux,
-
-com/sun/jna/dragonflybsd-x86-64/libjnidispatch.so;
-processor=x86-64;osname=dragonflybsd,
-
-com/sun/jna/freebsd-x86/libjnidispatch.so;
-processor=x86;osname=freebsd,
-com/sun/jna/freebsd-x86-64/libjnidispatch.so;
-processor=x86-64;osname=freebsd,
-com/sun/jna/freebsd-aarch64/libjnidispatch.so;
-processor=aarch64;osname=freebsd,
-
-com/sun/jna/openbsd-x86/libjnidispatch.so;
-processor=x86;osname=openbsd,
-com/sun/jna/openbsd-x86-64/libjnidispatch.so;
-processor=x86-64;osname=openbsd,
-
-com/sun/jna/darwin-ppc/libjnidispatch.jnilib;
-osname=macosx;processor=ppc,
-com/sun/jna/darwin-ppc64/libjnidispatch.jnilib;
-osname=macosx;processor=ppc64,
-com/sun/jna/darwin-x86/libjnidispatch.jnilib;
-osname=macosx;processor=x86,
-com/sun/jna/darwin-x86-64/libjnidispatch.jnilib;
-osname=macosx;processor=x86-64,
-com/sun/jna/darwin-aarch64/libjnidispatch.jnilib;
-osname=macosx;processor=aarch64
-"/>
           </manifest>
           <manifest file="@{target}" mode="update" if:true="@{module-info}">
               <attribute name="Multi-Release" value="true"/>
@@ -445,114 +354,6 @@
       <fileset dir="${classes}" excludes="${jar.omitted}">
         <patternset refid="jar-compiled"/>
       </fileset>
-      <zipfileset src="${lib.native}/win32-x86.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/win32-x86"/>
-      <zipfileset src="${lib.native}/aix-ppc.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/aix-ppc"/>
-      <zipfileset src="${lib.native}/aix-ppc64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/aix-ppc64"/>
-      <zipfileset src="${lib.native}/darwin-ppc.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/darwin-ppc"/>
-      <zipfileset src="${lib.native}/darwin-ppc64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/darwin-ppc64"/>
-      <zipfileset src="${lib.native}/darwin-x86.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/darwin-x86"/>
-      <zipfileset src="${lib.native}/darwin-x86-64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/darwin-x86-64"/>
-      <zipfileset src="${lib.native}/darwin-aarch64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/darwin-aarch64"/>
-      <zipfileset src="${lib.native}/linux-x86.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/linux-x86"/>
-      <zipfileset src="${lib.native}/linux-x86-64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/linux-x86-64"/>
-      <zipfileset src="${lib.native}/linux-arm.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/linux-arm"/>
-      <zipfileset src="${lib.native}/linux-armel.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/linux-armel"/>
-      <zipfileset src="${lib.native}/linux-aarch64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/linux-aarch64"/>
-      <zipfileset src="${lib.native}/linux-ia64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/linux-ia64"/>
-      <zipfileset src="${lib.native}/linux-ppc.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/linux-ppc"/>
-      <zipfileset src="${lib.native}/linux-ppc64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/linux-ppc64"/>
-      <zipfileset src="${lib.native}/linux-ppc64le.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/linux-ppc64le"/>
-      <zipfileset src="${lib.native}/linux-sparcv9.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/linux-sparcv9"/>
-      <zipfileset src="${lib.native}/linux-mips64el.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/linux-mips64el"/>
-      <zipfileset src="${lib.native}/linux-loongarch64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/linux-loongarch64"/>
-      <zipfileset src="${lib.native}/linux-s390x.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/linux-s390x"/>
-      <zipfileset src="${lib.native}/linux-riscv64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/linux-riscv64"/>
-      <zipfileset src="${lib.native}/sunos-x86.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/sunos-x86"/>
-      <zipfileset src="${lib.native}/sunos-x86-64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/sunos-x86-64"/>
-      <zipfileset src="${lib.native}/sunos-sparc.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/sunos-sparc"/>
-      <zipfileset src="${lib.native}/sunos-sparcv9.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/sunos-sparcv9"/>
-      <zipfileset src="${lib.native}/dragonflybsd-x86-64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/dragonflybsd-x86-64"/>
-      <zipfileset src="${lib.native}/freebsd-x86.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/freebsd-x86"/>
-      <zipfileset src="${lib.native}/freebsd-x86-64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/freebsd-x86-64"/>
-      <zipfileset src="${lib.native}/freebsd-aarch64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/freebsd-aarch64"/>
-      <zipfileset src="${lib.native}/openbsd-x86.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/openbsd-x86"/>
-      <zipfileset src="${lib.native}/openbsd-x86-64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/openbsd-x86-64"/>
-      <zipfileset src="${lib.native}/win32-x86-64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/win32-x86-64"/>
-      <zipfileset src="${lib.native}/win32-aarch64.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/win32-aarch64"/>
-      <zipfileset src="${lib.native}/w32ce-arm.jar"
-                  includes="*jnidispatch*"
-                  prefix="com/sun/jna/w32ce-arm"/>
-      <zipfileset dir="."
-                  includes="LICENSE,LGPL2.1,AL2.0"
-                  prefix="META-INF"/>
     </jar>
     <zip zipfile="${build}/${minjar}">
       <zipfileset src="${build}/${jar}" excludes="**/*jnidispatch*"/>
