# Contributor: qaqland <qaq@qaq.land>
# Maintainer: qaqland <qaq@qaq.land>
pkgname=libtbox
pkgver=1.7.9
pkgrel=0
pkgdesc="A glib-like multi-platform c library"
url="https://github.com/tboox/tbox"
arch="all"
license="Apache-2.0"
subpackages="$pkgname-dev"
makedepends="linux-headers"
source="$pkgname-$pkgver.tar.gz::https://github.com/tboox/tbox/archive/refs/tags/v$pkgver.tar.gz
	$pkgname.pc
	"
builddir="$srcdir/tbox-$pkgver"

prepare() {
	default_prepare
	chmod -x ./*.md
}

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--kind=shared \
		--force_utf8=yes \
		--charset=yes \
		--float=yes \
		--hash=yes
	make
}

check() {
	make run
}

package() {
	make DESTDIR="$pkgdir" install
	rm "$pkgdir/usr/bin/demo"

	mkdir -p "$pkgdir/usr/lib/pkgconfig/"
	sed "s/@VERSION@/$pkgver/" "$srcdir/$pkgname.pc" > "$pkgdir/usr/lib/pkgconfig/$pkgname.pc"
}

sha512sums="
febb69c7dfb8f88511b8269b94f3fa414c25d9aa44a2825bc30a610e8ebea3712d41c53007d63e7f487b71424f7b89cac0481f6b928a248be584bbedbfd6f394  libtbox-1.7.9.tar.gz
9b9e41014af55df80419fde320784e396a6a54005cf09393567f43ce146b94494090927fdfa2685edf3b72bc5ff4d155c99a037d4ea8c9a3cb649187ac4c9a32  libtbox.pc
"
