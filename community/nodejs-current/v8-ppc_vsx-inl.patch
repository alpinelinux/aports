From: Johannes MÃ¼ller <50362-jogemu@users.gitlab.alpinelinux.org>
Date: Fri Feb 06 17:23:23 2026 +0000
Subject: Fix ppc64le build failure due to missing VSX conversion intrinsics

Highway's PPC VSX backend attempts to use the builtin intrinsics
__builtin_vsx_xvcvspsxds and __builtin_vsx_xvcvspuxds for vector
floating-point -> 64-bit integer conversions. These intrinsics originate
from the POWER7/VSX1 ISA and are not declared by GCC on POWER9/POWER10.
On Alpine, GCC defaults to newer POWER ISAs without providing these
legacy builtins, which causes compilation errors in Node/V8 such as:


    error: there are no arguments to '__builtin_vsx_xvcvspsxds' that depend on a template parameter, so a declaration of '__builtin_vsx_xvcvspsxds' must be available [-Wtemplate-body]

The patch updates Highway's feature guards to exclude PPC9 and PPC10 CPUs
from the code paths that rely on these VSX1 intrinsics. This forces
Highway to use the generic (non-intrinsic) fallback implementation that
works correctly on all PPC64LE processors.

See https://gitlab.alpinelinux.org/alpine/aports/-/merge_requests/88748

--- a/deps/v8/third_party/highway/src/hwy/ops/ppc_vsx-inl.h
+++ b/deps/v8/third_party/highway/src/hwy/ops/ppc_vsx-inl.h
@@ -3763,7 +3763,7 @@
 
 template <class D, HWY_IF_I64_D(D)>
 HWY_API VFromD<D> PromoteTo(D di64, VFromD<Rebind<float, D>> v) {
-#if !HWY_S390X_HAVE_Z14
+#if !HWY_S390X_HAVE_Z14 && !HWY_PPC9 && !HWY_PPC10
   const Repartition<float, decltype(di64)> dt_f32;
   const auto vt_f32 = ResizeBitCast(dt_f32, v);
   return detail::VsxXvcvspsxds(
@@ -3776,7 +3776,7 @@
 
 template <class D, HWY_IF_U64_D(D)>
 HWY_API VFromD<D> PromoteTo(D du64, VFromD<Rebind<float, D>> v) {
-#if !HWY_S390X_HAVE_Z14
+#if !HWY_S390X_HAVE_Z14 && !HWY_PPC9 && !HWY_PPC10
   const Repartition<float, decltype(du64)> dt_f32;
   const auto vt_f32 = ResizeBitCast(dt_f32, v);
   return detail::VsxXvcvspuxds(
@@ -3885,7 +3885,7 @@
 
 template <class D, HWY_IF_V_SIZE_D(D, 16), HWY_IF_I64_D(D)>
 HWY_API VFromD<D> PromoteUpperTo(D di64, Vec128<float> v) {
-#if !HWY_S390X_HAVE_Z14
+#if !HWY_S390X_HAVE_Z14 && !HWY_PPC9 && !HWY_PPC10
   (void)di64;
   return detail::VsxXvcvspsxds(
       detail::VsxF2INormalizeSrcVals(InterleaveUpper(Full128<float>(), v, v)));
@@ -3897,7 +3897,7 @@
 
 template <class D, HWY_IF_V_SIZE_D(D, 16), HWY_IF_U64_D(D)>
 HWY_API VFromD<D> PromoteUpperTo(D du64, Vec128<float> v) {
-#if !HWY_S390X_HAVE_Z14
+#if !HWY_S390X_HAVE_Z14 && !HWY_PPC9 && !HWY_PPC10
   (void)du64;
   return detail::VsxXvcvspuxds(
       detail::VsxF2INormalizeSrcVals(InterleaveUpper(Full128<float>(), v, v)));Full128<float>(), v, v))
