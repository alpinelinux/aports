# Contributor: Nicolas Lorin <androw95220@gmail.com>
# Maintainer: Micha≈Ç Adamski <michal@ert.pl>
pkgname=electrs
pkgver=0.11.0
pkgrel=0
pkgdesc="Efficient re-implementation of Electrum Server in Rust"
url="https://github.com/romanz/electrs"
license="MIT"
arch="all"
makedepends="
	cargo
	cargo-auditable
	clang21-libclang
	linux-headers
	rocksdb-dev
	rustfmt
	"
source="https://github.com/romanz/electrs/archive/v$pkgver/electrs-$pkgver.tar.gz"

build() {
	# Include cstdint header for electrs-librocksdb-sys
	# https://github.com/romanz/electrs/issues/1214
	CXXFLAGS="-include cstdint" \
	ROCKSDB_INCLUDE_DIR=/usr/include ROCKSDB_LIB_DIR=/usr/lib cargo auditable build --all --features "metrics_process" --release --locked
}

check() {
	CXXFLAGS="-include cstdint" \
	ROCKSDB_INCLUDE_DIR=/usr/include ROCKSDB_LIB_DIR=/usr/lib cargo test --all --release --locked
}

package() {
	install -Dm755 target/release/$pkgname -t "$pkgdir"/usr/bin
}

sha512sums="
607ad1c70536cbf5e14aad7d5c979e16f44d807b0b79a8300cc9f83a84db60c6fdd7b5efb6090d8eaccbbc4bd885f4b78aac49c4277045dfdfebbec89e3a0725  electrs-0.11.0.tar.gz
"
