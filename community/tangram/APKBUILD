# Contributor: knuxify <knuxify@gmail.com>
# Maintainer: knuxify <knuxify@gmail.com>
pkgname=tangram
pkgver=3.5
pkgrel=0
_troll_commit="8b0275948eedec9ed0378f9bdda1aa4aac3062ba"
pkgdesc="Browser for your pinned tabs"
url="https://apps.gnome.org/Tangram"
# armhf: blocked by gjs
arch="noarch !armhf"
license="GPL-3.0-or-later"
depends="
	gjs
	gtk4.0
	libadwaita
	webkit2gtk-6.0
	"
makedepends="
	appstream-glib
	blueprint-compiler
	coreutils
	desktop-file-utils
	gjs-dev
	glib-dev
	gtk4.0-dev
	libadwaita-dev
	meson
	"
subpackages="$pkgname-lang"
source="https://github.com/sonnyp/Tangram/archive/refs/tags/v$pkgver/Tangram-$pkgver.tar.gz
	troll-$_troll_commit.tar.gz::https://github.com/sonnyp/troll/archive/$_troll_commit.tar.gz
	busybox.patch
	"
builddir="$srcdir/Tangram-$pkgver"
options="!check" # no test suite

prepare() {
	default_prepare

	rm -r "$builddir"/troll
	mv "$srcdir"/troll-$_troll_commit "$builddir"/troll
}

build() {
	abuild-meson \
		. output
	meson compile -C output
}

check() {
	meson test --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

sha512sums="
5a65ec5f0d054fde5496b2af736513fb207b961c27277b0ad5ddd11da8e82a6db90f6362ae0c759b3f05b25c3033a3e3079133c1933c89a62648a2a217dc0cde  Tangram-3.5.tar.gz
a3476ea1017fd4f73f88dcbdca84e4cb55eabe9593549b5bd95da5fab9128816b8cb91c24abed970ca36d508746e481e3199829b4a0b6db80bea972c22f98afb  troll-8b0275948eedec9ed0378f9bdda1aa4aac3062ba.tar.gz
f733a74f3c65f5d4f24afcefa41421b41a2dc7727c7bb0698ea7b690624b885cf10cdb0e4548abab6b1316f2e592f25d39e0d40fa77f7264f844930321522452  busybox.patch
"
