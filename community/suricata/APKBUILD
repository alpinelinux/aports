# Contributor: Steve McMaster <code@mcmaster.io>
# Maintainer: Steve McMaster <code@mcmaster.io>
pkgname=suricata
pkgver=4.0.0
pkgrel=0
pkgdesc="High performance Network IDS, IPS and Network Security Monitoring engine"
url="https://suricata-ids.org/"
# luajit is not available for disabled arches
arch="all !s390x"
license="GPL-2"
makedepends="automake autoconf libtool libhtp-dev>=0.5.25 libcap-ng-dev
	file-dev luajit-dev geoip-dev pcre-dev yaml-dev libpcap-dev hiredis-dev
	libnet-dev libnetfilter_queue-dev libnfnetlink-dev jansson-dev python2
	nss-dev nspr-dev"
subpackages="$pkgname-doc"
source="http://www.openinfosecfoundation.org/download/$pkgname-$pkgver.tar.gz
	$pkgname.confd
	$pkgname.initd
	$pkgname.logrotate
	"
builddir="$srcdir/$pkgname-$pkgver"

prepare() {
	cd "$builddir"
	autoreconf -vif
}

build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var \
		--enable-non-bundled-htp \
		--enable-nfqueue \
		--disable-gccmarch-native \
		--enable-hiredis \
		--enable-geoip \
		--enable-gccprotect \
		--enable-pie \
		--enable-luajit \
		|| return 1
	make
}

check() {
	cd "$builddir"
	make check
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install
	make DESTDIR="$pkgdir" install-full

	cd "$srcdir"
	install -D -m 755 $pkgname.initd "$pkgdir"/etc/init.d/$pkgname
	install -D -m 644 $pkgname.confd "$pkgdir"/etc/conf.d/$pkgname
	install -D -m 644 $pkgname.logrotate "$pkgdir"/etc/logrotate.d/$pkgname
}
sha512sums="1dd386c36a74d1ab6bfa33db1dbde0dbe4f0045dc80f3304ece6b67a630b2a3eacf0b24e76f4501c55bf5ca65a7b54380da202425ca3873a06b3b5f759261453  suricata-4.0.0.tar.gz
ed7c78a80192f3f3ed433330df323beccb6079b5413289b9e9faa3fceea2c536de93de7372968d8605abd1618d73c9319ee39d86b16eed22e7313c8667252f5d  suricata.confd
258c6d60fc878dc1c7b7bf93cc758080050f591084a1edf7f1aac81ccb523c73615716616fedd0269f9ac5ef2fa7adcb3e2cefd714754bac5571e9806b6781be  suricata.initd
4f76a35bcde78c9860701897fe19bb84cc46bbc429124c4cb2e94cf3330f00ebe8067c0d7f3f83478e9b95323adb947e5081658f455657c4d03c682abe707534  suricata.logrotate"
