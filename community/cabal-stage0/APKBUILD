# Contributor: Steeve Chailloux <steeve.chailloux@orus.io>
# Contributor: Sören Tempel <soeren+alpine@soeren-tempel.net>
# Contributor: Mitch Tishmack <mitch.tishmack@gmail.com>
# Maintainer: Sören Tempel <soeren+alpine@soeren-tempel.net>
pkgname=cabal-stage0
pkgver=3.16.0.0
pkgrel=0
# GHC version used to bootstrap cabal via the ./bootstrap.py script.
_bootstrapver=9.10.3
pkgdesc="Cabal version used for bootstrapping"
url="https://haskell.org/cabal"
arch="aarch64 x86_64" # Limited by GHC
license="BSD-3-Clause"
depends="gmp zlib !cabal"
makedepends="ghc~$_bootstrapver gmp-dev libffi-dev zlib-dev python3"
options="!check"
source="$pkgname-$pkgver.tar.gz::https://github.com/haskell/cabal/archive/refs/tags/cabal-install-v$pkgver.tar.gz
	$pkgname-$pkgver-$_bootstrapver.tar.gz::https://dev.alpinelinux.org/archive/cabal-stage0/cabal-$pkgver-with-ghc-$_bootstrapver.tar.gz"
builddir="$srcdir/cabal-cabal-install-v$pkgver"

# Provide cabal-bootstrap for community/cabal.
# See comment in community/cabal for details.
provides="cabal-bootstrap=$pkgver-r$pkgrel"
provider_priority=1 # lowest

build() {
	./bootstrap/bootstrap.py --bootstrap-sources \
		"$srcdir/$pkgname-$pkgver-$_bootstrapver.tar.gz"
}

package() {
	install -m 755 -D _build/bin/cabal "$pkgdir/usr/bin/cabal"
	install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}

sha512sums="
785832f277661afd7b77f5b778d0bdaf678e918163f40c4a3e2e02bf839c50f16c314108e35b8d7605bb9b99325d1e0b7240118de9acf74f6516b7218596095b  cabal-stage0-3.16.0.0.tar.gz
89f2849369ed7a6eae0cff164f2083e26bd65916207bf9fc0f29f392ad0c9f98088e9e389ab183b158bae7387973937b4d7f3093b88a0fc015ad80bfd9d73372  cabal-stage0-3.16.0.0-9.10.3.tar.gz
"
