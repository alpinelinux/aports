Patch-Source: https://github.com/ximion/appstream-generator/commit/20010e3c85bc150cfa7c97dbb8802e758f656dcf
Backported for 0.10.1.
---
From 20010e3c85bc150cfa7c97dbb8802e758f656dcf Mon Sep 17 00:00:00 2001
From: Matthias Klumpp <matthias@tenstral.net>
Date: Mon, 3 Nov 2025 22:53:44 +0100
Subject: [PATCH] tests: Combine results and registry tests to make them
 order-independent

The tests had an implicit pseudo-dependency on each other, and somehow
the order randomly changed on recent Fedora releases (apparently the
compiler changed declaration order within the file? Even though that
shouldn't be possible...)

This patch removes the dependency, which hopefully addresses the test
failure.
---
 tests/meson.build    |  2 +-
 tests/tests-misc.cpp | 21 ++++++++++-----------
 2 files changed, 11 insertions(+), 12 deletions(-)

diff --git a/tests/tests-misc.cpp b/tests/tests-misc.cpp
index 30c21a5..c597200 100644
--- a/tests/tests-misc.cpp
+++ b/tests/tests-misc.cpp
@@ -332,9 +332,11 @@ TEST_CASE("Image size operations", "[utils][imagesize]")
     }
 }
 
-TEST_CASE("HintRegistry functionality", "[hintregistry]")
+TEST_CASE("GeneratorResult functionality", "[result]")
 {
-    using namespace ASGenerator;
+    /**
+     * HINTS REGISTRY
+     */
 
     SECTION("Load hints registry")
     {
@@ -415,14 +417,16 @@ TEST_CASE("HintRegistry functionality", "[hintregistry]")
         // Clean up
         fs::remove(tempFile);
     }
-}
 
-TEST_CASE("GeneratorResult functionality", "[result]")
-{
-    using namespace ASGenerator;
+    /**
+     * GENERATOR RESULT
+     */
 
     auto pkg = std::make_shared<DummyPackage>("foobar", "1.0.0", "amd64");
 
+    // Ensure hints registry is loaded
+    REQUIRE_NOTHROW(loadHintsRegistry());
+
     SECTION("Basic GeneratorResult operations")
     {
         GeneratorResult result(pkg);
@@ -439,9 +443,6 @@ TEST_CASE("GeneratorResult functionality", "[result]")
     {
         GeneratorResult result(pkg);
 
-        // Ensure hints registry is loaded
-        loadHintsRegistry();
-
         // Add a hint with component ID
         std::unordered_map<std::string, std::string> vars = {
             {"icon_fname",      "test.png" },
@@ -464,7 +465,6 @@ TEST_CASE("GeneratorResult functionality", "[result]")
     SECTION("Generate hints JSON")
     {
         GeneratorResult result(pkg);
-        loadHintsRegistry();
 
         // Add some hints
         const std::unordered_map<std::string, std::string> &vars = {
@@ -497,7 +497,6 @@ TEST_CASE("GeneratorResult functionality", "[result]")
     SECTION("Move semantics")
     {
         GeneratorResult result1(pkg);
-        loadHintsRegistry();
         result1.addHint("test.component", "icon-not-found");
 
         // Test move constructor
