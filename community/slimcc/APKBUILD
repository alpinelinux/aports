# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=slimcc
pkgver=0_git20260108
_gitrev=ff77023a41c2fbd58e0a9d7c7062aa989c185853
pkgrel=0
pkgdesc="C11 compiler with C23/C2y/GNU extensions"
url="https://github.com/fuhsnn/slimcc"
arch="x86_64"
license="MIT"
depends="
	binutils
	musl-dev
	slimcc-headers~$pkgver
	"
source="https://github.com/fuhsnn/slimcc/archive/$_gitrev/slimcc-$_gitrev.tar.gz
	abuild-default-cflags.patch
	include-path.patch
	"
builddir="$srcdir/$pkgname-$_gitrev"

prepare() {
	default_prepare

	ln -sv platform/linux-alpine.c platform.c
}

build() {
	make CFLAGS="${CFLAGS//-Os/-O2} -flto=auto"
}

check() {
	make test-all
}

package() {
	install -Dvm755 slimcc -t "$pkgdir"/usr/bin/
	install -Dvm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
}

sha512sums="
7c29476eae8cb412c4b7a40920522f07dc92b84a9bc1d4200d00345451e23b2b4c79b4b69dfe4fadef265a4b628664c9ad84576f8762d43d5a85e579c579514b  slimcc-ff77023a41c2fbd58e0a9d7c7062aa989c185853.tar.gz
549755b6274818c041e3dd621f54c8e62ea00427a8dad19df18c9f165b5db58513c3d09f7e0e928cc5acb0c249772cb00483c11ea6289ea593a1af18f3c2e2bd  abuild-default-cflags.patch
133d7a03a3936871c6d5774f6442edbcb3d5dfb6c757a4d942ab4df08e869bae80a889b86d6da1598cdf9e1de98c17579b1b1a68703971342e18fc3bd2acb200  include-path.patch
"
