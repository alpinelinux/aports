# Contributor: Willow Barraco <contact@willowbarraco.fr>
maintainer="Achill Gilgenast <achill@achill.org>"
pkgname=wl-mirror
pkgver=0.18.4
pkgrel=0
pkgdesc="A simple Wayland output mirror client"
url="https://github.com/Ferdi265/wl-mirror"
license="GPL-3.0-or-later"
arch="all"
makedepends="
	cmake
	mesa-dev
	samurai
	scdoc
	wayland-dev
	wayland-protocols
	"
subpackages="
	wl-present:wl_present:noarch
	wl-present-bash-completion:wl_present_bashcomp:noarch
	wl-present-doc:wl_present_doc:noarch
	wl-present-zsh-completion:wl_present_zshcomp:noarch
	$pkgname-bash-completion
	$pkgname-doc
	$pkgname-zsh-completion
	"
source="https://github.com/Ferdi265/wl-mirror/releases/download/v$pkgver/wl-mirror-$pkgver.tar.gz"
options="!check" # no test suite

build() {
	cmake -B build -G Ninja \
		-DCMAKE_BUILD_TYPE=MinSizeRel \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DINSTALL_DOCUMENTATION=ON \
		-DINSTALL_EXAMPLE_SCRIPTS=ON \
		-DWITH_GBM=ON \
		-DWLR_PROTOCOL_DIR="$builddir/proto/wlr-protocols"
	cmake --build build
}

package() {
	DESTDIR="$pkgdir" cmake --install build

	install -Dm644 scripts/completions/bash-completions/_wl-mirror \
		"$pkgdir"/usr/share/bash-completion/completions/wl-mirror
	install -Dm644 scripts/completions/zsh-completions/_wl-mirror \
		"$pkgdir"/usr/share/zsh/site-functions/_wl-mirror
}

wl_present() {
	pkgdesc="Start $pkgname and control the mirrored output and region"
	depends="bash pipectl $pkgname"

	amove usr/bin/wl-present
}

wl_present_bashcomp() {
	pkgdesc="Bash completions for wl-present"
	install_if="wl-present=$pkgver-r$pkgrel bash-completion"

	install -Dm644 "$builddir"/scripts/completions/bash-completions/_wl-present \
		"$subpkgdir"/usr/share/bash-completion/completions/wl-present
}

wl_present_doc() {
	pkgdesc="Start $pkgname and control the mirrored output and region (documentation)"
	install_if="wl-present=$pkgver-r$pkgrel docs"

	gzip -n -9 "$pkgdir"/usr/share/man/man1/wl-present.1
	amove usr/share/man/man1/wl-present.1.gz
}

wl_present_zshcomp() {
	pkgdesc="Zsh completions for wl-present"
	install_if="wl-present=$pkgver-r$pkgrel zsh"

	install -Dm644 "$builddir"/scripts/completions/zsh-completions/_wl-present \
		"$subpkgdir"/usr/share/zsh/site-functions/_wl-present
}

sha512sums="
3fcf05187256270312506264681498233e07a1928c76cf4fd9df97e90f4d6e9f5ed1a2ffa26983dfd528a03dd6557221000b78e028264a88ead02c0acbb8ba93  wl-mirror-0.18.4.tar.gz
"
