# Contributor: Kevin Daudt <kdaudt@alpinelinux.org>
# Contributor: Will Sinatra <wpsinatra@gmail.com>
maintainer="leso-kn <info@lesosoftware.com>"
pkgname=go-swag
pkgver=1.16.6
pkgrel=0
pkgdesc="Automatically generate RESTful API documentation with Swagger 2.0 for Go"
url="https://github.com/swaggo/swag"
arch="all"
license="MIT"
makedepends="make go"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/swaggo/swag/archive/refs/tags/v$pkgver.tar.gz"
options="net"
builddir="$srcdir/swag-$pkgver"

export GOCACHE="${GOCACHE:-"$srcdir/go-cache"}"
export GOTMPDIR="${GOTMPDIR:-"$srcdir"}"
export GOMODCACHE="${GOMODCACHE:-"$srcdir/go"}"

build() {
	make build
}

check() {
	# do not NOT as root! some tests fail if run as root.
	export GOROOT="/usr/lib/go"

	if [ "$CARCH" = "riscv64" ]; then
		# TestGen_BuildDescriptionWithQuotes makes use of 'go build -buildmode=plugin' which is not supported on riscv64.
		go test -run '!(^(TestGen_BuildDescriptionWithQuotes)$)' ./...
	else
		make test
	fi
}

package() {
	install -Dm644 license "$pkgdir"/usr/share/licenses/$pkgname/LICENSE

	install -Dm0755 swag "$pkgdir"/usr/bin/go-swag
	ln -s /usr/bin/go-swag "$pkgdir/usr/bin/swag"
}

sha512sums="
4302704925e5ecc2f6ab0dc5db1395f1f9a356fdd917168b6f53d30e7de4f9814d252c3c918d47c8339395cf1108966a0d559e62ac2a81376d90bd9932dc5383  go-swag-1.16.6.tar.gz
"
