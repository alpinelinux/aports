# Contributor: Valery Kartel <valery.kartel@gmail.com>
# Contributor: Stefan Wagner <stw@bit-strickerei.de>
# Maintainer: Valery Kartel <valery.kartel@gmail.com>
pkgname=opendkim
pkgver=2.10.3
pkgrel=5
pkgdesc="DKIM signing and verifying filter for MTAs"
url="http://www.opendkim.org"
arch="all"
license="custom"
depends=""
makedepends="libressl-dev libmilter-dev"
pkgusers="opendkim"
pkggroups="opendkim"
subpackages="$pkgname-dev $pkgname-doc $pkgname-libs $pkgname-dbg $pkgname-utils"
install="$pkgname.pre-install $pkgname.post-install"
source="http://downloads.sourceforge.net/project/$pkgname/$pkgname-$pkgver.tar.gz
	$pkgname.confd
	$pkgname.initd"
builddir="$srcdir"/$pkgname-$pkgver

build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc/$pkgname \
		|| return 1
	make || return 1
}

package() {
	cd "$builddir"
	# add libressl to depends. need for post-install script
	depends="$depends libressl"
	make DESTDIR="$pkgdir" install || return 1
	install -dm750 -u $pkgusers -g mail "$pkgdir"/var/db/dkim
	install -dm750 -g $pkggroups "$pkgdir"/etc/$pkgname
	mv "$pkgdir"/usr/share/doc/$pkgname/$pkgname.conf.simple \
		"$pkgdir"/etc/$pkgname/$pkgname.conf
+	install -d "$pkgdir"/usr/share/licenses/$pkgname;
	mv "$pkgdir"/usr/share/doc/$pkgname/LICENSE* \
		"$pkgdir"/usr/share/licenses/$pkgname
	install -Dm755 "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
	install -Dm644 "$srcdir"/$pkgname.confd "$pkgdir"/etc/conf.d/$pkgname
}

utils() {
	pkgdesc="$pkgdesc (key and zone utilities)"
	depends="$depends perl"
	install -d "$subpkgdir"/usr/bin
	mv "$pkgdir"/usr/sbin/$pkgname-* "$subpkgdir"/usr/bin
	rm -fr "$pkgdir"/usr/lib
}

md5sums="916e691cdd16cfabd1cd6efe745323f9  opendkim-2.10.3.tar.gz
57210e7c36bd81680c09e3857f3cae19  opendkim.confd
1aed4c15264c13945c67f2ffd52e4691  opendkim.initd"
sha256sums="43a0ba57bf942095fe159d0748d8933c6b1dd1117caf0273fa9a0003215e681b  opendkim-2.10.3.tar.gz
e3f737b54130e2ba91a7d232902b1f34778a73e1cb289fd30ad0066249c7909e  opendkim.confd
9b671a85c6743e17ad4045ed52dd35a5a5ec5bf6fdf7a67765f7c25a50eb00ef  opendkim.initd"
sha512sums="97923e533d072c07ae4d16a46cbed95ee799aa50f19468d8bc6d1dc534025a8616c3b4b68b5842bc899b509349a2c9a67312d574a726b048c0ea46dd4fcc45d8  opendkim-2.10.3.tar.gz
1dd6ed6e4efd93463f8eeb4603e72cf3a77f0a70117164a34b45bf0d2f45d4520b62c86696f7d180cff61a73201253c1ff875efdcd5317d631118776db665ea1  opendkim.confd
9cba06445cfbd8d5188e118969a9e3452add911788f590c5517d66687b8a8745a3d60ce3793dcafa88cf50a31ade80d995fb2166caf118181ca064e959702d17  opendkim.initd"
