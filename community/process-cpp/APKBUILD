# Maintainer: Luca Weiss <luca@lucaweiss.eu>
pkgname=process-cpp
pkgver=3.0.3
pkgrel=0
pkgdesc="A simple convenience library for handling processes in C++11"
url="https://gitlab.com/ubports/core/lib-cpp/process-cpp"
arch="all"
license="LGPL-3.0-only"
depends_dev="properties-cpp-dev"
makedepends="$depends_dev cmake cmake-extras boost-dev gtest-dev samurai"
subpackages="$pkgname-dev"
source="https://gitlab.com/ubports/core/lib-cpp/process-cpp/-/archive/$pkgver/process-cpp-$pkgver.tar.gz
	no-execinfo.patch
	gcc12.patch
	"
options="!check" # Tests are randomly failing

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		CMAKE_CROSSOPTS="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake3.5 -B build -G Ninja \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=None \
		-DPROCESS_CPP_ENABLE_DOC_GENERATION=OFF \
		-DPROCESS_CPP_WERROR=OFF \
		$CMAKE_CROSSOPTS .
	cmake --build build
}

check() {
	cd build
	ctest -E "linux_process_test"
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="
f4a46e53127c99beef57f4acd7d92cfebff4c1544b46f26690c43026cc5bbeb334a72397e3fdb52f223baf67fe0b5e22ac02f11b948df9fdfe26661f38d248a4  process-cpp-3.0.3.tar.gz
bf0e76f19594c19e1b598398fe7fc8f202182406dc7659f2fb9d346c451ba74599cf75ac7606a959c4c06b827a191d90d2afd5adf1a07e7e26df315bad68ab2a  no-execinfo.patch
15f47d9e1c6333f7861e535804f9bcc530bba47e7717a635a5720da39cce0f198867b577e95f42b9f1014e82e43deceabfe137e80eb9c8984945b0c4646c4362  gcc12.patch
"
