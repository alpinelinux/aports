# Maintainer: Marian Buschsieweke <marian.buschsieweke@ovgu.de>
pkgname=intel-ucode
pkgver=20191112
pkgrel=0
pkgdesc="Microcode update files for Intel CPUs"
arch="x86 x86_64"
url="https://downloadcenter.intel.com/SearchResult.aspx?lang=eng&keyword=%22microcode%22"
license="custom"
makedepends="iucode-tool"
source="https://github.com/intel/Intel-Linux-Processor-Microcode-Data-Files/archive/microcode-$pkgver.tar.gz"
options="!check"
builddir="$srcdir/Intel-Linux-Processor-Microcode-Data-Files-microcode-$pkgver"

build() {
	rm -f intel-ucode/list intel-ucode-with-caveats/list
	mkdir -p kernel/x86/microcode
	iucode_tool -w kernel/x86/microcode/GenuineIntel.bin \
		intel-ucode/ intel-ucode-with-caveats/
	echo kernel/x86/microcode/GenuineIntel.bin | \
		 cpio -o -H newc -R 0:0 > intel-ucode.img
}

package() {
	install -D -m0644 intel-ucode.img "$pkgdir"/boot/intel-ucode.img
	install -Dm644 license "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
}

sha512sums="34cebf266f9d6cc38b0dd87f8c7fcf42f3c8d9e434560328b0811b4c4834d0f253d834f53bfaf5b4c561bb153b4bcf509620131046bf0afd6038d02bf9a25a13  microcode-20191112.tar.gz"
