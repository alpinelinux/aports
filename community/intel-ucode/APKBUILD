# Maintainer: Marian Buschsieweke <marian.buschsieweke@ovgu.de>
pkgname=intel-ucode
pkgver=20190618
pkgrel=0
pkgdesc="Microcode update files for Intel CPUs"
arch="x86 x86_64"
url="https://downloadcenter.intel.com/SearchResult.aspx?lang=eng&keyword=%22microcode%22"
license="custom"
makedepends="iucode-tool"
source="https://github.com/intel/Intel-Linux-Processor-Microcode-Data-Files/archive/microcode-$pkgver.tar.gz"
options="!check"
builddir="$srcdir/Intel-Linux-Processor-Microcode-Data-Files-microcode-$pkgver"

build() {
	rm -f intel-ucode/list intel-ucode-with-caveats/list
	mkdir -p kernel/x86/microcode
	iucode_tool -w kernel/x86/microcode/GenuineIntel.bin \
		intel-ucode/ intel-ucode-with-caveats/
	echo kernel/x86/microcode/GenuineIntel.bin | \
		 cpio -o -H newc -R 0:0 > intel-ucode.img
}

package() {
	install -D -m0644 intel-ucode.img "$pkgdir"/boot/intel-ucode.img
	install -Dm644 license "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
}

sha512sums="f7717f476465705e14ea26b516cf7b1d04e29842da0924d7da5582346ad5dd5dfd8755041bdca8f3afa7fe64f138e91354498d87006fe4487701242858c24c17  microcode-20190618.tar.gz"
