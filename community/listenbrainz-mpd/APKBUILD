# Contributor: Matthias Ahouansou <matthias@ahouansou.cz>
# Maintainer: Matthias Ahouansou <matthias@ahouansou.cz>
pkgname=listenbrainz-mpd
pkgver=2.4.0
pkgrel=0
pkgdesc="ListenBrainz submission client for MPD written in Rust"
url="https://codeberg.org/elomatreb/listenbrainz-mpd"
arch="all"
license="AGPL-3.0-only"
makedepends="
	cargo
	cargo-auditable
	openssl-dev
	sqlite-dev
"
subpackages="
	$pkgname-doc
	$pkgname-openrc
	$pkgname-bash-completion
	$pkgname-zsh-completion
	$pkgname-fish-completion
"
source="
	$pkgname-$pkgver.tar.gz::https://codeberg.org/elomatreb/listenbrainz-mpd/archive/v$pkgver.tar.gz
	listenbrainz-mpd.initd
"
builddir="$srcdir/$pkgname"
options="net !check" # no tests

prepare() {
	default_prepare
	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen --all-features
}

package() {
	install -Dm755 target/release/listenbrainz-mpd "$pkgdir"/usr/bin/listenbrainz-mpd

	install -Dm644 listenbrainz-mpd.adoc -t "$pkgdir"/usr/share/doc/$pkgname/
	install -Dm644 LICENSE.txt "$pkgdir"/usr/share/licenses/$pkgname/LICENSE

	install -m755 -D "$srcdir"/"$pkgname".initd "$pkgdir"/etc/user/init.d/"$pkgname"

	install -Dm644 generated_completions/listenbrainz-mpd.bash "$pkgdir"/usr/share/bash-completion/completions/listenbrainz-mpd
	install -Dm644 generated_completions/listenbrainz-mpd.fish "$pkgdir"/usr/share/fish/vendor_completions.d/listenbrainz-mpd.fish
	install -Dm644 generated_completions/_listenbrainz-mpd "$pkgdir"/usr/share/zsh/site-functions/_listenbrainz-mpd
}

sha512sums="
69702dd6b6cf9b7d83424fb84a269221ea4f8aa4ee5bc29d7d21aed68919a5f2865160449de5ce63b5262ad7f6bcf4a02b7d919ef099489aa746a00607c78ca1  listenbrainz-mpd-2.4.0.tar.gz
719eae559a637ee619abebd7d9ba1f9b49c8cf88f913fc6b9d015c7d01de49b2f40645a34e6d88bb2c60eb3e3ae679864825f38bd8b08888b4c0f6c012459a34  listenbrainz-mpd.initd
"
