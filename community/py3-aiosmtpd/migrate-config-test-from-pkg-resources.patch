Patch-Source: https://github.com/aio-libs/aiosmtpd/commit/98f578389ae86e5345cc343fa4e5a17b21d9c96d
---
From 98f578389ae86e5345cc343fa4e5a17b21d9c96d Mon Sep 17 00:00:00 2001
From: John Bucy <bucy@gloop.org>
Date: Wed, 18 Jun 2025 12:32:04 -0700
Subject: [PATCH] migrate config_test from pkg_resources to importlib_resources
 (#557)

---
 aiosmtpd/tests/conftest.py | 13 ++++++++++---
 1 file changed, 10 insertions(+), 3 deletions(-)

diff --git a/aiosmtpd/tests/conftest.py b/aiosmtpd/tests/conftest.py
index 0c691031..e66b80bb 100644
--- a/aiosmtpd/tests/conftest.py
+++ b/aiosmtpd/tests/conftest.py
@@ -12,7 +12,7 @@
 from typing import Any, Callable, Generator, NamedTuple, Optional, Type, TypeVar
 
 import pytest
-from pkg_resources import resource_filename
+import importlib.resources
 from pytest_mock import MockFixture
 
 from aiosmtpd.controller import Controller
@@ -73,8 +73,15 @@ def set_addr_from(cls, contr: Controller):
 # If less than 1.0, might cause intermittent error if test system
 # is too busy/overloaded.
 AUTOSTOP_DELAY = 1.5
-SERVER_CRT = resource_filename("aiosmtpd.tests.certs", "server.crt")
-SERVER_KEY = resource_filename("aiosmtpd.tests.certs", "server.key")
+# https://importlib-resources.readthedocs.io/en/latest/migration.html
+# this assumes these files are already present in the filesystem so
+# it doesn't need to extract a tempfile for the context manager to clean up
+ref = importlib.resources.files("aiosmtpd.tests.certs") / "server.crt"
+with importlib.resources.as_file(ref) as path:
+    SERVER_CRT = str(path)
+ref = importlib.resources.files("aiosmtpd.tests.certs") / "server.key"
+with importlib.resources.as_file(ref) as path:
+    SERVER_KEY = str(path)
 
 # endregion
 
