# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=simde
pkgver=0.8.2
pkgrel=0
pkgdesc="Implementations of SIMD instruction sets"
url="https://github.com/simd-everywhere/simde"
arch="noarch"
license="MIT"
makedepends="meson"
subpackages="$pkgname-dev"
source="$pkgname-$pkgver.tar.gz::https://github.com/simd-everywhere/simde/archive/refs/tags/v$pkgver.tar.gz
musl-compatibility.patch
disable-tests.patch"

build() {
	abuild-meson -Db_lto=true . output
	meson compile -C output
}

check() {
	meson test --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
	mkdir -p "$pkgdir"/usr/include/simde/
	cp simde/musl-roundeven-compat.h "$pkgdir"/usr/include/simde/
}

sha512sums="
4e42d7140c0afae507773527c6c0c07e6f0cdad59a1d42ebcf4bd223fc9f71e91a2e3db7746aca3c0c5ad2a13333c2322ce1e384c7d699ddfe33bed6f107aec5  simde-0.8.2.tar.gz
d4560988a1f0bd5978ee1c88f2baa72fa1182c7a75609bc7d7a841d75d98f24db0c2d5b068aab60f264b9a661841346e975b0d436ab7c09a7b70f7fd8507d1aa  musl-compatibility.patch
7eb661416f51a0a0ee2e4b26064cf6b81256a4f54c24d07f055358b82468ccd0d59a9a69e3a51ab3522e552c2b3d70a350e5696dc2a5d232f97c954d7ec5a33f  disable-tests.patch
"
