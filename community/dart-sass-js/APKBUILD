# Contributor: knuxify <knuxify@gmail.com>
# Maintainer: knuxify <knuxify@gmail.com>
pkgname=dart-sass-js
pkgver=1.97.2
pkgrel=0
pkgdesc="The reference implementation of Sass, written in Dart (JS/Node version)"
url="https://sass-lang.com/dart-sass/"
arch="noarch"
license="MIT"
depends="nodejs"
makedepends="npm"
source="https://registry.npmjs.org/sass/-/sass-$pkgver.tgz"
options="!check"
builddir="$srcdir"

unpack() {
	# skipping unpacking, installing archive directly
	verify
}

package() {
	# Need to omit optional since it contains @parcel/watcher which has a C++ binary
	npm install \
		--global \
		--prefix "$pkgdir/usr" \
		--omit=optional \
		"$srcdir/sass-$pkgver.tgz"
	# TODO: --omit=optional does not seem to work with the --global flag
	# (https://github.com/npm/cli/issues/8284), so we have to remove
	# @parcel/watcher manually
	rm -r "$pkgdir"/usr/lib/node_modules/sass/node_modules/@parcel
	chown -R root: "$pkgdir" # npm installs as build user
}

sha512sums="
cb92d66f42256cee1ef7b66bedcde696969b71b06d4be89e899f62c03a284a1a452965dfeb6cf3e6910f770acb626f81c67d5f9dbc051b31ee08b480f6d066af  sass-1.97.2.tgz
"
