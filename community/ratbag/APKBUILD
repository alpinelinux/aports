# Contributor: Clayton Craft <clayton@craftyguy.net>
# Maintainer: Clayton Craft <clayton@craftyguy.net>
pkgname=ratbag
pkgver=0.18
pkgrel=0
pkgdesc="DBus daemon to configure input devices, mainly gaming mice"
url="https://github.com/libratbag/libratbag"
arch="all"
license="MIT"
depends="dbus"
makedepends="
	elogind-dev
	eudev-dev
	glib-dev
	json-glib-dev
	libevdev-dev
	libunistring-dev
	meson
	py3-gobject3-dev
	python3-dev
	swig
"
checkdepends="check-dev py3-gobject3 py3-evdev"
subpackages="$pkgname-dev $pkgname-doc $pkgname-tools:_tools"
source="$pkgname-$pkgver.tar.gz::https://github.com/libratbag/libratbag/archive/refs/tags/v$pkgver.tar.gz
	gcc14.patch
"
builddir="$srcdir/libratbag-$pkgver"

build() {
	abuild-meson \
		-Db_lto=true \
		-Dsystemd=false \
		-Dlogind-provider=elogind \
		-Dtests="$(want_check && echo true || echo false)" \
		. output
	meson compile -C output
}

check() {
	meson test --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

_tools() {
	pkgdesc="ratbag cli tools"
	depends="python3 py3-evdev py3-gobject3"

	amove usr/bin/ratbagctl
	amove usr/bin/lur-command
}

sha512sums="
ae1796d738f7e448c6022c56cb876af5fb43e29b89fef31bbf42b9c838a07fd1d6cf94815dfde87dcd94a72bae159ca14624826b75cf83c988ba4c20340031cb  ratbag-0.18.tar.gz
48aa63bd283c070b78a9301cafcb60e09dd7a7576d8b5058095c1162b4607e23f9c3c9a5b4f42d10de2c5e32590bf84c26979b7d94ac075fedde443ba2770024  gcc14.patch
"
