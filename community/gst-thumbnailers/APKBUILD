maintainer="team/gnome <achill@achill.org>"
pkgname=gst-thumbnailers
pkgver=1.0_alpha3
_pkgver=${pkgver/_alpha/.alpha.}
pkgrel=0
pkgdesc="Thumbnail generator using GStreamer"
url="https://gitlab.gnome.org/GNOME/gst-thumbnailers"
arch="noarch"
license="GPL-3.0-only"
depends="gst-audio-thumbnailer gst-video-thumbnailer"
makedepends="
	cargo
	cargo-auditable
	gst-plugins-base-dev
	libglycin-dev
	meson
	"
subpackages="gst-audio-thumbnailer:audio:all gst-video-thumbnailer:video:all"
source="https://gitlab.gnome.org/GNOME/gst-thumbnailers/-/archive/$_pkgver/gst-thumbnailers-$_pkgver.tar.gz
	cargo-auditable.patch
	"
builddir="$srcdir/$pkgname-$_pkgver"
options="!check" # hangs

build() {
	abuild-meson \
		output .
	meson compile -C output
}

check() {
	meson test --print-errorlogs -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

audio() {
	pkgdesc="$pkgdesc (audio)"
	depends=
	amove usr/bin/gst-audio-thumbnailer
	amove usr/share/thumbnailers/gst-audio-thumbnailer.thumbnailer
}

video() {
	pkgdesc="$pkgdesc (video)"
	depends=
	amove usr/bin/gst-video-thumbnailer
	amove usr/share/thumbnailers/gst-video-thumbnailer.thumbnailer
}

sha512sums="
f144471bb4784e0cde734dbd58f6438febcec99fd6006180028557ae623b42618828bcbb56110b1d3112784d6f3dc5e9c3ff4d3fab6a653bd3848fad0ee54fc7  gst-thumbnailers-1.0.alpha.3.tar.gz
c202d7d673966fa6a767bc5f2019fc82a8cdd73b01fd61095667c25e9cba15f3b6c10a055ddfef6a6e879d6c3c57a47d29fdee99f4af3f37cdf45df4136ccea2  cargo-auditable.patch
"
