--- a/configure.ac
+++ b/configure.ac
@@ -43,7 +43,7 @@ DAV_CHECK_NEON
 # Checks for header files.
 AC_HEADER_DIRENT
 AC_HEADER_STDC
-AC_CHECK_HEADERS([fcntl.h iconv.h libintl.h langinfo.h limits.h locale.h mntent.h stddef.h stdint.h stdlib.h string.h sys/file.h sys/mount.h sys/time.h syslog.h termios.h unistd.h utime.h])
+AC_CHECK_HEADERS([error.h fcntl.h iconv.h libintl.h langinfo.h limits.h locale.h mntent.h stddef.h stdint.h stdlib.h string.h sys/file.h sys/mount.h sys/time.h sys/select.h sys/types.h syslog.h termios.h unistd.h utime.h])
 
 # Checks for typedefs, structures, and compiler characteristics.
 AC_C_CONST
@@ -79,7 +79,7 @@ AC_FUNC_SELECT_ARGTYPES
 AC_FUNC_STRFTIME
 AC_FUNC_STAT
 AC_FUNC_UTIME_NULL
-AC_CHECK_FUNCS([endpwent ftruncate getmntent iconv memset mkdir nl_langinfo rpmatch select setlocale strcasecmp strchr strdup strerror strpbrk strrchr strstr strtol strtoull utime])
+AC_CHECK_FUNCS([endpwent ftruncate getmntent memset mkdir nl_langinfo rpmatch select setlocale strcasecmp strchr strdup strerror strpbrk strrchr strstr strtol strtoull utime canonicalize_file_name fopencookie])
 
 # Misc.
 DAV_DEFAULTS
--- a/src/cache.c
+++ b/src/cache.c
@@ -19,6 +19,7 @@
 
 
 #include "config.h"
+#include "compat.h"
 
 #ifdef HAVE_DIRENT_H
 #include <dirent.h>
--- a/src/dav_fuse.c
+++ b/src/dav_fuse.c
@@ -48,6 +48,9 @@
 #ifdef HAVE_SYS_STAT_H
 #include <sys/stat.h>
 #endif
+#ifdef HAVE_SYS_SELECT_H
+#include <sys/select.h>
+#endif
 
 #include "defaults.h"
 #include "mount_davfs.h"
--- a/src/kernel_interface.c
+++ b/src/kernel_interface.c
@@ -20,6 +20,7 @@
 
 
 #include "config.h"
+#include "compat.h"
 
 #ifdef HAVE_FCNTL_H
 #include <fcntl.h>
@@ -52,6 +53,9 @@
 #ifdef HAVE_SYS_STAT_H
 #include <sys/stat.h>
 #endif
+#ifdef HAVE_SYS_TYPES_H
+#include <sys/types.h>
+#endif
 #include <sys/wait.h>
 
 #include "util.h"
--- a/src/mount_davfs.c
+++ b/src/mount_davfs.c
@@ -19,6 +19,7 @@
 
 
 #include "config.h"
+#include "compat.h"
 
 #include <ctype.h>
 #ifdef HAVE_FCNTL_H
@@ -75,7 +76,9 @@
 #include <sys/sysctl.h>
 #endif
 
+#if defined(__GLIBC__)
 #include <fstab.h>
+#endif
 
 #include <ne_string.h>
 #include <ne_uri.h>
@@ -142,8 +145,10 @@ check_dirs(dav_args *args);
 static char *
 check_double_mounts(dav_args *args);
 
+#if defined(__GLIBC__)
 static void
 check_fstab(const dav_args *args);
+#endif
 
 static void
 check_permissions(dav_args *args);
@@ -239,8 +244,10 @@ main(int argc, char *argv[])
     if (seteuid(getuid()) != 0)
         ERR(_("can't change effective user id"));
 
+#if defined(__GLIBC__)
     if (getuid() != 0)
         check_fstab(args);
+#endif
 
     parse_config(args);
 
@@ -661,6 +668,7 @@ check_double_mounts(dav_args *args)
 }
 
 
+#if defined(__GLIBC__)
 /* Checks fstab whether there is an entry for the mountpoint specified in args
    and compares the values in args with the values in fstab.
    If there is no such entry, or this entry does not allow user-mount, or the
@@ -750,6 +758,7 @@ check_fstab(const dav_args *args)
 
     delete_args(n_args);
 }
+#endif
 
 
 /* The mounting user must be either root or meet the following conditions:
--- a/src/umount_davfs.c
+++ b/src/umount_davfs.c
@@ -19,6 +19,7 @@
 
 
 #include "config.h"
+#include "compat.h"
 
 #include <getopt.h>
 #ifdef HAVE_LIBINTL_H
--- a/src/util.h
+++ b/src/util.h
@@ -67,7 +67,6 @@
 #endif
 
 #ifdef __linux__
-#include <error.h>
 #define ERR_AT_LINE(filename, lineno, fmt, ...) \
     error_at_line(EXIT_FAILURE, 0, filename, lineno, fmt, ## __VA_ARGS__);
 #endif
--- a/src/webdav.c
+++ b/src/webdav.c
@@ -19,6 +19,7 @@
 
 
 #include "config.h"
+#include "compat.h"
 
 #ifdef HAVE_FCNTL_H
 #include <fcntl.h>
@@ -367,6 +368,7 @@ dav_init_webdav(const dav_args *args)
         ERR(_("socket library initialization failed"));
 
     if (args->neon_debug & ~NE_DBG_HTTPPLAIN) {
+#ifdef HAVE_FOPENCOOKIE
         char *buf = malloc(log_bufsize);
         cookie_io_functions_t *log_func = malloc(sizeof(cookie_io_functions_t));
         if (!log_func) abort();
@@ -378,6 +380,9 @@ dav_init_webdav(const dav_args *args)
         if (!log_stream)
             ERR(_("can't open stream to log neon-messages"));
         ne_debug_init(log_stream, args->neon_debug);
+#else
+	error(EXIT_FAILURE, 0, "neon debugging unsupported");
+#endif
     }
 
     session = ne_session_create(args->scheme, args->host, args->port);

--- /dev/null
+++ b/src/compat.h
@@ -0,0 +1,64 @@
+#ifndef _COMPAT_H
+#define _COMPAT_H
+
+#ifndef _PATH_MOUNTED
+# define _PATH_MOUNTED "/proc/mounts"
+#endif
+
+#ifndef _PATH_MNTTAB
+# define _PATH_MNTTAB "/etc/fstab"
+#endif
+
+#ifdef HAVE_ERROR_H
+# include <error.h>
+#else
+# include <stdio.h>
+# include <stdarg.h>
+# include <stdlib.h>
+# include <string.h>
+static void error_at_line(int status, int errnum, const char *filename,
+                          unsigned int linenum, const char *format, ...)
+{
+	va_list ap;
+
+	fflush(stdout);
+
+	if (filename != NULL)
+		fprintf(stderr, "%s:%u: ", filename, linenum);
+
+	va_start(ap, format);
+	vfprintf(stderr, format, ap);
+	va_end(ap);
+
+	if (errnum != 0)
+		fprintf(stderr, ": %s", strerror(errnum));
+
+	fprintf(stderr, "\n");
+
+	if (status != 0)
+		exit(status);
+}
+
+#define error(status, errnum, format...) \
+	error_at_line(status, errnum, NULL, 0, format)
+
+#endif /* HAVE_ERROR_H */
+
+#ifndef HAVE_CANONICALIZE_FILE_NAME
+#include <limits.h>
+#include <string.h>
+#include <stdlib.h>
+static char * canonicalize_file_name(const char *path)
+{
+	char buf[PATH_MAX] = { };
+
+	snprintf(buf, sizeof(buf) - 1, "%s", path);
+
+	if (!realpath(path, buf))
+		return NULL;
+
+	return strdup(buf);
+}
+#endif
+
+#endif /* _COMPAT_H */
