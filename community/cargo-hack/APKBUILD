maintainer="Paolo Barbolini <paolo.barbolini@m4ss.net>"
pkgname=cargo-hack
pkgver=0.6.41
pkgrel=0
pkgdesc="Cargo subcommand to provide various options useful for testing and continuous integration."
url="https://github.com/taiki-e/cargo-hack"
arch="all"
license="MIT OR Apache-2.0"
makedepends="
	cargo
	cargo-auditable
	"
subpackages="$pkgname-doc"
# Cargo.lock extracted from https://static.crates.io/crates/cargo-hack/cargo-hack-$pkgver.crate
source="
	$pkgname-$pkgver.tar.gz::https://github.com/taiki-e/cargo-hack/archive/refs/tags/v$pkgver.tar.gz
	Cargo.lock
"
# net: cargo fetch
# !check: tests expect to be running in a git checkout
options="net !check"

prepare() {
	default_prepare

	cp "$srcdir"/Cargo.lock .
	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
}

package() {
	install -Dm755 target/release/cargo-hack -t "$pkgdir"/usr/bin/

	install -Dm 644 README.md -t "$pkgdir"/usr/share/doc/"$pkgname"/
	install -Dm 644 LICENSE-MIT -t "$pkgdir"/usr/share/licenses/"$pkgname"/
	install -Dm 644 LICENSE-APACHE -t "$pkgdir"/usr/share/licenses/"$pkgname"/
}

sha512sums="
758b0307c24864b8de3b6c3ec6d794c768aaeb5be7251b3e88af38d3057dbd29fc9c7bee592d2a133983abaa9f7633487e81f605e67cb521ebafaa0b5c2006c9  cargo-hack-0.6.41.tar.gz
8f8563d52523e1c74261dde51d1c0b355272a3cd476b73128e99cc55cfc5e6b33be498e028c4288e31ca9d721b3b7b84cf1554f29d98f208dc703187fb664557  Cargo.lock
"
