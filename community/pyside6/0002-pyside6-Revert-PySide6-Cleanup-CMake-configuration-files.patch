From 1a1ebe30660324653e4f5975ae40f89e99737724 Mon Sep 17 00:00:00 2001
From: Bart Ribbers <bribbers@disroot.org>
Date: Tue, 11 Nov 2025 18:57:31 +0100
Subject: [PATCH] Revert "PySide6: Cleanup CMake configuration files"

This reverts commit 05e328476f2d6ef8a0f3f44aca1e5b1cdb7499fc.
---
 sources/pyside6/cmake/PySideSetup.cmake       |  1 -
 sources/pyside6/libpyside/CMakeLists.txt      | 37 +++++++------------
 .../libpyside/PySide6Config-spec.cmake.in     |  4 --
 3 files changed, 14 insertions(+), 28 deletions(-)

diff --git a/sources/pyside6/cmake/PySideSetup.cmake b/sources/pyside6/cmake/PySideSetup.cmake
index 72d6a1ccf..71c820646 100644
--- a/sources/pyside6/cmake/PySideSetup.cmake
+++ b/sources/pyside6/cmake/PySideSetup.cmake
@@ -52,7 +52,6 @@ set(BINDING_API_MINOR_VERSION "${pyside_MINOR_VERSION}")
 set(BINDING_API_MICRO_VERSION "${pyside_MICRO_VERSION}")
 set(BINDING_API_PRE_RELEASE_VERSION_TYPE "${pyside_PRE_RELEASE_VERSION_TYPE}")
 set(BINDING_API_PRE_RELEASE_VERSION "${pyside_PRE_RELEASE_VERSION}")
-set(pyside6_library_so_version "${SHIBOKEN_SO_VERSION}")
 
 # Detect if the Python interpreter is actually PyPy
 execute_process(
diff --git a/sources/pyside6/libpyside/CMakeLists.txt b/sources/pyside6/libpyside/CMakeLists.txt
index 75c232874..089e1c74e 100644
--- a/sources/pyside6/libpyside/CMakeLists.txt
+++ b/sources/pyside6/libpyside/CMakeLists.txt
@@ -146,29 +146,28 @@ configure_file("${CMAKE_CURRENT_SOURCE_DIR}/pyside6.pc.in"
 include(CMakePackageConfigHelpers)
 
 # Build-tree / super project package config file.
-set(PYSIDE_PYTHONPATH "${PYTHON_SITE_PACKAGES}/PySide6")
-set(PYSIDE_TYPESYSTEMS "${CMAKE_INSTALL_PREFIX}/share/PySide6${pyside6_SUFFIX}/typesystems")
-set(PYSIDE_GLUE "${CMAKE_INSTALL_PREFIX}/share/PySide6${pyside6_SUFFIX}/glue")
+set(PYSIDE_PYTHONPATH "${pysidebindings_BINARY_DIR}/PySide6")
+set(PYSIDE_TYPESYSTEMS "${pysidebindings_SOURCE_DIR}/PySide6/templates/")
+set(PYSIDE_GLUE "${pysidebindings_SOURCE_DIR}/PySide6/glue")
 
 configure_package_config_file(
     "${CMAKE_CURRENT_SOURCE_DIR}/PySide6Config-spec.cmake.in"
     "${CMAKE_CURRENT_BINARY_DIR}/PySide6Config${SHIBOKEN_PYTHON_CONFIG_SUFFIX}.cmake"
-    INSTALL_DESTINATION "${CMAKE_CURRENT_BINARY_DIR}"
-    PATH_VARS PYSIDE_PYTHONPATH PYSIDE_TYPESYSTEMS PYSIDE_GLUE
-    INSTALL_PREFIX "${CMAKE_CURRENT_BINARY_DIR}"
+     INSTALL_DESTINATION "${CMAKE_CURRENT_BINARY_DIR}"
+     PATH_VARS PYSIDE_PYTHONPATH PYSIDE_TYPESYSTEMS PYSIDE_GLUE
+     INSTALL_PREFIX "${CMAKE_CURRENT_BINARY_DIR}"
 )
 
-# Install-tree / wheel configuration
-set(PYSIDE_PYTHONPATH "")
-set(PYSIDE_TYPESYSTEMS "typesystems")
-set(PYSIDE_GLUE "glue")
-set(PYSIDE_SOVERSION "${pyside6_library_so_version}")
+set(PYSIDE_PYTHONPATH "${PYTHON_SITE_PACKAGES}/PySide6")
+set(PYSIDE_TYPESYSTEMS "${CMAKE_INSTALL_PREFIX}/share/PySide6${pyside6_SUFFIX}/typesystems")
+set(PYSIDE_GLUE "${CMAKE_INSTALL_PREFIX}/share/PySide6${pyside6_SUFFIX}/glue")
 
+# Install-tree / relocatable package config file.
 configure_package_config_file(
     "${CMAKE_CURRENT_SOURCE_DIR}/PySide6Config-spec.cmake.in"
     "${CMAKE_CURRENT_BINARY_DIR}/install/PySide6Config${SHIBOKEN_PYTHON_CONFIG_SUFFIX}.cmake"
-    INSTALL_DESTINATION "${LIB_INSTALL_DIR}/cmake/PySide6"
-    PATH_VARS PYSIDE_PYTHONPATH PYSIDE_TYPESYSTEMS PYSIDE_GLUE
+     INSTALL_DESTINATION "${LIB_INSTALL_DIR}/cmake/PySide6"
+     PATH_VARS PYSIDE_PYTHONPATH PYSIDE_TYPESYSTEMS PYSIDE_GLUE
 )
 
 configure_file("${CMAKE_CURRENT_SOURCE_DIR}/PySide6Config.cmake.in"
@@ -179,20 +178,12 @@ configure_file("${CMAKE_CURRENT_SOURCE_DIR}/PySide6ConfigVersion.cmake.in"
 install(FILES ${libpyside_HEADERS}
         DESTINATION ${BINDING_NAME}${pyside6_SUFFIX}/include)
 
-# build-time installation
 install(TARGETS pyside6 EXPORT PySide6Targets
                         LIBRARY DESTINATION "${LIB_INSTALL_DIR}"
                         ARCHIVE DESTINATION "${LIB_INSTALL_DIR}"
                         RUNTIME DESTINATION bin)
-
-# wheel installation
-set_target_properties(pyside6 PROPERTIES
-    VERSION ${PYSIDE_SOVERSION})
-
-install(TARGETS pyside6 EXPORT PySide6WheelTargets
-                        LIBRARY DESTINATION "PySide6"
-                        ARCHIVE DESTINATION "PySide6"
-                        RUNTIME DESTINATION "PySide6")
+install(EXPORT PySide6Targets NAMESPACE PySide6::
+        DESTINATION "${LIB_INSTALL_DIR}/cmake/PySide6")
 
 install(FILES "${CMAKE_CURRENT_BINARY_DIR}/pyside6${pyside6_SUFFIX}.pc"
         DESTINATION "${LIB_INSTALL_DIR}/pkgconfig")
diff --git a/sources/pyside6/libpyside/PySide6Config-spec.cmake.in b/sources/pyside6/libpyside/PySide6Config-spec.cmake.in
index f9e9a4900..fd3de1e75 100644
--- a/sources/pyside6/libpyside/PySide6Config-spec.cmake.in
+++ b/sources/pyside6/libpyside/PySide6Config-spec.cmake.in
@@ -10,10 +10,6 @@ if (NOT TARGET PySide6::pyside6)
     include("${CMAKE_CURRENT_LIST_DIR}/PySide6Targets.cmake")
 endif()
 
-# set static variables
-set(PYSIDE_PYTHON_CONFIG_SUFFIX "@PYTHON_CONFIG_SUFFIX@")
-set(PYSIDE_SO_VERSION "@pyside6_library_so_version@")
-
 # Set relocatable variables.
 set_and_check(PYSIDE_PYTHONPATH "@PACKAGE_PYSIDE_PYTHONPATH@")
 set_and_check(PYSIDE_TYPESYSTEMS "@PACKAGE_PYSIDE_TYPESYSTEMS@")
-- 
2.51.2

