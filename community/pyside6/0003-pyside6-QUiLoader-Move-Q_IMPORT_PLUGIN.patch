From b11f1db3f7e49f0b9a19862e736a2c9ebda531f6 Mon Sep 17 00:00:00 2001
From: Friedemann Kleint <Friedemann.Kleint@qt.io>
Date: Tue, 29 Jul 2025 09:58:29 +0200
Subject: [PATCH] QUiLoader: Move Q_IMPORT_PLUGIN(PyCustomWidgets) to file
 scope

Adapt to qtbase/82eb0fc09e048b6074a9205e371a8c17576b421a.

Task-number: PYSIDE-3011
Change-Id: Id6aeab28948c54572069bca676c944327282a7ba
Reviewed-by: Shyamnath Premnadh <Shyamnath.Premnadh@qt.io>
---
 sources/pyside6/PySide6/QtUiTools/typesystem_uitools.xml | 3 ++-
 sources/pyside6/plugins/uitools/CMakeLists.txt           | 2 +-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/sources/pyside6/PySide6/QtUiTools/typesystem_uitools.xml b/sources/pyside6/PySide6/QtUiTools/typesystem_uitools.xml
index 9cfa176c8..c8e98d96f 100644
--- a/sources/pyside6/PySide6/QtUiTools/typesystem_uitools.xml
+++ b/sources/pyside6/PySide6/QtUiTools/typesystem_uitools.xml
@@ -13,7 +13,8 @@
         <include file-name="glue/plugins.h" location="local"/>
       </extra-includes>
       <inject-code class="native" position="beginning" file="../glue/qtuitools.cpp" snippet="uitools-loadui"/>
-      <inject-code file="../glue/qtuitools.cpp" snippet="quiloader"/>
+      <inject-code class="native" position="beginning"
+                   file="../glue/qtuitools.cpp" snippet="quiloader"/>
       <add-function signature="registerCustomWidget(PyObject*@customWidgetType@)" return-type="void">
          <inject-documentation format="target" mode="append" file="../doc/qtuitools.rst"
                                snippet="quiloader-registercustomwidget"/>
diff --git a/sources/pyside6/plugins/uitools/CMakeLists.txt b/sources/pyside6/plugins/uitools/CMakeLists.txt
index 06d0ae900..f111109f1 100644
--- a/sources/pyside6/plugins/uitools/CMakeLists.txt
+++ b/sources/pyside6/plugins/uitools/CMakeLists.txt
@@ -18,7 +18,7 @@ add_library(uiplugin STATIC ${ui_plugin_src})
 if(CMAKE_HOST_UNIX AND NOT CYGWIN)
     add_definitions(-fPIC)
 endif()
-add_definitions(-DQT_STATICPLUGIN)
+add_compile_definitions(QT_STATICPLUGIN)
 
 set_property(TARGET pyside6 PROPERTY CXX_STANDARD 17)
 
-- 
2.51.2

