# Contributor: Dermot Bradley <dermot_bradley@yahoo.com>
# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=hd-idle
pkgver=1.22
pkgrel=1
pkgdesc="Spin down idle hard disks"
url="https://github.com/adelolmo/hd-idle"
arch="all"
license="GPL-3.0-only"
makedepends="
	go
	"
subpackages="
	$pkgname-doc
	$pkgname-logrotate
	$pkgname-openrc
	"
options="!check" # There are no testcases
source="https://github.com/adelolmo/hd-idle/archive/v$pkgver/hd-idle-$pkgver.tar.gz
	hd-idle.confd
	hd-idle.initd
	hd-idle.logrotate
	"

export GOCACHE="${GOCACHE:-"$srcdir/go-cache"}"
export GOTMPDIR="${GOTMPDIR:-"$srcdir"}"
export GOMODCACHE="${GOMODCACHE:-"$srcdir/go"}"

build() {
	go build -o hd-idle hdidle.go main.go
}

package() {
	install -Dvm755 hd-idle -t "$pkgdir"/usr/sbin/

	install -Dvm644 "$srcdir"/hd-idle.confd "$pkgdir"/etc/conf.d/hd-idle
	install -Dvm755 "$srcdir"/hd-idle.initd "$pkgdir"/etc/init.d/hd-idle
	install -Dvm644 "$srcdir"/hd-idle.logrotate "$pkgdir"/etc/logrotate.d/hd-idle

	install -Dvm644 debian/hd-idle.8 -t "$pkgdir"/usr/share/man/man8/
}

logrotate() {
	pkgdesc="$pkgdesc (logrotate configuration)"
	depends=""
	install_if="$pkgname=$pkgver-r$pkgrel logrotate"

	amove etc/logrotate.d/hd-idle
}

sha512sums="
28c4707fe0fbc73b683756a47e3c7680c8eb5737a4205f975f7e6fcb6d7322557de3feafbf55eb5705091e795a8ee70c25ff86f1b60f63d5f3aa76e93beb5478  hd-idle-1.22.tar.gz
6a159e6fb0517a560e98a1389b105609d7d6c10c22ac905520a5f5d47da1a6f01ab6cc90a95f61b17f405bae2bd230ff5256502ac697ed5ff0107e2d4a7517b8  hd-idle.confd
3b3319636b463af92748a4967e44311f8caebe2c869ba5289bb11bec2cdbad5e798a5a75a9bb81b14727404e9328e9444f298748348864171322c07d8f72608a  hd-idle.initd
ec89ea63060c4684d892eae45ea686617620a966c873e863e9e7449418bc4d8c28e3175b050e89857c6ac4a969e71cebc99bba792e1e0c0af787fb246b0d9629  hd-idle.logrotate
"
