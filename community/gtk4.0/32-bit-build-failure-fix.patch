From ca58e397dc3cc96027ea724be61de002f36064cb Mon Sep 17 00:00:00 2001
From: Benjamin Otte <otte@redhat.com>
Date: Fri, 21 Nov 2025 10:07:31 +0100
Subject: [PATCH 1/2] vulkan: Don't treat Vulkan objects as pointers or 32bit
 breaks

Fixes: #7883
Part-of: <https://gitlab.gnome.org/GNOME/gtk/-/merge_requests/9170>
---
 gdk/gdkvulkancontext.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/gdk/gdkvulkancontext.c b/gdk/gdkvulkancontext.c
index 79a2cde5968..6d7781d9d56 100644
--- a/gdk/gdkvulkancontext.c
+++ b/gdk/gdkvulkancontext.c
@@ -692,7 +692,7 @@ gdk_vulkan_present_is_busy (GdkVulkanContext *self,
 {
   VkResult res;
 
-  if (present->vk_swapchain == NULL)
+  if (!present->vk_swapchain)
     return FALSE;
 
   if (!present->vk_fence)
@@ -1200,7 +1200,7 @@ gdk_vulkan_context_surface_detach (GdkDrawContext *context)
       if (priv->presents[i].vk_swapchain)
         {
           gdk_vulkan_context_unref_swapchain (self, priv->presents[i].vk_swapchain);
-          priv->presents[i].vk_swapchain = NULL;
+          priv->presents[i].vk_swapchain = VK_NULL_HANDLE;
         }
       vkDestroySemaphore (vk_device,
                           priv->presents[i].vk_semaphore,
-- 
GitLab


From 8af38ff007eff69338ff7be2bd7cb22c846d121f Mon Sep 17 00:00:00 2001
From: Benjamin Otte <otte@redhat.com>
Date: Fri, 21 Nov 2025 10:08:12 +0100
Subject: [PATCH 2/2] Fix a few profiler messges for 32bit

Related: #7883
Part-of: <https://gitlab.gnome.org/GNOME/gtk/-/merge_requests/9170>
---
 gdk/gdkmemoryformat.c  | 2 +-
 gdk/gdkvulkancontext.c | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/gdk/gdkmemoryformat.c b/gdk/gdkmemoryformat.c
index fb989b8db16..0476ca6f5f3 100644
--- a/gdk/gdkmemoryformat.c
+++ b/gdk/gdkmemoryformat.c
@@ -6614,7 +6614,7 @@ gdk_memory_mipmap_same_format_linear (gpointer data)
     }
 
   ADD_MARK (before,
-            "Mipmap linear (thread)", "size %lux%lu, lod %u, %lu rows",
+            "Mipmap linear (thread)", "size %zux%zu, lod %u, %zu rows",
             mipmap->src_layout.width, mipmap->src_layout.height, mipmap->lod_level, rows);
 }
 
diff --git a/gdk/gdkvulkancontext.c b/gdk/gdkvulkancontext.c
index 6d7781d9d56..0a578e1e490 100644
--- a/gdk/gdkvulkancontext.c
+++ b/gdk/gdkvulkancontext.c
@@ -1533,7 +1533,7 @@ gdk_vulkan_save_pipeline_cache (GdkDisplay *display)
     }
 
   gdk_profiler_end_markf (begin_time,
-                          "Save Vulkan pipeline cache", "%s size %lu",
+                          "Save Vulkan pipeline cache", "%s size %zu",
                           g_file_peek_path (file), size);
 
   g_object_unref (file);
-- 
GitLab

