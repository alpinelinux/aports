# Maintainer: TBK <alpine@jjtc.eu>
# Contributer: TBK <alpine@jjtc.eu>
pkgname=unifi
_pkgname=UniFi
pkgver=5.5.24
pkgrel=0
pkgdesc="The UniFi Controller allows you to manage Wireless, Routing & Switching, VoIP and Video of Ubiquiti Networks."
url="http://wiki.ubnt.com/UniFi_FAQ"
arch="noarch"
license="UniFi-EULA"
depends="openjdk8-jre-base java-snappy mongodb"
install="$pkgname.pre-install"
subpackages="$pkgname-doc"
source="$pkgname-$pkgver.zip::https://dl.ubnt.com/$pkgname/$pkgver/$_pkgname.unix.zip
        $pkgname.confd
        $pkgname.initd
        $pkgname.logrotated
        "
builddir="$srcdir/$_pkgname"

prepare(){
	cd "$builddir"
          
	rm -rf lib/native
}

package() {
	local destdir="${pkgdir}/usr/lib/${pkgname}"

	cd "$builddir"

	install -Dm644 "$srcdir"/$pkgname.logrotated \
		"$pkgdir"/etc/logrotate.d/$pkgname
	install -Dm755 "$srcdir"/$pkgname.initd \
		"$pkgdir"/etc/init.d/$pkgname
	install -Dm644 "$srcdir"/$pkgname.confd \
		"$pkgdir"/etc/conf.d/$pkgname

	install -Dm644 readme.txt \
		"$pkgdir"/usr/share/doc/$pkgname/readme.txt

	rm readme.txt

	local dir; for dir in work data run logs conf dl lib webapps; do
		mkdir -p -m755 "$destdir/$dir"
	done

        cp -R * "$destdir"

        ln -sf /usr/bin/mongod "$destdir"/bin/mongod
        ln -sf /usr/share/java/snappy-java.jar "$destdir"/lib/snappy-java-1.1.2.6.jar
}
sha512sums="aaf8ce0679d7b9605e10c717efe8b676638891f15916e75003d897881ba6df5dcebb2818df769164efcb6e97265a2fdccaea34638a62e2fc6bb0072e12e78ba3  unifi-5.5.24.zip
ebbfb27f98955c3228ac327afdc81b914a496e1293ee38a9b602eaa16189c84829fbd46abff0bc4a792a186049fc18009639e96918bcd3797fe79f186d22a140  unifi.confd
e5f8e748440d85c8cf3ebe4233e2f1bef5ca0c7398368bca4791fb9bdbc49663cf3ead9b33cef525361f293c1904b5a0fba12b8f326957b9c612dcb19c8b9851  unifi.initd
c4293d5908b7a843044c9f9645232c7a385f92384eb52b040039ead1cbc4f8902e7276ac9650b2842d8014ce06cdd1de445a55c84d80dcf994626fbf356bdf65  unifi.logrotated"
