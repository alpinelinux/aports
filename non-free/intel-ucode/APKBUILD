# Maintainer: Marian Buschsieweke <marian.buschsieweke@ovgu.de>
pkgname=intel-ucode
pkgver=20180807a
pkgrel=0
pkgdesc="Microcode update files for Intel CPUs"
arch=noarch
url="https://downloadcenter.intel.com/SearchResult.aspx?lang=eng&keyword=%22microcode%22"
license="custom"
source="https://downloadmirror.intel.com/28087/eng/microcode-$pkgver.tgz
	LICENSE
	intel-microcode2ucode.c"
options="!check"

build() {
	cd "$srcdir"
	gcc -Wall ${CFLAGS} -o intel-microcode2ucode intel-microcode2ucode.c
	./intel-microcode2ucode ./microcode.dat
}

package() {
	cd "$srcdir"
  
	install -d -m755 "$pkgdir"/boot
	mkdir -p kernel/x86/microcode
	mv microcode.bin kernel/x86/microcode/GenuineIntel.bin

	echo kernel/x86/microcode/GenuineIntel.bin | \
		 cpio -o -H newc -R 0:0 > "$pkgdir"/boot/intel-ucode.img
  
	install -Dm644 LICENSE "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
}

sha512sums="3cd6794a5ce26e86f7b644e523ba978699316046e593da215b73b17c4b43049ac4a81636e2ce3e727d06c2efbac98657764aa3ff355edb429127585bb49a9b10  microcode-20180807a.tgz
d80ce9087e2ffd0168600a34de195d6514d3a496bc233294cd838498e1ce668b9ad4463bbbe7958feec0421b5aed3ade1633432ce086241e03ed06bbd53b83a5  LICENSE
ee60f968acab4067f5660449eabae533b5d3996cd59fd4b69d0e23e0b264da216ab6e6ccd554222cf355fc14dbd348562a2d36a87a60f1f54433603e04998cd1  intel-microcode2ucode.c"
