# Contributor: Francesco Colista <fcolista@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=libks
pkgver=2.0.8
pkgrel=0
pkgdesc="Foundational support for signalwire C products"
url="https://github.com/signalwire/libks"
arch="all"
license="MIT"
makedepends="cmake samurai util-linux-dev openssl-dev>3"
subpackages="$pkgname-dev $pkgname-doc"
source="$pkgname-$pkgver.tar.gz::https://github.com/signalwire/libks/archive/refs/tags/v$pkgver.tar.gz
	disable-failing-tests.patch
	fix-deadlock.patch
	"

build() {
	cmake -B . -G Ninja \
		-DCMAKE_BUILD_TYPE=MinSizeRel \
		-DCMAKE_INSTALL_PREFIX=/usr
	cmake --build .
}

check() {
	ctest --test-dir .
}

package() {
	DESTDIR="$pkgdir" cmake --install .
}

sha512sums="
eafac957b4e2f78c89bc77934a9b0bd1d2e0d149f5b72b03cb13c592c761ba014a8ab99eed201bec9d059fe6d27d2a2a7b5517aa264464a6ac91beb5cc29a378  libks-2.0.8.tar.gz
aa260e2ccb45be79f6623c8fccff531569a62655e70149b48df6282cad3477dc8404d035553b3cc8f2b1cae5077ab36947e7e15bbf19d9ab2235208bf4653d4c  disable-failing-tests.patch
5a692f15e82c82c634948c9bde3cd182b4106f3b3931db2a36cab271a54f3cfccbf10b9154efcbb4bd51ffd2a1f0eac0736706d8690e632e0e026edae8d69828  fix-deadlock.patch
"
