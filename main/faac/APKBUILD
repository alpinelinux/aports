# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=faac
pkgver=1.28
pkgrel=8
pkgdesc="FAAC is an AAC audio encoder."
url="http://www.audiocoding.com/"
arch="all"
license="GPL custom"
subpackages="$pkgname-dev $pkgname-doc"
depends=
makedepends="autoconf automake libtool"
source="http://downloads.sourceforge.net/sourceforge/$pkgname/$pkgname-$pkgver.tar.gz
	automake.patch
"

prepare() {
        cd "$srcdir/$pkgname-$pkgver"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
	#taken from http://bugs.sourcemage.org/show_bug.cgi?id=15263
	if [ "$ALPINE_LIBC" = "eglibc" ]; then
		sed -i \
			"s/^\(.*strcasestr\)/\/\/ This is in libc and conflicts: \1 /" \
			common/mp4v2/mpeg4ip.h
	fi
}

build() {
	cd "$srcdir"/$pkgname-$pkgver
	./bootstrap || return 1
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		|| return 1
	make || return 1
}

package() {
	cd "$srcdir"/$pkgname-$pkgver
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la || return 1
	install -D -m644 "$srcdir"/$pkgname-$pkgver/libfaac/kiss_fft/COPYING \
		"$pkgdir"/usr/share/licenses/faac/COPYING.kiss_fft
}
md5sums="80763728d392c7d789cde25614c878f6  faac-1.28.tar.gz
5a52db11e04cce0a7a32bc8565a7aa60  automake.patch"
