# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=gamin
pkgver=0.1.10
pkgrel=10
pkgdesc="Gamin is a file and directory monitoring system defined to be a subset of the FAM (File Alteration Monitor) system."
url="http://www.gnome.org/~veillard/gamin"
arch="all"
license="GPL"
subpackages="$pkgname-dev py-$pkgname:py"
depends=
makedepends="glib-dev python2-dev"
source="https://www.gnome.org/~veillard/$pkgname/sources/$pkgname-$pkgver.tar.gz
	fix-deprecated-const.patch
	fix-pthread-mutex.patch"

builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	cd "$builddir"
	update_config_sub
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i;;
		esac
	done
}

build() {
	cd "$builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--disable-static \
		--with-threads \
		--disable-debug-api \
		--disable-debug \
		--disable-dnotify \
		--libexecdir=/usr/lib/gamin
	make
}

package() {
	cd "$builddir"
	# some kinde of race in the make install which is not solved with -j
	export MKDIRPROG="mkdir -p"
	make DESTDIR="$pkgdir" install
}

py() {
	pkgdesc="Python bindings for the gamin library"
	mkdir -p "$subpkgdir"/usr/lib
	mv "$pkgdir"/usr/lib/python* "$subpkgdir"/usr/lib/
}

sha512sums="21bfe6fcf8fb3117cd5a08c8ce3b8d0d1dd23e478e60a95b76c20d02cc29b050dde086578d81037990484ff891c3e104d2cbbf3d294b4a79346b14a0cae075bb  gamin-0.1.10.tar.gz
c4c10bee70c7231db395cbfe5bdf513ade6be599a11a9d35888ddfaca42d619fe2b5e87c2b2bab469ea98ba718bc01711252313ba5f53c392379b669f5b2902b  fix-deprecated-const.patch
70628fc39521ea8bc4a40b009d0881f6ee540334a31b2f0cb67dde0f75808c69feb78088ad24c3c4a0dec9fa59e87960fd81d1a2e56963ce9268d0a5e14f88e8  fix-pthread-mutex.patch"
