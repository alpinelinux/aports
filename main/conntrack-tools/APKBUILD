# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=conntrack-tools
pkgver=1.4.4
pkgrel=0
pkgdesc="Connection tracking userspace tools"
url="http://conntrack-tools.netfilter.org"
arch="all"
license="GPL-2.0-or-later"
subpackages="$pkgname-doc"
depends=
makedepends="linux-headers libnfnetlink-dev libnetfilter_conntrack-dev bison flex
	libmnl-dev libnetfilter_cttimeout-dev libnetfilter_cthelper-dev
	libnetfilter_queue-dev libtirpc-dev"
source="https://www.netfilter.org/projects/conntrack-tools/files/$pkgname-$pkgver.tar.bz2
	conntrackd.initd
	conntrackd.confd
	"

builddir="$srcdir"/$pkgname-$pkgver
prepare() {
	cd "$builddir"
	update_config_sub
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i;;
		esac
	done
}

build() {
	cd "$builddir"
	export CFLAGS="$CFLAGS -D_GNU_SOURCE `pkgconf --cflags libtirpc`"
	export LDFLAGS="$LDFLAGS `pkgconf --libs libtirpc`"

	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr
	make
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" install

	install -Dm755 ../conntrackd.initd "$pkgdir"/etc/init.d/conntrackd
	install -Dm644 ../conntrackd.confd "$pkgdir"/etc/conf.d/conntrackd
	install -Dm644 doc/stats/conntrackd.conf \
		"$pkgdir"/etc/conntrackd/conntrackd.conf
}

sha512sums="f53bd620bfd4e854e792416527a3090d883c5f00d1d8365e52ce3ba204218dc431490703985d3fdae44decbcddb24ed610bf81a6a99bd7ea01482f95f71df0f5  conntrack-tools-1.4.4.tar.bz2
1d8e6d6eec79233b276d12e78c5d184d356df85ede299bfa9f6967ace30987f3b2f8c8077a1e2f9123a817f2805fdb9bf8fa9ec441882a112d83cabf84932e16  conntrackd.initd
fd8cfab207867844db6671a8395efadca792d6085c3436381e574dc52f3b4e41d9526b3db6114dd98e534a5419ca19f291d21c091f8cf0426024d73d18133e6f  conntrackd.confd"
