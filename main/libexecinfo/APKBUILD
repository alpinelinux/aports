# Contributor: Philipp Andronov <filipp.andronov@gmail.com>
# Maintainer: Matt Smith <mcs@darkregion.net>

pkgname=libexecinfo
pkgver=1.1
pkgrel=0
pkgdesc="A quick-n-dirty BSD licensed clone of the GNU libc backtrace facility."
url="https://www.freshports.org/devel/libexecinfo"
arch="all"
license="BSD"
depends=
makedepends=
install=
subpackages="${pkgname}-dev"
source="http://distcache.freebsd.org/local-distfiles/itetcu/$pkgname-$pkgver.tar.bz2
	10-execinfo.patch
	20-define-gnu-source.patch
	30-linux-makefile.patch
	"

builddir="$srcdir"/$pkgname-$pkgver

prepare() {
	cd "$builddir"
	patch -p0 -i "$srcdir"/10-execinfo.patch
	patch -p0 -i "$srcdir"/20-define-gnu-source.patch
	patch -p0 -i "$srcdir"/30-linux-makefile.patch
}

build() {
	cd "$builddir"
	export CFLAGS="${CFLAGS} -fno-omit-frame-pointer"
	make
}

package() {
	cd "$builddir"

	install -D -m755 "$builddir"/execinfo.h \
		"$pkgdir"/usr/include/execinfo.h
	install -D -m755 "$builddir"/stacktraverse.h \
		"$pkgdir"/usr/include/stacktraverse.h
	install -D -m755 "$builddir"/libexecinfo.a \
		"$pkgdir"/usr/lib/libexecinfo.a
	install -D -m755 "$builddir"/libexecinfo.so.1 \
		"$pkgdir"/usr/lib/libexecinfo.so.1
	ln -s /usr/lib/libexecinfo.so.1 \
		"$pkgdir"/usr/lib/libexecinfo.so
}

