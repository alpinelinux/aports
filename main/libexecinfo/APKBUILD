# Contributor: Philipp Andronov <filipp.andronov@gmail.com>
# Maintainer: Matt Smith <mcs@darkregion.net>

pkgname=libexecinfo
pkgver=1.1
pkgrel=0
pkgdesc="A quick-n-dirty BSD licensed clone of the GNU libc backtrace facility."
url="https://www.freshports.org/devel/libexecinfo"
arch="all"
license="BSD"
depends=
makedepends=
install=
subpackages="${pkgname}-dev"
source="http://distcache.freebsd.org/local-distfiles/itetcu/$pkgname-$pkgver.tar.bz2
	10-execinfo.patch
	20-define-gnu-source.patch
	30-linux-makefile.patch
	"

builddir="$srcdir"/$pkgname-$pkgver

prepare() {
	cd "$builddir"
	patch -p0 -i "$srcdir"/10-execinfo.patch
	patch -p0 -i "$srcdir"/20-define-gnu-source.patch
	patch -p0 -i "$srcdir"/30-linux-makefile.patch
}

build() {
	cd "$builddir"
	export CFLAGS="${CFLAGS} -fno-omit-frame-pointer"
	make
}

package() {
	cd "$builddir"

	install -D -m755 "$builddir"/execinfo.h \
		"$pkgdir"/usr/include/execinfo.h
	install -D -m755 "$builddir"/stacktraverse.h \
		"$pkgdir"/usr/include/stacktraverse.h
	install -D -m755 "$builddir"/libexecinfo.a \
		"$pkgdir"/usr/lib/libexecinfo.a
	install -D -m755 "$builddir"/libexecinfo.so.1 \
		"$pkgdir"/usr/lib/libexecinfo.so.1
	ln -s /usr/lib/libexecinfo.so.1 \
		"$pkgdir"/usr/lib/libexecinfo.so
}

sha512sums="51fea7910ef6873061a25c22434ce4da724e9d8e37616a069ad0a58c0463755be4c6c7da88cd747484c2f3373909d7be4678b32a4bd91b6d9e0f74526094e92c  libexecinfo-1.1.tar.bz2
a38f75d305518d3432807735456b32b223e89e0d08860e2dfafb5ad3b507de92d4fa60e4bb11978e3dbf20d68be05da42237ced7db625304b49a5288b90be232  10-execinfo.patch
f335effbbb5425a4b1031fd8a4358f777825a5979f099d01357fab5715065e9f7439f118d155f124b1a15b1e91cd3a4e9a20793806d121f605775f148aea0102  20-define-gnu-source.patch
3596aef8c6d0593afd063c2295ede3473d33afa52eafa5258bb48fcd472a36f987196c7de647b2b408a5a02138de9f36253d93f7a9f061e2bb6082fc429acb76  30-linux-makefile.patch"
