# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer: Carlo Landmeter <clandmeter@gmail.com>
pkgname=libxml2
pkgver=2.9.1
pkgrel=5
pkgdesc="XML parsing library, version 2"
url="http://www.xmlsoft.org/"
arch="all"
license="MIT"
depends=
depends_dev="zlib-dev python-dev"
makedepends="zlib-dev python-dev"
subpackages="$pkgname-doc $pkgname-dev py-$pkgname:py $pkgname-utils"
source="ftp://ftp.xmlsoft.org/${pkgname}/${pkgname}-${pkgver}.tar.gz
	libxml2-pthread.patch
	CVE-2014-0191.patch
	CVE-2015-1819.patch
	CVE-2015-5312.patch
	CVE-2015-7497.patch
	CVE-2015-7498.patch
	CVE-2015-7499-1.patch
	CVE-2015-7499-2.patch
	CVE-2015-7500.patch
	CVE-2015-7941_1.patch
	CVE-2015-7941_2.patch
	CVE-2015-7942.patch
	CVE-2015-7942-2.patch
	CVE-2015-8035.patch
	CVE-2015-8241.patch
	CVE-2015-8242.patch
	CVE-2015-8317-1.patch
	CVE-2015-8317-2.patch
	"

options="!strip"

_builddir="$srcdir/$pkgname-$pkgver"
prepare() {
	cd "$_builddir"
	update_config_sub || return 1
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		|| return 1
	make
}

package() {
	cd "$_builddir"
	make -j1 DESTDIR="$pkgdir" install
	rm "$pkgdir"/usr/lib/*.la \
		"$pkgdir"/usr/lib/python*/site-packages/*.la \
		|| return 1

	install -Dm644 COPYING "$pkgdir"/usr/share/licenses/$pkgname/COPYING
}

py() {
	cd "$_builddir"
	pkgdesc="$pkgname python bindings"
	install -d "$subpkgdir"/usr/lib
	mv "$pkgdir"/usr/lib/python* "$subpkgdir"/usr/lib/
}

utils() {
	pkgdesc="XML utilities"
	replaces="libxml2"
	mkdir -p "$subpkgdir"/usr
	mv "$pkgdir"/usr/bin "$subpkgdir"/usr/
}

md5sums="9c0cfef285d5c4a5c80d00904ddab380  libxml2-2.9.1.tar.gz
cc0da520c5296e87407d24166480da73  libxml2-pthread.patch
e6f432aea642badcb848e5791bcf6df7  CVE-2014-0191.patch
44b96e4a7c675f103628d7decfa56d37  CVE-2015-1819.patch
a6fdca7e058fe6fbaa248e8c0aae7424  CVE-2015-5312.patch
70b52327b3bbc473cfde89730f829aeb  CVE-2015-7497.patch
5cfa24ef6c26ad780bcdd7dfad831fd1  CVE-2015-7498.patch
d876337f727521061309722c9d16ba9a  CVE-2015-7499-1.patch
2852386b8844d628e6680e054fbbba4e  CVE-2015-7499-2.patch
0be954db9ac4cf9055b95eed5077fb2e  CVE-2015-7500.patch
286111441eed116f2edc489e9788d573  CVE-2015-7941_1.patch
44ad838bfb10784f016bf35ead4e1beb  CVE-2015-7941_2.patch
7304667ea636d829feed9cc6747d5efb  CVE-2015-7942.patch
ffdfbe9d5d7d334c5baca09060d56e78  CVE-2015-7942-2.patch
66f5aa382028e125202f6ac70f507c0a  CVE-2015-8035.patch
6f8105eed1006d1d5587d3d88b7c5bbd  CVE-2015-8241.patch
f5dc37a7162905c53ec86d06e20cb9b3  CVE-2015-8242.patch
f767ce95f29c9b63c31eaf6afb36e376  CVE-2015-8317-1.patch
017edcbd0f90ca13b23565f55f6c09e3  CVE-2015-8317-2.patch"
sha256sums="fd3c64cb66f2c4ea27e934d275904d92cec494a8e8405613780cbc8a71680fdb  libxml2-2.9.1.tar.gz
97d5e152580774483c47b28483282a4180c2c375bb7716a807ec859e59c3ec2f  libxml2-pthread.patch
288a762e8b115cecc02d920e4b36ebfa5249b8a6713a1a948e344d881d094ea8  CVE-2014-0191.patch
18cc94e2d1917e6e7b959d1ad1a1b1a907cdbd6fc7cfd52bfd2a7aaec7816bf2  CVE-2015-1819.patch
8676498e81d8f973c02bb0c8d56486be593c0179a0cc9d0c6e9bcdfff068bb05  CVE-2015-5312.patch
b63be023398e8d89068b968bacb8c50d9cac0b32eeec29c972d4b9a54f7288cd  CVE-2015-7497.patch
56bf3c58cd388bdabf3b47613cfb2d84be564954d86836e815679ad4151923dc  CVE-2015-7498.patch
ad99f8442cc6dc5127cb67c8b6277995f301b739ec8a60a474746c846e360ece  CVE-2015-7499-1.patch
4c44c22a5f3156aff40a029d656caca55cc095cf3cbaeeabc0b6e09b03fcf08c  CVE-2015-7499-2.patch
a482436a040e0c94efc669ac71bfd42427efd33a9e7d755897a6b0ae8b42e41f  CVE-2015-7500.patch
86d575ab1273f9a182a5c589db3e7a93b7c4bed63ca3588a8a99a84235b990be  CVE-2015-7941_1.patch
53c2adf000f8716a9e96aef9018cd824bb4cd24169d62686c1631bbee6ec60c8  CVE-2015-7941_2.patch
9095165d17db7e66060307fea16872ce5be63bd9f52e858f05200d6f12391ee4  CVE-2015-7942.patch
bd98845e4fb4405ae45f4dbdac097ac40db4e8ac8d2ff7194ac0997404ca37bf  CVE-2015-7942-2.patch
3b4d7e17929e8cb4ce078a7358450b308e15c9b9aa9d125a4d945ef6623e9bae  CVE-2015-8035.patch
fc8c07b99a5bb456a720eafc2393eb6b299930dc5cb1781494f692681e9818ac  CVE-2015-8241.patch
e4a1441afcd4379455ed683216dfbee49b7ef5480f57c449481fb3928190b41f  CVE-2015-8242.patch
81777f53a343a9d0dcf88c7871d52a2b7b5e7fc793ec3538cbe923d0919b2ae1  CVE-2015-8317-1.patch
0ef449496e8054809a653d33591326aaaf18aeffe8e2cfea28ede63b134e4430  CVE-2015-8317-2.patch"
sha512sums="7b10de749485bc2eb2108063e97d89e70d6fbb78b1bf195ab5528c8c64e79483d55223a49d95934f4e00b00e906c18bdd34344703ffe158dcf08096905a44c1b  libxml2-2.9.1.tar.gz
bda49c5e09605acc2bb36203521f750903d81345cc38af54b977e3ce71e288267fb3ab98f1813d846ab45461490482337f7af8b0f1a8a5e0b2c09e03bbadc7f7  libxml2-pthread.patch
41b6737b5cfe6392e3d781ebde48db0bf221bde89701742408afe625a88a67f6f6aed5cf04c1983ba2e7e04c2d819a8011908d23060365225571691c5e61cf11  CVE-2014-0191.patch
61c512e2f43bd0791e05a60c6bfa41a8a53bc95b2e45f983e6a87964246a6ab596955f9c9956d1f7ffd08fff774ab8d54222eeebb1e14cd5e54378e65ff677ce  CVE-2015-1819.patch
3a1f95a681fed8ae26327246c767d332d863d401318e246cd97b79f63ac09aef7e9a82a6185e60e7de9d4489a9f21ed519d015ea9748da2ed065ab579c596b25  CVE-2015-5312.patch
50dcf87ddce80643d7bb0e622d3d67a095549571da5866c9b6f8867c28aa3b41fe43ae12e4c2aa2ddb4d084908dfb79cd84995089fead447c1f1db1bff6a0ca3  CVE-2015-7497.patch
6c3c7dbc23380f53d6a5122bd2d55cf2352822974d6cf7921dbe07f11b5396cdc5f1812263e10d53c41610989bbf7c5266f6751eb987c0fd93ff068e8f4348a2  CVE-2015-7498.patch
17c62e675e64366079a44753aaf460a026a0716b5a1bc7bace4156dc693639bf842c0be326877eebf4661943f93f43866967e1989603499233ae280f93c79d37  CVE-2015-7499-1.patch
9a51143edb520491653bf44c8cdce3a359d4ada33bb1352b2985a1e00bf6367941f7f41983b126fb1eca531811473966b20d03338873490ab328af6647a2d4e0  CVE-2015-7499-2.patch
1bddc8789cc37b015abee0659cafdb60936a38a4ec7d39e23ecc4c8ca0bf5fc73aefeb9a16f480749dc73bc9c752986dc5df6dc92d041d17677bce64b9d4588a  CVE-2015-7500.patch
c86c62704b527e5b3e0834586a4a05e5acc059ececf80e45135bf9d00ed0531aa268366c9bdac1fb4f5fa98a03175f33d98e3edde4d351095b8aae456656579f  CVE-2015-7941_1.patch
3711688706751455818ac29ecc49f221ce747173145ff076bc1a2223d8c00287362f0b5bfc6351583bc3edabe1f05546295d78633c0ccf9cfa4d48a5594e09d8  CVE-2015-7941_2.patch
bbf93ce9f9277f049ccac6644f72e4c2d42a7513762950c928bbdab3813a9a20123a3aef5c83b8448213026761150bc4ad5a2a89dd9eb770793b642a54ca3fd0  CVE-2015-7942.patch
40837e2cc46aa8972818aa4526926cffd213e4c5a689c66f4c4b864c339582588e03d98f4fcf5781977b3a71a2a0850de17540b0293e58755f07346471e76aa4  CVE-2015-7942-2.patch
071577d6d2f4fa2df1894fab3379ac461f79a785a3c54b04c729a1e06982d3ae0158526d213a4b375fa878fa7bb2a257cf9070092f8228ad5dc159f99ea71ea1  CVE-2015-8035.patch
baec4095aae6e272e8d6dc6b820af8fdc73fe50d7ae5bad12a3fc550cdf73d03e949e00eb81ea15c796f0b454400d88190edd0c59a8dd0606f8d21419ae4ebdf  CVE-2015-8241.patch
98c83b942f718a765821771eb32aef70086edaedc44b83ecf291e8c65afdca63ec204b50d4dbfb87c13e6ded12cce3a7cfd3291449e9daa4d30d025525605e4d  CVE-2015-8242.patch
eccf558670f2458ce087c4211dc911463427b9722a5e6aee2ba1b008636bde967c6f88d7751f7586a8d338111520d64d2480e36d8a284180b9f867fad7f9957b  CVE-2015-8317-1.patch
04538232684bc44825b664d963aae41e4297a657404a4ea2b276a51f8f02f8334af35d630adccb48aa27a23b0aee328d41b1d4deff69aa28bed8f9f4cf1fae0b  CVE-2015-8317-2.patch"
