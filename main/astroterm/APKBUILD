# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=astroterm
pkgver=1.0.10
pkgrel=0
pkgdesc="Terminal-based star map"
url="https://github.com/da-luce/astroterm"
arch="all"
license="MIT"
makedepends="
	argtable2-dev
	muon
	ncurses-dev
	perl-file-slurp
	"
subpackages="$pkgname-doc"
source="https://github.com/da-luce/astroterm/archive/refs/tags/v$pkgver/astroterm-$pkgver.tar.gz
	$pkgname-bsc5-20231007::https://web.archive.org/web/20231007085824if_/http://tdc-www.harvard.edu/catalogs/BSC5
	gregkh-xxdi-v001.pl::https://github.com/gregkh/xxdi/raw/v001/xxdi.pl
	use-xxdi.patch
	"

export PATH="$tmpdir/bin:$PATH" # for xxdi

prepare() {
	default_prepare

	ln -Tsvf ../../$pkgname-bsc5-20231007 data/bsc5

	install -Dvm755 "$srcdir"/gregkh-xxdi-v001.pl "$tmpdir"/bin/xxdi
}

build() {
	abuild-muon \
		output .
	ninja -C output
}

check() {
	muon -C output test -j "${JOBS:-0}" -R -d dots
}

package() {
	DESTDIR="$pkgdir" muon -C output install

	install -Dvm644 README.md -t "$pkgdir"/usr/share/doc/$pkgname/
	install -Dvm644 LICENSE -t "$pkgdir"/usr/share/licenses/$pkgname/
}

sha512sums="
5953fab8750b86a6ea4d2ceb946c14b87b950f9d72cb3c403edf963959522d66b6773033705bbf924b0a20e36e0f24da964e469c49bf374fab39808f175465c2  astroterm-1.0.10.tar.gz
b96630ef38fa43bedff0462181b43276dca6c12d53ff91eb073d4985ec0fd191a6c84f8261cf6d4259f28ec80566765f53009fdca5508625ab8cb825c1e48e6a  astroterm-bsc5-20231007
da9b41a0ac805c970294e38e3178f6c35f8d4c246ce6c430ee254d276b8702a0509bc886b0d516daaacf2ec2495dfd5d0e8f6ec13dc2faf05435c16a8b5764c5  gregkh-xxdi-v001.pl
6bfe01e0e46c8a6d746a3c4fd4538c491820f0249ddc81b63fa210b7f8e7085d78b99149581447618910740f0ec11e8e42321e2eaffc0d1310b0426818574d43  use-xxdi.patch
"
