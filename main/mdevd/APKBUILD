# Maintainer: Laurent Bercot <ska-devel@skarnet.org>
pkgname=mdevd
pkgver=0.1.8.1
pkgrel=0
pkgdesc="A netlink-listening device manager using mdev's configuration files"
url="https://skarnet.org/software/mdevd/"
arch="all"
license="ISC"
options="!check"  # No test suite.
depends_openrc="mdevd
	mdev-conf"
depends_doc="busybox-doc"
makedepends="linux-headers
	skalibs-dev"
subpackages="$pkgname-doc $pkgname-openrc"
source="https://skarnet.org/software/mdevd/mdevd-$pkgver.tar.gz
	$pkgname.initd
	mdevd-init.initd"

build() {
	./configure \
		--prefix=/usr \
		--libexecdir="/usr/libexec/$pkgname" \
		--enable-shared \
		--disable-allstatic \
		--with-pkgconfig
	make
}

package() {
	make install DESTDIR="$pkgdir"
	install -D -m 0755 "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/$pkgname
	install -D -m 0755 "$srcdir"/mdevd-init.initd "$pkgdir"/etc/init.d/mdevd-init
	install -D -m 0644 COPYING "$pkgdir/usr/share/licenses/$pkgname/COPYING"
	mkdir -p "$pkgdir/usr/share/doc"
	cp -a doc "$pkgdir/usr/share/doc/$pkgname"
}

openrc() {
	provides="dev-openrc"
	provider_priority=20
	default_openrc
}

sha512sums="
8ae414f90dc74c4cbe194c3ff4cf4b5d57875cfc1006d4348d2dcd33e7310a7760cbfdc6b4020f7d3ff81ad2c1b1904334ae1fd2559affec9ca0c3127d770ea2  mdevd-0.1.8.1.tar.gz
8e139779b19a062abad601522c2d006d6dd21f1c7f99eeb1f5f061b75cf8cccb71019665468f9cd99429affd8236b5bc345691bdc8db0807d55faa388efb6849  mdevd.initd
a1e4734b1ad1a508da6c035aa9523a465cfd44489cceb7552f3b6e94ca8b8fb39e6baa3b230388ff9e89c1edbdcac5682f4c636b9fe52d94a92ac98f55bdd972  mdevd-init.initd
"
