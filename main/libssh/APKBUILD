# Contributor: Carlo Landmeter
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libssh
pkgver=0.5.4
pkgrel=1
pkgdesc="Library for accessing ssh client services through C libraries"
url="http://www.libssh.org/"
arch="all"
license="LGPL"
depends=
makedepends="openssl-dev cmake doxygen"
subpackages="$pkgname-dev"
source="https://red.libssh.org/attachments/download/41/libssh-$pkgver.tar.gz
	link-pthread.patch
	CVE-2014-0017.patch"

_builddir="$srcdir"/$pkgname-$pkgver

prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch)
			msg "Applying $i"
			patch -p1 -i "$srcdir"/$i || return 1
			;;
		esac
	done
}

build() {
	cd "$srcdir"
	
	mkdir build && cd build
	cmake "$srcdir"/${pkgname}-${pkgver} \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=Release
	make || return 1
}

package() {
	cd "$srcdir"/build
	make DESTDIR="$pkgdir" install
}

md5sums="b8b4e733c13dfabae33b2688ef82dacc  libssh-0.5.4.tar.gz
8d58b3391286de4dad3eb8a5b70171aa  link-pthread.patch
2eddf36e41adf62e4094f17b64d466e0  CVE-2014-0017.patch"
sha256sums="5f3825caebf7c47e6c6025aa048cb967e32c2b6cbfdc04109f05a35cbf4dca80  libssh-0.5.4.tar.gz
7a57c161357cb588e37a0b2e0b6a4a42505834da00e763ffe21141ed3a899169  link-pthread.patch
0321e6d26b05b49a4dcc5ecc622061d14e17b44c823625c422a561317cdf1267  CVE-2014-0017.patch"
sha512sums="1d854ee05e62e9e04ac704bc99a60b6f88237078b728e50e3e0f1142fbc5d1a4b4d04d675f257491c82c8b222b97db7a7f8e243f4a0f723e82788ecef3a7a71d  libssh-0.5.4.tar.gz
da26f14312a0988c72663225b6412ec06b2cdda6fdfd234f167f7fe9f1371fa432cb4c5d6326048540cffa527781203019023844870fe52c1b58631d8ca45b39  link-pthread.patch
4de07b3a70458d98b871e840ee23fd460e6911705d5a6a79d97dbc312c9921481e622088a3b651a3c9341ff5168aa2726b63cb0966dbaab72a7761102b307b1e  CVE-2014-0017.patch"
