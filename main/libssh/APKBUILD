# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libssh
pkgver=0.8.9
pkgrel=1
pkgdesc="Library for accessing ssh client services through C libraries"
url="http://www.libssh.org/"
arch="all"
license="LGPL"
makedepends="zlib-dev openssl-dev cmake doxygen"
subpackages="$pkgname-dev"
options="!check"
source="https://www.libssh.org/files/${pkgver%.*}/libssh-$pkgver.tar.xz
	fix-includes.patch
	CVE-2020-16135.patch
	"
builddir="$srcdir"/$pkgname-$pkgver

# secfixes:
#   0.8.9-r1:
#     - CVE-2020-16135
#   0.8.9-r0:
#     - CVE-2020-1730
#   0.8.8-r0:
#     - CVE-2019-14889
#   0.7.6-r0:
#     - CVE-2018-10933

build() {
	cd "$srcdir"
	mkdir build && cd build
	cmake "$builddir" \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_BUILD_TYPE=Release
	make
}

package() {
	cd "$srcdir"/build
	make DESTDIR="$pkgdir" install
}

sha512sums="86ad3cfe2e494a8cb63fa4dd959b84ecc3eec5bf4935ec6b9028c2c3ddcb6c824e8fed491ea78ee6735b646cf5127befe6c781922430988d6ff137623ec403d7  libssh-0.8.9.tar.xz
055a8f6b97c65384a5a3ab8fe00c69d94cc30092fe926093dbbc122ce301fbe9d76127aa07b5e6107d7fa9dd2aad6b165fa0958b56520253b5d64428ff42a318  fix-includes.patch
a916193b138f72f3ba7a0a7fe72ebd3815462994d4632b191b0b7f0e35ce25d28eb39ca3681b2ba6a924b5345a0c5fdce32f92d250e368f437d27383b1bd499a  CVE-2020-16135.patch"
