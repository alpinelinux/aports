# Maintainer:Carlo Landmeter
pkgname=transmission
pkgver=2.90
pkgrel=0
pkgdesc="Lightweight GTK BitTorrent client"
url="http://www.tansmissionbt.com"
install="transmission-daemon.pre-install transmission-daemon.post-upgrade"
arch="all"
license="MIT"
depends=
pkgusers="transmission"
pkggroups="transmission"
makedepends="openssl-dev curl-dev gtk+3.0-dev intltool libevent-dev
	libnotify-dev dbus-glib-dev autoconf automake tar gconf-dev
	bsd-compat-headers"
source="http://download.m0k.org/transmission/files/transmission-$pkgver.tar.xz
	musl-fix-includes.patch
	transmission-daemon.initd
	transmission-daemon.confd
	"
subpackages="$pkgname-cli $pkgname-daemon $pkgname-doc $pkgname-lang"

_builddir="$srcdir"/$pkgname-$pkgver

prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch)
			msg "Applying $i"
			patch -p1 -i "$srcdir"/$i || return 1
			;;
		esac
	done
}

build() {
        cd "$_builddir"

	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--localstatedir=/var \
		--enable-utp \
		--with-inotify \
		--enable-cli \
		|| return 1
	make || return 1
}

package() {
        cd "$_builddir"
        make DESTDIR="$pkgdir" install || return 1
}

daemon() {
	pkgdesc="Lightweight BitTorrent client (daemon and webinterface)"
	install -d "$subpkgdir"/usr/share \
		"$subpkgdir"/usr/bin || return 1
	install -d -o transmission -g transmission \
		"$subpkgdir"/var/lib/transmission \
		"$subpkgdir"/var/log/transmission || return 1
	mv "$pkgdir"/usr/bin/transmission-daemon \
		"$subpkgdir"/usr/bin/ || return 1
	mv "$pkgdir"/usr/share/transmission \
		"$subpkgdir"/usr/share/ || return 1
        install -D -m755 "$srcdir"/transmission-daemon.initd \
		"$subpkgdir"/etc/init.d/transmission-daemon || return 1
        install -D -m644 "$srcdir"/transmission-daemon.confd \
		"$subpkgdir"/etc/conf.d/transmission-daemon || return 1
}

cli() {
	pkgdesc="Lightweight BitTorrent client (cli  and remote)"
	install -d "$subpkgdir"/usr/bin
	mv "$pkgdir"/usr/bin/transmission-cli \
		"$pkgdir"/usr/bin/transmission-create \
		"$pkgdir"/usr/bin/transmission-edit \
		"$pkgdir"/usr/bin/transmission-show \
		"$pkgdir"/usr/bin/transmission-remote \
		"$subpkgdir"/usr/bin/ || return 1
}

md5sums="0792c67fcbf722f7823e964e09eb16bc  transmission-2.90.tar.xz
c82db96ef007babdc70b54652eec09be  musl-fix-includes.patch
33aad5f659b532262fc38c908b6b3dd2  transmission-daemon.initd
5caf0fc25dfd67c61627f1e0313f4245  transmission-daemon.confd"
sha256sums="69ff8caf81684155926f437f46bf7df1b1fb304f52c7809f546257e8923f2fd2  transmission-2.90.tar.xz
ad5dd85c077fe2e389142a8210d3322c486892a0952fee650f92d76c1b698283  musl-fix-includes.patch
61b7bbba865e902400940f945de8df7cdafcc496573eb855491ebda47f837e23  transmission-daemon.initd
4b47acf195a14a322550cfcaa735a59aac38410d1c2c63ffa824ff131c55ca70  transmission-daemon.confd"
sha512sums="09c8e90cb1c7b508e3956d294ba9b5f01b4093c9f934c76d7515e96915c657b97f02819e1365dbbfecbdf489ae5757346d8bb2dd8e0070c304af434006495fda  transmission-2.90.tar.xz
4ded1ceb44ab973470ad568248658969268869036b18c9aa5c1122557e789dcd5123016633e983fffd00f879d8effd5e2810e0c2b99ae1d8b0eabe7cad2f4459  musl-fix-includes.patch
d31275fba7eb322510f9667e66a186d626889a6e3143be2923aae87b9c35c5cf0c508639f1cb8c1b88b1e465bc082d80bb1101385ebde736a34d4eeeae0f6e15  transmission-daemon.initd
a3b9ac2b7bbe30e33060c8b6a693dc7072d3c6ac44f92ddd567969d8f57a0bfc1a561e781ae167703ccb4b2fd5b0e6d8f8a66c5ba14fe01d8d89a501d4501474  transmission-daemon.confd"
