# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=ffmpeg
_svnrev=30526
pkgver=0.5_svn$_svnrev
pkgrel=2
pkgdesc="Complete and free Internet live audio and video broadcasting solution for Linux/Unix"
url="http://ffmpeg.mplayerhq.hu/"
license="GPL"
subpackages="$pkgname-dev $pkgname-doc"
makedepends="lame-dev libvorbis-dev faad2-dev faac-dev xvidcore-dev zlib-dev
	imlib2-dev x264-dev libtheora-dev coreutils bzip2-dev perl"
depends=
source="ftp://ftp.archlinux.org/other/ffmpeg/ffmpeg-$_svnrev.tar.bz2
	pic.patch"

_builddir="$srcdir"/$pkgname
build() {
	cd "$_builddir"
	patch -p1 < ../pic.patch || return 1

	./configure --prefix=/usr \
		--enable-gpl \
		--enable-libmp3lame \
		--enable-libvorbis \
		--enable-libfaac \
		--enable-libfaad \
		--enable-libxvid \
		--enable-libx264 \
		--enable-libtheora \
		--enable-nonfree \
		--enable-postproc \
		--enable-shared \
		--enable-pthreads \
		--enable-x11grab \
		--disable-mmx \
		--disable-mmx2 \
		--disable-stripping \
		|| return 1
	make || return 1
	make tools/qt-faststart || return 1
	make doc/ffmpeg.1 doc/ffplay.1 doc/ffserver.1 || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install install-man || return 1
	install -D -m755 tools/qt-faststart "$pkgdir/usr/bin/qt-faststart" || return 1
#	strip --strip-debug "$pkgdir"/usr/lib/*.a || return 1
}
md5sums="36710a8fa2bb91556c355aeb0e662c81  ffmpeg-30526.tar.bz2
3c5d446db8d512a3bca5f5a860bbcc04  pic.patch"
