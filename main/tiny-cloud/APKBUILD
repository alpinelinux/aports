# Contributor: Mike Crute <mike@crute.us>
# Contributor: Jake Buchholz Göktürk <tomalok@gmail.com>
# Maintainer: Jake Buchholz Göktürk <tomalok@gmail.com>
pkgname=tiny-cloud
pkgver=3.2.3
pkgrel=0
pkgdesc="Tiny Cloud instance bootstrapper"
url="https://gitlab.alpinelinux.org/alpine/cloud/tiny-cloud"
arch="noarch"
license="MIT"
checkdepends="kyua xz lz4 zstd"
depends="e2fsprogs-extra partx sfdisk yx openssh-server"
provides="tiny-cloud-allclouds=$pkgver-r$pkgrel"
source="
	$url/-/archive/$pkgver/tiny-cloud-$pkgver.tar.gz
"
install="
	tiny-cloud.pre-upgrade
	tiny-cloud-openrc.pre-upgrade
	tiny-cloud-aws.post-install
	tiny-cloud-azure.post-install
	tiny-cloud-digitalocean.post-install
	tiny-cloud-gcp.post-install
	tiny-cloud-hetzner.post-install
	tiny-cloud-incus.post-install
	tiny-cloud-nocloud.post-install
	tiny-cloud-oci.post-install
	tiny-cloud-scaleway.post-install
"
subpackages="
	$pkgname-openrc
	$pkgname-aws
	$pkgname-azure
	$pkgname-digitalocean
	$pkgname-gcp
	$pkgname-hetzner
	$pkgname-incus
	$pkgname-nocloud
	$pkgname-oci
	$pkgname-scaleway
"

check() {
	make check
}

package() {
	make PREFIX="$pkgdir" install
}

aws() {
	pkgdesc="Tiny Cloud - Amazon Web Services module"
	depends="$pkgname=$pkgver-r$pkgrel"
	provides="tiny-ec2-bootstrap"
	mkdir -p "$subpkgdir"
}

azure() {
	pkgdesc="Tiny Cloud - Azure module"
	depends="$pkgname=$pkgver-r$pkgrel"
	mkdir -p "$subpkgdir"
}

digitalocean() {
	pkgdesc="Tiny Cloud - DigitalOcean module"
	depends="$pkgname=$pkgver-r$pkgrel"
	mkdir -p "$subpkgdir"
}

gcp() {
	pkgdesc="Tiny Cloud - Google Cloud Platform module"
	depends="$pkgname=$pkgver-r$pkgrel"
	mkdir -p "$subpkgdir"
}

hetzner() {
	pkgdesc="Tiny Cloud - Hetzner Cloud module"
	depends="$pkgname=$pkgver-r$pkgrel"
	mkdir -p "$subpkgdir"
}

incus() {
	pkgdesc="Tiny Cloud - Incus module"
	depends="$pkgname=$pkgver-r$pkgrel"
	mkdir -p "$subpkgdir"
}

nocloud() {
	pkgdesc="Tiny Cloud - NoCloud module"
	depends="$pkgname=$pkgver-r$pkgrel"
	provides="tiny-cloud-alpine=$pkgver-r$pkgrel"
	mkdir -p "$subpkgdir"
}

oci() {
	pkgdesc="Tiny Cloud - Oracle Cloud Infrastructure module"
	depends="$pkgname=$pkgver-r$pkgrel"
	mkdir -p "$subpkgdir"
}

scaleway() {
	pkgdesc="Tiny Cloud - Scaleway Cloud module"
	depends="$pkgname=$pkgver-r$pkgrel"
	mkdir -p "$subpkgdir"
}

sha512sums="
e5d9c57ee0fd0b4cb561e957ad74d722c9ef19de091232c080f6378a8b485ca6b1334dc36d46f013f62c5aa9cb9e47216322e544a968abf4822f7dd0ef019d0e  tiny-cloud-3.2.3.tar.gz
"
