# Contributor: William Pitcock <nenolod@dereferenced.org>
# Contributor: Roger Pau Monne <roger.pau@entel.upc.edu>
# Maintainer: William Pitcock <nenolod@dereferenced.org>
pkgname=xen
pkgver=4.9.2
pkgrel=3
pkgdesc="Xen hypervisor"
url="http://www.xen.org/"
arch="x86_64 armhf aarch64"
license="GPL"
depends="bash iproute2 logrotate"
depends_dev="libressl-dev python2-dev e2fsprogs-dev gettext zlib-dev ncurses-dev
	dev86 texinfo perl pciutils-dev glib-dev yajl-dev libnl3-dev
	spice-dev gnutls-dev curl-dev libaio-dev lzo-dev xz-dev util-linux-dev
	e2fsprogs-dev linux-headers argp-standalone perl-dev"
makedepends="$depends_dev autoconf automake libtool dnsmasq"
options="!strip"

# secfixes:
#   4.7.0-r0:
#     - CVE-2016-6258 XSA-182
#     - CVE-2016-6259 XSA-183
#     - CVE-2016-5403 XSA-184
#   4.7.0-r1:
#     - CVE-2016-7092 XSA-185
#     - CVE-2016-7093 XSA-186
#     - CVE-2016-7094 XSA-187
#   4.7.0-r5:
#     - CVE-2016-7777 XSA-190
#   4.7.1-r1:
#     - CVE-2016-9386 XSA-191
#     - CVE-2016-9382 XSA-192
#     - CVE-2016-9385 XSA-193
#     - CVE-2016-9384 XSA-194
#     - CVE-2016-9383 XSA-195
#     - CVE-2016-9377 XSA-196
#     - CVE-2016-9378 XSA-196
#     - CVE-2016-9381 XSA-197
#     - CVE-2016-9379 XSA-198
#     - CVE-2016-9380 XSA-198
#   4.7.1-r3:
#     - CVE-2016-9932 XSA-200
#     - CVE-2016-9815 XSA-201
#     - CVE-2016-9816 XSA-201
#     - CVE-2016-9817 XSA-201
#     - CVE-2016-9818 XSA-201
#   4.7.1-r4:
#     - CVE-2016-10024 XSA-202
#     - CVE-2016-10025 XSA-203
#     - CVE-2016-10013 XSA-204
#   4.7.1-r5:
#     - XSA-207
#     - CVE-2017-2615 XSA-208
#     - CVE-2017-2620 XSA-209
#     - XSA-210
#   4.7.2-r0:
#     - CVE-2016-9603 XSA-211
#     - CVE-2017-7228 XSA-212
#   4.8.1-r2:
#     - CVE-2017-8903 XSA-213
#     - CVE-2017-8904 XSA-214
#   4.9.0-r0:
#     - CVE-2017-10911 XSA-216
#     - CVE-2017-10912 XSA-217
#     - CVE-2017-10913 XSA-218
#     - CVE-2017-10914 XSA-218
#     - CVE-2017-10915 XSA-219
#     - CVE-2017-10916 XSA-220
#     - CVE-2017-10917 XSA-221
#     - CVE-2017-10918 XSA-222
#     - CVE-2017-10919 XSA-223
#     - CVE-2017-10920 XSA-224
#     - CVE-2017-10921 XSA-224
#     - CVE-2017-10922 XSA-224
#     - CVE-2017-10923 XSA-225
#   4.9.0-r1:
#     - CVE-2017-12135 XSA-226
#     - CVE-2017-12137 XSA-227
#     - CVE-2017-12136 XSA-228
#     - CVE-2017-12855 XSA-230
#   4.9.0-r2:
#     - XSA-235
#   4.9.0-r4:
#     - CVE-2017-14316 XSA-231
#     - CVE-2017-14318 XSA-232
#     - CVE-2017-14317 XSA-233
#     - CVE-2017-14319 XSA-234
#   4.9.0-r5:
#     - XSA-245
#   4.9.0-r6:
#     - CVE-2017-15590 XSA-237
#     - XSA-238
#     - CVE-2017-15589 XSA-239
#     - CVE-2017-15595 XSA-240
#     - CVE-2017-15588 XSA-241
#     - CVE-2017-15593 XSA-242
#     - CVE-2017-15592 XSA-243
#     - CVE-2017-15594 XSA-244
#   4.9.0-r7:
#     - CVE-2017-15597 XSA-236
#   4.9.1-r1:
#     - XSA-246
#     - XSA-247
#   4.9.1-r2:
#     - XSA-248
#     - XSA-249
#     - XSA-250
#     - XSA-251
#   4.9.1-r3:
#     - CVE-2017-5753 CVE-2017-5715 CVE-2017-5754 XSA-254 XPTI
#   4.9.1-r4:
#     - CVE-2018-7540 XSA-252
#     - CVE-2018-7541 XSA-255
#     - CVE-2018-7542 XSA-256
#   4.9.2-r1:
#     - CVE-2018-10472 XSA-258
#     - CVE-2018-10471 XSA-259
#   4.9.2-r2:
#     - CVE-2018-8897  XSA-260
#     - CVE-2018-10982 XSA-261
#     - CVE-2018-10981 XSA-262
#   4.9.2-r3:
#     - CVE-2018-3639 XSA-263
#     - CVE-2018-3665 XSA-267

case "$CARCH" in
x86*)
	depends="$depends syslinux"
	makedepends="$makedepends iasl seabios-bin"
	;;
arm*)
	makedepends="$makedepends dtc-dev"
	;;
aarch64)
	makedepends="$makedepends dtc-dev iasl"
	;;
esac

install=""

#if [ "$CARCH" != "armhf" ]; then
#	subpackages="$pkgname-dbg"
#fi
subpackages="$subpackages $pkgname-doc $pkgname-dev $pkgname-libs
	$pkgname-hypervisor $pkgname-bridge"

# grep _VERSION= stubdom/configure
_ZLIB_VERSION="1.2.3"
_LIBPCI_VERSION="2.2.9"
_NEWLIB_VERSION="1.16.0"
_LWIP_VERSION="1.3.0"
_GRUB_VERSION="0.97"
_OCAML_VERSION="3.11.0"
_GMP_VERSION="4.3.2"
_POLARSSL_VERSION="1.1.4"
_TPMEMU_VERSION="0.7.4"

# grep ^IPXE_GIT_TAG tools/firmware/etherboot/Makefile
_IPXE_GIT_TAG=827dd1bfee67daa683935ce65316f7e0f057fe1c

source="https://downloads.xenproject.org/release/$pkgname/$pkgver/$pkgname-$pkgver.tar.gz
	http://xenbits.xen.org/xen-extfiles/gmp-$_GMP_VERSION.tar.bz2
	http://xenbits.xen.org/xen-extfiles/grub-$_GRUB_VERSION.tar.gz
	http://xenbits.xen.org/xen-extfiles/lwip-$_LWIP_VERSION.tar.gz
	http://xenbits.xen.org/xen-extfiles/newlib-$_NEWLIB_VERSION.tar.gz
	http://xenbits.xen.org/xen-extfiles/pciutils-$_LIBPCI_VERSION.tar.bz2
	http://xenbits.xen.org/xen-extfiles/polarssl-$_POLARSSL_VERSION-gpl.tgz
	http://xenbits.xen.org/xen-extfiles/tpm_emulator-$_TPMEMU_VERSION.tar.gz
	http://xenbits.xen.org/xen-extfiles/zlib-$_ZLIB_VERSION.tar.gz
	http://xenbits.xen.org/xen-extfiles/ipxe-git-$_IPXE_GIT_TAG.tar.gz

	qemu-coroutine-gthread.patch
	qemu-xen_paths.patch

	hotplug-vif-vtrill.patch

	musl-support.patch
	musl-hvmloader-fix-stdint.patch
	stdint_local.h
	elf_local.h

	xen-hotplug-lockfd.patch
	xen-fd-is-file.c

	xenstore_client_transaction_fix.patch

	xenqemu-xattr-size-max.patch

	xsa258.patch
	xsa259.patch

	x86-XPTI-reduce-.text.entry.patch
	xsa260-1.patch
	xsa260-2.patch
	xsa260-3.patch
	xsa260-4.patch
	xsa261-4.9.patch
	xsa262-4.9.patch

	x86-log-XPTI-enabled-status.patch
	x86-disable-XPTI-when-RDCL_NO.patch
	x86-spec_ctrl-Updates-to-retpoline-safety-decision-m.patch
	x86-spec_ctrl-Fix-several-bugs-in-SPEC_CTRL_ENTRY_FR.patch
	x86-suppress-BTI-mitigations-around-S3-suspend-resum.patch
	0001-x86-spec_ctrl-Read-MSR_ARCH_CAPABILITIES-only-once.patch
	0002-x86-spec_ctrl-Express-Xen-s-choice-of-MSR_SPEC_CTRL-.patch
	0003-x86-spec_ctrl-Merge-bti_ist_info-and-use_shadow_spec.patch
	0004-x86-spec_ctrl-Fold-the-XEN_IBRS_-SET-CLEAR-ALTERNATI.patch
	0005-x86-spec_ctrl-Rename-bits-of-infrastructure-to-avoid.patch
	0006-x86-spec_ctrl-Elide-MSR_SPEC_CTRL-handling-in-idle-c.patch
	0007-x86-spec_ctrl-Split-X86_FEATURE_SC_MSR-into-PV-and-H.patch
	0008-x86-spec_ctrl-Explicitly-set-Xen-s-default-MSR_SPEC_.patch
	0009-x86-cpuid-Improvements-to-guest-policies-for-specula.patch
	0010-x86-spec_ctrl-Introduce-a-new-spec-ctrl-command-line.patch
	0011-x86-AMD-Mitigations-for-GPZ-SP4-Speculative-Store-By.patch
	0012-x86-Intel-Mitigations-for-GPZ-SP4-Speculative-Store-.patch
	0013-x86-msr-Virtualise-MSR_SPEC_CTRL.SSBD-for-guests-to-.patch

	x86-xpti-avoid-copying-L4-page-table-contents-when-p.patch
	xen-x86-add-a-function-for-modifying-cr3.patch
	xen-x86-support-per-domain-flag-for-xpti.patch
	xsa267-4.9-1.patch
	xsa267-4.9-2.patch

	xenstored.initd
	xenstored.confd
	xenconsoled.initd
	xenconsoled.confd
	xendomains.initd
	xendomains.confd
	xen-consoles.logrotate
	xenqemu.confd
	xenqemu.initd
	xendriverdomain.initd
	"

builddir="$srcdir"/$pkgname-$pkgver
_seabios=/usr/share/seabios/bios-256k.bin

# Override wrong arch detection from xen-$pkgver/Config.mk.
case "$CARCH" in
armhf) export XEN_TARGET_ARCH="arm32";;
aarch64) export XEN_TARGET_ARCH="arm64";;
esac

prepare() {
	local i _failed= _series=
	cd "$builddir"

	for i in $source; do
		case $i in
		*-etherboot-*)
			p=${i%%::*}
			p=${p##*/}
			msg "adding to ipxe: $p"
			cp "$srcdir"/$p tools/firmware/etherboot/patches/
			echo "$p" >> tools/firmware/etherboot/patches/series
			;;
		*.patch) msg $i; patch -s -N -p1 -i "$srcdir"/$i \
				|| _failed="$_failed $i"
			;;
		*/ipxe-git-*)
			ln -s "$srcdir"/${i##*/} \
				tools/firmware/etherboot/ipxe.tar.gz || return 1
			;;
		*/xen-extfiles/*)
			ln -s "$srcdir"/${i##*/} stubdom/ || return 1
			;;
		esac
	done
	if [ -n "$_failed" ]; then
		error "Patches failed:"
		for i in $_failed; do
			echo $i
		done
		return 1
	fi

	# install our stdint_local.h and elf_local.h
	install "$srcdir"/stdint_local.h "$srcdir"/elf_local.h \
		"$builddir"/tools/firmware/ || return 1
	ln -s ../firmware/stdint_local.h "$builddir"/tools/libxl/

	# remove all -Werror
	msg "Eradicating -Werror..."
	find . -name '*.mk' -o -name 'Make*' | xargs sed -i -e 's/-Werror//g' \
		|| return 1

	msg "Updating config.sub..."
	update_config_sub || return 1

	msg "Autoreconf..."
	autoreconf || return 1

	unset CFLAGS
	unset LDFLAGS
}

# Unset CFLAGS and LDFLAGS because the xen build system
# doesn't support them. Instead use .config in xen root
# folder if necessary.
munge_cflags() {
	msg "Munging CFLAGS..."

	unset CFLAGS
	unset LDFLAGS
	unset LANG
	unset LC_ALL

	case "$CARCH" in
	armhf) export CFLAGS="-mcpu=cortex-a15";;
	aarch64) export CFLAGS="-mcpu=cortex-a53";;
	esac
}

# These tasks are added as separate tasks to enable a packager
# to invoke specific tasks like building the hypervisor.  i.e.
#    $ abuild configure build_tools
configure() {
	cd "$builddir"

	msg "Running configure..."
	./configure --prefix=/usr \
		--build=$CBUILD \
		--host=$CHOST \
		--with-system-seabios=$_seabios \
		|| return 1
}

build_hypervisor() {
	munge_cflags

	msg "Building hypervisor..."
	make xen || return 1
}

build_tools() {
	munge_cflags

	msg "Building tools..."
	make tools || return 1
}

build_docs() {
	munge_cflags

	msg "Building documentation..."
	make docs
}

build_stubdom() {
	munge_cflags

	msg "Building stub domains..."
	make stubdom || return 1
}

build() {
	cd "$builddir"
	configure || return 1
	build_hypervisor || return 1
	build_tools || return 1
	build_docs || return 1
	case "$CARCH" in
	x86*) build_stubdom || return 1;;
	esac

	${CC:-gcc} -o xen-fd-is-file "$srcdir"/xen-fd-is-file.c
}

package() {
	cd "$builddir"

	unset CFLAGS
	unset LDFLAGS

	make -j1 DESTDIR="$pkgdir" install-xen install-tools install-docs \
		|| return 1
	case "$CARCH" in
	x86*) make -j1 DESTDIR="$pkgdir" install-stubdom || return 1;;
	esac

	# remove default xencommons
	rm -rf "$pkgdir"/etc/init.d/xencommons
	# remove default xendriverdomain
	rm -rf "$pkgdir"/etc/init.d/xendriverdomain

	for i in $source; do
		case $i in
		*.initd) install -Dm755 "$srcdir"/$i \
				"$pkgdir"/etc/init.d/${i%.*};;
		*.confd) install -Dm644 "$srcdir"/$i \
				"$pkgdir"/etc/conf.d/${i%.*};;
		esac
	done
	install -Dm644 "$srcdir"/xen-consoles.logrotate \
		"$pkgdir"/etc/xen/xen-consoles.logrotate

	install -m755 xen-fd-is-file "$pkgdir"/usr/lib/xen/bin/xen-fd-is-file

	# we need to exclude /usr/share when stripping
        msg "Stripping binaries"
	scanelf --recursive --nobanner --etype "ET_DYN,ET_EXEC" "$pkgdir"/usr/lib \
		"$pkgdir"/usr/bin \
		"$pkgdir"/usr/sbin \
                | sed -e 's:^ET_DYN ::' -e 's:^ET_EXEC ::' \
                | xargs strip
}

check() {
	cd "$builddir"
	make test
}

libs() {
	pkgdesc="Libraries for Xen tools"
	replaces="xen"
	depends=
	mkdir -p "$subpkgdir"/usr/lib
	mv "$pkgdir"/usr/lib/*.so.* \
		"$pkgdir"/usr/lib/fs \
		"$subpkgdir"/usr/lib/
}

hypervisor() {
	pkgdesc="Xen hypervisor"
	depends=
	mkdir -p "$subpkgdir"
	mv "$pkgdir"/boot "$subpkgdir"/
}

bridge() {
	depends="dnsmasq"
	pkgdesc="Bridge interface for XEN with dhcp"
	mkdir -p "$subpkgdir"/etc/conf.d \
		"$subpkgdir"/etc/init.d \
		"$subpkgdir"/etc/xen

	ln -s dnsmasq "$subpkgdir"/etc/init.d/dnsmasq.xenbr0
	cat ->>"$subpkgdir"/etc/conf.d/dnsmasq.xenbr0 <<EOF
		BRIDGE_ADDR="10.0.4.1"
		BRIDGE_NETMASK="255.255.255.0"
		BRIDGE_NETWORK="10.0.4.0/24"
		BRIDGE_DHCP_RANGE="10.0.4.2,10.0.4.254"
		BRIDGE_DHCP_MAX="253"
		BRIDGE_MAC="00:16:3f:00:00:00"
		DNSMASQ_CONFFILE="/etc/xen/dnsmasq.conf"
EOF
	cat ->>"$subpkgdir"/etc/xen/dnsmasq.conf <<EOF
		#dhcp-host=somehost,10.0.4.3
		#dhcp-host=otherhost,10.0.4.4
EOF

}

sha512sums="e06aec25439abcc548c174ba8e271c23031ea704bcc2480905140aa68490064fbb1c58d9c4174f6617b4f7bbcddfda284317df6f480a6e5b5b5a2c71fbe0ac93  xen-4.9.2.tar.gz
2e0b0fd23e6f10742a5517981e5171c6e88b0a93c83da701b296f5c0861d72c19782daab589a7eac3f9032152a0fc7eff7f5362db8fccc4859564a9aa82329cf  gmp-4.3.2.tar.bz2
c2bc9ffc8583aeae71cee9ddcc4418969768d4e3764d47307da54f93981c0109fb07d84b061b3a3628bd00ba4d14a54742bc04848110eb3ae8ca25dbfbaabadb  grub-0.97.tar.gz
1465b58279af1647f909450e394fe002ca165f0ff4a0254bfa9fe0e64316f50facdde2729d79a4e632565b4500cf4d6c74192ac0dd3bc9fe09129bbd67ba089d  lwip-1.3.0.tar.gz
40eb96bbc6736a16b6399e0cdb73e853d0d90b685c967e77899183446664d64570277a633fdafdefc351b46ce210a99115769a1d9f47ac749d7e82837d4d1ac3  newlib-1.16.0.tar.gz
2b3d98d027e46d8c08037366dde6f0781ca03c610ef2b380984639e4ef39899ed8d8b8e4cd9c9dc54df101279b95879bd66bfd4d04ad07fef41e847ea7ae32b5  pciutils-2.2.9.tar.bz2
88da614e4d3f4409c4fd3bb3e44c7587ba051e3fed4e33d526069a67e8180212e1ea22da984656f50e290049f60ddca65383e5983c0f8884f648d71f698303ad  polarssl-1.1.4-gpl.tgz
4928b5b82f57645be9408362706ff2c4d9baa635b21b0d41b1c82930e8c60a759b1ea4fa74d7e6c7cae1b7692d006aa5cb72df0c3b88bf049779aa2b566f9d35  tpm_emulator-0.7.4.tar.gz
021b958fcd0d346c4ba761bcf0cc40f3522de6186cf5a0a6ea34a70504ce9622b1c2626fce40675bc8282cf5f5ade18473656abc38050f72f5d6480507a2106e  zlib-1.2.3.tar.gz
82ba65e1c676d32b29c71e6395c9506cab952c8f8b03f692e2b50133be8f0c0146d0f22c223262d81a4df579986fde5abc6507869f4965be4846297ef7b4b890  ipxe-git-827dd1bfee67daa683935ce65316f7e0f057fe1c.tar.gz
c3c46f232f0bd9f767b232af7e8ce910a6166b126bd5427bb8dc325aeb2c634b956de3fc225cab5af72649070c8205cc8e1cab7689fc266c204f525086f1a562  qemu-coroutine-gthread.patch
1936ab39a1867957fa640eb81c4070214ca4856a2743ba7e49c0cd017917071a9680d015f002c57fa7b9600dbadd29dcea5887f50e6c133305df2669a7a933f3  qemu-xen_paths.patch
f095ea373f36381491ad36f0662fb4f53665031973721256b23166e596318581da7cbb0146d0beb2446729adfdb321e01468e377793f6563a67d68b8b0f7ffe3  hotplug-vif-vtrill.patch
a3197d9c2455983554610031702ea95dc31f1b375b8c1291207d33c9e6114c6928417b4c8138cb5356ee58d07846963143abba5f204ecaee49eab6f84ad5e4f5  musl-support.patch
77b08e9655e091b0352e4630d520b54c6ca6d659d1d38fbb4b3bfc9ff3e66db433a2e194ead32bb10ff962c382d800a670e82b7a62835b238e294b22808290ea  musl-hvmloader-fix-stdint.patch
8c3b57eab8641bcee3dbdc1937ea7874f77b9722a5a0aa3ddb8dff8cc0ced7e19703ef5d998621b3809bea7c16f3346cfa47610ec9ab014ad0de12651c94e5ff  stdint_local.h
853467a2d055c5bfbdc7bdca175a334241be44a7c5ac3c0a84a4bc5463b5c070b66d37e2a557429ef860727a6b7350683af758cc2494d85b6be4d883143a2c0d  elf_local.h
79cb1b6b81b17cb87a064dfe3548949dfb80f64f203cac11ef327102b7a25794549ce2d9c019ebf05f752214da8e05065e9219d069e679c0ae5bee3d090c685e  xen-hotplug-lockfd.patch
e76816c6ad0e91dc5f81947f266da3429b20e6d976c3e8c41202c6179532eec878a3f0913921ef3ac853c5dbad8082da3c9cd53b65081910516feb492577b7fc  xen-fd-is-file.c
69dfa60628ca838678862383528654ecbdf4269cbb5c9cfb6b84d976202a8dea85d711aa65a52fa1b477fb0b30604ca70cf1337192d6fb9388a08bbe7fe56077  xenstore_client_transaction_fix.patch
2094ea964fa610b2bf72fd2c7ede7e954899a75c0f5b08030cf1d74460fb759ade84866176e32f8fe29c921dfdc6dafd2b31e23ab9b0a3874d3dceeabdd1913b  xenqemu-xattr-size-max.patch
5be5befaf5c6a83bd1d02cf33e4bddc6d61d683ee4392e1a40b004c9026e785d62a8a6a80c94dba67150af1355ab141b8457589839c7d7beb4673fd302cc2470  xsa258.patch
023b34174d059d1e22a070e9f48d0601b0a6e735acef5b74af7f8613d3267e66773e662790a8f2a5b7fda32b017bf654a059e4fecd94a82ff8502900e4b24b25  xsa259.patch
dc0b706903da13025cc9fa3dde1ba8f0f774839704d9f3d3c6482b476f3cf1e85b9567fd4a6761e0322e55e0e9792944be6d23b2ef23db2844822a95d9491b8c  x86-XPTI-reduce-.text.entry.patch
af38aae378414e88c2553dd61c499a7016e0be9bfc663d134b90fc4fba7eb792c34bfbbc5b52eb19339fea4e6d0bd8d629f150daadcd28ff13c2b1f5902496d5  xsa260-1.patch
4796336af7505dc0b024d739f745483229a199dd5f7c91de52af0fc164b1951825c57faeb597bacf945ebfeafdcc3b2fd129b8dc9f01d852503d5124af49691f  xsa260-2.patch
90f9283da362c25403c764db4eeb42cd329969e784d9685ef7691437e4589e4aec207cc24467b9971d552884be614f3f1aa5fd91095074cd26689e31bd9c6815  xsa260-3.patch
34ad2d35f20f0be9b88ea93454497bd2e5539b91eac767f885257fef19d304e39bcc1ece5e06475208dafb8ca0cfe9941191ccb580037ae4bdb82b249e09bff9  xsa260-4.patch
78c537f82b759bfbcec9d8e7f06b72501695978735a16d4f1ef71dbf5ea87a1e9b1d7fb9a3a56013e4aada33c1d9cb5de74a3b058946285485db20481a7317e1  xsa261-4.9.patch
05dc19a710290b49ba6dbd1181dd0e69fc9ad524870c008813d22c8b0c2d6af573034e7a44b0b75dd2d112989caf1447b0d6b42d007f1bffc3442828a88ac8f3  xsa262-4.9.patch
a8877fe633ac7e887ee1d6cd970840b93c1befb901855e2f51646390565c1794450c86b90a351309567fa5e7e74454e42823fdbd5f8418a63e0141ee1e265501  x86-log-XPTI-enabled-status.patch
0c70e4365619d0e64eab5a791393b430b90a504bf70f6ad55738e54e0f6de4c0a27068ab97455c3f59fb16792ee8710682faeb887a4a839902dd423836ea6903  x86-disable-XPTI-when-RDCL_NO.patch
54554a9a2c2186a690bb96d0b990f3f149cee58c3fd874721e4712995ff702d8d83fd44c1da3b93ebb63400a50775a2567d4e80908717ef6c97751c37cfa128c  x86-spec_ctrl-Updates-to-retpoline-safety-decision-m.patch
1cc28b2d1814bda58ac3d51843d144a5f0245a39615c8dfbd064623177c663053e545017b4a9d6f039a0cd708047555d75021aaf0958b98aa09947aceee72546  x86-spec_ctrl-Fix-several-bugs-in-SPEC_CTRL_ENTRY_FR.patch
af068ac9a2f0fab4e688571a9dc6a16577e87a4758070702b12547a97fed2f77e9a59bc2a64aa5e78f81a275541b73c0f8122d49266236f21901b70b23b53bcc  x86-suppress-BTI-mitigations-around-S3-suspend-resum.patch
eb1f291678134d7f22ed23e66bd5af20dad31654d8f3e53b8c8b4a2e3465e4efe058d1850dbed0ceef1c2cb3d82e1abf049087a359c10cd143624627873f5108  0001-x86-spec_ctrl-Read-MSR_ARCH_CAPABILITIES-only-once.patch
2ee96424f55f148ba6b58cdafb5e3a49bbae8418f18363fd2e16b5e617290d962289a687ab711626db7e1ed56e0b5a83c38e321d784d62abed2b1062af1d9978  0002-x86-spec_ctrl-Express-Xen-s-choice-of-MSR_SPEC_CTRL-.patch
7adaff8730355883f113715be2a6a095b889d0168b900a2d68d96d0563a9cd992ff8de5f521e540fabbed739b2f0f1a1105fad20fb9dab5be8b873d48ad33d9c  0003-x86-spec_ctrl-Merge-bti_ist_info-and-use_shadow_spec.patch
b6ce53f8abe92034bd8b051317d5733cfe282622c24f2b6e2c68b58a4b9b64301a6ca715f79323d13b38db3b9fd82db51ca8c5351be089b8f609e1b8399bd1f9  0004-x86-spec_ctrl-Fold-the-XEN_IBRS_-SET-CLEAR-ALTERNATI.patch
ddc70323d755d63c04db34309022900c8d8ae7a5c7b8786bdfae9f7f8432e70452310bd98a05504b05d9fbf107dfe21e9052c44d96ecae2636ee259069659d03  0005-x86-spec_ctrl-Rename-bits-of-infrastructure-to-avoid.patch
96d12a703ea1174b855df88e8734ebae6544ca5a30dcb7a848d94b04ac50e311d2f4fe3f3d4d8f019d4cddf7e4ac56a457e537248f864d2e4dbad712763d5eee  0006-x86-spec_ctrl-Elide-MSR_SPEC_CTRL-handling-in-idle-c.patch
8620bd970c6b7b0de941a39e1a1c521197e05f030225825b7fe9481b4e8e4c29a9a154de3a3cb3d059b3ef9d829300badf60a1d40fdad947bdc54a7ba3347ecc  0007-x86-spec_ctrl-Split-X86_FEATURE_SC_MSR-into-PV-and-H.patch
09afd8e3c67a9b35280be04d7f3988f34738e77e7258682486889777a6ff66f1971c0d9515a8951476ea663fffe3c220149356a26bb23c7a641ee9864a5b703b  0008-x86-spec_ctrl-Explicitly-set-Xen-s-default-MSR_SPEC_.patch
bc775ed9d3c8da2a5451889ef9e800f97cf72b31b18a84dcc634414cbddf1a45da3af5d41b55ccadc716cd0132e16ae33bef8251353ff113747a26f70801f8f5  0009-x86-cpuid-Improvements-to-guest-policies-for-specula.patch
9a3c0a0dba17481fec5215a87dbc689511eead2c22f8927dbd382b978bf4d8f31ff190f4d842505dc1d9bf21a36422b24ac9b1370d7fa6efbcc532815384d56f  0010-x86-spec_ctrl-Introduce-a-new-spec-ctrl-command-line.patch
2bdaad7daccb67180b06dbd6f9c32aca4b4010da6246034018d8fad8a175151a9bcb277c2dcf339c84d7b413360b06652570418e4a740d3cd00ffda8c6169fa3  0011-x86-AMD-Mitigations-for-GPZ-SP4-Speculative-Store-By.patch
6c67220cb20abda6c4c532d8165ef8aa36488acd3fe87b2385c842848e5e185aa77a2d4bebaf1f70ff7cb6cea8e65d87bb347d64e8372c17e3d9baad48316c39  0012-x86-Intel-Mitigations-for-GPZ-SP4-Speculative-Store-.patch
608615226f87e5b5e0aa6575781a24128095b4c90fd24360cb43e94d488f21b375a2eb5ee69f8a5fc3550b7928457b9a622ac8cef59e3febd602674e2dc3b712  0013-x86-msr-Virtualise-MSR_SPEC_CTRL.SSBD-for-guests-to-.patch
4f03e72d0a6a5ecf1ea576a940a13db1a06e7bf0f4a9533428899df7a77515b5ad42b3cbff6c18aff79d7a493f009b99631da292f69ceebe7ad14e1705ddd263  x86-xpti-avoid-copying-L4-page-table-contents-when-p.patch
66460970095e0f23cfec007c1ea477274bd6d72d0cc54eccbfe1ab9c2092a1d46e5eb614dcec055e4d1e97b86572f2a03abaebad029396e9a07efa2870c0a3b8  xen-x86-add-a-function-for-modifying-cr3.patch
24f236c05ea9c779beda10ae30a65e2890598c8fee7bcfc2559d821720928c1c5fbd22b5f3e15b00a663316fddb927203d501b6c6c65ba34f5aac56f351c6387  xen-x86-support-per-domain-flag-for-xpti.patch
d09e4f9253e239276e1480ca222ea980092116cf17b95f70f5ae1f9687cc5f6d17d2173d4bc865a99c7c637d650f4d5ab550055cf5f3af586bb1885e5b16dae6  xsa267-4.9-1.patch
795d4e8daf4f4d0626e8a8e9b35a4484f935d7f15b1b3b63985f8083ef36ff203db52c9dfe453878171d95af0eb9d9c7521f1debd4943ef8a636b89eaa19c71a  xsa267-4.9-2.patch
52c43beb2596d645934d0f909f2d21f7587b6898ed5e5e7046799a8ed6d58f7a09c5809e1634fa26152f3fd4f3e7cfa07da7076f01b4a20cc8f5df8b9cb77e50  xenstored.initd
093f7fbd43faf0a16a226486a0776bade5dc1681d281c5946a3191c32d74f9699c6bf5d0ab8de9d1195a2461165d1660788e92a3156c9b3c7054d7b2d52d7ff0  xenstored.confd
3c86ed48fbee0af4051c65c4a3893f131fa66e47bf083caf20c9b6aa4b63fdead8832f84a58d0e27964bc49ec8397251b34e5be5c212c139f556916dc8da9523  xenconsoled.initd
30df69cc38d0bed26bc4d6e08a2b62cbdc654d5f663009a05cb3b83b3e3dc5e206362d3fd59abbb753ceb8d6d79eaa6e15d079bb8f4f35dc74667103faf4e85d  xenconsoled.confd
357ab672be7ac36e4b5b056504cd5094d9218c4ea148c2f739d628479ebf0d9c0eb201ea7d4f97f07d01e59b88cafd318de0e1250a5b3db41bd94aa3fb7c7e49  xendomains.initd
c7c0eecd5f454d903b57a710902da27dcb2c6b200f88d4eadfab33a447be6b41454109d482aab849a690446ea5c928e619dfc6cf95b7955f00a476f2317bb82b  xendomains.confd
ab2105c75cfe01768aecd5bcbb56269d63666e8a44e42b6a83aee87df6c84ee2f9ab249171c21b2e09f8fec2cae8318f6e87d160989398a3e7dd68db8d52c426  xen-consoles.logrotate
bdbe15c924071cdc2d0f23e53ba8e3f837d4b5369bfb218abd3405f9bef25d105269aaf0784baeb69c073a5786b8c82ffdfd414e86874da34293cfdc2c497928  xenqemu.confd
8475119369409efb8ad930c7735cd3d782191d18fab4fc322a51120c395162ff88e381182876036d1078afd30079dbf3f94a3568689e9b52ba235adead4b97d3  xenqemu.initd
85afec835a374aac3d307b3226eee7a08a676b1daac7e39bb7463d564ef72438dc27dd188a871cfd031e80c6992b756951f26bdca0d445e07eab6dba5245de46  xendriverdomain.initd"
