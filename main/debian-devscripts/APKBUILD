# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=debian-devscripts
pkgver=2.25.33
pkgrel=0
pkgdesc="Debian developer scripts"
url="https://tracker.debian.org/pkg/devscripts"
arch="noarch"
license="GPL-2.0-or-later"
checkdepends="perl"
# checkbashisms is the common accepted name, but prefix for rest
subpackages="
	$pkgname-doc
	$pkgname-bash-completion
	checkbashisms
	$pkgname-hardening-check:harden
	"
source="$pkgname-$pkgver.tar.gz::https://salsa.debian.org/debian/devscripts/-/archive/v$pkgver/devscripts-v$pkgver.tar.gz"
builddir="$srcdir/devscripts-v$pkgver/scripts"

prepare() {
	default_prepare

	sed -i "s/###VERSION###/$pkgver/" checkbashisms.pl

	mv checkbashisms.pl checkbashisms
	mv hardening-check.pl hardening-check
}

check() {
	printf '#!/bin/sh\necho "hello world"\n' > ./testfile
	perl ./checkbashisms --version
	perl ./checkbashisms ./testfile
}

package() {
	depends="
		checkbashisms=$pkgver-r$pkgrel
		$pkgname-hardening-check=$pkgver-r$pkgrel
		"

	# only these useful for now
	install -Dm755 -t "$pkgdir"/usr/bin/ \
		checkbashisms \
		hardening-check

	install -Dm644 checkbashisms.1 \
		-t "$pkgdir"/usr/share/man/man1/
	install -Dm644 checkbashisms.bash_completion \
		"$pkgdir"/usr/share/bash-completion/completions/checkbashisms
}

checkbashisms() {
	pkgdesc="$pkgdesc (checkbashisms)"
	depends="perl"

	amove usr/bin/checkbashisms
}

harden() {
	pkgdesc="$pkgdesc (hardening-check)"
	depends="perl"

	amove usr/bin/hardening-check
}

sha512sums="
9bbcfed2a45e15bcef7225a1fbc163e24e4ed92b018288b4c3b6b910b45e4c02ed88755283f29d7a665c7d97363d9e7adb025c93006fb55aa16a8cdcf7f4a4d9  debian-devscripts-2.25.33.tar.gz
"
