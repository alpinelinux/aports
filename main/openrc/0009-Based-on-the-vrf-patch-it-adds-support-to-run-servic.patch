From 957fcda029fd248dff9a6f32c14c028ef35eb138 Mon Sep 17 00:00:00 2001
From: Thomas Liske <thomas@fiasko-nw.net>
Date: Sat, 16 Sep 2023 18:25:42 +0200
Subject: [PATCH 2/2] Based on the vrf patch it adds support to run services in
 netns namespaces. It is even possible to stack both options and run services
 in a VRF inside a netns namespace.

---
 sh/openrc-run.sh.in | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/sh/openrc-run.sh.in b/sh/openrc-run.sh.in
index f50b1624..abc91263 100644
--- a/sh/openrc-run.sh.in
+++ b/sh/openrc-run.sh.in
@@ -266,6 +266,11 @@ if [ -n "$vrf" ]; then
 	RC_VRF_EXEC="ip vrf exec $vrf"
 fi
 
+# Add ip netns if configured to run in a netns (netns+vrf may stack)
+if [ -n "$netns" ]; then
+	RC_VRF_EXEC="ip netns exec $netns $RC_VRF_EXEC"
+fi
+
 if yesno "$RC_USER_SERVICES" && [ "$_usr_conf/init.d" != "${RC_SERVICE%/*}" ]; then
 	if ! sourcex -e "$_usr_conf/conf.d/$RC_SVCNAME.$RC_RUNLEVEL"; then
 		sourcex -e "$_usr_conf/conf.d/$RC_SVCNAME"
-- 
2.47.3

