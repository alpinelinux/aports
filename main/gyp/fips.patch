From e1abcf3205b57400a8c81f2a7146edbc65e6d115 Mon Sep 17 00:00:00 2001
From: LN Liberda <lauren@selfisekai.rocks>
Date: Sun, 11 Jan 2026 02:25:33 +0100
Subject: [PATCH] Mark usedforsecurity=False use of hashlib

Port of https://github.com/archlinux/svntogit-packages/blob/2a3fe81edf582af4e97e9954ad20408306273561/trunk/0003-gyp-fips.patch
to gyp-next
---
 pylib/gyp/generator/make.py  | 3 ++-
 pylib/gyp/generator/ninja.py | 4 ++--
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/pylib/gyp/generator/make.py b/pylib/gyp/generator/make.py
index 5f30f39..08d9166 100644
--- a/pylib/gyp/generator/make.py
+++ b/pylib/gyp/generator/make.py
@@ -2170,7 +2170,8 @@ $(obj).$(TOOLSET)/$(TARGET)/%%.o: $(obj)/%%%s FORCE_DO_CMD
 
             # Hash the target name to avoid generating overlong filenames.
             cmddigest = hashlib.sha1(
-                (command or self.target).encode("utf-8")
+                (command or self.target).encode("utf-8"),
+                usedforsecurity=False,
             ).hexdigest()
             intermediate = "%s.intermediate" % cmddigest
             self.WriteLn("{}: {}".format(" ".join(outputs), intermediate))
diff --git a/pylib/gyp/generator/ninja.py b/pylib/gyp/generator/ninja.py
index bc9ddd2..c899785 100644
--- a/pylib/gyp/generator/ninja.py
+++ b/pylib/gyp/generator/ninja.py
@@ -810,7 +810,7 @@ class NinjaWriter:
                 if self.flavor == "win":
                     # WriteNewNinjaRule uses unique_name to create a rsp file on win.
                     extra_bindings.append(
-                        ("unique_name", hashlib.md5(outputs[0]).hexdigest())
+                        ("unique_name", hashlib.md5(outputs[0], usedforsecurity=False).hexdigest())
                     )
 
                 self.ninja.build(
@@ -2803,7 +2803,7 @@ def GenerateOutputForConfig(target_list, target_dicts, data, params, config_name
             build_file, name, toolset
         )
         qualified_target_for_hash = qualified_target_for_hash.encode("utf-8")
-        hash_for_rules = hashlib.md5(qualified_target_for_hash).hexdigest()
+        hash_for_rules = hashlib.md5(qualified_target_for_hash, usedforsecurity=False).hexdigest()
 
         base_path = os.path.dirname(build_file)
         obj = "obj"
