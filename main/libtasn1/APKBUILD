# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libtasn1
pkgver=3.6
pkgrel=3
pkgdesc="The ASN.1 library used in GNUTLS"
url="http://www.gnu.org/software/gnutls/"
arch="all"
license="GPL3 LGPL"
subpackages="$pkgname-dev $pkgname-doc"
depends=
makedepends="texinfo"
install=
source="ftp://ftp.gnu.org/gnu/$pkgname/$pkgname-$pkgver.tar.gz
	CVE-2015-2806.patch
	CVE-2015-3622.patch
	CVE-2016-4008.patch
	"

_builddir="$srcdir"/$pkgname-$pkgver

prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

prepare() {
        local i
        cd "$_builddir"
        #update_config_sub || return 1
        for i in $source; do
                case $i in
                *.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
                esac
        done
}

build() { 
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la || return 1
}

md5sums="6ed38e161e11013054f2a2bb4c4da449  libtasn1-3.6.tar.gz
4a0e850f458a1ae1a94f419e47e2390b  CVE-2015-2806.patch
fbe5e8a0a79f3d46b4c214ddbc14166d  CVE-2015-3622.patch
536fc9b1ca168805b7c0131f8e6c5987  CVE-2016-4008.patch"
sha256sums="19e34766a38abc74cec1863cc30c8a4e13f763310ecaf7a5e861ba1d143ea430  libtasn1-3.6.tar.gz
203076736bcac3e31bc0f6e2c6b16db28d0e66e9e734656d27d2ee938443f4c2  CVE-2015-2806.patch
02eb371e987731c6558a8870553d90c54feefc86de1ab6f8536bc9dd2728f105  CVE-2015-3622.patch
ef347ecb87acda6d472f568461be07729939a33fead0dbac3812d163551a0410  CVE-2016-4008.patch"
sha512sums="c682cd7502c687e3a304216366fdbb9de62052cb5f3394bbe1172ccb5eae8fd00bbf7282ad642c58a6be5f1ad224353a4a3f7d9a6bad14ab7016d530883a5d9e  libtasn1-3.6.tar.gz
7107e5a25208118994f508731f0d219734dc1f61d3ae991d6bacdcacf5759dbecf21b10e2ff49b7dc9f22af405fcd7480feeb93cc5d2854ff9311497431ca9f8  CVE-2015-2806.patch
535784b109de72363c1efe02c42b60a0486c19270f9b8ffb53f08db2879a11f5c3e9072782631800da848ef0e95176223a2912752faa13b14ee36a81ae96c60d  CVE-2015-3622.patch
0c2b639df74ea9ff386a429f499d5e4764efeed4686c8ec28bd18d75c07eba84bfe21b5780d2115aebefe6a54ffe87cc5fac28b82b00bc2f5a47c090d3bd8fd7  CVE-2016-4008.patch"
