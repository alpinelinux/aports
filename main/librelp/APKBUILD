# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=librelp
pkgver=1.12.0
pkgrel=0
pkgdesc="The Reliable Event Logging Protocol library"
url="https://www.rsyslog.com"
arch="all"
license="GPL-3.0-or-later"
makedepends="openssl-dev"
checkdepends="
	bash
	coreutils
	grep
	"
subpackages="$pkgname-static $pkgname-dev"
source="https://download.rsyslog.com/librelp/librelp-$pkgver.tar.gz"
options="!check" # XXX: some fail in CI, don't know why

build() {
	# --disable-tls disables just GnuTLS
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--mandir=/usr/share/man \
		--enable-valgrind=no \
		--disable-tls \
		--enable-tls-openssl
	make
}

check() {
	make -j1 check || {
		cat tests/test-suite.log
		return 1
	}
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
16c5014202656aa9b1b164a863b5c170da0f2cda1308f44a09e0e7cd2163a2e364cac95779d061031dbf1a6da929a296739ba6d012787fc7c58bc0e59d37c3f7  librelp-1.12.0.tar.gz
"
