Patch-Source: https://github.com/LudovicRousseau/PCSC/pull/243
---
From 8028cf0fcd757f2debe4cc108bd0cf58afa9a850 Mon Sep 17 00:00:00 2001
From: Ludovic Rousseau <ludovic.rousseau@free.fr>
Date: Wed, 10 Dec 2025 15:55:29 +0100
Subject: [PATCH] meson: install systemd files even if libsystemd is not used

See: https://github.com/LudovicRousseau/PCSC/pull/243
---
 meson.build | 14 ++++++++------
 1 file changed, 8 insertions(+), 6 deletions(-)

diff --git a/meson.build b/meson.build
index 4d4d2bf9..1b2926f4 100644
--- a/meson.build
+++ b/meson.build
@@ -127,11 +127,19 @@ if get_option('polkit')
   features += 'polkit'
 endif
 
+systemdunit = get_option('systemdunit')
 if get_option('libsystemd')
   systemd_dep = dependency('libsystemd')
   pcscd_dep += systemd_dep
   conf_data.set('USE_LIBSYSTEMD', true)
   features += 'systemd'
+
+  systemd = dependency('systemd')
+  systemdsystemunitdir = systemd.get_variable(pkgconfig : 'systemd' + systemdunit + 'unitdir')
+  sysusersdir = systemd.get_variable(pkgconfig : 'sysusersdir')
+else
+  systemdsystemunitdir = get_option('prefix') / 'lib' / 'systemd' / systemdunit
+  sysusersdir = get_option('prefix') / 'sysusers.d'
 endif
 
 # architecture
@@ -291,11 +299,6 @@ configure_file(output : 'pcsclite.h',
 configure_file(output : 'pcscd.h',
   input : 'src/pcscd.h.in',
   configuration : confgen_data)
-if get_option('libsystemd')
-  systemd = dependency('systemd')
-  unit = get_option('systemdunit')
-  systemdsystemunitdir = systemd.get_variable(pkgconfig : 'systemd' + unit + 'unitdir')
-  sysusersdir = systemd.get_variable(pkgconfig : 'sysusersdir')
 configure_file(output : 'pcscd.socket',
   input : 'etc/pcscd.socket.in',
   install_dir : systemdsystemunitdir,
@@ -306,7 +309,6 @@ configure_file(output : 'pcscd.service',
   configuration : confgen_data)
 install_data('etc/pcscd-sysusers.conf',
   install_dir : sysusersdir)
-endif
 configure_file(output : 'pcscd.8',
   input : 'doc/pcscd.8.in',
   install_dir : join_paths(get_option('mandir'), 'man8'),
