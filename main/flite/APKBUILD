# Contributor: Natanael Copa <ncopa@alpinelinux.org>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=flite
pkgver=2.0.0
pkgrel=0
pkgdesc="Small, fast speech synthesis engine (text-to-speech)"
url="http://www.speech.cs.cmu.edu/flite/"
arch="all"
license="MIT"
depends=
depends_dev=
makedepends="$depends_dev"
install=""
subpackages="$pkgname-dev"
source="http://www.festvox.org/flite/packed/flite-${pkgver%.*}/flite-$pkgver-release.tar.bz2"

builddir="$srcdir"/flite-$pkgver-release
prepare() {
	local i
	cd "$builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i;;
		esac
	done
}

build() {
	cd "$builddir"
	CFLAGS="$CFLAGS -fPIC" ./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--enable-shared \
		--localstatedir=/var
	# work around parallel build issue
	make -C include
	make -C src
	make -C lang
	make -C tools
	make -j1
}

package() {
	cd "$builddir"
	make install INSTALLBINDIR="$pkgdir"/usr/bin \
		INSTALLLIBDIR="$pkgdir"/usr/lib \
		INSTALLINCDIR="$pkgdir"/usr/include/flite
	# remove relative rpaths
	scanelf -R -r --fix "$pkgdir"
	mkdir -p "$pkgdir"/usr/lib/pkgconfig
	cat > "$pkgdir"/usr/lib/pkgconfig/flite.pc <<EOF
prefix=/usr
exec_prefix=\${prefix}
libdir=\${exec_prefix}/lib
includedir=\${prefix}/include

Name: flite
Description: a text to speech library
Requires:
Version: 2.0.0
Libs: -L\${libdir} -lflite -lflite_cmu_grapheme_lang -lflite_cmu_grapheme_lex -lflite_cmu_indic_lang -lflite_cmu_indic_lex -lflite_cmulex -lflite_cmu_time_awb -lflite_cmu_us_awb -lflite_cmu_us_kal16 -lflite_cmu_us_kal -lflite_cmu_us_rms -lflite_cmu_us_slt -lflite_usenglish
Libs.private: -lm
Cflags: -I\${includedir}/flite/
EOF
}

sha512sums="e2b353721d0316fbd7948f90f9c9561d080eebd50e8dd0449a9c803ffbdb060a469385fadd63f535ade8d627cba37928d8e72ac61d5bcf98f73ca5ebb66549f8  flite-2.0.0-release.tar.bz2"
