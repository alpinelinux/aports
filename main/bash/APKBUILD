# Contributor: ≈Åukasz Jendrysik <scadu@yandex.com>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=bash
pkgver=4.3.48
_patchlevel=${pkgver##*.}
_myver=${pkgver%.*}
_patchbase=${_myver/./}
pkgrel=2
pkgdesc="The GNU Bourne Again shell"
url="http://www.gnu.org/software/bash/bash.html"
arch="all"
license="GPL3+"
makedepends_build="bison flex"
makedepends_host="readline-dev ncurses-dev"
depends=""
install="$pkgname.post-install $pkgname.post-upgrade $pkgname.pre-deinstall"
subpackages="$pkgname-doc"
source="http://ftp.gnu.org/gnu/bash/bash-${_myver}.tar.gz
	bash-noinfo.patch
	privmode-setuid-fail.patch
	CVE-2016-9401.patch
	"
# generate url's to patches. note: no forks allowed!
_i=1
_pad="00"
while [ $_i -le $_patchlevel ]; do
	[ $_i -ge 10 ] && _pad="0"
	[ $_i -ge 100 ] && _pad=
	source="$source http://ftp.gnu.org/gnu/bash/bash-$_myver-patches/bash$_patchbase-$_pad$_i"
	_i=$(( $_i + 1))
done

_builddir="$srcdir"/$pkgname-$_myver
prepare() {
	local p
	cd "$_builddir"
	update_config_sub || return 1
	for p in $source; do
		case $p in
		*.patch|*/bash[0-9][0-9]-[0-9]*)
			msg "$p"
			patch -p0 -i "$srcdir"/${p##*/} || return 1
			;;
		esac
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--bindir=/bin \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--with-curses \
		--disable-nls \
		--enable-readline \
		--without-bash-malloc \
		--with-installed-readline \
		|| return 1
	# parallel build workarounds
	make y.tab.c && make builtins/libbuiltins.a && make || return 1
}

package() {
	cd ${startdir}/src/${pkgname}-${_myver}
	make DESTDIR=${pkgdir} install || return 1

	rm -rf "$pkgdir"/usr/share/locale
}

md5sums="81348932d5da294953e15d4814c74dd1  bash-4.3.tar.gz
80fec5f3d60a63756a4999c877e31a8e  bash-noinfo.patch
a577d42e38249d298d6a8d4bf2823883  privmode-setuid-fail.patch
0d8a6627e31e0647ee135981df6295a1  CVE-2016-9401.patch
1ab682b4e36afa4cf1b426aa7ac81c0d  bash43-001
8fc22cf50ec85da00f6af3d66f7ddc1b  bash43-002
a41728eca78858758e26b5dea64ae506  bash43-003
bf8d53d227829d67235927689a03cc7a  bash43-004
c0c00935c8b8ffff76e8ab77e7be7d15  bash43-005
6f01e364cd092faa28dd7119f47ddb5f  bash43-006
dcf471d222bcd83283d3094e6ceeb6f8  bash43-007
f7553416646dc26c266454c78a916d36  bash43-008
7e73d2151f4064b484a4ba2c4b09960e  bash43-009
a275463d21735bb6d7161f9fbd320d8f  bash43-010
c17103ee20420d77e46b224c8d3fceda  bash43-011
3e2a057a19d02b3f92a3a09eacbc03ae  bash43-012
fb377143a996d4ff087a2771bc8332f9  bash43-013
1a1aaecc99a9d0cbc310e8e247dcc8b6  bash43-014
4f04387458a3c1b4d460d199f49991a8  bash43-015
90e759709720c4f877525bebc9d5dc06  bash43-016
11e4046e1b86070f6adbb7ffc89641be  bash43-017
cd5a9b46f5bea0dc0248c93c7dfac011  bash43-018
cff4dc024d9d3456888aaaf8a36ca774  bash43-019
167839c5f147347f4a03d88ab97ff787  bash43-020
1d350671c48dec30b34d8b81f09cd79d  bash43-021
11c349af66a55481a3215ef2520bec36  bash43-022
b3cb0d80fd0c47728264405cbb3b23c7  bash43-023
b5ea5600942acceb4b6f07313d2de74e  bash43-024
193c06f578d38ffdbaebae9c51a7551f  bash43-025
922578e2be7ed03729454e92ee8d3f3a  bash43-026
8ff6948b16f2db5c29b1b9ae1085bbe7  bash43-027
dd51fa67913b5dca45a702b672b3323f  bash43-028
0729364c977ef4271e9f8dfafadacf67  bash43-029
efb709fdb1368945513de23ccbfae053  bash43-030
236df1ac1130a033ed0dbe2d2115f28f  bash43-031
2360f7e79cfb28526f80021025ea5909  bash43-032
b551c4ee7b8713759e4143499d0bbd48  bash43-033
c9a56fbe0348e05a886dff97f2872b74  bash43-034
e564e8ab44ed1ca3a4e315a9f6cabdc9  bash43-035
b00ff66c41a7c0f06e191200981980b0  bash43-036
be2a7b05f6ae560313f3c9d5f7127bda  bash43-037
61e0522830b24fbe8c0d1b010f132470  bash43-038
a4775487abe958536751c8ce53cdf6f9  bash43-039
80d3587c58854e226055ef099ffeb535  bash43-040
20bf63eef7cb441c0b1cc49ef3191d03  bash43-041
70790646ae61e207c995e44931390e50  bash43-042
855a46955cb251534e80b4732b748e37  bash43-043
29623d3282fcbb37e1158136509b5bb8  bash43-044
4473244ca5abfd4b018ea26dc73e7412  bash43-045
7e5fb09991c077076b86e0e057798913  bash43-046
8483153bad1a6f52cadc3bd9a8df7835  bash43-047
e9f5dc12a32b2e0d3961344e794f92b3  bash43-048"
sha256sums="afc687a28e0e24dc21b988fa159ff9dbcf6b7caa92ade8645cc6d5605cd024d4  bash-4.3.tar.gz
363bc919d98cadbfca27660be0d1d4bb6cfe1c5f86a7830966e456df36e46792  bash-noinfo.patch
6bc2d4e48ad05fb3c8aac120a012baf1911f6522464ed18c8232b111a40b7901  privmode-setuid-fail.patch
d30d949bcfde8db0d34485200aa2917440e77db84fb00a230aa691b4439666c1  CVE-2016-9401.patch
ecb3dff2648667513e31554b3ad054ccd89fce38e33367c9459ac3a285153742  bash43-001
eee7cd7062ab29a9e4f02924d9c367264dcb8b162703f74ff6eb8f175a91502b  bash43-002
000e6eac50cd9053ce0630db01239dcdead04a2c2c351c47e2b51dac1ac1087d  bash43-003
5ea0a42c6506720d26e6d3c5c358e9a0d49f6f189d69a8ed34d5935964821338  bash43-004
1ac83044032b9f5f11aeca8a344ae3c524ec2156185d3adbb8ad3e7a165aa3fa  bash43-005
a0648ee72d15e4a90c8b77a5c6b19f8d89e28c1bc881657d22fe26825f040213  bash43-006
1113e321c59cf6a8648a36245bbe4217cf8acf948d71e67886dad7d486f8f3a3  bash43-007
9941a98a4987192cc5ce3d45afe879983cad2f0bec96d441a4edd9033767f95e  bash43-008
c0226d6728946b2f53cdebf090bcd1c01627f01fee03295768605caa80bb40a5  bash43-009
ce05799c0137314c70c7b6ea0477c90e1ac1d52e113344be8e32fa5a55c9f0b7  bash43-010
7c63402cdbc004a210f6c1c527b63b13d8bb9ec9c5a43d5c464a9010ff6f7f3b  bash43-011
3e1379030b35fbcf314e9e7954538cf4b43be1507142b29efae39eef997b8c12  bash43-012
bfa8ca5336ab1f5ef988434a4bdedf71604aa8a3659636afa2ce7c7446c42c79  bash43-013
5a4d6fa2365b6eb725a9d4966248b5edf7630a4aeb3fa8d526b877972658ac13  bash43-014
13293e8a24e003a44d7fe928c6b1e07b444511bed2d9406407e006df28355e8d  bash43-015
92d60bcf49f61bd7f1ccb9602bead6f2c9946d79dea0e5ec0589bb3bfa5e0773  bash43-016
1267c25c6b5ba57042a7bb6c569a6de02ffd0d29530489a16666c3b8a23e7780  bash43-017
7aa8b40a9e973931719d8cc72284a8fb3292b71b522db57a5a79052f021a3d58  bash43-018
a7a91475228015d676cafa86d2d7aa9c5d2139aa51485b6bbdebfdfbcf0d2d23  bash43-019
ca5e86d87f178128641fe91f2f094875b8c1eb2de9e0d2e9154f5d5cc0336c98  bash43-020
41439f06883e6bd11c591d9d5e9ae08afbc2abd4b935e1d244b08100076520a9  bash43-021
fd4d47bb95c65863f634c4706c65e1e3bae4ee8460c72045c0a0618689061a88  bash43-022
9ac250c7397a8f53dbc84dfe790d2a418fbf1fe090bcece39b4a5c84a2d300d4  bash43-023
3b505882a0a6090667d75824fc919524cd44cc3bd89dd08b7c4e622d3f960f6c  bash43-024
1e5186f5c4a619bb134a1177d9e9de879f3bb85d9c5726832b03a762a2499251  bash43-025
2ecc12201b3ba4273b63af4e9aad2305168cf9babf6d11152796db08724c214d  bash43-026
1eb76ad28561d27f7403ff3c76a36e932928a4b58a01b868d663c165f076dabe  bash43-027
e8b0dbed4724fa7b9bd8ff77d12c7f03da0fbfc5f8251ef5cb8511eb082b469d  bash43-028
4cc4a397fe6bc63ecb97d030a4e44258ef2d4e076d0e90c77782968cc43d6292  bash43-029
85434f8a2f379d0c49a3ff6d9ffa12c8b157188dd739e556d638217d2a58385b  bash43-030
cd529f59dd0f2fdd49d619fe34691da6f0affedf87cc37cd460a9f3fe812a61d  bash43-031
889357d29a6005b2c3308ca5b6286cb223b5e9c083219e5db3156282dd554f4a  bash43-032
fb2a7787a13fbe027a7335aca6eb3c21cdbd813e9edc221274b6a9d8692eaa16  bash43-033
f1694f04f110defe1330a851cc2768e7e57ddd2dfdb0e3e350ca0e3c214ff889  bash43-034
370d85e51780036f2386dc18c5efe996eba8e652fc1973f0f4f2ab55a993c1e3  bash43-035
ac5f82445b36efdb543dbfae64afed63f586d7574b833e9aa9cd5170bc5fd27c  bash43-036
33f170dd7400ab3418d749c55c6391b1d161ef2de7aced1873451b3a3fca5813  bash43-037
adbeaa500ca7a82535f0e88d673661963f8a5fcdc7ad63445e68bf5b49786367  bash43-038
ab94dced2215541097691f60c3eb323cc28ef2549463e6a5334bbcc1e61e74ec  bash43-039
84bb396b9262992ca5424feab6ed3ec39f193ef5c76dfe4a62b551bd8dd9d76b  bash43-040
4ec432966e4198524a7e0cd685fe222e96043769c9613e66742ac475db132c1a  bash43-041
ac219322db2791da87a496ee6e8e5544846494bdaaea2626270c2f73c1044919  bash43-042
47a8a3c005b46e25821f4d8f5ccb04c1d653b1c829cb40568d553dc44f7a6180  bash43-043
9338820630bf67373b44d8ea68409f65162ea7a47b9b29ace06a0aed12567f99  bash43-044
ba6ec3978e9eaa1eb3fabdaf3cc6fdf8c4606ac1c599faaeb4e2d69864150023  bash43-045
b3b456a6b690cd293353f17e22d92a202b3c8bce587ae5f2667c20c9ab6f688f  bash43-046
c69248de7e78ba6b92f118fe1ef47bc86479d5040fe0b1f908ace1c9e3c67c4a  bash43-047
5b8215451c5d096ca1e115307ffe6613553551a70369525a0778f216c3a4dfa2  bash43-048"
sha512sums="a852b8e46ee55568dce9d23a30a9dbd1c770c2d2a4bc91e1c3177d723b31b32c5d69d19704a93f165891b409b9dd2cc65723372044e2bd0ee49ed59a11512651  bash-4.3.tar.gz
74d51550cc03410f22ffea13f6452350d1e5564bff619fb07a5bbef14ca565fbe03770a2c0041292732cda16e8944b33ccbd0dfe29a606a068fedabe277cd6ae  bash-noinfo.patch
c5804ace658f9d7f957d4b98bebab4d8eb0ba3dd2dd155a480c7f9b0f17b06ced344b4b4c9f52ef1d5c0cabb047bce5237c350f53b95cf6c95e156ab4ab9e8a9  privmode-setuid-fail.patch
6907974352bf009a03862794eebc5963f33b7ab9d3768f1cde92f86d9dc899ffb7f139768509161abcd40fa2c2f876db118ca1d8b8d78fba6f30360364d2ec11  CVE-2016-9401.patch
a1011392652180a28f9837af4a341a80beb929c1458e2384e282f0007713c5fe8d0b315abf1340b3707748d3caed322135dee87b59eeb7612ee5130f87d79888  bash43-001
e3178c85f553522d5d1c5fd39e76f015b680a8ccc84836a5e10283b2aed6e5b7cc3d23af0e67a270b7622dce0abf35dd8a95afa9bb6f89b73a9439f7435175a4  bash43-002
dc2c5fad8d357d1301e419afd959dfaf015a63172857080c11f77ab1bb7d1d737f411eb0e70a861f98a36bed1b19edb7217a4fa9f4773e21706b62dc56ec3464  bash43-003
6a5177d5f4205ca9d3824601052dc6d0cd768638cdfc125501c5643dd51d537f5d075cbd11a10356caf4205e47a0287c72636065789ecce264129fc92fbda420  bash43-004
e201aa8ef0ce0d74fa5ee42e8171bbb5ba633d831d863a8e8afc5d5157581bb055d16c52b316cc945979a852b0eae7921244a24b89818acfb7c96572ed04d1f8  bash43-005
d1da3c9d3781482d87cdcbfd69ab3958ed4950f2a00e9d15228ecb4ad5ca8ae253eff378010b4908d04df2ecf658e08f7c2efc97d6a0b8dd2317552c1895d7b2  bash43-006
c445b5cdd486d06991c78d4c88e2e44e49f74d1fc07b8e4bc9492cccfc4ff4045587bed6b24d745974c6339340e45b9756c27723fdb79e7591e7d6c5d350a86e  bash43-007
53bae88cd3341a4ef8c60d6a294c09402103d1b20f485cf85775e6730a3d2eec8e6ebe15aa6dd95336e4a1f540f21db394823b9d04b416e5af071a7a6c618900  bash43-008
8d06fe612cd32cb414fdcdc34d4420b8991b268dd3ddd2dd47b3d01679954debd78e21f697a7f495d2340f0dcc8acdc3ad6809b8870bf5fd300afb1439788776  bash43-009
e36e550d749f52bab01256ed5f8f1b48fe53190c1a0a0a15c545328261c1f50b85f574b44188855858de1f2d045945770c4940bdecadd8381ea2cf174bde2fee  bash43-010
678bbcd92b927c86631cd42d6d3ab7596a3ffd20b640f471a9783a7972f05d2d4fb15970c12e7645e90d407c5a2d2aadcad698113211724b0ef8d89eccd2cd66  bash43-011
169453248edb55baf761b0c9c7b296ed2c24543b80fcf4756b8dd398054b6317da285c5e9cd68828f2620b05874f21a08773844ee32416daef76b88d0ef3ee6d  bash43-012
536bbf0c9b23eb824579955e7fce892cfc1e1d9fbcfc66810353ac4ff238e9e57361c0a46b3f3573ca8ca563331070ce55442ffea38e2a632840b6a318db1c88  bash43-013
79fb50f62dbdca5e45a1359570e6d2173d442b3d4ddd4eb44809ed45ac022de4fe3f0aadd7672b4c8d9739405d51762486ee0c677b56f9c7d60e6224be84b87a  bash43-014
38a7af22f13f1f45705ceadf3abb52be75f3239959c2b1d57f333d137f25f14ed92c4d209b35417d449b1ec4291bbd984bb5fd11ad40375b22d2668b33fb8efb  bash43-015
52ab2966ccd42554c8bd76041e07921388220b46c93c34190197cdda38a085fd499d71e2e0a10daea130e6782ada556f35b1a37d06d023e83c4c4d665d07cd3f  bash43-016
88b11f324a780823b459b1e8a0904348c56079b4103cb86025d34dbba02543b0b7fbc2397bf043c24c1363f30539a6fe9b9f9fc717be9798f466071d1d420bb9  bash43-017
f83d8e1d6d8fa8adf1715b8d4130730a13f5cd626f75e9e4b8c63244645a45a3f1fbac03081bb9d1e46864919d1b3189a9bb6d7a5e7a8854e6270ab3269c771f  bash43-018
77e6dac3079d9282f6f85940a762b0da2473ac0d35e9bad2ebc2862bf0f3c4376a6220c746c1c37de0b4d492251ec9531a62c8a042a1be5e485f8f5ae6fa0704  bash43-019
fa06563eb46609115750ffa88098b07c608cc8b13fc31356f33e1428a4da4d2610e122e0241356afcfadfecc5ccee5db4b7cf07f74005e7f30240ada4a81b5f7  bash43-020
90dc85302d9bc60e68fa8cce472b7e022d8a6ccee361f97aad4cbe5f1585b4870ab9997a3e6fac420aaf84c3dce9757716eb08f4fa6b38e14bac4f2d5d503731  bash43-021
721b772349f9e0cc65975e419fabe4acdb23c77796a5d8fde01f110687ea1cb7d23fb706fc0452fb3c2082958a81c95b82f277e1f8f722b1156913efd59afc30  bash43-022
d45b5f5dc4682c7260c8b6ef6faa99c929d2159cc34534931790f71f76e7324376e4a5d4a2a3bc21c16c25a8206554580943e7a3f672ec5a4af16cbccd216819  bash43-023
eada2b4839b81f28f63a874e08c72dfee9708c0982d2447347c17770a29c8fbb3d3f8c58c8a22b0d46a9d10abbd79dec11b5815257fb39af06420ef3602f8499  bash43-024
b4ea28ea0a24c8609d5c3a10114c5fec87ab978ec60700c36992d093e7afd976dbaee4a0d62c6e41e8ed6674c356fc26589f4c5168642dec8df8d727d7127822  bash43-025
d55620c86ab4835eaf53c18033a939e00ebbef7045d1429bd6fb212be6da167c368b4c03aec6c00ba60a1363b9cf8a4828e85c8108c5476b4a342e6c57f03897  bash43-026
6941156db9a6ab35b2d6ddc63eec064e03da779e29f47e33b467711e3405c9adb58ad33be3ad3c77aea1e84a314d5404c8e1a8475408991f5f719b93c5a276b3  bash43-027
4317380539e3a93167f195eddd0acf0c75a5d86d5ef243cb7f7dca43e745badc3ebbc081b099678ac17dc03d9a3ed4a3ff3c6636bb1887e73e94b8ff9ced7c88  bash43-028
e25783c7557c1cda8344ba779d59f83e26b90b0aca393b5f7ee389e0583ccf81eba394589e992b33eb6c969083a8a4ff7fc8ce52059cab3b71289d085d381f07  bash43-029
ae41a9a5326ceb8e7105e359be097e14876160f6357bfa7c5cd3c4a495a629be762c3db671754c2cffc6abb34998aad91dde4a449ba16a0c6da844bac53feca4  bash43-030
3178b4ab48860ed284bb64ac9b36b6d4d1681c0d4bc37ceeb93e73c9dd140bd0a71e86a86ae595aab43babedae79d75a4b11c57e6ad6800f43ab5f7647f6c4c9  bash43-031
47afc6308bd4bed20661a87761330854508a745a1c2a7f2d661fbe0d95b00d2d5707cc04f510fcd027b3fdb065d9414697715bff33c707a56955e27341d1bfd0  bash43-032
3eed328960d77317e1742a9b53ccf40b304657cd535d7f283bdc24219c65ebdcb7aca3019fc8fd9e7152f42dc411625acb1b529f80e4a6c5b750b8f7cbd2e4d0  bash43-033
95d09b843287dc18845b75ac6657a2bd7bd71c31a62f922e7177368678ddf13c0f20498bc17bdf4cd5c1c34d40838174791d1e464ceca168957c68e789e34d06  bash43-034
1ea68e7ffb15356fdcf5eed08dd7fe0e16aea2928a4510fcfafe79e926d7ac25f013641bf547bfff0401bbb7e1476a802208e4f1ccb8b02ed20c094f99e450d2  bash43-035
089a05879b8b65c9f11c55127364a3281b651e71cbedfad6221e31dc88eca15d813986f999a22921726873db9590b7b50afcd6162027fe516c2a94e8734e3ee7  bash43-036
7977c0fb9142cdea259b06322092aab3231b9773cc397519bedb6f731aea02a46441c67615b31fd19c886678eb1985687d07357d15fc7f08e946404efc564966  bash43-037
2ef2557b17867b5820a9e5619daa1cddb3fadcff7470504c148828a3007217767da4bf540dc835cf263f9c943b2c1aa909c845f8410f69e2d04c8b3d659efee3  bash43-038
f9745a05bfbbe39f8e5af3865de3a32391d7ff291289977e23340c79a3783b4fad15bdcf8ce62478916b43fe18501c4d7c65cd54d3c20e8bb889919df48a9a19  bash43-039
25a0696f1f0e78cb971afa404e0b7fe634b70d49d6a5a9d6ff5506c42063968e8ede83ad80bd0b79601363676fe3abfedc3b76984f6f9ad2e7798790682e21d0  bash43-040
d75cdd6a1fb8aeb1a4e88f046cfea3ec493b994b96f60f27d5577b59408422bb7c51cc4525cadab821fd8c57f44fb07f811b087d077359242caff3b54cfc6819  bash43-041
01a6601029c0a55c9bf1a4ace3f387f9d094a9b9ee3511e2113c000123d85b1d5813c369e62d5a6dd329f515ef0d67d11394a6c0e4516956387556c13d13009a  bash43-042
eb05e537fac08587d0755ad59218bb5a51685aefc1476d6e3feaf72acd1e08cbda512988d8c157425e7939863b313d1e36f51b32f8a8497655c6b0710a24b738  bash43-043
2937ef80c99e93094e4aaa6a93d077efc3e433a4712c17e30590a0abeb5488293365cb8aa19e37d25b7d5c38d3ad26cdea12b904e5ffb2cdb16f18ab12f422fd  bash43-044
7b79dacff44e5358da736334d2277a2879ca1389e22e9dac50e139f30dab623bc89a56930d89e74efc468a00d051f6747ccaffcd1a30d7c737d49780b9830e3d  bash43-045
c036b659fa681f8129110356bec33fad00fb8e469f3b4bcefd0b7ddf5e20030977716adf5c65f58f3ff68cd7af0bdd42392ee077100bc7f45ee123749d082f7d  bash43-046
9332d680ac226491cf8e5986a3261eb76b53ef4b0b2a43405564b088afc0e8658077812c9177bdab7900e05394e69f3047d82ddb59553fc01ef721acfa9d5553  bash43-047
7c3963bfbc730b4592668460e86c166e727e9897c1a9235a6860a01bc90d365ef0707f0fac7ed62780dcc84e80dbe8484ec59e9e948def22f44ae03e8a169780  bash43-048"
