# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=postgresql-common
pkgver=1.3
pkgrel=0
pkgdesc="Common files for PostgreSQL"
url="https://www.postgresql.org/"
arch="noarch"
license="MIT"
install="$pkgname.pre-install $pkgname.pre-deinstall"
triggers="$pkgname.trigger=/usr/libexec/postgresql*:/usr/share/postgresql*"
subpackages="$pkgname-openrc"
source="pg_versions
	postgresql.initd
	postgresql.confd
	"
builddir="$srcdir"
options="!check"  # no tests

# secfixes:
#   0:
#     - CVE-2019-3466

package() {
	mkdir -p "$pkgdir"

	install -D -m755 "$srcdir"/pg_versions "$pkgdir"/usr/sbin/pg_versions
}

openrc() {
	pkgdesc="OpenRC init scripts for PostgreSQL"
	depends=""
	replaces="postgresql-openrc"  # for backward compatibility
	# Do not set install_if here.

	install -D -m755 "$srcdir"/postgresql.initd "$subpkgdir"/etc/init.d/postgresql
	install -D -m644 "$srcdir"/postgresql.confd "$subpkgdir"/etc/conf.d/postgresql
}

sha512sums="
3da6244dc23d89fd337ff76cdf619d9a13ef0545cb169b8592ad871e3e79719667e685d42acbd0aacee4c2aa556753530642cb24cc1322a2068f639d0b874b2b  pg_versions
3194f99665eaa4c2e7c8302d5368b5a456e0c6e2da1125b5bd3b8ce449ff4089196159b0346acac1806d74960b6a49c8e94223f346d0a839038cd72da73dff3b  postgresql.initd
4b8099084307db587811b9cb728831326803c6c11d6c76410c68395eead366476c6c52502b87f4b6c6c07be404c5e882e9fc2bcaa950e14198a3cbecd5f8f9a3  postgresql.confd
"
