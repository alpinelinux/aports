From 903c249b2769841af71e84051f51186e68b6674c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Pablo=20Correa=20G=C3=B3mez?=
 <pabloyoyoista@postmarketos.org>
Date: Mon, 20 Oct 2025 17:40:48 +0200
Subject: [PATCH] setup-disk: make /usr-merge on bootstrapping opt-in

---
 setup-disk.in | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/setup-disk.in b/setup-disk.in
index 9c12e80..37824db 100644
--- a/setup-disk.in
+++ b/setup-disk.in
@@ -662,8 +662,10 @@ install_mounted_root() {
 	done
 
 	init_chroot_mounts "$mnt"
-	mkdir -p "$mnt"/usr/lib "$mnt"/usr/bin "$mnt"/usr/sbin
-	ln -s usr/bin usr/sbin usr/lib "$mnt"/
+	if [ "$BOOTSTRAP_USR_MERGED" = "1" ]; then
+		mkdir -p "$mnt"/usr/lib "$mnt"/usr/bin "$mnt"/usr/sbin
+		ln -s usr/bin usr/sbin usr/lib "$mnt"/
+	fi
 	apk add --root "$mnt" $apkflags --overlay-from-stdin \
 		$repoflags $pkgs <$ovlfiles
 	local ret=$?
-- 
GitLab

