# Contributor: Carlo Landmeter <clandmeter@gmail.com>
# Maintainer: Carlo Landmeter <clandmeter@gmail.com>
pkgname=freetype
pkgver=2.5.0.1
pkgrel=2
pkgdesc="TrueType font rendering library"
url="http://freetype.sourceforge.net"
arch="all"
license="GPL"
depends=
depends_dev="zlib-dev"
makedepends="$depends_dev libpng-dev"
subpackages="$pkgname-dev"
source="http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.gz
20-enable-spr.patch
30-enable-valid.patch
40-memcpy-fix.patch
freetype-2.5.0-CVE-2014-2240.patch
freetype-2.5.0-CVE-2014-2241.patch
"

_builddir="$srcdir/$pkgname-$pkgver"

prepare() {
	cd "$_builddir"
	for i in "$srcdir"/*.patch; do
		msg "Applying ${i}"
		patch -p0 -i $i || return 1
	done
}

build() {
	cd "$_builddir"
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--disable-static \
		|| return 1
	make || return 1
}

package() {
	cd "$_builddir"
	make -j1 DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la || return 1
}

md5sums="aa1c67c73bbcbcc61bece94ac7389731  freetype-2.5.0.1.tar.gz
376b94c06b113a62a3437e4130bb3fc3  20-enable-spr.patch
3f6c5739843dcbc110ee0f243c4f6bdb  30-enable-valid.patch
bd2d808a0c00dcf9f1d1c0a9a8227ad9  40-memcpy-fix.patch
e29654122be7dbfbc828b1f890257f40  freetype-2.5.0-CVE-2014-2240.patch
54d52c143c5e399972f2928d17b0f28e  freetype-2.5.0-CVE-2014-2241.patch"
sha256sums="8eec68b480bc7c1e2bce365f07f8c4cc29c1c238ac8737b8281c3895f5013cfc  freetype-2.5.0.1.tar.gz
a0252c7d631307463b18e3a778259ee3759a82899bacc1719a4a6d91f3f48961  20-enable-spr.patch
5f1b3b767dc1fdb1fcd3963399ac3c2263d07fe3f1f14f677d08cd0d2161ae5c  30-enable-valid.patch
574c265c7a7032c5afb32a9807e5d04354ad0def656194cfcfff1ccca6a5540e  40-memcpy-fix.patch
902e8f228f14e3a924bde74cf3ffeb7152882ba99336c031e9f4ea63ad9ad836  freetype-2.5.0-CVE-2014-2240.patch
5aeb1b5630760e27dcb3ddc85b411d6f2ce1ab8caaf250e879802e505600e2a5  freetype-2.5.0-CVE-2014-2241.patch"
sha512sums="e8c1d127730d9085845069845ea85e2dcbfa4b8446455758a748a122e87bf247a4bcec248fcf2da4f6c8331dc7e7aa1ec73444863a44f9d77003687546f2de78  freetype-2.5.0.1.tar.gz
cc1121e0b74f0f9e8c5c516be7e139ed138a41fdfd3a152131b894204f8303ef975ac0cbcb0147f851c2fd2f72b95a084053a8c1c67d4154ca5797587f702e7b  20-enable-spr.patch
fdfa3c633a32bd9142f62454e12dd92442e8e02831fd34aca348aec6d00e7813130fbf267a7f4048a272596a478cfe3064df0ee9f9c06531378710f41bc2e40f  30-enable-valid.patch
1553f7f0514238012e300bc8d0b1e260145db17fb56f13e4aa667435e98c3749c00e150caa0e318289b84bca33b9a06a68b8342575e10ac3bf5af3d5cc861537  40-memcpy-fix.patch
d04f9ba99f18b5887553c6bcff1f8344c55c0264c148f0630df3660282b7a022ad87e1b92ed50370416be2eb180517662a98eb5954120d80271b926e041b8038  freetype-2.5.0-CVE-2014-2240.patch
12c6e0bc086a9968d0198dce50c3e34a417d52bfadbf80da27e22c97caa13c660a0d22a3c66a5344de172fcd829af686c60c58d0cd64b876099b61ce3a39d38b  freetype-2.5.0-CVE-2014-2241.patch"
