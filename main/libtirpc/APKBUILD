# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=libtirpc
pkgver=0.2.3
pkgrel=0
pkgdesc="Transport Independent RPC library (SunRPC replacement)"
url="http://libtirpc.sourceforge.net/"
arch="all"
license="GPL2"
depends=
depends_dev="krb5-dev"
makedepends="$depends_dev autoconf automake libtool"
subpackages="$pkgname-dev $pkgname-doc"
source="http://downloads.sourceforge.net/sourceforge/$pkgname/$pkgname-$pkgver.tar.bz2
	nis.h
	gssglue.patch
	libtirpc-no-des.patch
	automake.patch"

prepare() {
	cd "$srcdir"/$pkgname-$pkgver
	for i in $source; do
		case $i in
		*.patch)
			msg "Applying $i"
			patch -N -p1 -i "$srcdir"/$i || return 1
			;;
		esac
	done
	# uclibc does not provide nis.h so provide our own
	mkdir src/rpcsvc
	cp "$srcdir"/nis.h src/rpcsvc/

	libtoolize --force && aclocal -I m4 && autoconf \
		&& automake --add-missing || return 1
}

build() {
	cd "$srcdir"/$pkgname-$pkgver
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--enable-gss \
		|| return 1
	make || return 1
}

package() {
	cd $srcdir/$pkgname-$pkgver
	make DESTDIR="$pkgdir" install || return 1
	rm "$pkgdir"/usr/lib/*.la || return 1
	install -D -m644 doc/etc_netconfig "$pkgdir"/etc/netconfig
}
md5sums="b70e6c12a369a91e69fcc3b9feb23d61  libtirpc-0.2.3.tar.bz2
082dff1bc78bdcbac6d305c1534fe3c0  nis.h
7c50e2381f103cc9b84a86fad9b8eac5  gssglue.patch
80e8f54aab0f5bed37e58ad79fe4ff2b  libtirpc-no-des.patch
5cac96c765922f33de61a215aa264a7f  automake.patch"
sha256sums="4f29ea0491b4ca4c29f95f3c34191b857757873bbbf4b069f9dd4da01a6a923c  libtirpc-0.2.3.tar.bz2
7149d53da167168cbad9e75cbab302768f659e59e208763b1bf5df2a6ff3bfdb  nis.h
02658756777563dccb3904a00e87fa562eddeab0fe15ef0c6c21893b2d8619aa  gssglue.patch
5b7c8f6d19f17541902dfd1b1132f2b07e4cc0987152d4e8007243e776d4d47f  libtirpc-no-des.patch
6188b7236b1f9088ad09749eed6407bd7b75fe37d1569a19977f44d15ec6a10c  automake.patch"
sha512sums="dd480fcb6feda4a2bba7e5a5dc9b1f523697a39ddaa44a5742405f66d202996d99a562a31dbf6daf06e9b7ce5d82dfd1cce7b76a34466b92f84176e77498163d  libtirpc-0.2.3.tar.bz2
15edac1e30cc1aa65ca495bae14c6c7455d65ca539b7e5c865c3fbd5a51c76966b37dd34e9a6483aadcaea3602aefb0b48cdb46f877dae1c65dfa6840dfd8c54  nis.h
3dd3d4a082b1b9bb82c358a5b74e6c5f23fdd522ea2875fc27a7b1035e04b14aeec30db08aa3ce5c0168df325e540799bf6f55c3a67226e05cf52de11968ad86  gssglue.patch
9a984a7741deb943f92cd8a9f23d1a0e09a01e91aa88268456ccbb7998b24f50ad431e26400def3a8ba9d6cd345e5abccf5acf9c59708ce8f0653275c2ea5d61  libtirpc-no-des.patch
dcbc55ed5551703799e6a690e65dbdbd9cc0293c0392a1a3c2d52bc9e91e8b0e18b89fa146f78fea8476c04409b766b6cdbde38a5f226d32043987ca1471634c  automake.patch"
