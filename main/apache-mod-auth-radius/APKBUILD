# Contributor: Jeff Bilyk <jbilyk@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=apache-mod-auth-radius
_pkgname=mod_auth_radius
pkgver=1.5.8
pkgrel=3
pkgdesc="Apache authentication module to become RADIUS client for AAA requests"
url="http://freeradius.org/mod_auth_radius/"
arch="all"
license="BSD"
depends="apache2"
makedepends="apache2-dev freeradius-dev"
install=""
source="ftp://ftp.freeradius.org/pub/radius/$_pkgname-$pkgver.tar
	mod-auth-radius.conf
	remote-ip.patch"

builddir="$srcdir"/$_pkgname-$pkgver
prepare() {
	local i
	cd "$builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -i "$srcdir"/$i;;
		esac
	done
}

build() {
	cd "$builddir"
	apxs -c mod_auth_radius-2.0.c
}

package() {
	cd "$builddir"
	mkdir -p "$pkgdir"/etc/apache2/conf.d
	mkdir -p "$pkgdir"/usr/lib/apache2
	/usr/share/apache2/build/instdso.sh SH_LIBTOOL='/usr/share/build-1/libtool' mod_auth_radius-2.0.la "$pkgdir"/usr/lib/apache2/
	/usr/share/build-1/libtool --mode=install install mod_auth_radius-2.0.la "$pkgdir"/usr/lib/apache2/
	install -D -m644 ../../mod-auth-radius.conf "$pkgdir"/etc/apache2/conf.d/mod-auth-radius.conf
}

