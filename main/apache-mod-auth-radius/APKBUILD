# Contributor: Jeff Bilyk <jbilyk@alpinelinux.org>
# Maintainer: Francesco Colista <fcolista@alpinelinux.org>
pkgname=apache-mod-auth-radius
_pkgname=mod_auth_radius
pkgver=1.5.8
pkgrel=3
pkgdesc="Apache authentication module to become RADIUS client for AAA requests"
url="http://freeradius.org/mod_auth_radius/"
arch="all"
license="BSD"
depends="apache2"
makedepends="apache2-dev freeradius-dev"
install=""
source="ftp://ftp.freeradius.org/pub/radius/$_pkgname-$pkgver.tar
	mod-auth-radius.conf
	remote-ip.patch"

builddir="$srcdir"/$_pkgname-$pkgver
prepare() {
	local i
	cd "$builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -i "$srcdir"/$i;;
		esac
	done
}

build() {
	cd "$builddir"
	apxs -c mod_auth_radius-2.0.c
}

package() {
	cd "$builddir"
	mkdir -p "$pkgdir"/etc/apache2/conf.d
	mkdir -p "$pkgdir"/usr/lib/apache2
	/usr/share/apache2/build/instdso.sh SH_LIBTOOL='/usr/share/build-1/libtool' mod_auth_radius-2.0.la "$pkgdir"/usr/lib/apache2/
	/usr/share/build-1/libtool --mode=install install mod_auth_radius-2.0.la "$pkgdir"/usr/lib/apache2/
	install -D -m644 ../../mod-auth-radius.conf "$pkgdir"/etc/apache2/conf.d/mod-auth-radius.conf
}

sha512sums="0fcc43a44ea17b33595a850abb03ff6b92e100dfbeffc82caa9516f6eb7914fb463cb62286d624203a2c7035d05a107dda7b68c5cedf7de3b8be95b9266b6988  mod_auth_radius-1.5.8.tar
f5f8bb154e290c4f1d1af899b24ee2011d8fe88fbf31a3fd865e9dfd9927cc8e23cb022be996ec3c43ed79309814ad63efe7f3cd5b3ed670d23a572b3e561f54  mod-auth-radius.conf
85f58a7d09ee097f61fe691a4cbd777c4208e1daa880d46980c944903a33e70e4ecfacbcccd1d8b6fd175c661b7b0cde7081470c024a89d84f274d2bf3963e24  remote-ip.patch"
