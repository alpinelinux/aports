# Contributor: Kaarle Ritvanen <kaarle.ritvanen@datakunkku.fi>
# Maintainer: Kaarle Ritvanen <kaarle.ritvanen@datakunkku.fi>
pkgname=awall
pkgver=0.3.1
pkgrel=1
pkgdesc="Alpine Wall"
url=http://git.alpinelinux.org/cgit/awall/
arch=noarch
license=GPL-2
replaces="awall-nat"
depends="bind-tools ip6tables ipset iptables lua lua-alt-getopt lua-filesystem lua-json4 lua-pc lua-signal lua-sleep lua-stringy xtables-addons"
subpackages=$pkgname-masquerade
source="http://dev.alpinelinux.org/archive/awall/awall-${pkgver}.tar.bz2
	use-hashlimit.patch"

_builddir=$srcdir/awall-${pkgver}

prepare() {
	cd "$_builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	:
}

package() {
	cd "$_builddir"
	make "ROOT_DIR=$pkgdir" install
}

masquerade() {
	depends=awall
	cd "$_builddir"
	for file in lua/5.1/awall/modules/masquerade.lua awall/mandatory/masquerade.json; do	    	
		local path=usr/share/$file
		install -d "$subpkgdir/$(dirname $path)"
		mv "$pkgdir/$path" "$subpkgdir/$path"
	done
}

md5sums="b0547d6c2a90515b0fd66b3b9cf80ad6  awall-0.3.1.tar.bz2
502dfb94d8211304c3f119aa4e0005f3  use-hashlimit.patch"
sha256sums="7780a298b2f09ec959974e5f6fc5c64c196aa8c33b2bc0135a15dcfcb315cacb  awall-0.3.1.tar.bz2
26da6858a9a583bdc280e2c42522607f2d449228e9e7a13fe6635522180cfa45  use-hashlimit.patch"
sha512sums="5e4e150812899dd47ff607e5701e59fa17b4889c4dd2f60df864d3f831d28f89ac277789e7de6bb70a1578723f7e8782a3fccb3a645aeec35a013b8e62c01880  awall-0.3.1.tar.bz2
542d0bd3eb6a8e336460c2cca56b01c4c2d3ea2ce92f975429bd22078882caad3404e915fd48d2cb311caa585002b484311b0f2bff032494f1efe26cb7756ebe  use-hashlimit.patch"
