# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=libtool
pkgver=2.5.4
pkgrel=2
pkgdesc="Generic library support script"
url="https://www.gnu.org/software/libtool/"
arch="all"
license="LGPL-2.0-or-later AND GPL-2.0-or-later"
depends="
	libltdl=$pkgver-r$pkgrel
	"
makedepends="
	autoconf
	automake
	help2man
	m4
	texinfo
	"
checkdepends="
	gawk
	gzip
	"
subpackages="libltdl-static libltdl $pkgname-doc"
source="https://ftp.gnu.org/gnu/libtool/libtool-$pkgver.tar.gz
	no-xz.patch
	"
options="libtool !archcheck" # arch-specific files moved into libltdl

prepare() {
	default_prepare

	cp -v README README-release
	./bootstrap -cf --skip-git --skip-po
}

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var
	make
}

check() {
	# Test 69 shlibpath_overrides_runpath fails
	# Test 169 repeats the entire test suite with shorter max_cmd_len
	make check TESTSUITEFLAGS="-j$JOBS 1-68 70-168" SUBDIRS=.
}

package() {
	make DESTDIR="$pkgdir" install
}

libltdl() {
	pkgdesc="Runtime libraries for GNU Libtool Dynamic Module Loader"
	depends=

	amove usr/lib/libltdl.so*
}

sha512sums="
60599f5c3168a287fe3a35062fd2e32e0b73433fce820bfd18d28b0e3bd7a8fefde6d6f0505fbbc2d664119ab7c539269184993843289932c895847ea1ab9f04  libtool-2.5.4.tar.gz
d959624c03333f63bc6671822358cd0b9de071c4cab3f54b42c2b44b052cb4194ad5a4c5dae93eff2bbe60ad0f024acdea32d68839b4fd4da74a6d74d65f7dd6  no-xz.patch
"
