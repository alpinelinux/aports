# Maintainer: Celeste <cielesti@protonmail.com>
maintainer="Celeste <cielesti@protonmail.com>"
pkgname=libtool
pkgver=2.6.0
pkgrel=0
pkgdesc="Generic library support script"
url="https://www.gnu.org/software/libtool/"
arch="all"
license="LGPL-2.0-or-later AND GPL-2.0-or-later"
# libtool-next-version expects a `diff` that doesn't default to unified context
depends="
	diffutils
	libltdl=$pkgver-r$pkgrel
	"
makedepends="
	autoconf
	automake
	help2man
	m4
	texinfo
	"
checkdepends="
	gawk
	gzip
	"
subpackages="libltdl-static libltdl $pkgname-doc"
#source="https://ftp.gnu.org/gnu/libtool/libtool-$pkgver.tar.gz
source="https://alpha.gnu.org/gnu/libtool/libtool-$pkgver.tar.gz
	no-xz.patch
	"
options="libtool !archcheck" # arch-specific files moved into libltdl

prepare() {
	default_prepare

	cp -v README README-release
	./bootstrap -cf --skip-git --skip-po
}

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var
	make
}

check() {
	# "recursive" repeats the entire test suite with shorter max_cmd_len
	make check TESTSUITEFLAGS="-j$JOBS --keywords=!recursive" SUBDIRS=.
}

package() {
	make DESTDIR="$pkgdir" install
}

libltdl() {
	pkgdesc="Runtime libraries for GNU Libtool Dynamic Module Loader"
	depends=

	amove usr/lib/libltdl.so*
}

sha512sums="
172b6416b8fedeadbd4e6cb7052e9eda68c70a2e77bda55f3af9a950b761fa0fa0cc2943b32f1213010004f629be90f1047371480e59d2682e0d31010f03a196  libtool-2.6.0.tar.gz
d959624c03333f63bc6671822358cd0b9de071c4cab3f54b42c2b44b052cb4194ad5a4c5dae93eff2bbe60ad0f024acdea32d68839b4fd4da74a6d74d65f7dd6  no-xz.patch
"
