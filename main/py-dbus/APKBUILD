# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=py-dbus
pkgver=1.2.4
pkgrel=0
pkgdesc="Python bindings for DBUS"
url="http://www.freedesktop.org/wiki/Software/DBusBindings"
arch="all"
license="GPL LGPL"
depends=""
#depends_dev="py-dbus"
makedepends="dbus-glib-dev python2-dev python3-dev automake autoconf-archive"
subpackages="py2-${pkgname#py-}:_py2 py3-${pkgname#py-}:_py3 $pkgname-doc $pkgname-dev"
source="http://dbus.freedesktop.org/releases/dbus-python/dbus-python-$pkgver.tar.gz"

_builddir="$srcdir"/dbus-python-$pkgver

prepare() {
	local python; for python in python2 python3; do
		cp -r "$_builddir" "$_builddir-$python"
	done
}

package() {
	mkdir -p "$pkgdir"
}

_py2() {
	replaces="$pkgname"
	_py python2
}

_py3() {
	_py python3
}

_py() {
	local python="$1"
	pkgdesc="$pkgdesc (for $python)"
	depends="$depends $python"
	# should this line be here ?
	# install_if="$pkgname-$pkgver-r$pkgrel $python"
	cd "$_builddir-$python"
	PYTHON=$python ./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr
	make
	make DESTDIR="$subpkgdir" install
	rm -rf "$pkgdir"/docpkg "$pkgdir"/devpkg
	mkdir -p "$pkgdir"/docpkg "$pkgdir"/devpkg
	mv "$subpkgdir"/usr/share/doc "$pkgdir"/docpkg
	mv "$subpkgdir"/usr/lib/pkgconfig "$pkgdir"/devpkg
	mv "$subpkgdir"/usr/include "$pkgdir"/devpkg
	rmdir "$subpkgdir"/usr/share
}

doc() {
	mkdir -p "$subpkgdir"/usr/share/
	mv "$pkgdir"/docpkg/doc "$subpkgdir"/usr/share/doc
}

dev() {
	mkdir -p "$subpkgdir"/usr/lib
	mv "$pkgdir"/devpkg/pkgconfig "$subpkgdir"/usr/lib/
	mv "$pkgdir"/devpkg/include "$subpkgdir"/usr/
}

sha512sums="efdd9d96a8b56e813c93208d34777f1ca2db96c076d31f13afbcaec3c7770a16a623d5531fe23443130c555240949802503f171f2064d45eee97546d6251304b  dbus-python-1.2.4.tar.gz"
