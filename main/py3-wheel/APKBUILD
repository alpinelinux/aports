# Contributor: Antoine Fontaine <antoine.fontaine@epfl.ch>
# Maintainer: psykose <alice@ayaya.dev>
pkgname=py3-wheel
_pyname=wheel
pkgver=0.38.2
pkgrel=0
pkgdesc="built-package format for Python"
url="https://github.com/pypa/wheel"
arch="noarch"
license="MIT"
subpackages="$pkgname-doc"
depends="python3 py3-packaging"
makedepends="py3-setuptools"
checkdepends="py3-pytest python3-dev"
source="https://files.pythonhosted.org/packages/source/w/wheel/wheel-$pkgver.tar.gz
	use-system-packaging.patch
	"
builddir="$srcdir"/$_pyname-$pkgver

prepare() {
	default_prepare

	# py3-pytest-cov not available in main
	sed -i '/cov-config/d' setup.cfg
	# we're not macos
	rm tests/test_macosx_libfile.py
}

build() {
	rm -rf src/wheel/vendored

	python3 setup.py build
}

check() {
	python3 -m venv --system-site-packages test-env
	test-env/bin/python3 setup.py install
	test-env/bin/python3 -m pytest
}

package() {
	python3 setup.py install --prefix=/usr --root="$pkgdir"
	install -Dm 0644 "$srcdir"/$_pyname-$pkgver/docs/index.rst "$pkgdir/usr/share/doc/py3-wheel"
}

sha512sums="
fb4a06800cb45be60f42ff60b0d1bf24d0aeb4c1ace1dee4bd9fbc2dcf66e4e927607c79d4e7e88a7e545b13ddd35b0f8dfa27eb0acd18d146cbfde99a8cce93  wheel-0.38.2.tar.gz
f408d3c9ccaece65fe38303cda0df0d63cd142ec9fab5751cadcaad9758bb39c0172a1d4e0407338a684efb54b695d11410712acdb081352e692db0803f2626e  use-system-packaging.patch
"
