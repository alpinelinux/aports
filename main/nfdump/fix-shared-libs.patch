From aeb703c7622da7f66d5d609a8aa88f1c11df6bdd Mon Sep 17 00:00:00 2001
From: Peter Haag <peter@Peters-Mac.local>
Date: Fri, 6 May 2016 15:06:08 +0200
Subject: [PATCH] Fix shared library build issue. --enable-shared=no and yes
 are honored correctly.

---
 autom4te.cache/requests | 468 ++++++++++++++++++++++++------------------------
 bin/Makefile.am         |   2 +-
 bin/Makefile.in         |   2 +-
 bin/pcap_reader.c       |   7 +
 4 files changed, 243 insertions(+), 236 deletions(-)

diff --git a/autom4te.cache/requests b/autom4te.cache/requests
index fd25b66..986b741 100644
--- a/autom4te.cache/requests
+++ b/autom4te.cache/requests
@@ -34,47 +34,47 @@
                         'configure.ac'
                       ],
                       {
-                        'AC_CONFIG_MACRO_DIR' => 1,
-                        'AC_DEFUN_ONCE' => 1,
-                        '_AC_AM_CONFIG_HEADER_HOOK' => 1,
-                        'AM_SET_CURRENT_AUTOMAKE_VERSION' => 1,
-                        'AM_SET_DEPDIR' => 1,
-                        '_AM_SET_OPTIONS' => 1,
-                        '_AM_CONFIG_MACRO_DIRS' => 1,
+                        '_m4_warn' => 1,
+                        '_AM_PROG_CC_C_O' => 1,
+                        'AM_DEP_TRACK' => 1,
+                        '_AM_AUTOCONF_VERSION' => 1,
                         '_AM_OUTPUT_DEPENDENCY_COMMANDS' => 1,
-                        'AM_PROG_INSTALL_STRIP' => 1,
                         '_AM_SUBST_NOTMAKE' => 1,
-                        'AM_RUN_LOG' => 1,
+                        'include' => 1,
+                        'AM_SET_CURRENT_AUTOMAKE_VERSION' => 1,
+                        'AU_DEFUN' => 1,
+                        'm4_pattern_forbid' => 1,
+                        'AM_PROG_INSTALL_STRIP' => 1,
                         '_AM_SET_OPTION' => 1,
-                        'AM_SET_LEADING_DOT' => 1,
-                        'AM_AUX_DIR_EXPAND' => 1,
-                        'AM_SILENT_RULES' => 1,
-                        'AM_MISSING_HAS_RUN' => 1,
-                        'AM_PROG_INSTALL_SH' => 1,
-                        'AM_PROG_CC_C_O' => 1,
+                        'AM_SANITY_CHECK' => 1,
+                        'AC_DEFUN_ONCE' => 1,
+                        'AM_AUTOMAKE_VERSION' => 1,
                         'AM_MISSING_PROG' => 1,
-                        'AM_OUTPUT_DEPENDENCY_COMMANDS' => 1,
-                        '_m4_warn' => 1,
-                        'AM_INIT_AUTOMAKE' => 1,
-                        'm4_include' => 1,
-                        '_AM_PROG_CC_C_O' => 1,
-                        'AC_DEFUN' => 1,
-                        '_AM_DEPENDENCIES' => 1,
                         '_AM_PROG_TAR' => 1,
-                        'AM_DEP_TRACK' => 1,
-                        'AM_AUTOMAKE_VERSION' => 1,
                         'AM_MAKE_INCLUDE' => 1,
-                        '_AM_AUTOCONF_VERSION' => 1,
-                        'm4_pattern_forbid' => 1,
+                        'AC_CONFIG_MACRO_DIR_TRACE' => 1,
+                        '_AM_SET_OPTIONS' => 1,
+                        '_AM_DEPENDENCIES' => 1,
+                        'AM_AUX_DIR_EXPAND' => 1,
+                        '_AC_AM_CONFIG_HEADER_HOOK' => 1,
+                        'm4_include' => 1,
+                        'AM_INIT_AUTOMAKE' => 1,
+                        'AM_PROG_INSTALL_SH' => 1,
+                        'AM_SILENT_RULES' => 1,
+                        'AM_RUN_LOG' => 1,
+                        '_AM_MANGLE_OPTION' => 1,
+                        '_AM_IF_OPTION' => 1,
                         'AM_SUBST_NOTMAKE' => 1,
+                        'AM_OUTPUT_DEPENDENCY_COMMANDS' => 1,
                         'AM_CONDITIONAL' => 1,
+                        'AM_MISSING_HAS_RUN' => 1,
                         'm4_pattern_allow' => 1,
-                        '_AM_MANGLE_OPTION' => 1,
-                        '_AM_IF_OPTION' => 1,
-                        'AC_CONFIG_MACRO_DIR_TRACE' => 1,
-                        'AM_SANITY_CHECK' => 1,
-                        'AU_DEFUN' => 1,
-                        'include' => 1
+                        'AM_SET_LEADING_DOT' => 1,
+                        'AC_DEFUN' => 1,
+                        '_AM_CONFIG_MACRO_DIRS' => 1,
+                        'AM_PROG_CC_C_O' => 1,
+                        'AM_SET_DEPDIR' => 1,
+                        'AC_CONFIG_MACRO_DIR' => 1
                       }
                     ], 'Autom4te::Request' ),
              bless( [
@@ -89,65 +89,65 @@
                         'configure.ac'
                       ],
                       {
-                        'AM_PROG_CXX_C_O' => 1,
-                        'AC_CONFIG_HEADERS' => 1,
-                        'include' => 1,
-                        'AC_FC_PP_SRCEXT' => 1,
-                        'AM_PROG_FC_C_O' => 1,
-                        'AC_CONFIG_FILES' => 1,
-                        'AC_FC_PP_DEFINE' => 1,
-                        'AC_CONFIG_SUBDIRS' => 1,
-                        'AM_MAINTAINER_MODE' => 1,
-                        'AC_FC_SRCEXT' => 1,
-                        'AC_DEFINE_TRACE_LITERAL' => 1,
-                        'LT_INIT' => 1,
-                        'AM_NLS' => 1,
-                        'AC_CANONICAL_SYSTEM' => 1,
+                        'AM_EXTRA_RECURSIVE_TARGETS' => 1,
                         'AC_CONFIG_AUX_DIR' => 1,
-                        'AC_PROG_LIBTOOL' => 1,
-                        'm4_pattern_allow' => 1,
-                        'AM_CONDITIONAL' => 1,
-                        'm4_pattern_forbid' => 1,
-                        'AM_PROG_MOC' => 1,
-                        'AC_CONFIG_LIBOBJ_DIR' => 1,
-                        '_LT_AC_TAGCONFIG' => 1,
-                        'LT_CONFIG_LTDL_DIR' => 1,
-                        'AC_SUBST' => 1,
-                        'AM_MAKEFILE_INCLUDE' => 1,
                         'AM_AUTOMAKE_VERSION' => 1,
-                        'AM_PROG_MKDIR_P' => 1,
-                        'AM_XGETTEXT_OPTION' => 1,
-                        'AC_CANONICAL_HOST' => 1,
-                        'AM_EXTRA_RECURSIVE_TARGETS' => 1,
-                        'AC_CONFIG_LINKS' => 1,
+                        'AM_GNU_GETTEXT' => 1,
+                        'AC_CONFIG_SUBDIRS' => 1,
+                        'AM_POT_TOOLS' => 1,
+                        'LT_SUPPORTED_TAG' => 1,
+                        'AC_FC_FREEFORM' => 1,
+                        'AC_INIT' => 1,
+                        'AC_DEFINE_TRACE_LITERAL' => 1,
+                        '_AM_COND_ELSE' => 1,
+                        'AC_SUBST_TRACE' => 1,
+                        '_AM_SUBST_NOTMAKE' => 1,
                         '_AM_MAKEFILE_INCLUDE' => 1,
-                        'AC_CANONICAL_TARGET' => 1,
-                        'm4_include' => 1,
-                        'AM_INIT_AUTOMAKE' => 1,
+                        'AC_CANONICAL_BUILD' => 1,
+                        'AM_PROG_MOC' => 1,
                         '_m4_warn' => 1,
+                        'AH_OUTPUT' => 1,
+                        'm4_pattern_forbid' => 1,
                         'AM_PATH_GUILE' => 1,
+                        'AM_XGETTEXT_OPTION' => 1,
+                        '_LT_AC_TAGCONFIG' => 1,
+                        'AC_CONFIG_HEADERS' => 1,
                         'AM_PROG_AR' => 1,
-                        'AM_PROG_F77_C_O' => 1,
+                        'include' => 1,
+                        '_AM_COND_IF' => 1,
+                        'AC_CANONICAL_HOST' => 1,
+                        'AC_SUBST' => 1,
+                        'AM_GNU_GETTEXT_INTL_SUBDIR' => 1,
+                        'm4_pattern_allow' => 1,
+                        'LT_CONFIG_LTDL_DIR' => 1,
                         'AC_REQUIRE_AUX_FILE' => 1,
+                        'AM_CONDITIONAL' => 1,
+                        'AC_PROG_LIBTOOL' => 1,
                         'AM_ENABLE_MULTILIB' => 1,
-                        '_AM_COND_ELSE' => 1,
-                        'AM_POT_TOOLS' => 1,
+                        'AM_PROG_CC_C_O' => 1,
+                        'AC_FC_PP_SRCEXT' => 1,
+                        'AC_CONFIG_LIBOBJ_DIR' => 1,
+                        'AM_PROG_CXX_C_O' => 1,
                         'AC_LIBSOURCE' => 1,
+                        'AC_CANONICAL_TARGET' => 1,
+                        'sinclude' => 1,
+                        'AM_PROG_MKDIR_P' => 1,
+                        'AM_MAINTAINER_MODE' => 1,
                         'm4_sinclude' => 1,
-                        'AM_PROG_CC_C_O' => 1,
-                        '_AM_COND_ENDIF' => 1,
-                        'AM_GNU_GETTEXT' => 1,
-                        'AM_GNU_GETTEXT_INTL_SUBDIR' => 1,
-                        '_AM_SUBST_NOTMAKE' => 1,
-                        'AC_FC_FREEFORM' => 1,
-                        'LT_SUPPORTED_TAG' => 1,
                         'AM_SILENT_RULES' => 1,
-                        'AC_INIT' => 1,
-                        'AC_CANONICAL_BUILD' => 1,
-                        '_AM_COND_IF' => 1,
-                        'AC_SUBST_TRACE' => 1,
-                        'AH_OUTPUT' => 1,
-                        'sinclude' => 1
+                        'AM_NLS' => 1,
+                        'AM_INIT_AUTOMAKE' => 1,
+                        'AC_CONFIG_FILES' => 1,
+                        'AM_MAKEFILE_INCLUDE' => 1,
+                        'm4_include' => 1,
+                        'AC_CANONICAL_SYSTEM' => 1,
+                        '_AM_COND_ENDIF' => 1,
+                        'AM_PROG_F77_C_O' => 1,
+                        'AC_FC_PP_DEFINE' => 1,
+                        'AC_CONFIG_LINKS' => 1,
+                        'AM_PROG_FC_C_O' => 1,
+                        'AC_FC_SRCEXT' => 1,
+                        'LT_INIT' => 1
                       }
                     ], 'Autom4te::Request' ),
              bless( [
@@ -188,185 +188,185 @@
                         'configure.ac'
                       ],
                       {
-                        'AM_RUN_LOG' => 1,
-                        'LT_PATH_NM' => 1,
-                        '_AM_SUBST_NOTMAKE' => 1,
-                        'AM_SILENT_RULES' => 1,
-                        'AM_SET_LEADING_DOT' => 1,
-                        'LT_SYS_DLSEARCH_PATH' => 1,
-                        'LT_AC_PROG_GCJ' => 1,
-                        'LTDL_INSTALLABLE' => 1,
-                        'AM_PROG_LIBTOOL' => 1,
                         'AM_PROG_INSTALL_STRIP' => 1,
-                        'AC_ENABLE_SHARED' => 1,
-                        'LT_SYS_SYMBOL_USCORE' => 1,
-                        'AC_DISABLE_FAST_INSTALL' => 1,
-                        'AM_INIT_AUTOMAKE' => 1,
-                        'AC_LIBTOOL_PROG_CC_C_O' => 1,
-                        'LTOBSOLETE_VERSION' => 1,
-                        '_AM_PROG_CC_C_O' => 1,
-                        'AM_DISABLE_STATIC' => 1,
-                        'AC_LIBTOOL_PROG_COMPILER_PIC' => 1,
-                        'AC_PROG_LD_GNU' => 1,
-                        'LT_LIB_M' => 1,
-                        'AM_MAKE_INCLUDE' => 1,
+                        'AC_LIBTOOL_PROG_COMPILER_NO_RTTI' => 1,
                         '_LT_REQUIRED_DARWIN_CHECKS' => 1,
-                        'AC_LIBTOOL_LANG_C_CONFIG' => 1,
-                        '_LT_AC_TRY_DLOPEN_SELF' => 1,
-                        '_LT_AC_PROG_CXXCPP' => 1,
-                        'LTDL_CONVENIENCE' => 1,
+                        '_AM_SET_OPTION' => 1,
+                        'LTOPTIONS_VERSION' => 1,
+                        'LT_SYS_MODULE_PATH' => 1,
+                        'LT_FUNC_DLSYM_USCORE' => 1,
+                        'AC_LTDL_SHLIBEXT' => 1,
+                        'AC_LTDL_SYMBOL_USCORE' => 1,
+                        'AC_LIBTOOL_DLOPEN' => 1,
+                        'AC_LTDL_ENABLE_INSTALL' => 1,
+                        'LT_OUTPUT' => 1,
+                        '_AM_SET_OPTIONS' => 1,
+                        'AC_LIBTOOL_PROG_COMPILER_PIC' => 1,
+                        'AM_ENABLE_SHARED' => 1,
+                        'LT_SYS_MODULE_EXT' => 1,
+                        '_LT_PROG_ECHO_BACKSLASH' => 1,
+                        'AC_LTDL_SYSSEARCHPATH' => 1,
+                        'LT_CMD_MAX_LEN' => 1,
+                        'AU_DEFUN' => 1,
+                        'AC_LIBTOOL_SYS_OLD_ARCHIVE' => 1,
+                        'AM_CONDITIONAL' => 1,
+                        'AC_LIBTOOL_F77' => 1,
                         'AC_DISABLE_SHARED' => 1,
-                        'LT_WITH_LTDL' => 1,
+                        '_LT_AC_LOCK' => 1,
+                        'AC_PATH_MAGIC' => 1,
                         'AC_LIBTOOL_COMPILER_OPTION' => 1,
-                        '_LT_COMPILER_BOILERPLATE' => 1,
-                        'AC_LTDL_SYSSEARCHPATH' => 1,
-                        'AM_PROG_NM' => 1,
-                        'LT_CONFIG_LTDL_DIR' => 1,
-                        'AC_LIBTOOL_LINKER_OPTION' => 1,
-                        'AM_AUTOMAKE_VERSION' => 1,
-                        'AC_DISABLE_STATIC' => 1,
                         'AC_DEPLIBS_CHECK_METHOD' => 1,
-                        'AC_ENABLE_FAST_INSTALL' => 1,
-                        '_LT_PREPARE_SED_QUOTE_VARS' => 1,
-                        '_LT_AC_SYS_LIBPATH_AIX' => 1,
-                        'LT_INIT' => 1,
-                        '_LT_AC_CHECK_DLFCN' => 1,
-                        'AC_LIBLTDL_CONVENIENCE' => 1,
-                        'AC_LIBTOOL_PICMODE' => 1,
-                        'LT_SUPPORTED_TAG' => 1,
-                        'AM_AUX_DIR_EXPAND' => 1,
-                        'LT_PROG_GCJ' => 1,
-                        'AC_PATH_MAGIC' => 1,
-                        'LT_SYS_DLOPEN_SELF' => 1,
-                        '_LT_LINKER_OPTION' => 1,
-                        'AC_LTDL_DLLIB' => 1,
-                        'AC_LIBTOOL_WIN32_DLL' => 1,
-                        'AC_LIBTOOL_PROG_LD_SHLIBS' => 1,
-                        'LT_FUNC_ARGZ' => 1,
-                        '_AM_SET_OPTIONS' => 1,
-                        'AC_LTDL_ENABLE_INSTALL' => 1,
-                        'AM_DISABLE_SHARED' => 1,
-                        '_LT_AC_LANG_CXX' => 1,
-                        'AC_LIBTOOL_FC' => 1,
-                        'AC_DEFUN' => 1,
-                        'LT_PATH_LD' => 1,
-                        '_LT_DLL_DEF_P' => 1,
+                        'LT_LIB_M' => 1,
                         'AM_ENABLE_STATIC' => 1,
-                        'AC_LIBTOOL_PROG_COMPILER_NO_RTTI' => 1,
-                        'LT_LIB_DLLOAD' => 1,
-                        'LT_SYS_MODULE_EXT' => 1,
-                        'AC_LIBLTDL_INSTALLABLE' => 1,
-                        'AC_LTDL_SYS_DLOPEN_DEPLIBS' => 1,
                         'AC_PROG_LD_RELOAD_FLAG' => 1,
+                        'AC_LIBTOOL_CXX' => 1,
+                        '_LT_AC_SHELL_INIT' => 1,
+                        'AM_DISABLE_STATIC' => 1,
+                        '_LT_AC_SYS_COMPILER' => 1,
+                        'LTSUGAR_VERSION' => 1,
+                        '_AM_MANGLE_OPTION' => 1,
                         'AC_LTDL_OBJDIR' => 1,
-                        'AM_MISSING_PROG' => 1,
-                        '_LT_AC_TAGVAR' => 1,
-                        'LT_FUNC_DLSYM_USCORE' => 1,
-                        'AC_CHECK_LIBM' => 1,
                         'AM_SUBST_NOTMAKE' => 1,
-                        'LT_OUTPUT' => 1,
-                        '_LT_AC_PROG_ECHO_BACKSLASH' => 1,
-                        '_LT_AC_LANG_F77_CONFIG' => 1,
-                        '_LTDL_SETUP' => 1,
-                        'LT_SYS_MODULE_PATH' => 1,
-                        '_AM_PROG_TAR' => 1,
-                        'AC_LIBTOOL_F77' => 1,
-                        'AC_PATH_TOOL_PREFIX' => 1,
                         'AM_SANITY_CHECK' => 1,
-                        'AC_LIBTOOL_OBJDIR' => 1,
+                        'LT_SYS_DLOPEN_DEPLIBS' => 1,
+                        'AC_LTDL_DLSYM_USCORE' => 1,
+                        'AM_MAKE_INCLUDE' => 1,
+                        '_AM_PROG_TAR' => 1,
+                        '_LT_COMPILER_OPTION' => 1,
+                        '_LT_AC_LANG_CXX' => 1,
+                        'AC_LIBTOOL_CONFIG' => 1,
+                        'AM_AUX_DIR_EXPAND' => 1,
+                        'AC_LTDL_SHLIBPATH' => 1,
+                        '_AM_PROG_CC_C_O' => 1,
+                        '_LT_AC_PROG_CXXCPP' => 1,
+                        'AC_LIBTOOL_LANG_CXX_CONFIG' => 1,
+                        'AC_LTDL_DLLIB' => 1,
+                        '_LT_AC_TAGCONFIG' => 1,
+                        '_LT_AC_LANG_GCJ' => 1,
+                        'LT_LIB_DLLOAD' => 1,
+                        'm4_pattern_forbid' => 1,
                         '_LT_AC_LANG_F77' => 1,
-                        'AC_LIBTOOL_SYS_DYNAMIC_LINKER' => 1,
-                        'LTSUGAR_VERSION' => 1,
-                        'include' => 1,
-                        'AM_PROG_LD' => 1,
-                        '_LT_LIBOBJ' => 1,
-                        'LT_AC_PROG_EGREP' => 1,
-                        'AC_LIBTOOL_SYS_GLOBAL_SYMBOL_PIPE' => 1,
+                        'AC_PROG_LIBTOOL' => 1,
+                        '_LT_AC_FILE_LTDLL_C' => 1,
+                        '_LT_PREPARE_SED_QUOTE_VARS' => 1,
+                        'AC_LIBTOOL_LANG_GCJ_CONFIG' => 1,
+                        'AM_MISSING_HAS_RUN' => 1,
+                        'AC_ENABLE_STATIC' => 1,
                         '_LT_LINKER_BOILERPLATE' => 1,
+                        'm4_pattern_allow' => 1,
+                        'AC_LIBTOOL_DLOPEN_SELF' => 1,
+                        'AC_LIBTOOL_SYS_HARD_LINK_LOCKS' => 1,
+                        'AC_DEFUN' => 1,
                         'AC_LIBTOOL_SETUP' => 1,
-                        'AC_LIBTOOL_CONFIG' => 1,
-                        '_AC_PROG_LIBTOOL' => 1,
-                        'AC_CONFIG_MACRO_DIR' => 1,
-                        '_AC_AM_CONFIG_HEADER_HOOK' => 1,
-                        'AC_LIBTOOL_SYS_OLD_ARCHIVE' => 1,
-                        '_AM_OUTPUT_DEPENDENCY_COMMANDS' => 1,
+                        'AC_LIBLTDL_CONVENIENCE' => 1,
                         '_AM_CONFIG_MACRO_DIRS' => 1,
+                        '_LT_PROG_F77' => 1,
+                        'LT_SYS_DLSEARCH_PATH' => 1,
                         'm4_include' => 1,
-                        'AC_LTDL_SHLIBEXT' => 1,
+                        'AM_INIT_AUTOMAKE' => 1,
+                        '_LT_AC_TRY_DLOPEN_SELF' => 1,
+                        'LT_INIT' => 1,
+                        'LT_PATH_LD' => 1,
+                        'AC_DISABLE_FAST_INSTALL' => 1,
+                        'AC_LIBTOOL_WIN32_DLL' => 1,
+                        'AC_LIBTOOL_POSTDEP_PREDEP' => 1,
+                        'LT_AC_PROG_GCJ' => 1,
+                        'LT_PROG_GCJ' => 1,
+                        'AC_LIBTOOL_OBJDIR' => 1,
+                        'LT_AC_PROG_SED' => 1,
+                        'AC_PROG_NM' => 1,
+                        'LTVERSION_VERSION' => 1,
+                        'AC_DEFUN_ONCE' => 1,
+                        'AC_PATH_TOOL_PREFIX' => 1,
+                        'AM_MISSING_PROG' => 1,
+                        '_LT_PATH_TOOL_PREFIX' => 1,
+                        'AC_LIBTOOL_LANG_F77_CONFIG' => 1,
+                        'LTDL_INIT' => 1,
+                        'AC_LIBTOOL_LANG_C_CONFIG' => 1,
+                        '_LT_PROG_CXX' => 1,
+                        'LT_SYS_SYMBOL_USCORE' => 1,
+                        'AM_PROG_LIBTOOL' => 1,
+                        '_LT_AC_CHECK_DLFCN' => 1,
+                        'LT_AC_PROG_EGREP' => 1,
+                        'AC_LIB_LTDL' => 1,
                         '_m4_warn' => 1,
-                        'AC_LTDL_SHLIBPATH' => 1,
-                        'LT_AC_PROG_RC' => 1,
-                        '_LT_PROG_F77' => 1,
-                        'AC_LIBTOOL_DLOPEN_SELF' => 1,
+                        '_LT_AC_LANG_RC_CONFIG' => 1,
+                        'AC_LIBTOOL_SYS_DYNAMIC_LINKER' => 1,
+                        'AC_LIBTOOL_PROG_LD_HARDCODE_LIBPATH' => 1,
+                        'AC_LIBTOOL_LANG_RC_CONFIG' => 1,
+                        '_LT_AC_LANG_F77_CONFIG' => 1,
                         'LT_LANG' => 1,
-                        'AC_LTDL_DLSYM_USCORE' => 1,
-                        'LT_SYS_DLOPEN_DEPLIBS' => 1,
-                        'AM_MISSING_HAS_RUN' => 1,
-                        '_LT_PATH_TOOL_PREFIX' => 1,
-                        'AC_WITH_LTDL' => 1,
-                        '_LT_PROG_ECHO_BACKSLASH' => 1,
-                        'AM_PROG_INSTALL_SH' => 1,
-                        'AM_PROG_CC_C_O' => 1,
-                        'AC_LIBTOOL_SYS_MAX_CMD_LEN' => 1,
-                        'AC_LIBTOOL_LANG_CXX_CONFIG' => 1,
-                        'm4_pattern_allow' => 1,
-                        'AM_CONDITIONAL' => 1,
-                        'AC_ENABLE_STATIC' => 1,
-                        'LT_CMD_MAX_LEN' => 1,
-                        '_LT_AC_TAGCONFIG' => 1,
-                        '_LT_WITH_SYSROOT' => 1,
+                        'LT_PATH_NM' => 1,
+                        '_AM_SUBST_NOTMAKE' => 1,
+                        'AC_LIBTOOL_SYS_LIB_STRIP' => 1,
+                        'include' => 1,
+                        'AC_LIBLTDL_INSTALLABLE' => 1,
                         '_LT_PROG_FC' => 1,
-                        'AM_DEP_TRACK' => 1,
+                        'LT_SYS_DLOPEN_SELF' => 1,
+                        'LT_FUNC_ARGZ' => 1,
+                        'LT_AC_PROG_RC' => 1,
+                        'LT_CONFIG_LTDL_DIR' => 1,
+                        'AM_PROG_LD' => 1,
+                        'LT_PROG_GO' => 1,
+                        'AC_ENABLE_FAST_INSTALL' => 1,
                         '_LT_AC_LANG_CXX_CONFIG' => 1,
-                        'AC_LIBTOOL_GCJ' => 1,
-                        '_LT_AC_FILE_LTDLL_C' => 1,
+                        'LTOBSOLETE_VERSION' => 1,
+                        'AM_SET_DEPDIR' => 1,
+                        'AC_CONFIG_MACRO_DIR' => 1,
+                        'AM_PROG_CC_C_O' => 1,
+                        'AC_LIBTOOL_SYS_GLOBAL_SYMBOL_PIPE' => 1,
+                        'AM_PROG_INSTALL_SH' => 1,
+                        'AC_WITH_LTDL' => 1,
+                        'AM_SILENT_RULES' => 1,
+                        'AM_RUN_LOG' => 1,
+                        '_LT_LINKER_OPTION' => 1,
+                        'AM_PROG_NM' => 1,
+                        'AC_LTDL_PREOPEN' => 1,
+                        'AC_LIBTOOL_PICMODE' => 1,
                         '_AM_IF_OPTION' => 1,
-                        'AC_LIBTOOL_LANG_RC_CONFIG' => 1,
-                        '_LT_PROG_CXX' => 1,
-                        '_LT_AC_LANG_RC_CONFIG' => 1,
-                        '_AM_MANGLE_OPTION' => 1,
-                        'LT_AC_PROG_SED' => 1,
-                        'AC_LTDL_SYMBOL_USCORE' => 1,
-                        '_AM_SET_OPTION' => 1,
-                        'AC_LIBTOOL_PROG_LD_HARDCODE_LIBPATH' => 1,
-                        'LTOPTIONS_VERSION' => 1,
+                        'AC_PROG_EGREP' => 1,
+                        'AC_LIBTOOL_LINKER_OPTION' => 1,
+                        '_LT_WITH_SYSROOT' => 1,
+                        'AC_CHECK_LIBM' => 1,
+                        'AM_AUTOMAKE_VERSION' => 1,
+                        'LTDL_CONVENIENCE' => 1,
+                        'AC_PROG_LD_GNU' => 1,
+                        'AC_LIBTOOL_PROG_LD_SHLIBS' => 1,
+                        'LT_WITH_LTDL' => 1,
+                        '_LT_COMPILER_BOILERPLATE' => 1,
+                        'AC_LTDL_SYS_DLOPEN_DEPLIBS' => 1,
+                        '_LT_AC_SYS_LIBPATH_AIX' => 1,
+                        'AC_CONFIG_MACRO_DIR_TRACE' => 1,
+                        'LT_SUPPORTED_TAG' => 1,
+                        '_AM_DEPENDENCIES' => 1,
+                        'AC_DISABLE_STATIC' => 1,
+                        'AM_DISABLE_SHARED' => 1,
+                        '_LT_LIBOBJ' => 1,
+                        '_AM_AUTOCONF_VERSION' => 1,
+                        'AM_DEP_TRACK' => 1,
+                        '_AM_OUTPUT_DEPENDENCY_COMMANDS' => 1,
                         'AC_LIBTOOL_RC' => 1,
-                        'LT_PROG_RC' => 1,
-                        'LTDL_INIT' => 1,
-                        'AC_DEFUN_ONCE' => 1,
-                        'AC_LIB_LTDL' => 1,
-                        'AC_LIBTOOL_DLOPEN' => 1,
-                        'AC_LIBTOOL_SYS_HARD_LINK_LOCKS' => 1,
+                        '_LT_AC_LANG_C_CONFIG' => 1,
+                        '_LT_AC_PROG_ECHO_BACKSLASH' => 1,
                         'AM_SET_CURRENT_AUTOMAKE_VERSION' => 1,
-                        'AM_SET_DEPDIR' => 1,
-                        '_LT_AC_SYS_COMPILER' => 1,
-                        'AM_OUTPUT_DEPENDENCY_COMMANDS' => 1,
-                        'AC_LIBTOOL_POSTDEP_PREDEP' => 1,
-                        '_AM_DEPENDENCIES' => 1,
+                        '_LT_DLL_DEF_P' => 1,
+                        'AC_LIBTOOL_SYS_MAX_CMD_LEN' => 1,
+                        '_LTDL_SETUP' => 1,
+                        'AM_SET_LEADING_DOT' => 1,
+                        'AC_LIBTOOL_GCJ' => 1,
+                        'LT_PROG_RC' => 1,
+                        'LTDL_INSTALLABLE' => 1,
+                        'AC_LIBTOOL_PROG_CC_C_O' => 1,
+                        'AC_ENABLE_SHARED' => 1,
+                        '_LT_PROG_LTMAIN' => 1,
+                        '_AC_PROG_LIBTOOL' => 1,
                         'AC_PROG_LD' => 1,
-                        '_LT_AC_LANG_GCJ' => 1,
-                        '_LT_COMPILER_OPTION' => 1,
-                        '_LT_AC_SHELL_INIT' => 1,
-                        '_LT_AC_LOCK' => 1,
-                        'AC_PROG_NM' => 1,
+                        '_AC_AM_CONFIG_HEADER_HOOK' => 1,
                         '_LT_AC_LANG_GCJ_CONFIG' => 1,
-                        'AC_LIBTOOL_LANG_F77_CONFIG' => 1,
-                        'AM_ENABLE_SHARED' => 1,
-                        'AC_LIBTOOL_CXX' => 1,
-                        '_LT_PROG_LTMAIN' => 1,
-                        '_AM_AUTOCONF_VERSION' => 1,
+                        '_LT_AC_TAGVAR' => 1,
                         '_LT_CC_BASENAME' => 1,
-                        'AC_LIBTOOL_SYS_LIB_STRIP' => 1,
-                        'AC_PROG_LIBTOOL' => 1,
-                        'm4_pattern_forbid' => 1,
-                        'LT_PROG_GO' => 1,
-                        'AC_LTDL_PREOPEN' => 1,
-                        'LTVERSION_VERSION' => 1,
-                        'AU_DEFUN' => 1,
-                        '_LT_AC_LANG_C_CONFIG' => 1,
-                        'AC_PROG_EGREP' => 1,
-                        'AC_CONFIG_MACRO_DIR_TRACE' => 1,
-                        'AC_LIBTOOL_LANG_GCJ_CONFIG' => 1
+                        'AC_LIBTOOL_FC' => 1,
+                        'AM_OUTPUT_DEPENDENCY_COMMANDS' => 1
                       }
                     ], 'Autom4te::Request' )
            );
diff --git a/bin/Makefile.am b/bin/Makefile.am
index 486afc0..8bd5a0f 100755
--- a/bin/Makefile.am
+++ b/bin/Makefile.am
@@ -60,7 +60,7 @@ launch = launch.c launch.h
 lib_LTLIBRARIES = libnfdump.la
 libnfdump_la_SOURCES = $(common) $(util) $(filelzo) $(nflist) $(filter) $(exporter)
 #libnfdump_la_LIBADD = -lz
-libnfdump_la_LDFLAGS = -release 1.6.14 -shared 
+libnfdump_la_LDFLAGS = -release 1.6.14
 
 
 nfdump_SOURCES = nfdump.c nfdump.h nfstat.c nfstat.h nfexport.c nfexport.h  \
diff --git a/bin/Makefile.in b/bin/Makefile.in
index cc1ccde..a2d31d2 100644
--- a/bin/Makefile.in
+++ b/bin/Makefile.in
@@ -719,7 +719,7 @@ launch = launch.c launch.h
 lib_LTLIBRARIES = libnfdump.la
 libnfdump_la_SOURCES = $(common) $(util) $(filelzo) $(nflist) $(filter) $(exporter)
 #libnfdump_la_LIBADD = -lz
-libnfdump_la_LDFLAGS = -release 1.6.14 -shared 
+libnfdump_la_LDFLAGS = -release 1.6.14
 nfdump_SOURCES = nfdump.c nfdump.h nfstat.c nfstat.h nfexport.c nfexport.h  \
 	$(nflowcache) $(nfprof)
 
diff --git a/bin/pcap_reader.c b/bin/pcap_reader.c
index 8b0ebfa..363aa4e 100755
--- a/bin/pcap_reader.c
+++ b/bin/pcap_reader.c
@@ -148,6 +148,7 @@ struct sockaddr_in *in_sock = (struct sockaddr_in *)sock;
  	*  extract the first byte and make it the big byte and then extract
  	*  the next byte and make it the small byte.
  	*/
+	REDO_LINK:
 	switch (pkt[12] << 0x08 | pkt[13]) {
 		case 0x0800:
 			/* IPv4 */
@@ -162,8 +163,14 @@ struct sockaddr_in *in_sock = (struct sockaddr_in *)sock;
 			/* ARP */
 			arp_count++;
 			break;
+		case 0x8100: // VLAN 
+			pkt += 4; // strip off vlan
+			printf("Skip VLAN labels\n");
+			goto REDO_LINK;
+			break;
 		default:
 			/* We're not bothering with 802.3 or anything else */
+			printf("PCAP unknown linktype %u%u\n", pkt[12], pkt[13]);
 			unknow_count++;
 			break;
 	}
