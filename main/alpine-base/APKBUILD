# Contributor: Natanael Copa <ncopa@alpinelinux.org>
# Maintainer: Natanael Copa <ncopa@alpinelinux.org>
pkgname=alpine-base
pkgver=3.5.0
pkgrel=1
pkgdesc="Meta package for minimal alpine base"
url="http://alpinelinux.org"
arch="noarch"
pkgusers="mail"
pkggroups="mail www-data"
license="MIT"
options="!check"
depends="alpine-baselayout alpine-conf apk-tools busybox busybox-suid busybox-initscripts
	openrc libc-utils alpine-keys"
makedepends=""
install="$pkgname-mail.pre-install $pkgname-www.pre-install"
subpackages="$pkgname-mail:_mail $pkgname-www:_www"
replaces="alpine-baselayout"
source="$pkgname-mail.aliases"

build() {
	return 0
}

package() {
	mkdir -p "$pkgdir"/etc
	# create /etc/alpine-release
	echo $pkgver > "$pkgdir"/etc/alpine-release

	# create /etc/issue
	cat >"$pkgdir"/etc/issue<<EOF
Welcome to Alpine Linux ${pkgver%.*}
Kernel \\r on an \\m (\\l)

EOF

	_ver="$(echo "$pkgver" | grep -E -o '^[0-9]+\.[0-9]+')"
	# create os-release
	cat >"$pkgdir"/etc/os-release<<EOF
NAME="Alpine Linux"
ID=alpine
VERSION_ID=$pkgver
PRETTY_NAME="Alpine Linux v$_ver"
HOME_URL="http://alpinelinux.org"
BUG_REPORT_URL="http://bugs.alpinelinux.org"
EOF
}

_mail() {
	depends=$pkgname
	pkgdesc="Base layout for smtp servers"
	install -Dm750 -g mail -d "$subpkgdir"/var/spool/mail || return 1
	install -Dm644 "$srcdir"/$subpkgname.aliases "$subpkgdir"/etc/mail/aliases
}

_www() {
	depends=$pkgname
	pkgdesc="Base layout for http servers and webapps"
	install -Dm755 -g www-data -d "$subpkgdir"/var/www/localhost/htdocs
}
sha512sums="a9a0cceee81ff80915484707ce206c13df50fc629a43c20187103716e12779f7e0c044a1aab0fe24f72b7eb9b47cd824de2258e1b5021f29535fa6b6c0f34b01  alpine-base-mail.aliases"
